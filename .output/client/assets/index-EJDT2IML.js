import{h as L,r,t as v,j as e,B as b}from"./main-Cfdx-166.js";import{u as M}from"./index-lXLfk88N.js";import{U}from"./Provider-ByMBYsBJ.js";import{A as $}from"./complete-logo-C9qAcUgu.js";import{L as G}from"./Loading-CBYA94ZU.js";import{F as z,A as H}from"./approve-logo-DmVG-5bx.js";import{A as y}from"./approved-Icon-DeOvi-fV.js";import{V as K}from"./view-icon-BjrB748i.js";import{C as q,a as J,b as W,c as X}from"./card-DY_jjDAj.js";import{C as Q}from"./checkbox-Cqwp9yie.js";import{D as Y,d as Z,a as ee,e as se}from"./dialog-Cl5SrRCX.js";import{S as te}from"./separator-V9LYKW80.js";import{T as ae,a as re,b as oe,c as ie}from"./tooltip-Dk48ikt-.js";import{l as ne,m as le}from"./manage-N6m0a4Rv.js";import{a as ce}from"./statusConstants-CRfW9VUD.js";import{M as me,a as de}from"./ManageCaseHeader-C-iqY6N9.js";import{c as pe,s as xe,f as w}from"./manage-B5DlZb4f.js";import{u as _}from"./useMutation-B1DU5d2J.js";import{D as ue}from"./DocsCommentsSection-BmQlyRR2.js";import{G as fe}from"./GetCaseNotes-DTiXzwk0.js";import{P as ge}from"./PendingStepOverlay-Dz6uvJCx.js";import{U as he}from"./userFileIcon-CjfzYP1T.js";import{X as je}from"./x-OEbIHzu5.js";import{L as ve}from"./loader-circle-CtVpcMqj.js";import"./CaseFilingIcon-B3T83UWb.js";import"./legal-notice-icon-CQRroJUz.js";import"./notes-edit-icon-DR2vjJ_2.js";import"./index-CHQA3myx.js";import"./index-FfAIZCaX.js";import"./index-C_gXUdb4.js";import"./index-hzHaN75t.js";import"./index-DF_xtgj4.js";import"./useUserPermissions-EkOdBJwI.js";import"./userDetails-BK07mqDr.js";import"./pending-icon-DAWTPq6S.js";import"./current-icon-8I7qxN0n.js";import"./chevron-down-CCzDJ7wY.js";import"./createLucideIcon-BmLFQ-XG.js";import"./litigations-CHZYp0Qz.js";import"./fetch-B9iWZIk4.js";import"./useQuery-JrEwn0HC.js";import"./useInfiniteQuery-CsBoIoE-.js";import"./notes-close-icon-DwQRAOm_.js";import"./index-DETgyAaU.js";import"./index-DE95MUWf.js";import"./index-Vwln1SHO.js";import"./textarea-HR3ErcZs.js";import"./fileUpload-C5Dy2rVy.js";import"./apiHelpers-Bpl3N5CG.js";import"./index-CUHrv82z.js";import"./index-BoybbV93.js";import"./check-eR3old9D.js";import"./index-BBlAPqfG.js";import"./notification-Dr26wPLe.js";import"./service-7i-FAUkJ.js";import"./index-BjReNNxi.js";import"./default-user-H6DJgCjJ.js";import"./notes-delete-icon-BGPvWUIE.js";import"./notes-head-icon-B7j4bc-E.js";import"./summary-icon-card-D2HQg2x6.js";import"./avatar-BO1wJRFV.js";import"./input-DYbhqlvz.js";import"./sheet-CMzcKqsy.js";import"./skeleton-CvqsTR7_.js";import"./dayjs.min-CmsQqqGy.js";import"./utc-BVtgXMZy.js";import"./pdf.worker-C_rv1CF2.js";const Es=({stage:c,subStage:n,mappedCaseStagesData:N})=>{const{service_id:m}=L({strict:!1}),[C,x]=r.useState(!1),[o,d]=r.useState(!1),[A,u]=r.useState(""),[f,g]=r.useState(""),[S,p]=r.useState(!1),{allDocsIsFetching:i,allDocsData:a,allRecords:D,getAllDocsRefetch:P,getCaseStagesRefetch:F}=U(),{completeSubStage:R}=M(),{isPrevSubStageCompleted:k,subStageLabel:E}=pe({stage:c,subStage:n,mappedCaseStagesData:N}),I=ce[E],{mutate:T,isPending:h}=_({mutationFn:async s=>{const t=await ne(s);if(t?.status===200||t?.status===201)return t?.data},onSuccess:()=>{},onError:s=>{s.status==422}}),B=s=>{const t=f?.trim();if(t&&t.length<2){v.error("Remarks must be at least 2 characters long.");return}if(t&&t.length>=2){const V=[{title:"DRAFT REMARKS",note:t,type:"CASE_DRAFT_REMARKS",case_id:Number(m),case_sub_stage:n,case_stage:c}];T(V)}const j={case_stage:"CSFG",case_sub_stage:A||"CSFG#DAPT",is_consent_provided:s};O({case_id:String(m),payload:j}),d(s)},{mutate:O,isPending:l}=_({mutationKey:["drafting-consent",m],mutationFn:async({case_id:s,payload:t})=>(await le({case_id:s,payload:t}))?.data,onSuccess:async s=>{await F(),R(n),P(),v.success(s?.message)}});return r.useEffect(()=>{if(i||!Array.isArray(a)||a.length===0){x(!1),d(!1),u("");return}const s=a.find(t=>t.verification_status==="APPROVED");s&&u(s.case_sub_stage),d(a.every(t=>t?.is_consent_provided===!0)),x(a.some(t=>t?.verification_status==="APPROVED"))},[a,i]),e.jsxs("div",{className:"h-full",children:[k?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"px-1 h-full ",children:[e.jsx("div",{className:"",children:e.jsx(me,{caseStage:c,caseSubStage:n,showNoteButton:!1,showUploadButton:!1})}),e.jsx("div",{className:"overflow-auto relative p-2 h-[calc(100%-50px)] w-full",children:i?e.jsx(G,{loading:i,message:"Files..."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`w-full ${D?.length===0?"h-[calc(100%-20px)]":""} `,children:e.jsx("div",{className:"h-full w-full",children:!Array.isArray(a)||a.length===0||a.every(s=>!s.download_url)&&!i?e.jsx("div",{className:"col-span-full text-center text-lg h-full  flex items-center justify-center",children:"Draft document will upload by your Advocate"}):e.jsx("div",{className:"gap-4 h-full overflow-y-auto",children:a?.filter(s=>s.verification_status==="APPROVED").length>0?a?.map(s=>{if(s.verification_status!=="APPROVED")return null;const t=s.file_type==="application/pdf"||s.file_type==="pdf"?"bg-[#F3F3F3]":"bg-gray-100";return e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"py-1",children:s?.category}),e.jsxs(q,{className:"w-56 rounded-none overflow-hidden border border-gray-200",children:[e.jsxs(Y,{children:[e.jsx(Z,{asChild:!0,className:"w-full",children:e.jsxs(J,{className:`${t} relative flex items-center p-0 space-y-0 justify-center min-h-28 w-full`,children:[e.jsx("span",{className:"text-green-600 absolute top-3 right-3",children:s.verification_status==="APPROVED"&&e.jsx(y,{})}),e.jsx(b,{className:"flex items-center justify-center w-full p-0 border-none bg-transparent [&_svg]:size-12","aria-label":"View Image",children:e.jsx(he,{fileType:s.file_type,downloadUrl:s.download_url,fileName:s.file_name})})]})}),e.jsxs(ee,{className:"w-[90%] p-2 gap-0 bg-white","aria-describedby":void 0,children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"text-sm",children:s.file_name}),e.jsx(se,{className:"hover:bg-gray-100 cursor-pointer",children:e.jsx(je,{})})]}),e.jsx("hr",{className:"mt-2 mb-0 border-t-[0.5px] border-gray-200 shadow-none"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"w-3/5 border-r border-gray-200 px-2 py-2 flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-end w-full mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:s.verification_status==="REJECTED"?" bg-red-500 hover:bg-red-500 text-xs px-4 py-2 text-white rounded-none font-primary":s.verification_status==="APPROVED"?" bg-green-500 hover:bg-green-500 text-xs px-2 py-1 text-white rounded-none font-primary":s.verification_status==="PENDING"?" bg-orange-500 hover:bg-orange-500 text-xs px-4 py-1 text-white rounded-none font-primary":" bg-black hover:bg-black text-xs px-4 py-1 text-white rounded-none font-primary",children:s.verification_status?s.verification_status.charAt(0).toUpperCase()+s.verification_status.slice(1).toLowerCase():""}),e.jsx(z,{file:{key:s.key,file_name:s.file_name}})]})}),e.jsx("div",{className:"flex",children:["image","jpg","image/jpeg","image/png","gif","svg","webp"].includes(s.file_type)?e.jsx("img",{src:s.download_url,alt:"Full Image",className:"w-full h-[70vh] object-contain rounded-lg"}):e.jsx("iframe",{src:s.download_url,title:"Full Image",className:"w-full h-[70vh] object-contain rounded-lg"})})]}),e.jsx("div",{className:"w-2/5 flex flex-col",children:e.jsx(ue,{documentId:s.id})})]})]})]}),e.jsxs(W,{className:"flex flex-col px-2 py-2",children:[e.jsx(ae,{children:e.jsxs(re,{children:[e.jsx(oe,{children:e.jsx("div",{className:"font-medium text-start text-xs",children:s?.file_name?xe(s?.file_name,25):null})}),e.jsx(ie,{className:"bg-white border border-gray-200 p-1 ml-10 w-3/4",children:s?.file_name})]})}),e.jsx("div",{className:"text-xs font-light"})]}),e.jsxs(X,{className:"w-full p-2 text-left flex justify-between items-center y",children:[e.jsxs("div",{className:"text-gray-500 hover:text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px]",children:s.updated_at?e.jsx(e.Fragment,{children:w(s.updated_at)}):e.jsx(e.Fragment,{children:w(s.created_at)})}),s.key?e.jsxs(e.Fragment,{children:[e.jsx(te,{orientation:"vertical",className:"h-3 bg-gray-500"}),e.jsxs("span",{className:"text-[11px]",children:[de(s.file_size),"MB"]})]}):""]}),s.key?e.jsx("a",{href:s.download_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(K,{className:"w-4 h-4"})}):null]})]}),C&&e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[o&&!l&&e.jsx(Q,{className:"gap-2 cursor-not-allowed",id:`consent-checkbox-${s.id}`,checked:o}),e.jsx("label",{htmlFor:`consent-checkbox-${s.id}`,className:"text-sm text-gray-700",children:o?"Consent received. The petition will be filed accordingly":"Provide your consent to proceed with filing the petition."})]}),!o&&!l&&e.jsxs(b,{onClick:()=>p(!o),className:`flex items-center font-normal cursor-pointer text-sm w-20 p-2 justify-center gap-2 ${blur} active:scale-95 ease-in-out transition-all duration-300 text-white h-6 rounded-none ${s.is_consent_provided?"bg-green-700 pointer-events-none":"bg-black hover:bg-black/80"}`,children:[s.is_consent_provided?"Accepted":"Accept",s.is_consent_provided&&e.jsx(y,{})]}),l&&e.jsx(ve,{className:"w-4 h-4 mr-2 animate-spin"})]})]},s?.id)}):e.jsx("div",{className:"col-span-full text-center text-lg h-full flex items-center justify-center",children:e.jsx("div",{className:"flex items-center justify-center w-full h-[calc(100%-70px)]",children:"Draft document will upload by your Advocate"})})})})}),e.jsx(fe,{})]})})]})}):e.jsx(ge,{title:I}),e.jsx($,{icon:e.jsx(H,{}),open:S,onOpenChange:p,remarks:f,setRemarks:g,title:"Accept Draft Review",message:"Please review the draft and confirm to proceed. If you have any remarks enter below.",onCancel:()=>{p(!1),g("")},isPending:h,onConfirm:()=>B(!0),requireRemarks:!0,disabled:h||l})]})};export{Es as default};
