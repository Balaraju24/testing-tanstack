import{j as e,r as j,t as x}from"./main-Cfdx-166.js";import{U as N}from"./Provider-ByMBYsBJ.js";import{L as b}from"./Loading-CBYA94ZU.js";import{h as v}from"./fileUpload-C5Dy2rVy.js";import{d as D}from"./apiHelpers-Bpl3N5CG.js";import{u as k}from"./useMutation-B1DU5d2J.js";import{M as _}from"./ManageCaseHeader-C-iqY6N9.js";import{T as h,S as F}from"./TableHeader-sQshSSr-.js";import{d as C}from"./dayjs.min-CmsQqqGy.js";import{E as S}from"./eye-BQaVMbMk.js";import{L as U}from"./loader-circle-CtVpcMqj.js";import{D as A}from"./download-DD_AicsW.js";import"./litigations-CHZYp0Qz.js";import"./fetch-B9iWZIk4.js";import"./manage-N6m0a4Rv.js";import"./useQuery-JrEwn0HC.js";import"./useInfiniteQuery-CsBoIoE-.js";import"./index-FfAIZCaX.js";import"./index-CHQA3myx.js";import"./index-lXLfk88N.js";import"./CaseFilingIcon-B3T83UWb.js";import"./legal-notice-icon-CQRroJUz.js";import"./notes-edit-icon-DR2vjJ_2.js";import"./index-C_gXUdb4.js";import"./index-hzHaN75t.js";import"./index-DF_xtgj4.js";import"./tooltip-Dk48ikt-.js";import"./index-DE95MUWf.js";import"./index-BoybbV93.js";import"./index-BBlAPqfG.js";import"./manage-B5DlZb4f.js";import"./utc-BVtgXMZy.js";import"./useUserPermissions-EkOdBJwI.js";import"./userDetails-BK07mqDr.js";import"./pending-icon-DAWTPq6S.js";import"./approved-Icon-DeOvi-fV.js";import"./current-icon-8I7qxN0n.js";import"./chevron-down-CCzDJ7wY.js";import"./createLucideIcon-BmLFQ-XG.js";import"./complete-logo-C9qAcUgu.js";import"./notes-close-icon-DwQRAOm_.js";import"./index-DETgyAaU.js";import"./index-Vwln1SHO.js";import"./textarea-HR3ErcZs.js";import"./notification-Dr26wPLe.js";import"./service-7i-FAUkJ.js";import"./index-BjReNNxi.js";import"./x-OEbIHzu5.js";import"./default-user-H6DJgCjJ.js";import"./notes-delete-icon-BGPvWUIE.js";import"./notes-head-icon-B7j4bc-E.js";import"./summary-icon-card-D2HQg2x6.js";import"./avatar-BO1wJRFV.js";import"./input-DYbhqlvz.js";import"./sheet-CMzcKqsy.js";import"./skeleton-CvqsTR7_.js";const E=({doc:a,index:n,downloadingDocId:s,isPendingDownloadFile:m,onView:i,onDownload:l})=>e.jsxs("tr",{className:`hover:bg-gray-200 ${n%2===0?"bg-gray-100":"bg-white"}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:C(a.created_at).format("DD MMM YYYY")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsx("div",{className:"truncate w-32",title:a?.file_name||"--",children:a?.file_name||"--"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsx("div",{className:"truncate w-32 cursor-pointer",title:a.document_type,children:a.document_type})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(a.download_url),className:"p-1 hover:bg-gray-300 rounded transition-colors cursor-pointer",title:"View Document",children:e.jsx(S,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>l(a),disabled:m,className:"p-1 hover:bg-gray-300 rounded transition-colors disabled:opacity-50 cursor-pointer",title:"Download Document",children:s===a.id?e.jsx(U,{className:"w-4 h-4 text-gray-600 animate-spin"}):e.jsx(A,{className:"w-4 h-4 text-gray-600"})})]})})]},a.id);function Me({stage:a,subStage:n,isLoading:s=!1}){const[m,i]=j.useState(null),{allDocsIsFetching:l,allDocsData:o}=N(),{mutate:u,isPending:f}=k({mutationFn:async t=>{const r={file_key:t.key},d=await v(r),p=d?.data?.status,c=d?.data?.data?.download_url;if((p===200||p===201)&&c)D(c,t.file_name),i(null);else throw new Error("Invalid response or download URL")},onError:()=>{x.error("Failed to download attachment.")}}),g=t=>{t?window.open(t,"_blank","noopener,noreferrer"):console.error("No download URL available")},w=t=>{t.key?(i(t.id),u({key:t.key,file_name:t.file_name})):x.error("Document key not available for download")},y=()=>s?e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full",children:[e.jsx(h,{}),e.jsx("tbody",{children:Array.from({length:5}).map((t,r)=>e.jsx(F,{index:r},`skeleton-${r}`))})]})}):o?.length===0?e.jsx("div",{className:"px-4 py-5 sm:px-6",children:e.jsx("h3",{className:"text-lg font-normal leading-6 text-gray-900",children:"No Documents Uploaded"})}):e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full",children:[e.jsx(h,{}),e.jsx("tbody",{children:Array.isArray(o)&&o.map((t,r)=>e.jsx(E,{doc:t,index:r,downloadingDocId:m,isPendingDownloadFile:f,onView:g,onDownload:w},t.id))})]})});return e.jsx("div",{className:"h-full relative",children:l?e.jsx(b,{loading:l,message:"Loading documents..."}):e.jsxs(e.Fragment,{children:[e.jsx(_,{caseStage:a,caseSubStage:n,showActionButton:!1,showUploadButton:!1}),e.jsx("div",{className:"p-2 w-full h-max-[calc(100%-60px)] overflow-auto",children:e.jsx("div",{className:"bg-white overflow-hidden",children:y()})}),s?e.jsxs("div",{className:"col-span-12 space-y-2 mt-4 flex flex-col p-4 pt-2",children:[e.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded animate-pulse mb-2"}),e.jsx("div",{className:"bg-gray-50 p-2",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})})]}):o?.length>0&&o[0]?.remarks&&e.jsxs("div",{className:"col-span-12 space-y-2 mt-4 flex flex-col p-4 pt-2",children:[e.jsx("div",{className:"w-full text-sm font-normal text-gray-700 mb-1",children:"Remarks"}),e.jsx("div",{className:"bg-gray-50 p-2 text-gray-700 text-xs 2xl:text-sm",children:o[0].remarks})]})]})})}export{Me as default};
