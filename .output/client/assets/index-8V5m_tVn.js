import{h as $,r as p,t as j,j as e}from"./main-Cfdx-166.js";import{U as P}from"./Provider-ByMBYsBJ.js";import{L as E}from"./Loading-CBYA94ZU.js";import{A as L,E as k}from"./experience-icon-DbUI6Ccl.js";import{D as M}from"./default-user-H6DJgCjJ.js";import{P as O}from"./phone-icon-DAf3Qr9z.js";import{A as U,a as q}from"./avatar-BO1wJRFV.js";import{g as B}from"./advocate-D234CMYd.js";import{m as K}from"./service-7i-FAUkJ.js";import{i as R,M as z}from"./ManageCaseHeader-C-iqY6N9.js";import{u as H}from"./useQuery-JrEwn0HC.js";import{u as Q}from"./useMutation-B1DU5d2J.js";import"./litigations-CHZYp0Qz.js";import"./fetch-B9iWZIk4.js";import"./manage-N6m0a4Rv.js";import"./useInfiniteQuery-CsBoIoE-.js";import"./index-FfAIZCaX.js";import"./index-CHQA3myx.js";import"./index-hzHaN75t.js";import"./index-lXLfk88N.js";import"./CaseFilingIcon-B3T83UWb.js";import"./legal-notice-icon-CQRroJUz.js";import"./notes-edit-icon-DR2vjJ_2.js";import"./index-C_gXUdb4.js";import"./index-DF_xtgj4.js";import"./tooltip-Dk48ikt-.js";import"./index-DE95MUWf.js";import"./index-BoybbV93.js";import"./index-BBlAPqfG.js";import"./manage-B5DlZb4f.js";import"./dayjs.min-CmsQqqGy.js";import"./utc-BVtgXMZy.js";import"./useUserPermissions-EkOdBJwI.js";import"./userDetails-BK07mqDr.js";import"./pending-icon-DAWTPq6S.js";import"./approved-Icon-DeOvi-fV.js";import"./current-icon-8I7qxN0n.js";import"./chevron-down-CCzDJ7wY.js";import"./createLucideIcon-BmLFQ-XG.js";import"./complete-logo-C9qAcUgu.js";import"./notes-close-icon-DwQRAOm_.js";import"./index-DETgyAaU.js";import"./index-Vwln1SHO.js";import"./textarea-HR3ErcZs.js";import"./loader-circle-CtVpcMqj.js";import"./notification-Dr26wPLe.js";import"./fileUpload-C5Dy2rVy.js";import"./index-BjReNNxi.js";import"./x-OEbIHzu5.js";import"./notes-delete-icon-BGPvWUIE.js";import"./notes-head-icon-B7j4bc-E.js";import"./summary-icon-card-D2HQg2x6.js";import"./input-DYbhqlvz.js";import"./sheet-CMzcKqsy.js";import"./skeleton-CvqsTR7_.js";const We=({stage:g,subStage:c})=>{const{service_id:y}=$({strict:!1}),[i,u]=p.useState([]),[x,f]=p.useState(!1),{serviceData:t,setServiceData:A,caseStagesData:_}=P(),d=y,b=t?.service_type==="Legal opinion",w=R(_?.sub_stages,c),h=()=>t?.advocate_cases&&Array.isArray(t.advocate_cases)?t.advocate_cases.filter(s=>s.is_advocate_assigned).map(s=>s.advocate.id):t?.advocate_ids&&Array.isArray(t.advocate_ids)?t.advocate_ids:t?.advocate_id?[t.advocate_id]:[],o=h().length>0,N=t?.advocate_cases?.length,{isLoading:v,data:l}=H({queryKey:["advocate"],queryFn:async()=>{let s={user_type:"ADVOCATE",location_id:t?.location_id};const a=await B(s);if(a.status===200||a.status===201){const{records:n}=a?.data?.data;return{records:n}}},enabled:!0,refetchOnWindowFocus:!1}),m=o?t?.advocate_cases?.map(s=>s.advocate)||[]:l?.records||[],{mutate:S,isPending:r}=Q({mutationKey:["assign-advocates",d],mutationFn:async()=>{if(!d||i.length===0)throw new Error("File ID is missing or no advocates selected");const s={advocate_id:i,stage:g,sub_stage:c};return(await K(d.toString(),s))?.data},onSuccess:s=>{j.success(s?.message);const a=i.map(n=>{const F=l?.records?.find(D=>D.id===n);return{id:Date.now()+n,is_advocate_assigned:!0,advocate_assigned_at:new Date().toISOString(),advocate:F,assigned_by:null}});A({...t,advocate_cases:a,advocate_ids:i,advocate_id:i[0]}),f(!1)},onError:s=>{j.error(s?.message||"Failed to assign advocates. Please try again.")}}),I=s=>{r||u(a=>b?[s]:a.includes(s)?a.filter(n=>n!==s):[...a,s])},C=()=>{S()};return p.useEffect(()=>{const s=h();u(s),s.length===0&&f(!1)},[t?.advocate_cases,t?.advocate_ids,t?.advocate_id]),e.jsx("div",{className:"h-full relative",children:v?e.jsx(E,{loading:v,message:"Loading advocates..."}):e.jsx("div",{className:"h-full px-1",children:e.jsxs("div",{className:"h-full relative",children:[e.jsx(z,{caseStage:g,caseSubStage:c,showActionButton:l?.records?.length===0?!1:o&&!x,showUploadButton:!1,showNoteButton:!1}),m?.length!==0&&!w&&e.jsx("div",{className:"sticky top-0 z-10 bg-white p-2 flex justify-end",children:o&&!x?e.jsx(e.Fragment,{}):e.jsx("button",{className:"bg-black text-white px-3 py-1 text-xs font-normal cursor-pointer disabled:bg-gray-400 flex items-center",onClick:C,disabled:i.length===0||r,"aria-busy":r,"aria-label":r?"Assigning advocates":"Assign advocates",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Assigning..."]}):"Assign Advocate"})}),e.jsx("div",{className:"p-2 w-full h-[calc(100%-100px)] overflow-auto",children:e.jsx("div",{className:"bg-white",children:m?.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(L,{}),e.jsx("span",{className:" text-gray-400 font-normal text-base",children:"No advocates available"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"pt-4 px-2 pb-6",children:e.jsx("div",{className:"grid xl:grid-cols-2 3xl:grid-cols-3 gap-4 max-w-4xl",children:m?.map(s=>{const a=i.includes(s.id);return e.jsxs("div",{className:`bg-white border border-gray-200 transform transition duration-300
                                ${o?"":" hover:shadow-xl"} 
                                ${r?"opacity-50":o?"":"cursor-pointer"} 
                                ${a&&!N?"border rounded-none border-gray-500":""}
                              `,onClick:o||r?void 0:()=>I(s.id),"aria-disabled":r,children:[e.jsxs("div",{className:"flex justify-between p-2",children:[e.jsxs("div",{className:"flex justify-start gap-2 mb-2",children:[e.jsx(U,{className:"h-6 w-6 rounded-full bg-[#F7F7F7] border-grey-800 flex items-center justify-center",children:s?.profile_pic?e.jsx(q,{src:s?.profile_pic,className:"w-6 h-6 rounded-full object-cover"}):e.jsx(M,{className:"w-4 h-4"})}),e.jsx("div",{children:e.jsxs("h3",{className:"text-xs font-normal text-gray-900 leading-tight pt-1 w-40 overflow-ellipsis whitespace-nowrap overflow-hidden cursor-pointer",title:`${s?.first_name} ${s?.last_name}`,children:[s?.first_name," ",s?.last_name]})})]}),e.jsx("div",{className:"ml-3 flex justify-between"})]}),e.jsx("div",{className:`space-y-2 bg-gray-100 p-2 justify-end ${a?"rounded-b-md":""}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-600 ml-2",children:s?.phone?.replace(/^(\+91)(\d{5})(\d{5})$/,"$1 $2$3")}),e.jsxs("div",{className:"ml-auto flex justify-center items-center",children:[e.jsx(k,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"text-xs text-gray-600 ml-1 mt-0.5",children:[s.experience," Yrs"]})]})]})})]},s.id)})})})})})})]})})})};export{We as default};
