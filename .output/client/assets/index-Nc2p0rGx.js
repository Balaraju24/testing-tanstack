import{i as A,u as H,j as t,r as l,a as q,B as S}from"./main-Cfdx-166.js";import{T as K,P as B}from"./TanstackTable-vIi7ShkO.js";import{S as Q,g as J,T as X,G as Z,E as ee,C as te,v as ae,V as se}from"./settings-icon-k7v3dcIJ.js";import{d as ie}from"./litigations-CHZYp0Qz.js";import{D as re}from"./advocate-CZvQPyEV.js";import{u as ne}from"./userDetails-BK07mqDr.js";import{c as f,a as oe}from"./app-BaxlpBql.js";import{N as le}from"./NoDataBlock-gmsqOTLj.js";import{u as E}from"./useUserPermissions-EkOdBJwI.js";import{u as ce}from"./useQuery-JrEwn0HC.js";import{u as me}from"./index-FfAIZCaX.js";import{S as pe}from"./SearchFilter-CucxpMqz.js";import{O as de}from"./OverflowContentTooltip-DQomnG4W.js";import{D as I}from"./default-user-H6DJgCjJ.js";import{V as ue}from"./view-icon-BjrB748i.js";import{A as w,a as ge}from"./avatar-BO1wJRFV.js";import{s as z,c as O}from"./statusConstants-CRfW9VUD.js";import{d as xe}from"./dayjs.min-CmsQqqGy.js";import{S as he}from"./SearchDropdown-9gwCpadL.js";import{P as fe}from"./plus-CqTDA3jy.js";import"./select-CFrWO_XW.js";import"./index-C_gXUdb4.js";import"./index-CHQA3myx.js";import"./index-DE95MUWf.js";import"./index-hzHaN75t.js";import"./index-Vwln1SHO.js";import"./index-BoybbV93.js";import"./index-CUHrv82z.js";import"./index-BBlAPqfG.js";import"./chevron-down-CCzDJ7wY.js";import"./createLucideIcon-BmLFQ-XG.js";import"./check-eR3old9D.js";import"./skeleton-CvqsTR7_.js";import"./input-DYbhqlvz.js";import"./chevron-right-B9rEYsY4.js";import"./calendar-icon-w-TlbBlI.js";import"./litigation-D_lEvaBp.js";import"./legal-notice-icon-CQRroJUz.js";import"./pending-icon-DAWTPq6S.js";import"./approved-Icon-DeOvi-fV.js";import"./current-icon-8I7qxN0n.js";import"./tooltip-Dk48ikt-.js";import"./index-DF_xtgj4.js";import"./x-OEbIHzu5.js";import"./summary-icon-card-D2HQg2x6.js";import"./todo-icon-BiaYQS-5.js";import"./card-DY_jjDAj.js";import"./fetch-B9iWZIk4.js";import"./no-cases-data-1cuEGLat.js";import"./noDataConstants-nJx6rPaL.js";import"./search-BG32cvb7.js";function ve(){const v=A(),o=H(),{isUser:p,isManager:x,isAdvocate:r,isAdmin:i}=E(),_=e=>{if(sessionStorage.setItem("case-origin","legal-opinion"),p()){o({to:`/legal-opinion/service/${e}/user/manage`});return}o({to:`/legal-opinion/service/${e}/manage`})},h=[{accessorFn:e=>e.temp_id,id:"service_id",cell:e=>t.jsx("span",{className:"text-xs  flex gap-2 [&_svg]:size-4 items-center ",children:e.getValue()||"--"}),width:"150px",maxWidth:"150px",minWidth:"150px",header:()=>t.jsx("span",{className:"text-sm  ",children:"File ID"}),footer:e=>e.column.id},{accessorFn:e=>e.organisation_name,id:"organization_name",cell:e=>t.jsx("div",{className:"text-xs  w-36 truncate",title:e.getValue(),children:e.getValue()||"--"}),width:"180px",maxWidth:"180px",minWidth:"180px",header:()=>t.jsx("span",{className:"text-sm  ",children:"Organization"}),footer:e=>e.column.id},{accessorFn:e=>e.stage,id:"status",cell:e=>t.jsx("span",{className:"text-xs  uppercase font-normal",style:{color:z.find(s=>s.value===e.getValue())?.color},children:z.find(s=>s.value===e.getValue())?.label}),width:"150px",maxWidth:"150px",minWidth:"150px",header:()=>t.jsx("span",{className:"text-sm",children:"Stage"}),footer:e=>e.column.id},{accessorFn:e=>e.due_date,id:"due_date",cell:e=>{const s=e.getValue();return t.jsxs("span",{className:"text-xs ",children:[s?xe(s).format("DD MMM YYYY"):"--"," "]})},width:"150px",maxWidth:"150px",minWidth:"150px",header:()=>t.jsx("span",{className:"text-sm  ",children:"Due Date"}),footer:e=>e.column.id},{accessorFn:e=>e.actions,id:"actions",cell:e=>t.jsxs("div",{className:"table-action-buttons flex space-x-3 items-center  cursor-pointer",children:[t.jsx("span",{onClick:()=>{sessionStorage.setItem("case-origin","legal-opinion"),v.navigate({to:`/legal-opinion/service/${e.row.original.id}/notes`})},title:"View Service",children:t.jsx(ue,{className:"size-4"})}),t.jsx("span",{onClick:()=>{_(e.row.original.id)},title:"Manage Service",children:t.jsx(Q,{className:"size-4 text-black"})})]}),header:()=>t.jsx("span",{className:"text-sm  ",children:"Actions"}),footer:e=>e.column.id,width:"120px",minWidth:"120px",maxWidth:"120px"}];return(p()||x()||i())&&h.splice(2,0,{accessorFn:e=>{const s=e.advocate?.first_name?f(e.advocate.first_name):"",u=e.advocate?.last_name?f(e.advocate.last_name):"";return{fullname:`${s} ${u}`.trim(),avatar:e?.advocate?.profile_pic||null}},id:"advocate_name",header:()=>t.jsx("span",{className:"text-sm  ",children:"Advocate"}),footer:e=>e.column.id,width:"180px",maxWidth:"180px",minWidth:"180px",cell:e=>{const{fullname:s,avatar:u}=e.getValue()||{fullname:"--",avatar:null},c=s.trim()===""?"--":s;return t.jsxs("span",{className:"flex gap-2 items-center",children:[u?t.jsx(w,{className:"w-7 h-7 border-0",children:t.jsx(ge,{src:u,className:"object-center"})}):t.jsx(w,{className:"w-7 h-7 flex items-center justify-center rounded-full bg-[#F7F7F7] border border-grey-800",children:t.jsx(I,{className:"w-4 h-4"})}),t.jsx("div",{className:"self-center text-xs truncate w-48",title:c,children:t.jsx(de,{text:c})})]})}}),(r()||x()||i()||p())&&h.splice(2,0,{accessorFn:e=>({fullname:(p()?e.customer_name?f(e.customer_name):"":`${e.user?.first_name?f(e.user.first_name):""} ${e.user?.last_name?f(e.user.last_name):""}`)||"--",avatar:null}),id:"customer_name",cell:e=>{const{fullname:s}=e.getValue()||{fullname:"--"};return t.jsxs("span",{className:"flex gap-2 items-center",children:[t.jsx(w,{className:"w-7 h-7 flex items-center justify-center rounded-full bg-[#F7F7F7] border border-grey-800",children:t.jsx(I,{className:"w-4 h-4"})}),t.jsx("span",{className:"self-center text-xs w-42 truncate",title:s,children:s})]})},width:"220px",maxWidth:"220px",minWidth:"220px",header:()=>t.jsx("span",{className:"text-sm",children:p()?"Customer":"Point of Contact"}),footer:e=>e.column.id}),h}const je=({heightClass:v=re})=>{const o=A(),p=me(),x=l.useRef(!0),r=new URLSearchParams(p.search),[i,_]=l.useState(J()),[h,e]=l.useState(!1),[s,u]=l.useState(r.get("search_string")||""),[c,W]=l.useState(r.get("search_string")||""),[d,j]=l.useState({current_page:Number(r.get("page"))||1,page_size:Number(r.get("page_size"))||15}),{isAdvocate:P,isAdmin:y,isUser:C}=E(),T=q(ne,a=>a.user),[g,D]=l.useState(r.get("status")||""),k=O.find(a=>a.value===g)?.label||"",[F,b]=l.useState(k),$=ve(),{isLoading:V,data:m,refetch:_e}=ce({queryKey:["legalOpinion",d,c,T?.id,i,g],queryFn:async()=>{let a={page:d.current_page,page_size:d.page_size,service_type:"Legal opinion",view:i,...c&&{search_string:c},...g&&{status:g}};o.navigate({to:"/legal-opinion",search:a});const n=await ie(a);if(n.status===200||n.status===201){const{records:Y,pagination_info:N}=n?.data?.data;return{records:oe(Y,N.current_page,N.page_size)||[],pagination_info:N}}},enabled:!!d.current_page,refetchOnWindowFocus:!1}),L=a=>{_(a),ae.setViewState(se.LEGAL_OPINION,a),o.navigate({to:"/legal-opinion",search:{...Object.fromEntries(r),view:a,page:d.current_page,page_size:d.page_size,service_type:"Legal opinion"}})},M=async({page:a,page_size:n})=>{j({current_page:a,page_size:n}),o.navigate({to:"/legal-opinion",search:{...Object.fromEntries(r),page:a,page_size:n,view:i,service_type:"Legal opinion"}})},G=a=>{j(n=>({...n,current_page:a})),o.navigate({to:"/legal-opinion",search:{...Object.fromEntries(r),page:a,view:i,service_type:"Legal opinion"}})},U=a=>{j(n=>({...n,page_size:a,current_page:1})),o.navigate({to:"/legal-opinion",search:{...Object.fromEntries(r),page_size:a,page:1,view:i,service_type:"Legal opinion"}})},R=O.filter(a=>a.label.includes(F));return l.useEffect(()=>{const a=setTimeout(()=>{W(s),x.current?x.current=!1:(j(n=>({...n,current_page:1})),o.navigate({to:"/legal-opinion",search:{...Object.fromEntries(r),search_string:s,page:1,page_size:d.page_size,service_type:"Legal opinion"}}))},1e3);return()=>clearTimeout(a)},[s]),l.useEffect(()=>{e(!0)},[]),t.jsx("div",{className:"overflow-hidden h-full relative",children:h&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center gap-x-8 mb-2 mx-0",children:[t.jsxs("div",{className:"flex items-center border border-gray-200",children:[t.jsx(S,{variant:i==="table"?"default":"outline",size:"sm",onClick:()=>L("table"),className:`h-8 px-3 !rounded-none  cursor-pointer ${i==="table"?"bg-gray-200 text-white":"bg-white-300 text-white hover:bg-gray-50 "}`,children:t.jsx(X,{className:"w-5 h-5"})}),t.jsx(S,{variant:i==="grid"?"default":"outline",size:"sm",onClick:()=>L("grid"),className:`h-8 !rounded-none px-3 cursor-pointer ${i==="grid"?"bg-gray-200 text-white":"bg-white-300 text-white hover:bg-gray-50 "}`,children:t.jsx(Z,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex gap-x-3 ",children:[!C()&&t.jsx(pe,{searchString:s,setSearchString:u,title:"Search by Point of Contact"}),(y()||C())&&t.jsx(he,{options:R,value:g,onSelect:a=>{D(a.value),b(a.label)},onClear:()=>{D(""),b("")},placeholder:"Filter by Status",getOptionLabel:a=>a.label,getOptionKey:a=>a.value,isSelected:a=>a.value===g,width:"w-44",className:"h-9",searchValue:F,onSearchChange:b}),!P()&&!y()&&t.jsx(S,{onClick:()=>o.navigate({to:"/create-legal-opinion"}),className:"bg-black !text-white hover:bg-gray-800 cursor-pointer group focus:ring-none active:scale-95 !rounded-none h-9 px-6 py-0 transition duration-300 text-sm  3xl:text-base font-normal",children:t.jsxs("div",{className:"flex flex-row space-x-1 justify-center items-center  ",children:[t.jsx(fe,{className:"font-extralight w-6 h-6 group-hover:rotate-90 duration-300"}),t.jsx("div",{className:"font-extralight",children:" New Service"})]})})]})]}),i==="table"?t.jsx("div",{children:t.jsx(K,{data:m?.records||[],columns:$,paginationDetails:m?.pagination_info||{},getData:M,loading:V,removeSortingForColumnIds:["service_id","status","due_date","actions","advocate_name","customer_name","organization_name","phone"],heightClass:v,noDataLabel:"legal opinions",noDataDescription:c?"Try adjusting your search criteria":"Get started by creating your first legal opinion",showNoDataIcon:!0,noDataHeight:v||"h-[calc(100vh-170px)]"})}):t.jsxs("div",{className:"flex flex-col h-[calc(100vh-115px)]",children:[t.jsx("div",{className:"flex-1 overflow-y-auto",children:V?t.jsx(ee,{}):m?.records&&m?.records.length>0?t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4  p-0",children:m?.records?.map(a=>t.jsx(te,{record:a},a.id))}):t.jsx("div",{className:"flex justify-center items-center w-full h-120",children:t.jsx(le,{title:"legal opinions",description:c?"Try adjusting your search criteria":"Get started by creating your first legal opinion",hasSearch:!!c,height:"h-full"})})}),m?.records&&m?.records.length>0&&m?.pagination_info&&t.jsx("div",{className:"sticky bottom-0 bg-white",children:t.jsx("div",{className:"flex justify-center items-center gap-4",children:t.jsx(B,{paginationDetails:m?.pagination_info,capturePageNum:G,captureRowPerItems:U})})})]})]})})},jt=je;export{jt as component};
