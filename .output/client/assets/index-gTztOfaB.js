import{h as $,r as p,t as j,j as e}from"./main-CbopZ6M6.js";import{U as P}from"./Provider-BC_HjP_o.js";import{L as E}from"./Loading-DliovM0z.js";import{A as L,E as k}from"./experience-icon-BRuL7537.js";import{D as M}from"./default-user-B5Qt0uKr.js";import{P as O}from"./phone-icon-BN6KEZlh.js";import{A as U,a as q}from"./avatar-I9rQhuEx.js";import{g as B}from"./advocate-DDA6A40v.js";import{m as K}from"./service-Clbc7XwB.js";import{i as R,M as z}from"./ManageCaseHeader-5m-OMl3k.js";import{u as H}from"./useQuery-aXFamHAp.js";import{u as Q}from"./useMutation-AZp6LET6.js";import"./litigations-CmIaLu41.js";import"./fetch-BYBqU-UB.js";import"./manage-UYlebOZ2.js";import"./useInfiniteQuery-DCpiOsiQ.js";import"./index-Bz18Tu21.js";import"./index-DFgmobCw.js";import"./index-BfzcKS58.js";import"./index-9N-Gpv7K.js";import"./CaseFilingIcon-Ki22rwHg.js";import"./legal-notice-icon-DY79a5uN.js";import"./notes-edit-icon-Dx1vAmyL.js";import"./index-CXHJR4o1.js";import"./index-BYuWQ9Ar.js";import"./tooltip-BNtdrHqg.js";import"./index-NA-xklZo.js";import"./index-C-zDLRzy.js";import"./index-CB5qnijn.js";import"./manage-Dtja-RKh.js";import"./dayjs.min-BPVt0UoP.js";import"./utc-YeGeLL22.js";import"./useUserPermissions-DqHuV15h.js";import"./userDetails-BKeSBteA.js";import"./pending-icon-xk-CqbVY.js";import"./approved-Icon-sUM8RCgD.js";import"./current-icon-dhgqbcsv.js";import"./chevron-down-DFI8aQgh.js";import"./createLucideIcon-2fvSvvVa.js";import"./complete-logo-BdyjTQM1.js";import"./notes-close-icon-CZlPG_WL.js";import"./index-Bn1KO0DZ.js";import"./index-BrJXLgSY.js";import"./textarea-DVdyI6Fw.js";import"./loader-circle-CHBElFpm.js";import"./notification-B2GbDUfo.js";import"./fileUpload-CyZu8moV.js";import"./index-BFdYt5ff.js";import"./x-ClszbkRs.js";import"./notes-delete-icon-COtxmY5M.js";import"./notes-head-icon-zA5gOWGa.js";import"./summary-icon-card-x7nT6ld4.js";import"./input-BFw7NH1J.js";import"./sheet-KGfwaNTI.js";import"./skeleton-CGIrBuj0.js";const We=({stage:g,subStage:c})=>{const{service_id:y}=$({strict:!1}),[i,u]=p.useState([]),[x,f]=p.useState(!1),{serviceData:t,setServiceData:A,caseStagesData:_}=P(),d=y,b=t?.service_type==="Legal opinion",w=R(_?.sub_stages,c),h=()=>t?.advocate_cases&&Array.isArray(t.advocate_cases)?t.advocate_cases.filter(s=>s.is_advocate_assigned).map(s=>s.advocate.id):t?.advocate_ids&&Array.isArray(t.advocate_ids)?t.advocate_ids:t?.advocate_id?[t.advocate_id]:[],o=h().length>0,N=t?.advocate_cases?.length,{isLoading:v,data:l}=H({queryKey:["advocate"],queryFn:async()=>{let s={user_type:"ADVOCATE",location_id:t?.location_id};const a=await B(s);if(a.status===200||a.status===201){const{records:n}=a?.data?.data;return{records:n}}},enabled:!0,refetchOnWindowFocus:!1}),m=o?t?.advocate_cases?.map(s=>s.advocate)||[]:l?.records||[],{mutate:S,isPending:r}=Q({mutationKey:["assign-advocates",d],mutationFn:async()=>{if(!d||i.length===0)throw new Error("File ID is missing or no advocates selected");const s={advocate_id:i,stage:g,sub_stage:c};return(await K(d.toString(),s))?.data},onSuccess:s=>{j.success(s?.message);const a=i.map(n=>{const F=l?.records?.find(D=>D.id===n);return{id:Date.now()+n,is_advocate_assigned:!0,advocate_assigned_at:new Date().toISOString(),advocate:F,assigned_by:null}});A({...t,advocate_cases:a,advocate_ids:i,advocate_id:i[0]}),f(!1)},onError:s=>{j.error(s?.message||"Failed to assign advocates. Please try again.")}}),I=s=>{r||u(a=>b?[s]:a.includes(s)?a.filter(n=>n!==s):[...a,s])},C=()=>{S()};return p.useEffect(()=>{const s=h();u(s),s.length===0&&f(!1)},[t?.advocate_cases,t?.advocate_ids,t?.advocate_id]),e.jsx("div",{className:"h-full relative",children:v?e.jsx(E,{loading:v,message:"Loading advocates..."}):e.jsx("div",{className:"h-full px-1",children:e.jsxs("div",{className:"h-full relative",children:[e.jsx(z,{caseStage:g,caseSubStage:c,showActionButton:l?.records?.length===0?!1:o&&!x,showUploadButton:!1,showNoteButton:!1}),m?.length!==0&&!w&&e.jsx("div",{className:"sticky top-0 z-10 bg-white p-2 flex justify-end",children:o&&!x?e.jsx(e.Fragment,{}):e.jsx("button",{className:"bg-black text-white px-3 py-1 text-xs font-normal cursor-pointer disabled:bg-gray-400 flex items-center",onClick:C,disabled:i.length===0||r,"aria-busy":r,"aria-label":r?"Assigning advocates":"Assign advocates",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Assigning..."]}):"Assign Advocate"})}),e.jsx("div",{className:"p-2 w-full h-[calc(100%-100px)] overflow-auto",children:e.jsx("div",{className:"bg-white",children:m?.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(L,{}),e.jsx("span",{className:" text-gray-400 font-normal text-base",children:"No advocates available"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"pt-4 px-2 pb-6",children:e.jsx("div",{className:"grid xl:grid-cols-2 3xl:grid-cols-3 gap-4 max-w-4xl",children:m?.map(s=>{const a=i.includes(s.id);return e.jsxs("div",{className:`bg-white border border-gray-200 transform transition duration-300
                                ${o?"":" hover:shadow-xl"} 
                                ${r?"opacity-50":o?"":"cursor-pointer"} 
                                ${a&&!N?"border rounded-none border-gray-500":""}
                              `,onClick:o||r?void 0:()=>I(s.id),"aria-disabled":r,children:[e.jsxs("div",{className:"flex justify-between p-2",children:[e.jsxs("div",{className:"flex justify-start gap-2 mb-2",children:[e.jsx(U,{className:"h-6 w-6 rounded-full bg-[#F7F7F7] border-grey-800 flex items-center justify-center",children:s?.profile_pic?e.jsx(q,{src:s?.profile_pic,className:"w-6 h-6 rounded-full object-cover"}):e.jsx(M,{className:"w-4 h-4"})}),e.jsx("div",{children:e.jsxs("h3",{className:"text-xs font-normal text-gray-900 leading-tight pt-1 w-40 overflow-ellipsis whitespace-nowrap overflow-hidden cursor-pointer",title:`${s?.first_name} ${s?.last_name}`,children:[s?.first_name," ",s?.last_name]})})]}),e.jsx("div",{className:"ml-3 flex justify-between"})]}),e.jsx("div",{className:`space-y-2 bg-gray-100 p-2 justify-end ${a?"rounded-b-md":""}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-600 ml-2",children:s?.phone?.replace(/^(\+91)(\d{5})(\d{5})$/,"$1 $2$3")}),e.jsxs("div",{className:"ml-auto flex justify-center items-center",children:[e.jsx(k,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{className:"text-xs text-gray-600 ml-1 mt-0.5",children:[s.experience," Yrs"]})]})]})})]},s.id)})})})})})})]})})})};export{We as default};
