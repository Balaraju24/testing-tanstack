import{j as e,a as se,t as x,B as R,r as c}from"./main-CbopZ6M6.js";import{U as te}from"./Provider-BC_HjP_o.js";import{A as re}from"./complete-logo-BdyjTQM1.js";import{A as oe,F as ie}from"./ApproveRejectDialog-BF9KYNd2.js";import{L as ne}from"./Loading-DliovM0z.js";import{F as Y,A as ae}from"./approve-logo-Cvv-fgf8.js";import{P as ce}from"./plus-icon-DTyDVCiO.js";import{A as le,a as de,b as me,c as pe}from"./index-9N-Gpv7K.js";import{e as J,b as ue}from"./fileUpload-CyZu8moV.js";import{i as xe,M as ge}from"./ManageCaseHeader-5m-OMl3k.js";import{u as z}from"./useUserPermissions-DqHuV15h.js";import{u as F}from"./useMutation-AZp6LET6.js";import{G as fe}from"./GetCaseNotes-BQlQ731L.js";import{A as he}from"./approved-Icon-sUM8RCgD.js";import{D as je}from"./delete-stroke-icon-J36fXlMP.js";import{D as Ee,F as _e,d as Ne,c as De,b as Se,a as Ce}from"./DocsCommentsSection-w38vTm24.js";import{R as ve}from"./reject-icon-DuJbt4iK.js";import{V as Ae}from"./view-icon-Ctx0vsE9.js";import{D as Ie,d as be,a as we,c as ye,e as Te}from"./dialog-fcNOpNe_.js";import{T as V,a as B,b as H,c as q,d as Oe}from"./tooltip-BNtdrHqg.js";import{u as Re}from"./userDetails-BKeSBteA.js";import{s as Fe}from"./manage-Dtja-RKh.js";import{X as Pe}from"./x-ClszbkRs.js";import{F as Le}from"./file-text-CUT2TE3F.js";import{C as Ge}from"./chevron-down-DFI8aQgh.js";import"./litigations-CmIaLu41.js";import"./fetch-BYBqU-UB.js";import"./manage-UYlebOZ2.js";import"./useQuery-aXFamHAp.js";import"./useInfiniteQuery-DCpiOsiQ.js";import"./index-Bz18Tu21.js";import"./index-DFgmobCw.js";import"./notes-close-icon-CZlPG_WL.js";import"./index-Bn1KO0DZ.js";import"./index-CXHJR4o1.js";import"./index-NA-xklZo.js";import"./index-BfzcKS58.js";import"./index-BrJXLgSY.js";import"./index-BYuWQ9Ar.js";import"./textarea-DVdyI6Fw.js";import"./loader-circle-CHBElFpm.js";import"./createLucideIcon-2fvSvvVa.js";import"./index-BFdYt5ff.js";import"./file-C6x6tI_M.js";import"./loader-DiNWPT3S.js";import"./apiHelpers-Cq0RJRye.js";import"./CaseFilingIcon-Ki22rwHg.js";import"./legal-notice-icon-DY79a5uN.js";import"./notes-edit-icon-Dx1vAmyL.js";import"./pending-icon-xk-CqbVY.js";import"./current-icon-dhgqbcsv.js";import"./notification-B2GbDUfo.js";import"./service-Clbc7XwB.js";import"./default-user-B5Qt0uKr.js";import"./notes-delete-icon-COtxmY5M.js";import"./notes-head-icon-zA5gOWGa.js";import"./summary-icon-card-x7nT6ld4.js";import"./avatar-I9rQhuEx.js";import"./input-BFw7NH1J.js";import"./sheet-KGfwaNTI.js";import"./skeleton-CGIrBuj0.js";import"./dayjs.min-BPVt0UoP.js";import"./card-Byeow1YH.js";import"./index-C-zDLRzy.js";import"./index-CB5qnijn.js";import"./utc-YeGeLL22.js";const u={IMAGE_TYPES:["image","jpg","jpeg","image/jpeg","image/png","gif","svg","png","webp","image/webp","image/jpg"],PDF_TYPES:["application/pdf","pdf"],AUDIO_TYPES:["audio"],DOCUMENT_TYPES:["document","docx","doc","application/msword"],SPREADSHEET_TYPES:["xlsx","xls","csv"],TEXT_TYPES:["text","txt","text/plain","text/csv"]},d={APPROVED:"APPROVED",REJECTED:"REJECTED",PENDING:"PENDING"},l={NO_MISSING_DOCS_USER:"The advocate has reviewed your case and did not raise any queries. This stage is already completed.",NO_MISSING_DOCS_ADVOCATE:"No missing documents were required for this case. This stage is already completed",NO_MISSING_DOCS_FOUND:"No missing documents found",RAISE_QUERY_MESSAGE:"Raise a query to upload the missing documents",NO_FILES_CATEGORY:"No files available for this category.",LOADING_MESSAGE:"Loading LOD Files",DELETE_CONFIRMATION:"Are you sure want to delete the file",SUCCESS_DELETE:"File deleted successfully",ERROR_DELETE_DEFAULT:"Failed to delete file"},P={FILENAME_SLICE_LENGTH:11,LOADING_TIMEOUT:2e3,GRID_CLASSES:"grid xl:grid-cols-2 2xl:grid-cols-2 3xl:grid-cols-4 gap-1 cursor-pointer"};function Me({className:t}){return e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 48 49",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M7.40782 45.1959C6.21032 45.1959 5.21125 44.7956 4.4106 43.9949C3.60995 43.1943 3.20876 42.1943 3.20703 40.9951V7.80467C3.20703 6.60717 3.60822 5.6081 4.4106 4.80745C5.21298 4.0068 6.21205 3.60561 7.40782 3.60388H40.6008C41.7966 3.60388 42.7957 4.00507 43.5981 4.80745C44.4004 5.60983 44.8008 6.6089 44.799 7.80467V40.9977C44.799 42.1935 44.3987 43.1925 43.5981 43.9949C42.7974 44.7973 41.7975 45.1976 40.5982 45.1959H7.40782ZM7.40782 42.5964H40.6008C40.9994 42.5964 41.366 42.43 41.7004 42.0973C42.0349 41.7645 42.2013 41.3971 42.1995 40.9951V7.80467C42.1995 7.40435 42.0332 7.03695 41.7004 6.70249C41.3677 6.36802 41.0003 6.20165 40.5982 6.20338H7.40782C7.0075 6.20338 6.6401 6.36975 6.30563 6.70249C5.97117 7.03522 5.8048 7.40262 5.80653 7.80467V40.9977C5.80653 41.3963 5.9729 41.7628 6.30563 42.0973C6.63837 42.4317 7.0049 42.5981 7.40522 42.5964M12.3053 36.0976H36.1011L28.7523 26.2975L21.9546 34.8967L17.4055 29.3987L12.3053 36.0976Z",fill:"#353535"})})}function Ue({file:t,index:m,stage:g,subStage:f,isReportingStageCompleted:w,onDeleteFile:h,getAllDocsRefetch:y,setDialogType:v,isCurrentStageCompleted:N}){const{isUser:D}=z(),S=se(Re,s=>s.user),A=s=>u.IMAGE_TYPES.includes(s)?e.jsx(Me,{}):u.PDF_TYPES.includes(s)?e.jsx(_e,{}):u.AUDIO_TYPES.includes(s)?e.jsx(Ne,{}):u.DOCUMENT_TYPES.includes(s)?e.jsx(De,{}):u.SPREADSHEET_TYPES.includes(s)?e.jsx(Se,{}):u.TEXT_TYPES.includes(s)?e.jsx(Le,{}):e.jsx(Ce,{}),{mutate:T,isPending:I}=F({mutationKey:["approve_reject_document"],mutationFn:async({docId:s,verification_status:_})=>await J({payload:{verification_status:_,case_stage:g,case_sub_stage:f},doc_id:s}),onSuccess:s=>{y(),x.success(s?.data?.message,{action:{label:"✕",onClick:()=>x.dismiss()}})},onError:s=>{x.error(s?.data?.errData?.notes?.[0]||"An error occurred")}}),C=s=>{v({docId:s.docId,verification_status:s.verification_status})},j=s=>{T(s)},E=()=>{const s=t.verification_status,_="leading-tight text-xs px-4 py-2 text-white rounded-none font-primary";return s===d.REJECTED?e.jsx("p",{className:`bg-red-500 hover:bg-red-500 ${_}`,children:s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()}):s===d.APPROVED?e.jsx("p",{className:`bg-green-500 hover:bg-green-500 ${_}`,children:s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()}):null},a=()=>D()||t.verification_status!==d.PENDING||N?E():e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{className:"bg-red-500 hover:bg-red-500 border border-red-500 text-white rounded-none text-xs h-7 px-4",onClick:()=>C({docId:t.id,verification_status:d.REJECTED}),children:"Reject"}),e.jsx(R,{className:"bg-green-500 h-7 hover:bg-green-500 text-white-500 text-xs px-4 py-1 text-white rounded-none",onClick:()=>j({docId:t.id,verification_status:d.APPROVED}),disabled:I,children:"Approve"})]}),O=u.IMAGE_TYPES.includes(t.file_type);return t?.file_name?e.jsxs(Ie,{children:[e.jsxs("div",{className:"flex justify-between items-center border border-gray-300 p-2 mb-2 cursor-pointer",children:[e.jsx(be,{className:"w-full cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-1 [&_svg]:size-4 cursor-pointer",children:[A(t.file_type),e.jsx(V,{children:e.jsxs(B,{children:[e.jsx(H,{children:e.jsx("div",{className:"text-sm cursor-pointer",children:Fe(t?.file_name,P.FILENAME_SLICE_LENGTH)})}),e.jsx(q,{className:"bg-white cursor-pointer",children:t?.file_name})]})})]})}),e.jsxs("div",{className:"flex gap-1 items-center",children:[t?.verification_status===d.APPROVED&&e.jsx("span",{className:"text-green-500",children:e.jsx(he,{className:"w-4 h-4"})}),t?.verification_status===d.REJECTED&&e.jsx("span",{className:"text-red-500",children:e.jsx(ve,{})}),e.jsx("div",{className:"bg-gray-100 hover:bg-gray-200 h-7 w-7 flex justify-center items-center",children:e.jsx("a",{href:t.download_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Ae,{className:"w-4 h-4"})})}),e.jsx(Y,{file:{key:t.key,file_name:t.file_name}}),t?.verification_status===d.PENDING&&!N&&t?.uploaded_by===S?.id&&e.jsx(V,{children:e.jsxs(B,{children:[e.jsx(H,{asChild:!0,children:e.jsx("div",{onClick:()=>h(t),className:"cursor-pointer bg-gray-100 hover:bg-gray-200 px-1 py-0.5",children:e.jsx(je,{className:"size-5"})})}),e.jsxs(q,{className:"bg-black text-xs rounded-none text-white px-1 py-1",children:["Delete",e.jsx(Oe,{className:"fill-black"})]})]})})]})]}),e.jsxs(we,{"aria-describedby":void 0,className:"w-[90%] p-2 gap-0 bg-white",children:[e.jsx(ye,{}),e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"text-sm",children:t.file_name}),e.jsx(Te,{className:"border-0 border-gray-300 mt-0 h-fit px-0 py-0 [&_svg]:size-6",children:e.jsx(Pe,{className:"stroke-red-500 cursor-pointer"})})]}),e.jsx("hr",{className:"mt-2 mb-0 border-gray-300"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"w-3/5 px-2 py-2 border-r border-r-gray-300 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-end gap-2 w-full mb-4",children:[e.jsx("div",{children:!D()&&a()}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Y,{file:{key:t.key,file_name:t.file_name}})})]}),e.jsx("div",{className:"flex",children:O?e.jsx("img",{src:t.download_url,alt:"Full Image",className:"w-full h-[70vh] object-contain rounded-lg"}):e.jsx("iframe",{src:t.download_url,title:"Document Preview",className:"w-full h-[70vh] object-contain rounded-lg"})})]}),e.jsx("div",{className:"w-2/5 h-full flex flex-col",children:e.jsx(Ee,{documentId:t.id})})]})]})]},m):null}function $s({stage:t,subStage:m}){const[g,f]=c.useState(null),[w,h]=c.useState(null),[y,v]=c.useState([]),[N,D]=c.useState(""),[S,A]=c.useState(!1),[T,I]=c.useState(""),{isUser:C}=z(),{allDocsIsFetching:j,getAllDocsRefetch:E,allDocsData:a,caseStagesData:O}=te(),s=xe(O?.sub_stages,m),_=()=>h(null),L=()=>f(null),{mutate:G,isPending:M}=F({mutationKey:["deleteFile"],mutationFn:async r=>{const i=a?.find(n=>n.id===r);if(!i?.id)throw new Error("Document ID not found");const o=await ue({docId:i.id,payload:{case_stage:t,case_sub_stage:m}});if(o?.status===200||o?.status===201)return o.data.data;throw new Error(l.ERROR_DELETE_DEFAULT)},onSuccess:()=>{x.success(l.SUCCESS_DELETE,{action:{label:"✕",onClick:()=>x.dismiss()}}),h(null),E()},onError:r=>{}}),{mutate:K,isPending:U}=F({mutationKey:["approve_reject_document"],mutationFn:async({docId:r,verification_status:i})=>{const o=a?.find(ee=>ee.id===r);if(!o?.id)throw new Error("Document ID not found");let n={verification_status:i,case_stage:t,case_sub_stage:m,notes:void 0};return N!==""&&(n={...n,notes:N,type:i}),await J({payload:n,doc_id:o.id})},onSuccess:r=>{E(),x.success(r?.data?.message,{action:{label:"✕",onClick:()=>x.dismiss()}}),f(null),D("")},onError:r=>{I(r?.data?.errData?.notes?.[0])}}),X=()=>{g&&K(g)},Q=()=>{M||G(w?.id)},Z=r=>{h(r)},b=c.useMemo(()=>Array.isArray(a)&&a?.reduce((r,i)=>{if(i.is_requested){const o=i.category||"Uncategorized";r[o]||(r[o]=[]);const n=a.filter(p=>p.category===o&&!p.is_requested);r[o]=n}return r},{})||{},[a]);c.useEffect(()=>{if(a&&b){const r=Object.entries(b).filter(([i,o])=>o.some(n=>n?.file_name)).map(([i])=>i);v(i=>{const o=i.filter(p=>r.includes(p)),n=r.filter(p=>!o.includes(p));return[...o,...n]})}},[a,b]),c.useEffect(()=>{j&&setTimeout(()=>{A(!1)},P.LOADING_TIMEOUT)},[j]);const $=()=>s?e.jsx("div",{className:"h-96 flex justify-center items-center",children:e.jsx("div",{className:"text-center text-base text-gray-500 flex items-center justify-center",children:C()?l.NO_MISSING_DOCS_USER:l.NO_MISSING_DOCS_ADVOCATE})}):e.jsx("div",{className:"h-[calc(100vh-200px)] flex justify-center items-center",children:e.jsx("div",{className:"text-center text-base text-gray-500 flex items-center justify-center",children:C()?l.NO_MISSING_DOCS_FOUND:l.RAISE_QUERY_MESSAGE})}),W=r=>e.jsx("div",{className:P.GRID_CLASSES,children:r.map((i,o)=>e.jsx(Ue,{file:i,index:o,stage:t,subStage:m,isReportingStageCompleted:s,onDeleteFile:Z,getAllDocsRefetch:E,setDialogType:f,isCurrentStageCompleted:s},o))}),k=(r,i)=>s||!(!i||i)?null:e.jsx(R,{className:"bg-black hover:bg-black text-white h-fit rounded-none py-1 px-2",children:e.jsx(ie,{refetch:E,category:r,loading2:S,setLoading2:A,children:e.jsxs("div",{className:"flex gap-1 items-center text-sm",children:[e.jsx(ce,{className:"!h-4 !w-4"})," Upload"]})})});return e.jsxs("div",{className:"h-full overflow-hidden",children:[e.jsx(ge,{caseStage:t,caseSubStage:m,showUploadButton:!1,showActionButton:!C(),showNoteButton:!1}),e.jsxs("div",{className:"p-4 relative h-[calc(100%-30px)] overflow-y-auto",children:[e.jsx("div",{children:S||j?e.jsx(ne,{loading:S||j,message:l.LOADING_MESSAGE}):a?.length===0?$():e.jsx(le,{type:"multiple",className:"space-y-2 w-full",value:y,onValueChange:v,children:Object.entries(b).map(([r,i])=>{const o=i.some(n=>n?.file_name);return e.jsxs(de,{value:r,className:"border border-gray-300 rounded-none p-3",children:[e.jsxs(me,{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center space-x-2 w-full cursor-pointer",children:e.jsx("div",{className:"text-xs font-normal",children:r})}),e.jsxs("div",{className:"flex gap-2 items-center",children:[!o&&!s&&e.jsx("div",{onClick:n=>n.stopPropagation(),children:k(r,o)}),e.jsx(Ge,{className:"cursor-pointer"})]})]}),e.jsxs(pe,{className:"p-2",children:[o?W(i):e.jsx("p",{className:"text-sm text-gray-500",children:l.NO_FILES_CATEGORY}),!s&&o&&e.jsx("div",{className:"mt-2",children:k(r,o)})]})]},r)})})}),e.jsx(re,{icon:e.jsx(ae,{}),open:!!w,onOpenChange:h,title:"Delete File",message:l.DELETE_CONFIRMATION,onCancel:_,isPending:M,onConfirm:Q}),e.jsx(oe,{removeConfirm:!!g,setRemoveConfirm:()=>f(null),onCancel:L,onConfirm:X,isDeleteLoading:U,setApproveRejectReason:D,dialogType:g,appRejError:T,setAppRejError:I,isPending:U}),e.jsx(fe,{})]})]})}export{$s as default};
