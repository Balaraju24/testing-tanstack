var $s=c=>{throw TypeError(c)};var ss=(c,t,e)=>t.has(c)||$s("Cannot "+e);var G=(c,t,e)=>(ss(c,t,"read from private field"),e?e.call(c):t.get(c)),xt=(c,t,e)=>t.has(c)?$s("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(c):t.set(c,e),ft=(c,t,e,s)=>(ss(c,t,"write to private field"),s?s.call(c,e):t.set(c,e),e),St=(c,t,e)=>(ss(c,t,"access private method"),e);var Vs=(c,t,e,s)=>({set _(i){ft(c,t,i,e)},get _(){return G(c,t,s)}});import{j as _,r as Bt,B as ue,k as Ui,t as Ot}from"./main-CbopZ6M6.js";import{u as Wi}from"./useMutation-AZp6LET6.js";import{u as qi}from"./useInfiniteQuery-DCpiOsiQ.js";import{u as Xi}from"./index-Bz18Tu21.js";import{C as Yi}from"./card-Byeow1YH.js";import{T as Ki}from"./textarea-DVdyI6Fw.js";import{g as Zi,d as Qi}from"./fileUpload-CyZu8moV.js";import{d as ke}from"./dayjs.min-BPVt0UoP.js";import{A as Pe,a as Me}from"./avatar-I9rQhuEx.js";import{D as is}from"./default-user-B5Qt0uKr.js";import{c as Ji}from"./createLucideIcon-2fvSvvVa.js";import{L as tn}from"./loader-circle-CHBElFpm.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]],sn=Ji("send-horizontal",en),ct=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),fs=[.001,0,0,.001,0,0],ns=1.35,mt={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ht={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},ci="pdfjs_internal_editor_",O={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},j={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},nn={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},nt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},He={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},J={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Jt={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},We={ERRORS:0,WARNINGS:1,INFOS:5},ye={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Re={moveTo:0,lineTo:1,curveTo:2,closePath:3},rn={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let qe=We.WARNINGS;function an(c){Number.isInteger(c)&&(qe=c)}function on(){return qe}function Xe(c){qe>=We.INFOS&&console.log(`Info: ${c}`)}function B(c){qe>=We.WARNINGS&&console.log(`Warning: ${c}`)}function z(c){throw new Error(c)}function et(c,t){c||z(t)}function ln(c){switch(c?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function di(c,t=null,e=null){if(!c)return null;if(e&&typeof c=="string"&&(e.addDefaultProtocol&&c.startsWith("www.")&&c.match(/\./g)?.length>=2&&(c=`http://${c}`),e.tryConvertEncoding))try{c=fn(c)}catch{}const s=t?URL.parse(c,t):URL.parse(c);return ln(s)?s:null}function ui(c,t,e=!1){const s=URL.parse(c);return s?(s.hash=t,s.href):e&&di(c,"http://example.com")?c.split("#",1)[0]+`${t?`#${t}`:""}`:""}function H(c,t,e,s=!1){return Object.defineProperty(c,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const Yt=(function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t})();class zs extends Yt{constructor(t,e){super(t,"PasswordException"),this.code=e}}class rs extends Yt{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class ps extends Yt{constructor(t){super(t,"InvalidPDFException")}}class Ve extends Yt{constructor(t,e,s){super(t,"ResponseException"),this.status=e,this.missing=s}}class hn extends Yt{constructor(t){super(t,"FormatError")}}class $t extends Yt{constructor(t){super(t,"AbortException")}}function fi(c){(typeof c!="object"||c?.length===void 0)&&z("Invalid argument for bytesToString");const t=c.length,e=8192;if(t<e)return String.fromCharCode.apply(null,c);const s=[];for(let i=0;i<t;i+=e){const n=Math.min(i+e,t),r=c.subarray(i,n);s.push(String.fromCharCode.apply(null,r))}return s.join("")}function ve(c){typeof c!="string"&&z("Invalid argument for stringToBytes");const t=c.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=c.charCodeAt(s)&255;return e}function cn(c){return String.fromCharCode(c>>24&255,c>>16&255,c>>8&255,c&255)}function dn(){const c=new Uint8Array(4);return c[0]=1,new Uint32Array(c.buffer,0,1)[0]===1}function un(){try{return new Function(""),!0}catch{return!1}}class ot{static get isLittleEndian(){return H(this,"isLittleEndian",dn())}static get isEvalSupported(){return H(this,"isEvalSupported",un())}static get isOffscreenCanvasSupported(){return H(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return H(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return H(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return H(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const as=Array.from(Array(256).keys(),c=>c.toString(16).padStart(2,"0"));class M{static makeHexColor(t,e,s){return`#${as[t]}${as[e]}${as[s]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,s=0){const i=t[s],n=t[s+1];t[s]=i*e[0]+n*e[2]+e[4],t[s+1]=i*e[1]+n*e[3]+e[5]}static applyTransformToBezier(t,e,s=0){const i=e[0],n=e[1],r=e[2],a=e[3],o=e[4],l=e[5];for(let h=0;h<6;h+=2){const d=t[s+h],u=t[s+h+1];t[s+h]=d*i+u*r+o,t[s+h+1]=d*n+u*a+l}}static applyInverseTransform(t,e){const s=t[0],i=t[1],n=e[0]*e[3]-e[1]*e[2];t[0]=(s*e[3]-i*e[2]+e[2]*e[5]-e[4]*e[3])/n,t[1]=(-s*e[1]+i*e[0]+e[4]*e[1]-e[5]*e[0])/n}static axialAlignedBoundingBox(t,e,s){const i=e[0],n=e[1],r=e[2],a=e[3],o=e[4],l=e[5],h=t[0],d=t[1],u=t[2],f=t[3];let g=i*h+o,p=g,b=i*u+o,m=b,A=a*d+l,y=A,C=a*f+l,w=C;if(n!==0||r!==0){const v=n*h,x=n*u,S=r*d,E=r*f;g+=S,m+=S,b+=E,p+=E,A+=v,w+=v,C+=x,y+=x}s[0]=Math.min(s[0],g,b,p,m),s[1]=Math.min(s[1],A,C,y,w),s[2]=Math.max(s[2],g,b,p,m),s[3]=Math.max(s[3],A,C,y,w)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const s=t[0],i=t[1],n=t[2],r=t[3],a=s**2+i**2,o=s*n+i*r,l=n**2+r**2,h=(a+l)/2,d=Math.sqrt(h**2-(a*l-o**2));e[0]=Math.sqrt(h+d||1),e[1]=Math.sqrt(h-d||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>i)return null;const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>r?null:[s,n,i,r]}static pointBoundingBox(t,e,s){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}static rectBoundingBox(t,e,s,i,n){n[0]=Math.min(n[0],t,s),n[1]=Math.min(n[1],e,i),n[2]=Math.max(n[2],t,s),n[3]=Math.max(n[3],e,i)}static#t(t,e,s,i,n,r,a,o,l,h){if(l<=0||l>=1)return;const d=1-l,u=l*l,f=u*l,g=d*(d*(d*t+3*l*e)+3*u*s)+f*i,p=d*(d*(d*n+3*l*r)+3*u*a)+f*o;h[0]=Math.min(h[0],g),h[1]=Math.min(h[1],p),h[2]=Math.max(h[2],g),h[3]=Math.max(h[3],p)}static#e(t,e,s,i,n,r,a,o,l,h,d,u){if(Math.abs(l)<1e-12){Math.abs(h)>=1e-12&&this.#t(t,e,s,i,n,r,a,o,-d/h,u);return}const f=h**2-4*d*l;if(f<0)return;const g=Math.sqrt(f),p=2*l;this.#t(t,e,s,i,n,r,a,o,(-h+g)/p,u),this.#t(t,e,s,i,n,r,a,o,(-h-g)/p,u)}static bezierBoundingBox(t,e,s,i,n,r,a,o,l){l[0]=Math.min(l[0],t,a),l[1]=Math.min(l[1],e,o),l[2]=Math.max(l[2],t,a),l[3]=Math.max(l[3],e,o),this.#e(t,s,n,a,e,i,r,o,3*(-t+3*(s-n)+a),6*(t-2*s+n),3*(s-t),l),this.#e(t,s,n,a,e,i,r,o,3*(-e+3*(i-r)+o),6*(e-2*i+r),3*(i-e),l)}}function fn(c){return decodeURIComponent(escape(c))}let os=null,Gs=null;function pn(c){return os||(os=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Gs=new Map([["ﬅ","ſt"]])),c.replaceAll(os,(t,e,s)=>e?e.normalize("NFKC"):Gs.get(s))}function pi(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const c=new Uint8Array(32);return crypto.getRandomValues(c),fi(c)}const xs="pdfjs_internal_id_";function gn(c,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[s,i,...n]=e;if(!c(s)&&!Number.isInteger(s)||!t(i))return!1;const r=n.length;let a=!0;switch(i.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;a=!1;break;default:return!1}for(const o of n)if(!(typeof o=="number"||a&&o===null))return!1;return!0}function dt(c,t,e){return Math.min(Math.max(c,t),e)}function gi(c){return Uint8Array.prototype.toBase64?c.toBase64():btoa(fi(c))}function mn(c){return Uint8Array.fromBase64?Uint8Array.fromBase64(c):ve(atob(c))}typeof Promise.try!="function"&&(Promise.try=function(c,...t){return new Promise(e=>{e(c(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(c){return c.reduce((t,e)=>t+e,0)});const Lt="http://www.w3.org/2000/svg";class ae{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function _e(c,t="text"){if(fe(c,document.baseURI)){const e=await fetch(c);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const i=new XMLHttpRequest;i.open("GET",c,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class xe{constructor({viewBox:t,userUnit:e,scale:s,rotation:i,offsetX:n=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=t,this.userUnit=e,this.scale=s,this.rotation=i,this.offsetX=n,this.offsetY=r,s*=e;const o=(t[2]+t[0])/2,l=(t[3]+t[1])/2;let h,d,u,f;switch(i%=360,i<0&&(i+=360),i){case 180:h=-1,d=0,u=0,f=1;break;case 90:h=0,d=1,u=1,f=0;break;case 270:h=0,d=-1,u=-1,f=0;break;case 0:h=1,d=0,u=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(u=-u,f=-f);let g,p,b,m;h===0?(g=Math.abs(l-t[1])*s+n,p=Math.abs(o-t[0])*s+r,b=(t[3]-t[1])*s,m=(t[2]-t[0])*s):(g=Math.abs(o-t[0])*s+n,p=Math.abs(l-t[1])*s+r,b=(t[2]-t[0])*s,m=(t[3]-t[1])*s),this.transform=[h*s,d*s,u*s,f*s,g-h*s*o-u*s*l,p-d*s*o-f*s*l],this.width=b,this.height=m}get rawDims(){const t=this.viewBox;return H(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new xe({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(t,e){const s=[t,e];return M.applyTransform(s,this.transform),s}convertToViewportRectangle(t){const e=[t[0],t[1]];M.applyTransform(e,this.transform);const s=[t[2],t[3]];return M.applyTransform(s,this.transform),[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){const s=[t,e];return M.applyInverseTransform(s,this.transform),s}}class Ss extends Yt{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Ye(c){const t=c.length;let e=0;for(;e<t&&c[e].trim()==="";)e++;return c.substring(e,e+5).toLowerCase()==="data:"}function Es(c){return typeof c=="string"&&/\.pdf$/i.test(c)}function bn(c){return[c]=c.split(/[#?]/,1),c.substring(c.lastIndexOf("/")+1)}function yn(c,t="document.pdf"){if(typeof c!="string")return t;if(Ye(c))return B('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const s=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(c);if(!s)return t;const i=a=>{try{let o=decodeURIComponent(a);return o.includes("/")?(o=o.split("/").at(-1),o.test(/^\.pdf$/i)?o:a):o}catch{return a}},n=/\.pdf$/i,r=s.pathname.split("/").at(-1);if(n.test(r))return i(r);if(s.searchParams.size>0){const a=Array.from(s.searchParams.values()).reverse();for(const l of a)if(n.test(l))return i(l);const o=Array.from(s.searchParams.keys()).reverse();for(const l of o)if(n.test(l))return i(l)}if(s.hash){const o=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(o)return i(o[0])}return t}class Us{started=Object.create(null);times=[];time(t){t in this.started&&B(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||B(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:i,end:n}of this.times)t.push(`${s.padEnd(e)} ${n-i}ms
`);return t.join("")}}function fe(c,t){const e=t?URL.parse(c,t):URL.parse(c);return e?.protocol==="http:"||e?.protocol==="https:"}function wt(c){c.preventDefault()}function tt(c){c.preventDefault(),c.stopPropagation()}function An(c){console.log("Deprecated API usage: "+c)}class gs{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const s=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let o=parseInt(e[6],10);o=o>=0&&o<=59?o:0;const l=e[7]||"Z";let h=parseInt(e[8],10);h=h>=0&&h<=23?h:0;let d=parseInt(e[9],10)||0;return d=d>=0&&d<=59?d:0,l==="-"?(r+=h,a+=d):l==="+"&&(r-=h,a-=d),new Date(Date.UTC(s,i,n,r,a,o))}}function Cn(c,{scale:t=1,rotation:e=0}){const{width:s,height:i}=c.attributes.style,n=[0,0,parseInt(s),parseInt(i)];return new xe({viewBox:n,userUnit:1,scale:t,rotation:e})}function Ke(c){if(c.startsWith("#")){const t=parseInt(c.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return c.startsWith("rgb(")?c.slice(4,-1).split(",").map(t=>parseInt(t)):c.startsWith("rgba(")?c.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(B(`Not a valid color format: "${c}"`),[0,0,0])}function wn(c){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of c.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;c.set(e,Ke(s))}t.remove()}function W(c){const{a:t,b:e,c:s,d:i,e:n,f:r}=c.getTransform();return[t,e,s,i,n,r]}function Et(c){const{a:t,b:e,c:s,d:i,e:n,f:r}=c.getTransform().invertSelf();return[t,e,s,i,n,r]}function qt(c,t,e=!1,s=!0){if(t instanceof xe){const{pageWidth:i,pageHeight:n}=t.rawDims,{style:r}=c,a=ot.isCSSRoundSupported,o=`var(--total-scale-factor) * ${i}px`,l=`var(--total-scale-factor) * ${n}px`,h=a?`round(down, ${o}, var(--scale-round-x))`:`calc(${o})`,d=a?`round(down, ${l}, var(--scale-round-y))`:`calc(${l})`;!e||t.rotation%180===0?(r.width=h,r.height=d):(r.width=d,r.height=h)}s&&c.setAttribute("data-main-rotation",t.rotation)}class Mt{constructor(){const{pixelRatio:t}=Mt;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,s,i,n=-1){let r=1/0,a=1/0,o=1/0;s=Mt.capPixels(s,n),s>0&&(r=Math.sqrt(s/(t*e))),i!==-1&&(a=i/t,o=i/e);const l=Math.min(r,a,o);return this.sx>l||this.sy>l?(this.sx=l,this.sy=l,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,s):s}return t}}const ms=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class me{#t=null;#e=null;#s;#i=null;#r=null;#n=null;#a=null;static#o=null;constructor(t){this.#s=t,me.#o||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#s._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",wt,{signal:e}),t.addEventListener("pointerdown",me.#l,{signal:e}));const s=this.#i=document.createElement("div");s.className="buttons",t.append(s);const i=this.#s.toolbarPosition;if(i){const{style:n}=t,r=this.#s._uiManager.direction==="ltr"?1-i[0]:i[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#h(t){this.#s._focusEventsAllowed=!1,tt(t)}#u(t){this.#s._focusEventsAllowed=!0,tt(t)}#c(t){const e=this.#s._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#h.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#u.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",wt,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#r?.shown(),this.#n?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#s,s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",me.#o[t]),this.#c(s)&&s.addEventListener("click",i=>{e.delete()},{signal:e._signal}),this.#i.append(s)}get#f(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#c(e),this.#i.append(e,this.#f),this.#r=t}addComment(t){if(this.#n)return;const e=t.render();e&&(this.#c(e),this.#i.append(e,this.#f),this.#n=t,t.toolbar=this)}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#c(e),this.#i.append(e,this.#f)}async addEditSignatureButton(t){const e=this.#a=await t.renderEditButton(this.#s);this.#c(e),this.#i.append(e,this.#f)}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e);break}}updateEditSignatureButton(t){this.#a&&(this.#a.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class vn{#t=null;#e=null;#s;constructor(t){this.#s=t}#i(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#s._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",wt,{signal:e});const s=this.#t=document.createElement("div");return s.className="buttons",t.append(s),this.#s.hasCommentManager()&&this.#n("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#s.commentSelection("floating_button")}),this.#n("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#s.highlightSelection("floating_button")}),t}#r(t,e){let s=0,i=0;for(const n of t){const r=n.y+n.height;if(r<s)continue;const a=n.x+(e?n.width:0);if(r>s){i=a,s=r;continue}e?a>i&&(i=a):a<i&&(i=a)}return[e?1-i:i,s]}show(t,e,s){const[i,n]=this.#r(e,s),{style:r}=this.#e||=this.#i();t.append(this.#e),r.insetInlineEnd=`${100*i}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#n(t,e,s,i){const n=document.createElement("button");n.classList.add("basic",t),n.tabIndex=0,n.setAttribute("data-l10n-id",e);const r=document.createElement("span");n.append(r),r.className="visuallyHidden",r.setAttribute("data-l10n-id",s);const a=this.#s._signal;a instanceof AbortSignal&&!a.aborted&&(n.addEventListener("contextmenu",wt,{signal:a}),n.addEventListener("click",i,{signal:a})),this.#t.append(n)}}function mi(c,t,e){for(const s of e)t.addEventListener(s,c[s].bind(c))}class _n{#t=0;get id(){return`${ci}${this.#t++}`}}class Ts{#t=pi();#e=0;#s=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=t;const n=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return H(this,"_isSVGFittingCanvas",n)}async#i(t,e){this.#s||=new Map;let s=this.#s.get(t);if(s===null)return null;if(s?.bitmap)return s.refCounter+=1,s;try{s||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let i;if(typeof e=="string"?(s.url=e,i=await _e(e,"blob")):e instanceof File?i=s.file=e:e instanceof Blob&&(i=e),i.type==="image/svg+xml"){const n=Ts._isSVGFittingCanvas,r=new FileReader,a=new Image,o=new Promise((l,h)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,l()},r.onload=async()=>{const d=s.svgUrl=r.result;a.src=await n?`${d}#svgView(preserveAspectRatio(none))`:d},a.onerror=r.onerror=h});r.readAsDataURL(i),await o}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){B(i),s=null}return this.#s.set(t,s),s&&this.#s.set(s.id,s),s}async getFromFile(t){const{lastModified:e,name:s,size:i,type:n}=t;return this.#i(`${e}_${s}_${i}_${n}`,t)}async getFromUrl(t){return this.#i(t,t)}async getFromBlob(t,e){const s=await e;return this.#i(t,s)}async getFromId(t){this.#s||=new Map;const e=this.#s.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#s||=new Map;let s=this.#s.get(t);if(s?.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#s.set(t,s),this.#s.set(s.id,s),s}getSvgUrl(t){const e=this.#s.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#s||=new Map;const e=this.#s.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:s}=e;if(!e.url&&!e.file){const i=new OffscreenCanvas(s.width,s.height);i.getContext("bitmaprenderer").transferFromImageBitmap(s),e.blobPromise=i.convertToBlob()}s.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class xn{#t=[];#e=!1;#s;#i=-1;constructor(t=128){this.#s=t}add({cmd:t,undo:e,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(i&&t(),this.#e)return;const o={cmd:t,undo:e,post:s,type:n};if(this.#i===-1){this.#t.length>0&&(this.#t.length=0),this.#i=0,this.#t.push(o);return}if(r&&this.#t[this.#i].type===n){a&&(o.undo=this.#t[this.#i].undo),this.#t[this.#i]=o;return}const l=this.#i+1;l===this.#s?this.#t.splice(0,1):(this.#i=l,l<this.#t.length&&this.#t.splice(l)),this.#t.push(o)}undo(){if(this.#i===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1,this.#i-=1}redo(){if(this.#i<this.#t.length-1){this.#i+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#i];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#t.length-1}cleanType(t){if(this.#i!==-1){for(let e=this.#i;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#i-e),this.#i=e;return}this.#t.length=0,this.#i=-1}}destroy(){this.#t=null}}class Se{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=ot.platform;for(const[s,i,n={}]of t)for(const r of s){const a=r.startsWith("mac+");e&&a?(this.callbacks.set(r.slice(4),{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1))):!e&&!a&&(this.callbacks.set(r,{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(this.#t(e));if(!s)return;const{callback:i,options:{bubbles:n=!1,args:r=[],checker:a=null}}=s;a&&!a(t,e)||(i.bind(t,...r,e)(),n||tt(e))}}class ks{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return wn(t),H(this,"_colors",t)}convert(t){const e=Ke(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,i]of this._colors)if(i.every((n,r)=>n===e[r]))return ks._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?M.makeHexColor(...e):t}}class Vt{#t=new AbortController;#e=null;#s=null;#i=new Map;#r=new Map;#n=null;#a=null;#o=null;#l=new xn;#h=null;#u=null;#c=null;#f=0;#g=new Set;#p=null;#d=null;#m=new Set;_editorUndoBar=null;#A=!1;#b=!1;#w=!1;#v=null;#y=null;#_=null;#k=null;#E=!1;#x=null;#L=new _n;#T=!1;#P=!1;#N=!1;#D=null;#I=null;#F=null;#R=null;#H=null;#S=O.NONE;#C=new Set;#j=null;#$=null;#z=null;#X=null;#W=null;#q={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#O=[0,0];#G=null;#U=null;#Q=null;#J=null;#B=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=Vt.prototype,e=r=>r.#U.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),s=(r,{target:a})=>{if(a instanceof HTMLInputElement){const{type:o}=a;return o!=="text"&&o!=="number"}return!0},i=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return H(this,"_keyboardManager",new Se([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#U.contains(a)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#U.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}constructor(t,e,s,i,n,r,a,o,l,h,d,u,f,g,p,b){const m=this._signal=this.#t.signal;this.#U=t,this.#Q=e,this.#J=s,this.#n=i,this.#h=n,this.#$=r,this.#W=o,this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:m}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:m}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:m}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:m}),a._on("setpreference",this.onSetPreference.bind(this),{signal:m}),a._on("switchannotationeditorparams",A=>this.updateParams(A.type,A.value),{signal:m}),window.addEventListener("pointerdown",()=>{this.#P=!0},{capture:!0,signal:m}),window.addEventListener("pointerup",()=>{this.#P=!1},{capture:!0,signal:m}),this.#lt(),this.#ut(),this.#et(),this.#a=o.annotationStorage,this.#v=o.filterFactory,this.#z=l,this.#k=h||null,this.#A=d,this.#b=u,this.#w=f,this.#H=g||null,this.viewParameters={realScale:ae.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=b!==!1}destroy(){this.#B?.resolve(),this.#B=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#r.values())t.destroy();this.#r.clear(),this.#i.clear(),this.#m.clear(),this.#R?.clear(),this.#e=null,this.#C.clear(),this.#l.destroy(),this.#n?.destroy(),this.#h?.destroy(),this.#$?.destroy(),this.#x?.hide(),this.#x=null,this.#F?.destroy(),this.#F=null,this.#s=null,this.#y&&(clearTimeout(this.#y),this.#y=null),this.#G&&(clearTimeout(this.#G),this.#G=null),this._editorUndoBar?.destroy(),this.#W=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#H}get useNewAltTextFlow(){return this.#b}get useNewAltTextWhenAddingImage(){return this.#w}get hcmFilter(){return H(this,"hcmFilter",this.#z?this.#v.addHCMFilter(this.#z.foreground,this.#z.background):"none")}get direction(){return H(this,"direction",getComputedStyle(this.#U).direction)}get _highlightColors(){return H(this,"_highlightColors",this.#k?new Map(this.#k.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return H(this,"highlightColors",null);const e=new Map,s=!!this.#z;for(const[i,n]of t){const r=i.endsWith("_HCM");if(s&&r){e.set(i.replace("_HCM",""),n);continue}!s&&!r&&e.set(i,n)}return H(this,"highlightColors",e)}get highlightColorNames(){return H(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#c=t}setMainHighlightColorPicker(t){this.#F=t}editAltText(t,e=!1){this.#n?.editAltText(this,t,e)}hasCommentManager(){return!!this.#h}editComment(t,e){this.#h?.open(this,t,e)}getSignature(t){this.#$?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#$}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#w=e;break}}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#U.focus()}findParent(t,e){for(const s of this.#r.values()){const{x:i,y:n,width:r,height:a}=s.div.getBoundingClientRect();if(t>=i&&t<=i+r&&e>=n&&e<=n+a)return s}return null}disableUserSelect(t=!1){this.#Q.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#m.add(t)}removeShouldRescale(t){this.#m.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*ae.PDF_TO_CSS_UNITS;for(const e of this.#m)e.onScaleChanging();this.#c?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#Z({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of this.#r.values())if(s.hasTextLayer(t))return s;return null}highlightSelection(t="",e=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:a}=s,o=s.toString(),h=this.#Z(s).closest(".textLayer"),d=this.getSelectionBoxes(h);if(!d)return;s.empty();const u=this.#tt(h),f=this.#S===O.NONE,g=()=>{const p=u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:d,anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:a,text:o});f&&this.showAllEditors("highlight",!0,!0),e&&p?.editComment()};if(f){this.switchToMode(O.HIGHLIGHT,g);return}g()}commentSelection(t=""){this.highlightSelection(t,!0)}#at(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=this.#Z(t).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(this.#x||=new vn(this),this.#x.show(s,i,this.direction==="ltr"))}addToAnnotationStorage(t){!t.isEmpty()&&this.#a&&!this.#a.has(t.id)&&this.#a.setValue(t.id,t)}a11yAlert(t,e=null){const s=this.#J;s&&(s.setAttribute("data-l10n-id",t),e?s.setAttribute("data-l10n-args",JSON.stringify(e)):s.removeAttribute("data-l10n-args"))}#ot(){const t=document.getSelection();if(!t||t.isCollapsed){this.#j&&(this.#x?.hide(),this.#j=null,this.#M({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#j)return;const i=this.#Z(t).closest(".textLayer");if(!i){this.#j&&(this.#x?.hide(),this.#j=null,this.#M({hasSelectedText:!1}));return}if(this.#x?.hide(),this.#j=e,this.#M({hasSelectedText:!0}),!(this.#S!==O.HIGHLIGHT&&this.#S!==O.NONE)&&(this.#S===O.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#E=this.isShiftKeyDown,!this.isShiftKeyDown)){const n=this.#S===O.HIGHLIGHT?this.#tt(i):null;if(n?.toggleDrawing(),this.#P){const r=new AbortController,a=this.combinedSignal(r),o=l=>{l.type==="pointerup"&&l.button!==0||(r.abort(),n?.toggleDrawing(!0),l.type==="pointerup"&&this.#Y("main_toolbar"))};window.addEventListener("pointerup",o,{signal:a}),window.addEventListener("blur",o,{signal:a})}else n?.toggleDrawing(!0),this.#Y("main_toolbar")}}#Y(t=""){this.#S===O.HIGHLIGHT?this.highlightSelection(t):this.#A&&this.#at()}#lt(){document.addEventListener("selectionchange",this.#ot.bind(this),{signal:this._signal})}#ht(){if(this.#_)return;this.#_=new AbortController;const t=this.combinedSignal(this.#_);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#ct(){this.#_?.abort(),this.#_=null}blur(){if(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#Y("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#C)if(e.div.contains(t)){this.#I=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#I)return;const[t,e]=this.#I;this.#I=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#D)return;this.#D=new AbortController;const t=this.combinedSignal(this.#D);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#dt(){this.#D?.abort(),this.#D=null}#st(){if(this.#u)return;this.#u=new AbortController;const t=this.combinedSignal(this.#u);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#it(){this.#u?.abort(),this.#u=null}#ut(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.#st()}removeEditListeners(){this.#dt(),this.#it()}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of this.#d)if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of this.#d)if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of this.#C){const i=s.serialize(!0);i&&e.push(i)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const n of e.items)for(const r of this.#d)if(r.isHandlingMimeForPasting(n.type)){r.paste(n,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(n){B(`paste: "${n.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const n=[];for(const o of s){const l=await i.deserialize(o);if(!l)return;n.push(l)}const r=()=>{for(const o of n)this.#nt(o);this.#rt(n)},a=()=>{for(const o of n)o.remove()};this.addCommands({cmd:r,undo:a,mustExec:!0})}catch(n){B(`paste: "${n.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#S!==O.NONE&&!this.isEditorHandlingKeyboard&&Vt._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#E&&(this.#E=!1,this.#Y("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#M(t){Object.entries(t).some(([s,i])=>this.#q[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#q,t)}),this.#S===O.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#V([[j.HIGHLIGHT_FREE,!0]]))}#V(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ht(),this.#st(),this.#M({isEditing:this.#S!==O.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:this.#l.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ct(),this.#it(),this.#M({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#d){this.#d=t;for(const e of this.#d)this.#V(e.defaultPropertiesToUpdate)}}getId(){return this.#L.id}get currentLayer(){return this.#r.get(this.#f)}getLayer(t){return this.#r.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#r.set(t.pageIndex,t),this.#T?t.enable():t.disable()}removeLayer(t){this.#r.delete(t.pageIndex)}async updateMode(t,e=null,s=!1,i=!1,n=!1){if(this.#S!==t&&!(this.#B&&(await this.#B.promise,!this.#B))){if(this.#B=Promise.withResolvers(),this.#c?.commitOrRemove(),this.#S===O.POPUP&&this.#h?.hideSidebar(),this.#S=t,t===O.NONE){this.setEditingState(!1),this.#pt(),this._editorUndoBar?.hide(),this.#B.resolve();return}t===O.SIGNATURE&&await this.#$?.loadSignatures(),t===O.POPUP&&(this.#s||=await this.#W.getAnnotationsByType(new Set(this.#d.map(r=>r._editorType))),this.#h?.showSidebar(this.#s)),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const r of this.#r.values())r.updateMode(t);if(!e){s&&this.addNewEditorFromKeyboard(),this.#B.resolve();return}for(const r of this.#i.values())r.annotationElementId===e||r.id===e?(this.setSelected(r),n?r.editComment():i&&r.enterInEditMode()):r.unselect();this.#B.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#S&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#d){switch(t){case j.CREATE:this.currentLayer.addNewEditor(e);return;case j.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#X||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const s of this.#C)s.updateParams(t,e);else for(const s of this.#d)s.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){for(const n of this.#i.values())n.editorType===t&&n.show(e);(this.#X?.get(j.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#V([[j.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#N!==t){this.#N=t;for(const e of this.#r.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#T){this.#T=!0;const t=[];for(const e of this.#r.values())t.push(e.enable());await Promise.all(t);for(const e of this.#i.values())e.enable()}}#pt(){if(this.unselectAll(),this.#T){this.#T=!1;for(const t of this.#r.values())t.disable();for(const t of this.#i.values())t.disable()}}getEditors(t){const e=[];for(const s of this.#i.values())s.pageIndex===t&&e.push(s);return e}getEditor(t){return this.#i.get(t)}addEditor(t){this.#i.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.focusMainContainer(),this.#y=null},0)),this.#i.delete(t.id),t.annotationElementId&&this.#R?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#g.has(t.annotationElementId))&&this.#a?.remove(t.id)}addDeletedAnnotationElement(t){this.#g.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#g.has(t)}removeDeletedAnnotationElement(t){this.#g.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#nt(t){const e=this.#r.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#V(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#C);return t}updateUI(t){this.#gt===t&&this.#V(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#V(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#C.has(t)){this.#C.delete(t),t.unselect(),this.#M({hasSelectedEditor:this.hasSelection});return}this.#C.add(t),t.select(),this.#V(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.id}),this.#c?.commitOrRemove();for(const e of this.#C)e!==t&&e.unselect();this.#C.clear(),this.#C.add(t),t.select(),this.#V(t.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}isSelected(t){return this.#C.has(t)}get firstSelectedEditor(){return this.#C.values().next().value}unselect(t){t.unselect(),this.#C.delete(t),this.#M({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#C.size!==0}get isEnterHandled(){return this.#C.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#l.undo(),this.#M({hasSomethingToUndo:this.#l.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#l.redo(),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:this.#l.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#l.add(t),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#l.cleanType(t)}#K(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(const t of this.#i.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#C],s=()=>{this._editorUndoBar?.show(i,e.length===1?e[0].editorType:e.length);for(const n of e)n.remove()},i=()=>{for(const n of e)this.#nt(n)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#rt(t){for(const e of this.#C)e.unselect();this.#C.clear();for(const e of t)e.isEmpty()||(this.#C.add(e),e.select());this.#M({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#C)t.commit();this.#rt(this.#i.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#S!==O.NONE))&&!this.#c?.commitOrRemove()&&this.hasSelection){for(const t of this.#C)t.unselect();this.#C.clear(),this.#M({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#O[0]+=t,this.#O[1]+=e;const[i,n]=this.#O,r=[...this.#C],a=1e3;this.#G&&clearTimeout(this.#G),this.#G=setTimeout(()=>{this.#G=null,this.#O[0]=this.#O[1]=0,this.addCommands({cmd:()=>{for(const o of r)this.#i.has(o.id)&&(o.translateInPage(i,n),o.translationDone())},undo:()=>{for(const o of r)this.#i.has(o.id)&&(o.translateInPage(-i,-n),o.translationDone())},mustExec:!1})},a);for(const o of r)o.translateInPage(t,e),o.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#p=new Map;for(const t of this.#C)this.#p.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#p)return!1;this.disableUserSelect(!1);const t=this.#p;this.#p=null;let e=!1;for(const[{x:i,y:n,pageIndex:r},a]of t)a.newX=i,a.newY=n,a.newPageIndex=r,e||=i!==a.savedX||n!==a.savedY||r!==a.savedPageIndex;if(!e)return!1;const s=(i,n,r,a)=>{if(this.#i.has(i.id)){const o=this.#r.get(a);o?i._setParentAndPosition(o,n,r):(i.pageIndex=a,i.x=n,i.y=r)}};return this.addCommands({cmd:()=>{for(const[i,{newX:n,newY:r,newPageIndex:a}]of t)s(i,n,r,a)},undo:()=>{for(const[i,{savedX:n,savedY:r,savedPageIndex:a}]of t)s(i,n,r,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#p)for(const s of this.#p.keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#C.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#S}get imageManager(){return H(this,"imageManager",new Ts)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let l=0,h=e.rangeCount;l<h;l++)if(!t.contains(e.getRangeAt(l).commonAncestorContainer))return null;const{x:s,y:i,width:n,height:r}=t.getBoundingClientRect();let a;switch(t.getAttribute("data-main-rotation")){case"90":a=(l,h,d,u)=>({x:(h-i)/r,y:1-(l+d-s)/n,width:u/r,height:d/n});break;case"180":a=(l,h,d,u)=>({x:1-(l+d-s)/n,y:1-(h+u-i)/r,width:d/n,height:u/r});break;case"270":a=(l,h,d,u)=>({x:1-(h+u-i)/r,y:(l-s)/n,width:u/r,height:d/n});break;default:a=(l,h,d,u)=>({x:(l-s)/n,y:(h-i)/r,width:d/n,height:u/r});break}const o=[];for(let l=0,h=e.rangeCount;l<h;l++){const d=e.getRangeAt(l);if(!d.collapsed)for(const{x:u,y:f,width:g,height:p}of d.getClientRects())g===0||p===0||o.push(a(u,f,g,p))}return o.length===0?null:o}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#o||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#o?.delete(t)}renderAnnotationElement(t){const e=this.#o?.get(t.data.id);if(!e)return;const s=this.#a.getRawValue(e);s&&(this.#S===O.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}setMissingCanvas(t,e,s){const i=this.#R?.get(t);i&&(i.setCanvas(e,s),this.#R.delete(t))}addMissingCanvas(t,e){(this.#R||=new Map).set(t,e)}}class Pt{#t=null;#e=!1;#s=null;#i=null;#r=null;#n=null;#a=!1;#o=null;#l=null;#h=null;#u=null;#c=!1;static#f=null;static _l10n=null;constructor(t){this.#l=t,this.#c=t._uiManager.useNewAltTextFlow,Pt.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){Pt._l10n??=t}async render(){const t=this.#s=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#i=document.createElement("span");t.append(e),this.#c?(t.classList.add("new"),t.setAttribute("data-l10n-id",Pt.#f.missing),e.setAttribute("data-l10n-id",Pt.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=this.#l._uiManager._signal;t.addEventListener("contextmenu",wt,{signal:s}),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),this.#l._uiManager.editAltText(this.#l),this.#c&&this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(this.#a=!0,i(n))},{signal:s}),await this.#p(),t}get#g(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#s&&(this.#s.focus({focusVisible:this.#a}),this.#a=!1)}isEmpty(){return this.#c?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#c?this.#t!==null||!!this.#h:this.isEmpty()}get guessedText(){return this.#h}async setGuessedText(t){this.#t===null&&(this.#h=t,this.#u=await Pt._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#p())}toggleAltTextBadge(t=!1){if(!this.#c||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#l.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#h===e&&(e=this.#u),{altText:e,decorative:this.#e,guessedText:this.#h,textWithDisclaimer:this.#u}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:i,cancel:n=!1}){s&&(this.#h=s,this.#u=i),!(this.#t===t&&this.#e===e)&&(n||(this.#t=t,this.#e=e),this.#p())}toggle(t=!1){this.#s&&(!t&&this.#n&&(clearTimeout(this.#n),this.#n=null),this.#s.disabled=!t)}shown(){this.#l._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#s?.remove(),this.#s=null,this.#i=null,this.#r=null,this.#o?.remove(),this.#o=null}async#p(){const t=this.#s;if(!t)return;if(this.#c){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",Pt.#f[this.#g]),this.#i?.setAttribute("data-l10n-id",Pt.#f[`${this.#g}-label`]),!this.#t){this.#r?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#r?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#r;if(!e){this.#r=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#l.id}`;const i=100,n=this.#l._uiManager._signal;n.addEventListener("abort",()=>{clearTimeout(this.#n),this.#n=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#n=setTimeout(()=>{this.#n=null,this.#r.classList.add("show"),this.#l._reportTelemetry({action:"alt_text_tooltip"})},i)},{signal:n}),t.addEventListener("mouseleave",()=>{this.#n&&(clearTimeout(this.#n),this.#n=null),this.#r?.classList.remove("show")},{signal:n})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#l.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class Le{#t=null;#e=!1;#s=null;#i=null;#r=null;#n=null;#a=!1;constructor(t){this.#s=t,this.toolbar=null}render(){if(!this.#s._uiManager.hasCommentManager())return null;const t=this.#t=document.createElement("button");t.className="comment",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button");const e=this.#s._uiManager._signal;if(!(e instanceof AbortSignal)||e.aborted)return t;t.addEventListener("contextmenu",wt,{signal:e}),t.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:e});const s=i=>{i.preventDefault(),this.edit()};return t.addEventListener("click",s,{capture:!0,signal:e}),t.addEventListener("keydown",i=>{i.target===t&&i.key==="Enter"&&(this.#e=!0,s(i))},{signal:e}),t}edit(){const{bottom:t,left:e,right:s}=this.#s.getClientDimensions(),i={top:t};this.#s._uiManager.direction==="ltr"?i.right=s:i.left=e,this.#s._uiManager.editComment(this.#s,i)}finish(){this.#t&&(this.#t.focus({focusVisible:this.#e}),this.#e=!1)}isDeleted(){return this.#a||this.#r===""}hasBeenEdited(){return this.isDeleted()||this.#r!==this.#i}serialize(){return this.data}get data(){return{text:this.#r,date:this.#n,deleted:this.#a}}set data(t){if(t===null){this.#r="",this.#a=!0;return}this.#r=t,this.#n=new Date,this.#a=!1}setInitialText(t){this.#i=t,this.data=t}toggle(t=!1){this.#t&&(this.#t.disabled=!t)}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#r="",this.#n=null,this.#s=null,this.#e=!1,this.#a=!1}}class Ze{#t;#e=!1;#s=null;#i;#r;#n;#a;#o=null;#l;#h=null;#u;#c=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:r=null,signal:a}){this.#t=t,this.#s=s,this.#i=e,this.#r=i,this.#n=n,this.#a=r,this.#u=new AbortController,this.#l=AbortSignal.any([a,this.#u.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#l})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Mt.pixelRatio}#f(t){if(this.#i?.())return;if(t.touches.length===1){if(this.#o)return;const i=this.#o=new AbortController,n=AbortSignal.any([this.#l,i.signal]),r=this.#t,a={capture:!0,signal:n,passive:!1},o=l=>{l.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};r.addEventListener("pointerdown",l=>{l.pointerType==="touch"&&(tt(l),o(l))},a),r.addEventListener("pointerup",o,a),r.addEventListener("pointercancel",o,a);return}if(!this.#c){this.#c=new AbortController;const i=AbortSignal.any([this.#l,this.#c.signal]),n=this.#t,r={signal:i,capture:!1,passive:!1};n.addEventListener("touchmove",this.#g.bind(this),r);const a=this.#p.bind(this);n.addEventListener("touchend",a,r),n.addEventListener("touchcancel",a,r),r.capture=!0,n.addEventListener("pointerdown",tt,r),n.addEventListener("pointermove",tt,r),n.addEventListener("pointercancel",tt,r),n.addEventListener("pointerup",tt,r),this.#r?.()}if(tt(t),t.touches.length!==2||this.#s?.()){this.#h=null;return}let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]),this.#h={touch0X:e.screenX,touch0Y:e.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#g(t){if(!this.#h||t.touches.length!==2)return;tt(t);let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]);const{screenX:i,screenY:n}=e,{screenX:r,screenY:a}=s,o=this.#h,{touch0X:l,touch0Y:h,touch1X:d,touch1Y:u}=o,f=d-l,g=u-h,p=r-i,b=a-n,m=Math.hypot(p,b)||1,A=Math.hypot(f,g)||1;if(!this.#e&&Math.abs(A-m)<=Ze.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(o.touch0X=i,o.touch0Y=n,o.touch1X=r,o.touch1Y=a,!this.#e){this.#e=!0;return}const y=[(i+r)/2,(n+a)/2];this.#n?.(y,A,m)}#p(t){t.touches.length>=2||(this.#c&&(this.#c.abort(),this.#c=null,this.#a?.()),this.#h&&(tt(t),this.#h=null,this.#e=!1))}destroy(){this.#u?.abort(),this.#u=null,this.#o?.abort(),this.#o=null}}class I{#t=null;#e=null;#s=null;#i=null;#r=!1;#n=null;#a="";#o=!1;#l=null;#h=null;#u=null;#c=null;#f="";#g=!1;#p=null;#d=!1;#m=!1;#A=!1;#b=null;#w=0;#v=0;#y=null;#_=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#k=!1;#E=I._zIndex++;static _borderLineWidth=-1;static _colorManager=new ks;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=I.prototype._resizeWithKeyboard,e=Vt.TRANSLATE_SMALL,s=Vt.TRANSLATE_BIG;return H(this,"_resizerKeyboardManager",new Se([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],I.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null;const{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[n,r];const[a,o]=this.parentDimensions;this.x=t.x/a,this.y=t.y/o,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return H(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new Sn({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(I._l10n??=t,I._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),I._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);I._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){z("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#k}set _isDraggable(t){this.#k=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#E}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#O(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){const[n,r]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(t+s)/n,this.y=(e+i)/r,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[s,i]=this.parentDimensions;this.setAt(t*s,e*i,this.width*s,this.height*i),this._onTranslated()}#x([t,e],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/t,this.y+=i/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#x(this.parentDimensions,t,e)}translateInPage(t,e){this.#p||=[this.x,this.y,this.width,this.height],this.#x(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#p||=[this.x,this.y,this.width,this.height];const{div:s,parentDimensions:[i,n]}=this;if(this.x+=t/i,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:u}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this;const[o,l]=this.getBaseTranslation();r+=o,a+=l;const{style:h}=s;h.left=`${(100*r).toFixed(2)}%`,h.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#p&&(this.#p[0]!==this.x||this.#p[1]!==this.y)}get _hasBeenResized(){return!!this.#p&&(this.#p[2]!==this.width||this.#p[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=I,i=s/t,n=s/e;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,i]}=this;let{x:n,y:r,width:a,height:o}=this;if(a*=s,o*=i,n*=s,r*=i,this._mustFixPosition)switch(t){case 0:n=dt(n,0,s-a),r=dt(r,0,i-o);break;case 90:n=dt(n,0,s-o),r=dt(r,a,i);break;case 180:n=dt(n,a,s),r=dt(r,o,i);break;case 270:n=dt(n,o,s),r=dt(r,0,i-a);break}this.x=n/=s,this.y=r/=i;const[l,h]=this.getBaseTranslation();n+=l,r+=h,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#L(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return I.#L(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return I.#L(t,e,360-this.parentRotation)}#T(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(t,e){const[s,i]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*t/s).toFixed(2)}%`,this.#o||(n.height=`${(100*e/i).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:s}=t,i=s.endsWith("%"),n=!this.#o&&e.endsWith("%");if(i&&n)return;const[r,a]=this.parentDimensions;i||(t.width=`${(100*parseFloat(s)/r).toFixed(2)}%`),!this.#o&&!n&&(t.height=`${(100*parseFloat(e)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#P(){if(this.#l)return;this.#l=document.createElement("div"),this.#l.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const i=document.createElement("div");this.#l.append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",this.#N.bind(this,s),{signal:e}),i.addEventListener("contextmenu",wt,{signal:e}),i.tabIndex=-1}this.div.prepend(this.#l)}#N(t,e){e.preventDefault();const{isMac:s}=ot.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#s?.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,this.#h=[e.screenX,e.screenY];const n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#F.bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",tt,{passive:!1,signal:r}),window.addEventListener("contextmenu",wt,{signal:r}),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,o=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const l=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#s?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=o,this.#I()};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})}#D(t,e,s,i){this.width=s,this.height=i,this.x=t,this.y=e;const[n,r]=this.parentDimensions;this.setDims(n*s,r*i),this.fixAndSetPosition(),this._onResized()}_onResized(){}#I(){if(!this.#u)return;const{savedX:t,savedY:e,savedWidth:s,savedHeight:i}=this.#u;this.#u=null;const n=this.x,r=this.y,a=this.width,o=this.height;n===t&&r===e&&a===s&&o===i||this.addCommands({cmd:this.#D.bind(this,n,r,a,o),undo:this.#D.bind(this,t,e,s,i),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#F(t,e){const[s,i]=this.parentDimensions,n=this.x,r=this.y,a=this.width,o=this.height,l=I.MIN_SIZE/s,h=I.MIN_SIZE/i,d=this.#T(this.rotation),u=(R,L)=>[d[0]*R+d[2]*L,d[1]*R+d[3]*L],f=this.#T(360-this.rotation),g=(R,L)=>[f[0]*R+f[2]*L,f[1]*R+f[3]*L];let p,b,m=!1,A=!1;switch(t){case"topLeft":m=!0,p=(R,L)=>[0,0],b=(R,L)=>[R,L];break;case"topMiddle":p=(R,L)=>[R/2,0],b=(R,L)=>[R/2,L];break;case"topRight":m=!0,p=(R,L)=>[R,0],b=(R,L)=>[0,L];break;case"middleRight":A=!0,p=(R,L)=>[R,L/2],b=(R,L)=>[0,L/2];break;case"bottomRight":m=!0,p=(R,L)=>[R,L],b=(R,L)=>[0,0];break;case"bottomMiddle":p=(R,L)=>[R/2,L],b=(R,L)=>[R/2,0];break;case"bottomLeft":m=!0,p=(R,L)=>[0,L],b=(R,L)=>[R,0];break;case"middleLeft":A=!0,p=(R,L)=>[0,L/2],b=(R,L)=>[R,L/2];break}const y=p(a,o),C=b(a,o);let w=u(...C);const v=I._round(n+w[0]),x=I._round(r+w[1]);let S=1,E=1,D,T;if(e.fromKeyboard)({deltaX:D,deltaY:T}=e);else{const{screenX:R,screenY:L}=e,[q,lt]=this.#h;[D,T]=this.screenToPageTranslation(R-q,L-lt),this.#h[0]=R,this.#h[1]=L}if([D,T]=g(D/s,T/i),m){const R=Math.hypot(a,o);S=E=Math.max(Math.min(Math.hypot(C[0]-y[0]-D,C[1]-y[1]-T)/R,1/a,1/o),l/a,h/o)}else A?S=dt(Math.abs(C[0]-y[0]-D),l,1)/a:E=dt(Math.abs(C[1]-y[1]-T),h,1)/o;const V=I._round(a*S),P=I._round(o*E);w=u(...b(V,P));const N=v-w[0],$=x-w[1];this.#p||=[this.x,this.y,this.width,this.height],this.width=V,this.height=P,this.x=N,this.y=$,this.setDims(s*V,i*P),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#s?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#m)return this._editToolbar;this._editToolbar=new me(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,s]of t)await this._editToolbar.addButton(e,s);return this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#s?.destroy())}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#s||(Pt.initialize(I._l10n),this.#s=new Pt(this),this.#t&&(this.#s.data=this.#t,this.#t=null)),this.#s}get altTextData(){return this.#s?.data}set altTextData(t){this.#s&&(this.#s.data=t)}get guessedAltText(){return this.#s?.guessedText}async setGuessedAltText(t){await this.#s?.setGuessedText(t)}serializeAltText(t){return this.#s?.serialize(t)}hasAltText(){return!!this.#s&&!this.#s.isEmpty()}hasAltTextData(){return this.#s?.hasData()??!1}addCommentButton(){return this.#i?this.#i:this.#i=new Le(this)}get commentColor(){return null}get comment(){const t=this.#i;return{text:t.data.text,date:t.data.date,deleted:t.isDeleted(),color:this.commentColor}}set comment(t){this.#i||(this.#i=new Le(this)),this.#i.data=t}setCommentData(t){this.#i||(this.#i=new Le(this)),this.#i.setInitialText(t)}get hasEditedComment(){return this.#i?.hasBeenEdited()}async editComment(){this.#i||(this.#i=new Le(this)),this.#i.edit()}addComment(t){if(this.hasEditedComment){const[,,,i]=t.rect,[n]=this.pageDimensions,[r]=this.pageTranslation,a=r+n+1,o=i-100,l=a+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[a,o,l,i]}}}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#r?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#$();const[e,s]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*s/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/s).toFixed(2)}%`);const[i,n]=this.getInitialTranslation();return this.translate(i,n),mi(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#_||=new Ze({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#R.bind(this),onPinching:this.#H.bind(this),onPinchEnd:this.#S.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),t}#R(){this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#s?.toggle(!1),this.parent.togglePointerEvents(!1)}#H(t,e,s){let n=.7*(s/e)+1-.7;if(n===1)return;const r=this.#T(this.rotation),a=(v,x)=>[r[0]*v+r[2]*x,r[1]*v+r[3]*x],[o,l]=this.parentDimensions,h=this.x,d=this.y,u=this.width,f=this.height,g=I.MIN_SIZE/o,p=I.MIN_SIZE/l;n=Math.max(Math.min(n,1/u,1/f),g/u,p/f);const b=I._round(u*n),m=I._round(f*n);if(b===u&&m===f)return;this.#p||=[h,d,u,f];const A=a(u/2,f/2),y=I._round(h+A[0]),C=I._round(d+A[1]),w=a(b/2,m/2);this.x=y-w[0],this.y=C-w[1],this.width=b,this.height=m,this.setDims(o*b,l*m),this.fixAndSetPosition(),this._onResizing()}#S(){this.#s?.toggle(!0),this.parent.togglePointerEvents(!0),this.#I()}pointerdown(t){const{isMac:e}=ot.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#j(t);return}this.#C(t)}#C(t){const{isMac:e}=ot.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#j(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,n=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:n},a=l=>{i.abort(),this.#n=null,this.#g=!1,this._uiManager.endDragSession()||this.#C(l),s&&this._onStopDragging()};e&&(this.#w=t.clientX,this.#v=t.clientY,this.#n=t.pointerId,this.#a=t.pointerType,window.addEventListener("pointermove",l=>{s||(s=!0,this._onStartDragging());const{clientX:h,clientY:d,pointerId:u}=l;if(u!==this.#n){tt(l);return}const[f,g]=this.screenToPageTranslation(h-this.#w,d-this.#v);this.#w=h,this.#v=d,this._uiManager.dragSelectedEditors(f,g)},r),window.addEventListener("touchmove",tt,r),window.addEventListener("pointerdown",l=>{l.pointerType===this.#a&&(this.#_||l.isPrimary)&&a(l),tt(l)},r));const o=l=>{if(!this.#n||this.#n===l.pointerId){a(l);return}tt(l)};window.addEventListener("pointerup",o,{signal:n}),window.addEventListener("blur",o,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#b&&clearTimeout(this.#b),this.#b=setTimeout(()=>{this.#b=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const i=this.parentScale,[n,r]=this.pageDimensions,[a,o]=this.pageTranslation,l=t/i,h=e/i,d=this.x*n,u=this.y*r,f=this.width*n,g=this.height*r;switch(s){case 0:return[d+l+a,r-u-h-g+o,d+l+f+a,r-u-h+o];case 90:return[d+h+a,r-u+l+o,d+h+g+a,r-u+l+f+o];case 180:return[d-l-f+a,r-u+h+o,d-l+a,r-u+h+g+o];case 270:return[d-h-g+a,r-u-l-f+o,d-h+a,r-u-l+o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,i,n,r]=t,a=n-s,o=r-i;switch(this.rotation){case 0:return[s,e-r,a,o];case 90:return[s,e-i,o,a];case 180:return[n,e-i,a,o];case 270:return[n,e-r,o,a];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#m=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#m=!1,!0):!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#A}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return e<r&&i>0&&t<n&&s>0}#$(){if(this.#c||!this.div)return;this.#c=new AbortController;const t=this._uiManager.combinedSignal(this.#c);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#$()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){z("An editor must be serializable")}static async deserialize(t,e,s){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s,annotationElementId:t.annotationElementId});i.rotation=t.rotation,i.#t=t.accessibilityData,i._isCopy=t.isCopy||!1;const[n,r]=i.pageDimensions,[a,o,l,h]=i.getRectInCurrentCoords(t.rect,r);return i.x=a/n,i.y=o/r,i.width=l/n,i.height=h/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#c?.abort(),this.#c=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#b&&(clearTimeout(this.#b),this.#b=null),this.#O(),this.removeEditToolbar(),this.#y){for(const t of this.#y.values())clearTimeout(t);this.#y=null}this.parent=null,this.#_?.destroy(),this.#_=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#P(),this.#l.classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#l.children;if(!this.#e){this.#e=Array.from(e);const r=this.#z.bind(this),a=this.#X.bind(this),o=this._uiManager._signal;for(const l of this.#e){const h=l.getAttribute("data-resizer-name");l.setAttribute("role","spinbutton"),l.addEventListener("keydown",r,{signal:o}),l.addEventListener("blur",a,{signal:o}),l.addEventListener("focus",this.#W.bind(this,h),{signal:o}),l.setAttribute("data-l10n-id",I._l10nResizer[h])}}const s=this.#e[0];let i=0;for(const r of e){if(r===s)break;i++}const n=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(n!==i){if(n<i)for(let a=0;a<i-n;a++)this.#l.append(this.#l.firstChild);else if(n>i)for(let a=0;a<n-i;a++)this.#l.firstChild.before(this.#l.lastChild);let r=0;for(const a of e){const l=this.#e[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",I._l10nResizer[l])}}this.#q(0),this.#A=!0,this.#l.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#z(t){I._resizerKeyboardManager.exec(this,t)}#X(t){this.#A&&t.relatedTarget?.parentNode!==this.#l&&this.#O()}#W(t){this.#f=this.#A?t:""}#q(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#A&&this.#F(this.#f,{deltaX:t,deltaY:e,fromKeyboard:!0})}#O(){this.#A=!1,this.#q(-1),this.#I()}_stopResizingWithKeyboard(){this.#O(),this.div.focus()}select(){if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#s?.toggleAltTextBadge(!1)}}unselect(){this.isSelected&&(this.isSelected=!1,this.#l?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#s?.toggleAltTextBadge(!0))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#d}set isEditing(t){this.#d=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#o=!0;const s=t/e,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#y||=new Map;const{action:s}=t;let i=this.#y.get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),this.#y.delete(s),this.#y.size===0&&(this.#y=null)},I._telemetryTimeout),this.#y.set(s,i);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class Sn extends I{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Ws=3285377520,yt=4294901760,Tt=65535;class bi{constructor(t){this.h1=t?t&4294967295:Ws,this.h2=t?t&4294967295:Ws}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let p=0,b=t.length;p<b;p++){const m=t.charCodeAt(p);m<=255?e[s++]=m:(e[s++]=m>>>8,e[s++]=m&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,n=s-i*4,r=new Uint32Array(e.buffer,0,i);let a=0,o=0,l=this.h1,h=this.h2;const d=3432918353,u=461845907,f=d&Tt,g=u&Tt;for(let p=0;p<i;p++)p&1?(a=r[p],a=a*d&yt|a*f&Tt,a=a<<15|a>>>17,a=a*u&yt|a*g&Tt,l^=a,l=l<<13|l>>>19,l=l*5+3864292196):(o=r[p],o=o*d&yt|o*f&Tt,o=o<<15|o>>>17,o=o*u&yt|o*g&Tt,h^=o,h=h<<13|h>>>19,h=h*5+3864292196);switch(a=0,n){case 3:a^=e[i*4+2]<<16;case 2:a^=e[i*4+1]<<8;case 1:a^=e[i*4],a=a*d&yt|a*f&Tt,a=a<<15|a>>>17,a=a*u&yt|a*g&Tt,i&1?l^=a:h^=a}this.h1=l,this.h2=h}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&yt|t*36045&Tt,e=e*4283543511&yt|((e<<16|t>>>16)*2950163797&yt)>>>16,t^=e>>>1,t=t*444984403&yt|t*60499&Tt,e=e*3301882366&yt|((e<<16|t>>>16)*3120437893&yt)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const bs=Object.freeze({map:null,hash:"",transfer:void 0});class Ps{#t=!1;#e=null;#s=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=this.#s.get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return this.#s.get(t)}remove(t){if(this.#s.delete(t),this.#s.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of this.#s.values())if(e instanceof I)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=this.#s.get(t);let i=!1;if(s!==void 0)for(const[n,r]of Object.entries(e))s[n]!==r&&(i=!0,s[n]=r);else i=!0,this.#s.set(t,e);i&&this.#i(),e instanceof I&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#s.has(t)}get size(){return this.#s.size}#i(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new yi(this)}get serializable(){if(this.#s.size===0)return bs;const t=new Map,e=new bi,s=[],i=Object.create(null);let n=!1;for(const[r,a]of this.#s){const o=a instanceof I?a.serialize(!1,i):a;o&&(t.set(r,o),e.update(`${r}:${JSON.stringify(o)}`),n||=!!o.bitmap)}if(n)for(const r of t.values())r.bitmap&&s.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:bs}get editorStats(){let t=null;const e=new Map;for(const s of this.#s.values()){if(!(s instanceof I))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:n}=i;e.has(n)||e.set(n,Object.getPrototypeOf(s).constructor),t||=Object.create(null);const r=t[n]||=new Map;for(const[a,o]of Object.entries(i)){if(a==="type")continue;let l=r.get(a);l||(l=new Map,r.set(a,l));const h=l.get(o)??0;l.set(o,h+1)}}for(const[s,i]of e)t[s]=i.computeTelemetryFinalData(t[s]);return t}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;const t=[];for(const e of this.#s.values())!(e instanceof I)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#s.entries()}}class yi extends Ps{#t;constructor(t){super();const{map:e,hash:s,transfer:i}=t.serializable,n=structuredClone(e,i?{transfer:i}:null);this.#t={map:n,hash:s,transfer:i}}get print(){z("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return H(this,"modifiedIds",{ids:new Set,hash:""})}}class En{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:s}){if(!(!t||this.#t.has(t.loadedName))){if(et(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:n,style:r}=t,a=new FontFace(i,n,r);this.addNativeFontFace(a);try{await a.load(),this.#t.add(i),s?.(t)}catch{B(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}z("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw B(`Failed to load font '${s.family}': '${i}'.`),t.disableFontFace=!0,i}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return H(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return H(this,"isSyncFontLoadingSupported",ct||ot.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(et(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const n=s.shift();setTimeout(n.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:e,callback:t};return s.push(i),i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return H(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(C,w){return C.charCodeAt(w)<<24|C.charCodeAt(w+1)<<16|C.charCodeAt(w+2)<<8|C.charCodeAt(w+3)&255}function i(C,w,v,x){const S=C.substring(0,w),E=C.substring(w+v);return S+x+E}let n,r;const a=this._document.createElement("canvas");a.width=1,a.height=1;const o=a.getContext("2d");let l=0;function h(C,w){if(++l>30){B("Load test font never loaded."),w();return}if(o.font="30px "+C,o.fillText(".",0,20),o.getImageData(0,0,1,1).data[3]>0){w();return}setTimeout(h.bind(null,C,w))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;u=i(u,976,d.length,d);const g=16,p=1482184792;let b=s(u,g);for(n=0,r=d.length-3;n<r;n+=4)b=b-p+s(d,n)|0;n<d.length&&(b=b-p+s(d+"XXX",n)|0),u=i(u,g,4,cn(b));const m=`url(data:font/opentype;base64,${btoa(u)});`,A=`@font-face {font-family:"${d}";src:${m}}`;this.insertRule(A);const y=this._document.createElement("div");y.style.visibility="hidden",y.style.width=y.style.height="10px",y.style.position="absolute",y.style.top=y.style.left="0px";for(const C of[t.loadedName,d]){const w=this._document.createElement("span");w.textContent="Hi",w.style.fontFamily=C,y.append(w)}this._document.body.append(y),h(d,()=>{y.remove(),e.complete()})}}class Tn{constructor(t,e=null){this.compiledGlyphs=Object.create(null);for(const s in t)this[s]=t[s];this._inspectFont=e}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${gi(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const s=this.loadedName+"_path_"+e;let i;try{i=t.get(s)}catch(r){B(`getPathGenerator - ignoring character: "${r}".`)}const n=new Path2D(i||"");return this.fontExtraProperties||t.delete(s),this.compiledGlyphs[e]=n}}function kn(c){if(c instanceof URL)return c.href;if(typeof c=="string"){if(ct)return c;const t=URL.parse(c,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Pn(c){if(ct&&typeof Buffer<"u"&&c instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(c instanceof Uint8Array&&c.byteLength===c.buffer.byteLength)return c;if(typeof c=="string")return ve(c);if(c instanceof ArrayBuffer||ArrayBuffer.isView(c)||typeof c=="object"&&!isNaN(c?.length))return new Uint8Array(c);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function De(c){if(typeof c!="string")return null;if(c.endsWith("/"))return c;throw new Error(`Invalid factory url: "${c}" must include trailing slash.`)}const ys=c=>typeof c=="object"&&Number.isInteger(c?.num)&&c.num>=0&&Number.isInteger(c?.gen)&&c.gen>=0,Mn=c=>typeof c=="object"&&typeof c?.name=="string",Rn=gn.bind(null,ys,Mn);class Ln{#t=new Map;#e=Promise.resolve();postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[i]of this.#t)i.call(this,s)})}addEventListener(t,e,s=null){let i=null;if(s?.signal instanceof AbortSignal){const{signal:n}=s;if(n.aborted){B("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,e);i=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}this.#t.set(e,i)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const Ie={DATA:1,ERROR:2},Q={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function qs(){}function pt(c){if(c instanceof $t||c instanceof ps||c instanceof zs||c instanceof Ve||c instanceof rs)return c;switch(c instanceof Error||typeof c=="object"&&c!==null||z('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),c.name){case"AbortException":return new $t(c.message);case"InvalidPDFException":return new ps(c.message);case"PasswordException":return new zs(c.message,c.code);case"ResponseException":return new Ve(c.message,c.status,c.missing);case"UnknownErrorException":return new rs(c.message,c.details)}return new rs(c.message,c.toString())}class pe{#t=new AbortController;constructor(t,e,s){this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#i(t);return}if(t.callback){const s=t.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],t.callback===Ie.DATA)i.resolve(t.data);else if(t.callback===Ie.ERROR)i.reject(pt(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const s=this.sourceName,i=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(r){n.postMessage({sourceName:s,targetName:i,callback:Ie.DATA,callbackId:t.callbackId,data:r})},function(r){n.postMessage({sourceName:s,targetName:i,callback:Ie.ERROR,callbackId:t.callbackId,reason:pt(r)})});return}if(t.streamId){this.#s(t);return}e(t.data)}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const i=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(r){n.reject(r)}return n.promise}sendWithStream(t,e,s,i){const n=this.streamId++,r=this.sourceName,a=this.targetName,o=this.comObj;return new ReadableStream({start:l=>{const h=Promise.withResolvers();return this.streamControllers[n]={controller:l,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},o.postMessage({sourceName:r,targetName:a,action:t,streamId:n,data:e,desiredSize:l.desiredSize},i),h.promise},pull:l=>{const h=Promise.withResolvers();return this.streamControllers[n].pullCall=h,o.postMessage({sourceName:r,targetName:a,stream:Q.PULL,streamId:n,desiredSize:l.desiredSize}),h.promise},cancel:l=>{et(l instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[n].cancelCall=h,this.streamControllers[n].isClosed=!0,o.postMessage({sourceName:r,targetName:a,stream:Q.CANCEL,streamId:n,reason:pt(l)}),h.promise}},s)}#s(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,r=this,a=this.actionHandler[t.action],o={enqueue(l,h=1,d){if(this.isCancelled)return;const u=this.desiredSize;this.desiredSize-=h,u>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:s,targetName:i,stream:Q.ENQUEUE,streamId:e,chunk:l},d)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Q.CLOSE,streamId:e}),delete r.streamSinks[e])},error(l){et(l instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Q.ERROR,streamId:e,reason:pt(l)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[e]=o,Promise.try(a,t.data,o).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Q.START_COMPLETE,streamId:e,success:!0})},function(l){n.postMessage({sourceName:s,targetName:i,stream:Q.START_COMPLETE,streamId:e,reason:pt(l)})})}#i(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,r=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case Q.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(pt(t.reason));break;case Q.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(pt(t.reason));break;case Q.PULL:if(!a){n.postMessage({sourceName:s,targetName:i,stream:Q.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,Promise.try(a.onPull||qs).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Q.PULL_COMPLETE,streamId:e,success:!0})},function(l){n.postMessage({sourceName:s,targetName:i,stream:Q.PULL_COMPLETE,streamId:e,reason:pt(l)})});break;case Q.ENQUEUE:if(et(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case Q.CLOSE:if(et(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#r(r,e);break;case Q.ERROR:et(r,"error should have stream controller"),r.controller.error(pt(t.reason)),this.#r(r,e);break;case Q.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(pt(t.reason)),this.#r(r,e);break;case Q.CANCEL:if(!a)break;const o=pt(t.reason);Promise.try(a.onCancel||qs,o).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Q.CANCEL_COMPLETE,streamId:e,success:!0})},function(l){n.postMessage({sourceName:s,targetName:i,stream:Q.CANCEL_COMPLETE,streamId:e,reason:pt(l)})}),a.sinkCapability.reject(o),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#r(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class Ai{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){z("Abstract method `_createCanvas` called.")}}class Dn extends Ai{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class Ci{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){z("Abstract method `_fetch` called.")}}class Xs extends Ci{async _fetch(t){const e=await _e(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):ve(e)}}class wi{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,n){return"none"}destroy(t=!1){}}class In extends wi{#t;#e;#s;#i;#r;#n;#a=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#i=t,this.#r=e}get#o(){return this.#e||=new Map}get#l(){return this.#n||=new Map}get#h(){if(!this.#s){const t=this.#r.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const s=this.#r.createElementNS(Lt,"svg");s.setAttribute("width",0),s.setAttribute("height",0),this.#s=this.#r.createElementNS(Lt,"defs"),t.append(s),s.append(this.#s),this.#r.body.append(t)}return this.#s}#u(t){if(t.length===1){const o=t[0],l=new Array(256);for(let d=0;d<256;d++)l[d]=o[d]/255;const h=l.join(",");return[h,h,h]}const[e,s,i]=t,n=new Array(256),r=new Array(256),a=new Array(256);for(let o=0;o<256;o++)n[o]=e[o]/255,r[o]=s[o]/255,a[o]=i[o]/255;return[n.join(","),r.join(","),a.join(",")]}#c(t){if(this.#t===void 0){this.#t="";const e=this.#r.URL;e!==this.#r.baseURI&&(Ye(e)?B('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=ui(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[s,i,n]=this.#u(t),r=t.length===1?s:`${s}${i}${n}`;if(e=this.#o.get(r),e)return this.#o.set(t,e),e;const a=`g_${this.#i}_transfer_map_${this.#a++}`,o=this.#c(a);this.#o.set(t,o),this.#o.set(r,o);const l=this.#p(a);return this.#m(s,i,n,l),o}addHCMFilter(t,e){const s=`${t}-${e}`,i="base";let n=this.#l.get(i);if(n?.key===s||(n?(n.filter?.remove(),n.key=s,n.url="none",n.filter=null):(n={key:s,url:"none",filter:null},this.#l.set(i,n)),!t||!e))return n.url;const r=this.#b(t);t=M.makeHexColor(...r);const a=this.#b(e);if(e=M.makeHexColor(...a),this.#h.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return n.url;const o=new Array(256);for(let f=0;f<=255;f++){const g=f/255;o[f]=g<=.03928?g/12.92:((g+.055)/1.055)**2.4}const l=o.join(","),h=`g_${this.#i}_hcm_filter`,d=n.filter=this.#p(h);this.#m(l,l,l,d),this.#g(d);const u=(f,g)=>{const p=r[f]/255,b=a[f]/255,m=new Array(g+1);for(let A=0;A<=g;A++)m[A]=p+A/g*(b-p);return m.join(",")};return this.#m(u(0,5),u(1,5),u(2,5),d),n.url=this.#c(h),n.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[s]=this.#u([t]),i=`alpha_${s}`;if(e=this.#o.get(i),e)return this.#o.set(t,e),e;const n=`g_${this.#i}_alpha_map_${this.#a++}`,r=this.#c(n);this.#o.set(t,r),this.#o.set(i,r);const a=this.#p(n);return this.#A(s,a),r}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let s,i;if(t?([s]=this.#u([t]),i=`luminosity_${s}`):i="luminosity",e=this.#o.get(i),e)return this.#o.set(t,e),e;const n=`g_${this.#i}_luminosity_map_${this.#a++}`,r=this.#c(n);this.#o.set(t,r),this.#o.set(i,r);const a=this.#p(n);return this.#f(a),t&&this.#A(s,a),r}addHighlightHCMFilter(t,e,s,i,n){const r=`${e}-${s}-${i}-${n}`;let a=this.#l.get(t);if(a?.key===r||(a?(a.filter?.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},this.#l.set(t,a)),!e||!s))return a.url;const[o,l]=[e,s].map(this.#b.bind(this));let h=Math.round(.2126*o[0]+.7152*o[1]+.0722*o[2]),d=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),[u,f]=[i,n].map(this.#b.bind(this));d<h&&([h,d,u,f]=[d,h,f,u]),this.#h.style.color="";const g=(m,A,y)=>{const C=new Array(256),w=(d-h)/y,v=m/255,x=(A-m)/(255*y);let S=0;for(let E=0;E<=y;E++){const D=Math.round(h+E*w),T=v+E*x;for(let V=S;V<=D;V++)C[V]=T;S=D+1}for(let E=S;E<256;E++)C[E]=C[S-1];return C.join(",")},p=`g_${this.#i}_hcm_${t}_filter`,b=a.filter=this.#p(p);return this.#g(b),this.#m(g(u[0],f[0],5),g(u[1],f[1],5),g(u[2],f[2],5),b),a.url=this.#c(p),a.url}destroy(t=!1){t&&this.#n?.size||(this.#s?.parentNode.parentNode.remove(),this.#s=null,this.#e?.clear(),this.#e=null,this.#n?.clear(),this.#n=null,this.#a=0)}#f(t){const e=this.#r.createElementNS(Lt,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#g(t){const e=this.#r.createElementNS(Lt,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#p(t){const e=this.#r.createElementNS(Lt,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#h.append(e),e}#d(t,e,s){const i=this.#r.createElementNS(Lt,e);i.setAttribute("type","discrete"),i.setAttribute("tableValues",s),t.append(i)}#m(t,e,s,i){const n=this.#r.createElementNS(Lt,"feComponentTransfer");i.append(n),this.#d(n,"feFuncR",t),this.#d(n,"feFuncG",e),this.#d(n,"feFuncB",s)}#A(t,e){const s=this.#r.createElementNS(Lt,"feComponentTransfer");e.append(s),this.#d(s,"feFuncA",t)}#b(t){return this.#h.style.color=t,Ke(getComputedStyle(this.#h).getPropertyValue("color"))}}class vi{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){z("Abstract method `_fetch` called.")}}class Ys extends vi{async _fetch(t){const e=await _e(t,"arraybuffer");return new Uint8Array(e)}}class _i{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){z("Abstract method `_fetch` called.")}}class Ks extends _i{async _fetch(t){const e=await _e(t,"arraybuffer");return new Uint8Array(e)}}ct&&B("Please use the `legacy` build in Node.js environments.");async function Ms(c){const e=await process.getBuiltinModule("fs").promises.readFile(c);return new Uint8Array(e)}class Nn extends wi{}class Fn extends Ai{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class On extends Ci{async _fetch(t){return Ms(t)}}class Bn extends vi{async _fetch(t){return Ms(t)}}class Hn extends _i{async _fetch(t){return Ms(t)}}const Qt="__forcedDependency";class jn{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[Qt]:[]};#s=new Map;#i=[];#r=[];#n=[[1,0,0,1,0,0]];#a=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#l=-1;#h=new Set;#u=new Map;#c=new Map;#f;#g;constructor(t){this.#f=t.width,this.#g=t.height}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[Qt]:{__proto__:this.#e[Qt]}},this.#a={__proto__:this.#a},this.#i.push([t,null]),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#a=Object.getPrototypeOf(this.#a);const s=this.#i.pop();return s!==void 0&&(s[1]=t),this}recordOpenMarker(t){return this.#i.push([t,null]),this}getOpenMarker(){return this.#i.length===0?null:this.#i.at(-1)[0]}recordCloseMarker(t){const e=this.#i.pop();return e!==void 0&&(e[1]=t),this}beginMarkedContent(t){return this.#r.push([t,null]),this}endMarkedContent(t){const e=this.#r.pop();return e!==void 0&&(e[1]=t),this}pushBaseTransform(t){return this.#n.push(M.multiplyByDOMMatrix(this.#n.at(-1),t.getTransform())),this}popBaseTransform(){return this.#n.length>1&&this.#n.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#s.set(t,e),this}recordFutureForcedDependency(t,e){return this.recordIncrementalData(Qt,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#h)this.recordFutureForcedDependency(Qt,t);return this}resetBBox(t){return this.#l=t,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0,this}get hasPendingBBox(){return this.#l!==-1}recordClipBox(t,e,s,i,n,r){const a=M.multiplyByDOMMatrix(this.#n.at(-1),e.getTransform()),o=[1/0,1/0,-1/0,-1/0];M.axialAlignedBoundingBox([s,n,i,r],a,o);const l=M.intersect(this.#a,o);return l?(this.#a[0]=l[0],this.#a[1]=l[1],this.#a[2]=l[2],this.#a[3]=l[3]):(this.#a[0]=this.#a[1]=1/0,this.#a[2]=this.#a[3]=-1/0),this}recordBBox(t,e,s,i,n,r){const a=this.#a;if(a[0]===1/0)return this;const o=M.multiplyByDOMMatrix(this.#n.at(-1),e.getTransform());if(a[0]===-1/0)return M.axialAlignedBoundingBox([s,n,i,r],o,this.#o),this;const l=[1/0,1/0,-1/0,-1/0];return M.axialAlignedBoundingBox([s,n,i,r],o,l),this.#o[0]=Math.min(this.#o[0],Math.max(l[0],a[0])),this.#o[1]=Math.min(this.#o[1],Math.max(l[1],a[1])),this.#o[2]=Math.max(this.#o[2],Math.min(l[2],a[2])),this.#o[3]=Math.max(this.#o[3],Math.min(l[3],a[3])),this}recordCharacterBBox(t,e,s,i=1,n=0,r=0,a){const o=s.bbox;let l,h;if(o&&(l=o[2]!==o[0]&&o[3]!==o[1]&&this.#c.get(s),l!==!1&&(h=[0,0,0,0],M.axialAlignedBoundingBox(o,s.fontMatrix,h),(i!==1||n!==0||r!==0)&&M.scaleMinMax([i,0,0,-i,n,r],h),l)))return this.recordBBox(t,e,h[0],h[2],h[1],h[3]);if(!a)return this.recordFullPageBBox(t);const d=a();return o&&h&&l===void 0&&(l=h[0]<=n-d.actualBoundingBoxLeft&&h[2]>=n+d.actualBoundingBoxRight&&h[1]<=r-d.actualBoundingBoxAscent&&h[3]>=r+d.actualBoundingBoxDescent,this.#c.set(s,l),l)?this.recordBBox(t,e,h[0],h[2],h[1],h[3]):this.recordBBox(t,e,n-d.actualBoundingBoxLeft,n+d.actualBoundingBoxRight,r-d.actualBoundingBoxAscent,r+d.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#o[0]=Math.max(0,this.#a[0]),this.#o[1]=Math.max(0,this.#a[1]),this.#o[2]=Math.min(this.#f,this.#a[2]),this.#o[3]=Math.min(this.#g,this.#a[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const s=this.#h,i=this.#t,n=this.#e;for(const r of e)r in this.#t?s.add(i[r]):r in n&&n[r].forEach(s.add,s);return this}copyDependenciesFromIncrementalOperation(t,e){const s=this.#u,i=this.#h;for(const n of this.#e[e])s.get(n).dependencies.forEach(i.add,i.add(n));return this}recordNamedDependency(t,e){return this.#s.has(e)&&this.#h.add(this.#s.get(e)),this}recordOperation(t,e=!1){this.recordDependencies(t,[Qt]);const s=new Set(this.#h),i=this.#i.concat(this.#r),n=this.#l===t?{minX:this.#o[0],minY:this.#o[1],maxX:this.#o[2],maxY:this.#o[3]}:null;return this.#u.set(t,{bbox:n,pairs:i,dependencies:s}),e||(this.#l=-1),this.#h.clear(),this}bboxToClipBoxDropOperation(t){return this.#l!==-1&&(this.#l=-1,this.#a[0]=Math.max(this.#a[0],this.#o[0]),this.#a[1]=Math.max(this.#a[1],this.#o[1]),this.#a[2]=Math.min(this.#a[2],this.#o[2]),this.#a[3]=Math.min(this.#a[3],this.#o[3])),this.#h.clear(),this}_takePendingDependencies(){const t=this.#h;return this.#h=new Set,t}_extractOperation(t){const e=this.#u.get(t);return this.#u.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#h.add(e)}take(){return this.#c.clear(),Array.from(this.#u,([t,{bbox:e,pairs:s,dependencies:i}])=>(s.forEach(n=>n.forEach(i.add,i)),i.delete(t),{minX:(e?.minX??0)/this.#f,maxX:(e?.maxX??this.#f)/this.#f,minY:(e?.minY??0)/this.#g,maxY:(e?.maxY??this.#g)/this.#g,dependencies:Array.from(i).sort((n,r)=>n-r),idx:t}))}}class ze{#t;#e;#s=0;#i;#r=0;constructor(t,e){if(t instanceof ze)return t;this.#t=t,this.#i=t._takePendingDependencies(),this.#e=e}save(t){return this.#r++,this.#t.save(this.#e),this}restore(t){return this.#r>0&&(this.#t.restore(this.#e),this.#r--),this}recordOpenMarker(t){return this.#s++,this}getOpenMarker(){return this.#s>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#s--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#t.hasPendingBBox||this.#t.resetBBox(this.#e),this}get hasPendingBBox(){return this.#t.hasPendingBBox}recordClipBox(t,e,s,i,n,r){return this.#t.recordClipBox(this.#e,e,s,i,n,r),this}recordBBox(t,e,s,i,n,r){return this.#t.recordBBox(this.#e,e,s,i,n,r),this}recordCharacterBBox(t,e,s,i,n,r,a){return this.#t.recordCharacterBBox(this.#e,e,s,i,n,r,a),this}recordFullPageBBox(t){return this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}copyDependenciesFromIncrementalOperation(t,e){return this.#t.copyDependenciesFromIncrementalOperation(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){this.#t.recordOperation(this.#e,!0);const e=this.#t._extractOperation(this.#e);for(const s of e.dependencies)this.#i.add(s);return this.#i.delete(this.#e),this.#i.delete(null),this}bboxToClipBoxDropOperation(t){return this.#t.bboxToClipBoxDropOperation(this.#e),this}recordNestedDependencies(){this.#t._pushPendingDependencies(this.#i)}take(){throw new Error("Unreachable")}}const At={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation"],transform:["transform"],transformAndFill:["transform","fillColor"]},at={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function As(c,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,s),c.clip(i)}class Rs{isModifyingCurrentTransform(){return!1}getPattern(){z("Abstract method `getPattern` called.")}}class $n extends Rs{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)e.addColorStop(s[0],s[1]);return e}getPattern(t,e,s,i){let n;if(i===at.STROKE||i===at.FILL){const r=e.current.getClippedPathBoundingBox(i,W(t))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,o=Math.ceil(r[3]-r[1])||1,l=e.cachedCanvases.getCanvas("pattern",a,o),h=l.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-r[0],-r[1]),s=M.transform(s,[1,0,0,1,r[0],r[1]]),h.transform(...e.baseTransform),this.matrix&&h.transform(...this.matrix),As(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),n=t.createPattern(l.canvas,"no-repeat");const d=new DOMMatrix(s);n.setTransform(d)}else As(t,this._bbox),n=this._createGradient(t);return n}}function ls(c,t,e,s,i,n,r,a){const o=t.coords,l=t.colors,h=c.data,d=c.width*4;let u;o[e+1]>o[s+1]&&(u=e,e=s,s=u,u=n,n=r,r=u),o[s+1]>o[i+1]&&(u=s,s=i,i=u,u=r,r=a,a=u),o[e+1]>o[s+1]&&(u=e,e=s,s=u,u=n,n=r,r=u);const f=(o[e]+t.offsetX)*t.scaleX,g=(o[e+1]+t.offsetY)*t.scaleY,p=(o[s]+t.offsetX)*t.scaleX,b=(o[s+1]+t.offsetY)*t.scaleY,m=(o[i]+t.offsetX)*t.scaleX,A=(o[i+1]+t.offsetY)*t.scaleY;if(g>=A)return;const y=l[n],C=l[n+1],w=l[n+2],v=l[r],x=l[r+1],S=l[r+2],E=l[a],D=l[a+1],T=l[a+2],V=Math.round(g),P=Math.round(A);let N,$,R,L,q,lt,Rt,_t;for(let st=V;st<=P;st++){if(st<b){const X=st<g?0:(g-st)/(g-b);N=f-(f-p)*X,$=y-(y-v)*X,R=C-(C-x)*X,L=w-(w-S)*X}else{let X;st>A?X=1:b===A?X=0:X=(b-st)/(b-A),N=p-(p-m)*X,$=v-(v-E)*X,R=x-(x-D)*X,L=S-(S-T)*X}let Y;st<g?Y=0:st>A?Y=1:Y=(g-st)/(g-A),q=f-(f-m)*Y,lt=y-(y-E)*Y,Rt=C-(C-D)*Y,_t=w-(w-T)*Y;const Zt=Math.round(Math.min(N,q)),Nt=Math.round(Math.max(N,q));let Ft=d*st+Zt*4;for(let X=Zt;X<=Nt;X++)Y=(N-X)/(N-q),Y<0?Y=0:Y>1&&(Y=1),h[Ft++]=$-($-lt)*Y|0,h[Ft++]=R-(R-Rt)*Y|0,h[Ft++]=L-(L-_t)*Y|0,h[Ft++]=255}}function Vn(c,t,e){const s=t.coords,i=t.colors;let n,r;switch(t.type){case"lattice":const a=t.verticesPerRow,o=Math.floor(s.length/a)-1,l=a-1;for(n=0;n<o;n++){let h=n*a;for(let d=0;d<l;d++,h++)ls(c,e,s[h],s[h+1],s[h+a],i[h],i[h+1],i[h+a]),ls(c,e,s[h+a+1],s[h+1],s[h+a],i[h+a+1],i[h+1],i[h+a])}break;case"triangles":for(n=0,r=s.length;n<r;n+=3)ls(c,e,s[n],s[n+1],s[n+2],i[n],i[n+1],i[n+2]);break;default:throw new Error("illegal figure")}}class zn extends Rs{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,s){const a=Math.floor(this._bounds[0]),o=Math.floor(this._bounds[1]),l=Math.ceil(this._bounds[2])-a,h=Math.ceil(this._bounds[3])-o,d=Math.min(Math.ceil(Math.abs(l*t[0]*1.1)),3e3),u=Math.min(Math.ceil(Math.abs(h*t[1]*1.1)),3e3),f=l/d,g=h/u,p={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-o,scaleX:1/f,scaleY:1/g},b=d+4,m=u+4,A=s.getCanvas("mesh",b,m),y=A.context,C=y.createImageData(d,u);if(e){const v=C.data;for(let x=0,S=v.length;x<S;x+=4)v[x]=e[0],v[x+1]=e[1],v[x+2]=e[2],v[x+3]=255}for(const v of this._figures)Vn(C,v,p);return y.putImageData(C,2,2),{canvas:A.canvas,offsetX:a-2*f,offsetY:o-2*g,scaleX:f,scaleY:g}}isModifyingCurrentTransform(){return!0}getPattern(t,e,s,i){As(t,this._bbox);const n=new Float32Array(2);if(i===at.SHADING)M.singularValueDecompose2dScale(W(t),n);else if(this.matrix){M.singularValueDecompose2dScale(this.matrix,n);const[a,o]=n;M.singularValueDecompose2dScale(e.baseTransform,n),n[0]*=a,n[1]*=o}else M.singularValueDecompose2dScale(e.baseTransform,n);const r=this._createMeshCanvas(n,i===at.SHADING?null:this._background,e.cachedCanvases);return i!==at.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class Gn extends Rs{getPattern(){return"hotpink"}}function Un(c){switch(c[0]){case"RadialAxial":return new $n(c);case"Mesh":return new zn(c);case"Dummy":return new Gn}throw new Error(`Unknown IR type: ${c[0]}`)}const Zs={COLORED:1,UNCOLORED:2};class Ls{static MAX_PATTERN_SIZE=3e3;constructor(t,e,s,i){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(t){const{bbox:e,operatorList:s,paintType:i,tilingType:n,color:r,canvasGraphicsFactory:a}=this;let{xstep:o,ystep:l}=this;o=Math.abs(o),l=Math.abs(l),Xe("TilingType: "+n);const h=e[0],d=e[1],u=e[2],f=e[3],g=u-h,p=f-d,b=new Float32Array(2);M.singularValueDecompose2dScale(this.matrix,b);const[m,A]=b;M.singularValueDecompose2dScale(this.baseTransform,b);const y=m*b[0],C=A*b[1];let w=g,v=p,x=!1,S=!1;const E=Math.ceil(o*y),D=Math.ceil(l*C),T=Math.ceil(g*y),V=Math.ceil(p*C);E>=T?w=o:x=!0,D>=V?v=l:S=!0;const P=this.getSizeAndScale(w,this.ctx.canvas.width,y),N=this.getSizeAndScale(v,this.ctx.canvas.height,C),$=t.cachedCanvases.getCanvas("pattern",P.size,N.size),R=$.context,L=a.createCanvasGraphics(R);if(L.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(L,i,r),R.translate(-P.scale*h,-N.scale*d),L.transform(0,P.scale,0,0,N.scale,0,0),R.save(),L.dependencyTracker?.save(),this.clipBbox(L,h,d,u,f),L.baseTransform=W(L.ctx),L.executeOperatorList(s),L.endDrawing(),L.dependencyTracker?.restore().recordNestedDependencies?.(),R.restore(),x||S){const q=$.canvas;x&&(w=o),S&&(v=l);const lt=this.getSizeAndScale(w,this.ctx.canvas.width,y),Rt=this.getSizeAndScale(v,this.ctx.canvas.height,C),_t=lt.size,st=Rt.size,Y=t.cachedCanvases.getCanvas("pattern-workaround",_t,st),Zt=Y.context,Nt=x?Math.floor(g/o):0,Ft=S?Math.floor(p/l):0;for(let X=0;X<=Nt;X++)for(let oe=0;oe<=Ft;oe++)Zt.drawImage(q,_t*X,st*oe,_t,st,0,0,_t,st);return{canvas:Y.canvas,scaleX:lt.scale,scaleY:Rt.scale,offsetX:h,offsetY:d}}return{canvas:$.canvas,scaleX:P.scale,scaleY:N.scale,offsetX:h,offsetY:d}}getSizeAndScale(t,e,s){const i=Math.max(Ls.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*s);return n>=i?n=i:s=n/t,{scale:s,size:n}}clipBbox(t,e,s,i,n){const r=i-e,a=n-s;t.ctx.rect(e,s,r,a),M.axialAlignedBoundingBox([e,s,i,n],W(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const i=t.ctx,n=t.current;switch(e){case Zs.COLORED:const{fillStyle:r,strokeStyle:a}=this.ctx;i.fillStyle=n.fillColor=r,i.strokeStyle=n.strokeColor=a;break;case Zs.UNCOLORED:i.fillStyle=i.strokeStyle=s,n.fillColor=n.strokeColor=s;break;default:throw new hn(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,s,i){let n=s;i!==at.SHADING&&(n=M.transform(n,e.baseTransform),this.matrix&&(n=M.transform(n,this.matrix)));const r=this.createPatternCanvas(e);let a=new DOMMatrix(n);a=a.translate(r.offsetX,r.offsetY),a=a.scale(1/r.scaleX,1/r.scaleY);const o=t.createPattern(r.canvas,"repeat");return o.setTransform(a),o}}function Wn({src:c,srcPos:t=0,dest:e,width:s,height:i,nonBlackColor:n=4294967295,inverseDecode:r=!1}){const a=ot.isLittleEndian?4278190080:255,[o,l]=r?[n,a]:[a,n],h=s>>3,d=s&7,u=c.length;e=new Uint32Array(e.buffer);let f=0;for(let g=0;g<i;g++){for(const b=t+h;t<b;t++){const m=t<u?c[t]:255;e[f++]=m&128?l:o,e[f++]=m&64?l:o,e[f++]=m&32?l:o,e[f++]=m&16?l:o,e[f++]=m&8?l:o,e[f++]=m&4?l:o,e[f++]=m&2?l:o,e[f++]=m&1?l:o}if(d===0)continue;const p=t<u?c[t++]:255;for(let b=0;b<d;b++)e[f++]=p&1<<7-b?l:o}return{srcPos:t,destPos:f}}const Qs=16,Js=100,qn=15,ti=10,gt=16,hs=new DOMMatrix,bt=new Float32Array(2),se=new Float32Array([1/0,1/0,-1/0,-1/0]);function Xn(c,t){if(c._removeMirroring)throw new Error("Context is already forwarding operations.");c.__originalSave=c.save,c.__originalRestore=c.restore,c.__originalRotate=c.rotate,c.__originalScale=c.scale,c.__originalTranslate=c.translate,c.__originalTransform=c.transform,c.__originalSetTransform=c.setTransform,c.__originalResetTransform=c.resetTransform,c.__originalClip=c.clip,c.__originalMoveTo=c.moveTo,c.__originalLineTo=c.lineTo,c.__originalBezierCurveTo=c.bezierCurveTo,c.__originalRect=c.rect,c.__originalClosePath=c.closePath,c.__originalBeginPath=c.beginPath,c._removeMirroring=()=>{c.save=c.__originalSave,c.restore=c.__originalRestore,c.rotate=c.__originalRotate,c.scale=c.__originalScale,c.translate=c.__originalTranslate,c.transform=c.__originalTransform,c.setTransform=c.__originalSetTransform,c.resetTransform=c.__originalResetTransform,c.clip=c.__originalClip,c.moveTo=c.__originalMoveTo,c.lineTo=c.__originalLineTo,c.bezierCurveTo=c.__originalBezierCurveTo,c.rect=c.__originalRect,c.closePath=c.__originalClosePath,c.beginPath=c.__originalBeginPath,delete c._removeMirroring},c.save=function(){t.save(),this.__originalSave()},c.restore=function(){t.restore(),this.__originalRestore()},c.translate=function(e,s){t.translate(e,s),this.__originalTranslate(e,s)},c.scale=function(e,s){t.scale(e,s),this.__originalScale(e,s)},c.transform=function(e,s,i,n,r,a){t.transform(e,s,i,n,r,a),this.__originalTransform(e,s,i,n,r,a)},c.setTransform=function(e,s,i,n,r,a){t.setTransform(e,s,i,n,r,a),this.__originalSetTransform(e,s,i,n,r,a)},c.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},c.rotate=function(e){t.rotate(e),this.__originalRotate(e)},c.clip=function(e){t.clip(e),this.__originalClip(e)},c.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},c.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},c.bezierCurveTo=function(e,s,i,n,r,a){t.bezierCurveTo(e,s,i,n,r,a),this.__originalBezierCurveTo(e,s,i,n,r,a)},c.rect=function(e,s,i,n){t.rect(e,s,i,n),this.__originalRect(e,s,i,n)},c.closePath=function(){t.closePath(),this.__originalClosePath()},c.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class Yn{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,s)):(i=this.canvasFactory.create(e,s),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Ne(c,t,e,s,i,n,r,a,o,l){const[h,d,u,f,g,p]=W(c);if(d===0&&u===0){const A=r*h+g,y=Math.round(A),C=a*f+p,w=Math.round(C),v=(r+o)*h+g,x=Math.abs(Math.round(v)-y)||1,S=(a+l)*f+p,E=Math.abs(Math.round(S)-w)||1;return c.setTransform(Math.sign(h),0,0,Math.sign(f),y,w),c.drawImage(t,e,s,i,n,0,0,x,E),c.setTransform(h,d,u,f,g,p),[x,E]}if(h===0&&f===0){const A=a*u+g,y=Math.round(A),C=r*d+p,w=Math.round(C),v=(a+l)*u+g,x=Math.abs(Math.round(v)-y)||1,S=(r+o)*d+p,E=Math.abs(Math.round(S)-w)||1;return c.setTransform(0,Math.sign(d),Math.sign(u),0,y,w),c.drawImage(t,e,s,i,n,0,0,E,x),c.setTransform(h,d,u,f,g,p),[E,x]}c.drawImage(t,e,s,i,n,r,a,o,l);const b=Math.hypot(h,d),m=Math.hypot(u,f);return[b*o,m*l]}class ei{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=fs;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=nt.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,s){s?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=se.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=at.FILL,e=null){const s=this.minMax.slice();if(t===at.STROKE){e||z("Stroke bounding box must include transform."),M.singularValueDecompose2dScale(e,bt);const i=bt[0]*this.lineWidth/2,n=bt[1]*this.lineWidth/2;s[0]-=i,s[1]-=n,s[2]+=i,s[3]+=n}return s}updateClipFromPath(){const t=M.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(se,0)}getClippedPathBoundingBox(t=at.FILL,e=null){return M.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function si(c,t){if(t instanceof ImageData){c.putImageData(t,0,0);return}const e=t.height,s=t.width,i=e%gt,n=(e-i)/gt,r=i===0?n:n+1,a=c.createImageData(s,gt);let o=0,l;const h=t.data,d=a.data;let u,f,g,p;if(t.kind===He.GRAYSCALE_1BPP){const b=h.byteLength,m=new Uint32Array(d.buffer,0,d.byteLength>>2),A=m.length,y=s+7>>3,C=4294967295,w=ot.isLittleEndian?4278190080:255;for(u=0;u<r;u++){for(g=u<n?gt:i,l=0,f=0;f<g;f++){const v=b-o;let x=0;const S=v>y?s:v*8-7,E=S&-8;let D=0,T=0;for(;x<E;x+=8)T=h[o++],m[l++]=T&128?C:w,m[l++]=T&64?C:w,m[l++]=T&32?C:w,m[l++]=T&16?C:w,m[l++]=T&8?C:w,m[l++]=T&4?C:w,m[l++]=T&2?C:w,m[l++]=T&1?C:w;for(;x<S;x++)D===0&&(T=h[o++],D=128),m[l++]=T&D?C:w,D>>=1}for(;l<A;)m[l++]=0;c.putImageData(a,0,u*gt)}}else if(t.kind===He.RGBA_32BPP){for(f=0,p=s*gt*4,u=0;u<n;u++)d.set(h.subarray(o,o+p)),o+=p,c.putImageData(a,0,f),f+=gt;u<r&&(p=s*i*4,d.set(h.subarray(o,o+p)),c.putImageData(a,0,f))}else if(t.kind===He.RGB_24BPP)for(g=gt,p=s*g,u=0;u<r;u++){for(u>=n&&(g=i,p=s*g),l=0,f=p;f--;)d[l++]=h[o++],d[l++]=h[o++],d[l++]=h[o++],d[l++]=255;c.putImageData(a,0,u*gt)}else throw new Error(`bad image kind: ${t.kind}`)}function ii(c,t){if(t.bitmap){c.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,i=e%gt,n=(e-i)/gt,r=i===0?n:n+1,a=c.createImageData(s,gt);let o=0;const l=t.data,h=a.data;for(let d=0;d<r;d++){const u=d<n?gt:i;({srcPos:o}=Wn({src:l,srcPos:o,dest:h,width:s,height:u,nonBlackColor:0})),c.putImageData(a,0,d*gt)}}function le(c,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)c[s]!==void 0&&(t[s]=c[s]);c.setLineDash!==void 0&&(t.setLineDash(c.getLineDash()),t.lineDashOffset=c.lineDashOffset)}function Fe(c){c.strokeStyle=c.fillStyle="#000000",c.fillRule="nonzero",c.globalAlpha=1,c.lineWidth=1,c.lineCap="butt",c.lineJoin="miter",c.miterLimit=10,c.globalCompositeOperation="source-over",c.font="10px sans-serif",c.setLineDash!==void 0&&(c.setLineDash([]),c.lineDashOffset=0);const{filter:t}=c;t!=="none"&&t!==""&&(c.filter="none")}function ni(c,t){if(t)return!0;M.singularValueDecompose2dScale(c,bt);const e=Math.fround(Mt.pixelRatio*ae.PDF_TO_CSS_UNITS);return bt[0]<=e&&bt[1]<=e}const Kn=["butt","round","square"],Zn=["miter","round","bevel"],Qn={},ri={};class ne{constructor(t,e,s,i,n,{optionalContentConfig:r,markedContentStack:a=null},o,l,h){this.ctx=t,this.current=new ei(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new Yn(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=h??null}getObject(t,e,s=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):s}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:i=null}){const n=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=a,s){const o=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=o.canvas,this.ctx=o.context,this.ctx.save(),this.ctx.transform(...W(this.compositeCtx))}this.ctx.save(),Fe(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=W(this.ctx)}executeOperatorList(t,e,s,i,n){const r=t.argsArray,a=t.fnArray;let o=e||0;const l=r.length;if(l===o)return o;const h=l-o>ti&&typeof s=="function",d=h?Date.now()+qn:0;let u=0;const f=this.commonObjs,g=this.objs;let p,b;for(;;){if(i!==void 0&&o===i.nextBreakPoint)return i.breakIt(o,s),o;if(!n||n.has(o))if(p=a[o],b=r[o]??null,p!==ye.dependency)b===null?this[p](o):this[p](o,...b);else for(const m of b){this.dependencyTracker?.recordNamedData(m,o);const A=m.startsWith("g_")?f:g;if(!A.has(m))return A.get(m,s),o}if(o++,o===l)return o;if(h&&++u>ti){if(Date.now()>d)return s(),o;u=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const s=t.width??t.displayWidth,i=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),a=s,o=i,l="prescale1",h,d;for(;n>2&&a>1||r>2&&o>1;){let u=a,f=o;n>2&&a>1&&(u=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),n/=a/u),r>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o)/2,r/=o/f),h=this.cachedCanvases.getCanvas(l,u,f),d=h.context,d.clearRect(0,0,u,f),d.drawImage(t,0,0,a,o,0,0,u,f),t=h.canvas,a=u,o=f,l=l==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:o}}_createMaskCanvas(t,e){const s=this.ctx,{width:i,height:n}=e,r=this.current.fillColor,a=this.current.patternFill,o=W(s);let l,h,d,u;if((e.bitmap||e.data)&&e.count>1){const D=e.bitmap||e.data.buffer;h=JSON.stringify(a?o:[o.slice(0,4),r]),l=this._cachedBitmapsMap.get(D),l||(l=new Map,this._cachedBitmapsMap.set(D,l));const T=l.get(h);if(T&&!a){const V=Math.round(Math.min(o[0],o[2])+o[4]),P=Math.round(Math.min(o[1],o[3])+o[5]);return this.dependencyTracker?.recordDependencies(t,At.transformAndFill),{canvas:T,offsetX:V,offsetY:P}}d=T}d||(u=this.cachedCanvases.getCanvas("maskCanvas",i,n),ii(u.context,e));let f=M.transform(o,[1/i,0,0,-1/n,0,0]);f=M.transform(f,[1,0,0,1,0,-n]);const g=se.slice();M.axialAlignedBoundingBox([0,0,i,n],f,g);const[p,b,m,A]=g,y=Math.round(m-p)||1,C=Math.round(A-b)||1,w=this.cachedCanvases.getCanvas("fillCanvas",y,C),v=w.context,x=p,S=b;v.translate(-x,-S),v.transform(...f),d||(d=this._scaleImage(u.canvas,Et(v)),d=d.img,l&&a&&l.set(h,d)),v.imageSmoothingEnabled=ni(W(v),e.interpolate),Ne(v,d,0,0,d.width,d.height,0,0,i,n),v.globalCompositeOperation="source-in";const E=M.transform(Et(v),[1,0,0,1,-x,-S]);return v.fillStyle=a?r.getPattern(s,this,E,at.FILL):r,v.fillRect(0,0,i,n),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(h,w.canvas)),this.dependencyTracker?.recordDependencies(t,At.transformAndFill),{canvas:w.canvas,offsetX:Math.round(x),offsetY:Math.round(S)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=Kn[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=Zn[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,s){this.dependencyTracker?.recordSimpleData("dash",t);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=s)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[s,i]of e)switch(s){case"LW":this.setLineWidth(t,i);break;case"LC":this.setLineCap(t,i);break;case"LJ":this.setLineJoin(t,i);break;case"ML":this.setMiterLimit(t,i);break;case"D":this.setDash(t,i[0],i[1]);break;case"RI":this.setRenderingIntent(t,i);break;case"FL":this.setFlatness(t,i);break;case"Font":this.setFont(t,i[0],i[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=i;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=i;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,s=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(i,e,s);this.suspendedCtx=this.ctx;const r=this.ctx=n.context;r.setTransform(this.suspendedCtx.getTransform()),le(this.suspendedCtx,r),Xn(r,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),le(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,i){const n=i[0],r=i[1],a=i[2]-n,o=i[3]-r;a===0||o===0||(this.genericComposeSMask(e.context,s,a,o,e.subtype,e.backdrop,e.transferMap,n,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,i,n,r,a,o,l,h,d){let u=t.canvas,f=o-h,g=l-d;if(r)if(f<0||g<0||f+s>u.width||g+i>u.height){const b=this.cachedCanvases.getCanvas("maskExtension",s,i),m=b.context;m.drawImage(u,-f,-g),m.globalCompositeOperation="destination-atop",m.fillStyle=r,m.fillRect(0,0,s,i),m.globalCompositeOperation="source-over",u=b.canvas,f=g=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(f,g,s,i),t.clip(b),t.globalCompositeOperation="destination-atop",t.fillStyle=r,t.fillRect(f,g,s,i),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));const p=new Path2D;p.rect(o,l,s,i),e.clip(p),e.globalCompositeOperation="destination-in",e.drawImage(u,f,g,s,i,o,l,s,i),e.restore()}save(t){this.inSMaskMode&&le(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&le(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,s,i,n,r,a){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,s,i,n,r,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s,i){let[n]=s;if(!i){n||=s[0]=new Path2D,this[e](t,n);return}if(this.dependencyTracker!==null){const r=e===ye.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,i[0]-r,i[2]+r,i[1]-r,i[3]+r).recordDependencies(t,["transform"])}if(!(n instanceof Path2D)){const r=s[0]=new Path2D;for(let a=0,o=n.length;a<o;)switch(n[a++]){case Re.moveTo:r.moveTo(n[a++],n[a++]);break;case Re.lineTo:r.lineTo(n[a++],n[a++]);break;case Re.curveTo:r.bezierCurveTo(n[a++],n[a++],n[a++],n[a++],n[a++],n[a++]);break;case Re.closePath:r.closePath();break;default:B(`Unrecognized drawing path operator: ${n[a-1]}`);break}n=r}M.axialAlignedBoundingBox(i,W(this.ctx),this.current.minMax),this[e](t,n),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,s=!0){const i=this.ctx,n=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof n=="object"&&n?.getPattern){const r=n.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=n.getPattern(i,this,Et(i),at.STROKE),r){const a=new Path2D;a.addPath(e,i.getTransform().invertSelf().multiplySelf(r)),e=a}this.rescaleAndStroke(e,!1),i.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,At.stroke),s&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(at.STROKE,W(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,s=!0){const i=this.ctx,n=this.current.fillColor,r=this.current.patternFill;let a=!1;if(r){const l=n.isModifyingCurrentTransform()?i.getTransform():null;if(this.dependencyTracker?.save(t),i.save(),i.fillStyle=n.getPattern(i,this,Et(i),at.FILL),l){const h=new Path2D;h.addPath(e,i.getTransform().invertSelf().multiplySelf(l)),e=h}a=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(i.fill(e,"evenodd"),this.pendingEOFill=!1):i.fill(e)),this.dependencyTracker?.recordDependencies(t,At.fill),a&&(i.restore(),this.dependencyTracker?.restore(t)),s&&this.consumePath(t,e,o)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,At.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=Qn}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=ri}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;e!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",t),i.recordCloseMarker(t)}if(e!==void 0){const i=new Path2D,n=s.getTransform().invertSelf();for(const{transform:r,x:a,y:o,fontSize:l,path:h}of e)h&&i.addPath(h,new DOMMatrix(r).preMultiplySelf(n).translate(a,o).scale(l,-l));s.clip(i)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,s){this.dependencyTracker?.recordSimpleData("font",t).recordNamedDependency(t,e);const i=this.commonObjs.get(e),n=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(n.fontMatrix=i.fontMatrix||fs,(n.fontMatrix[0]===0||n.fontMatrix[3]===0)&&B("Invalid font matrix for font "+e),s<0?(s=-s,n.fontDirection=-1):n.fontDirection=1,this.current.font=i,this.current.fontSize=s,i.isType3Font)return;const r=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${r}", ${i.fallbackName}`;let o="normal";i.black?o="900":i.bold&&(o="bold");const l=i.italic?"italic":"normal";let h=s;s<Qs?h=Qs:s>Js&&(h=Js),this.current.fontSizeScale=s/h,this.ctx.font=`${l} ${o} ${h}px ${a}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,s){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=s}setLeadingMoveText(t,e,s){this.setLeading(t,-s),this.moveText(t,e,s)}setTextMatrix(t,e){this.dependencyTracker?.recordSimpleData("textMatrix",t);const{current:s}=this;s.textMatrix=e,s.textMatrixScale=Math.hypot(e[0],e[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#s(t,e,s){const i=new Path2D;return i.addPath(t,new DOMMatrix(s).invertSelf().multiplySelf(e)),i}paintChar(t,e,s,i,n,r){const a=this.ctx,o=this.current,l=o.font,h=o.textRenderingMode,d=o.fontSize/o.fontSizeScale,u=h&nt.FILL_STROKE_MASK,f=!!(h&nt.ADD_TO_PATH_FLAG),g=o.patternFill&&!l.missingFile,p=o.patternStroke&&!l.missingFile;let b;if((l.disableFontFace||f||g||p)&&!l.missingFile&&(b=l.getPathGenerator(this.commonObjs,e)),b&&(l.disableFontFace||g||p)){a.save(),a.translate(s,i),a.scale(d,-d),this.dependencyTracker?.recordCharacterBBox(t,a,l);let m;if(u===nt.FILL||u===nt.FILL_STROKE)if(n){m=a.getTransform(),a.setTransform(...n);const A=this.#s(b,m,n);a.fill(A)}else a.fill(b);if(u===nt.STROKE||u===nt.FILL_STROKE)if(r){m||=a.getTransform(),a.setTransform(...r);const{a:A,b:y,c:C,d:w}=m,v=M.inverseTransform(r),x=M.transform([A,y,C,w,0,0],v);M.singularValueDecompose2dScale(x,bt),a.lineWidth*=Math.max(bt[0],bt[1])/d,a.stroke(this.#s(b,m,r))}else a.lineWidth/=d,a.stroke(b);a.restore()}else(u===nt.FILL||u===nt.FILL_STROKE)&&(a.fillText(e,s,i),this.dependencyTracker?.recordCharacterBBox(t,a,l,d,s,i,()=>a.measureText(e))),(u===nt.STROKE||u===nt.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,a,l,d,s,i,()=>a.measureText(e)).recordDependencies(t,At.stroke),a.strokeText(e,s,i));f&&((this.pendingTextPaths||=[]).push({transform:W(a),x:s,y:i,fontSize:d,path:b}),this.dependencyTracker?.recordCharacterBBox(t,a,l,d,s,i))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){s=!0;break}return H(this,"isFontSubpixelAAEnabled",s)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,At.showText).copyDependenciesFromIncrementalOperation(t,"sameLineText").resetBBox(t),this.current.textRenderingMode&nt.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,i=s.font;if(i.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordOperation(t).recordIncrementalData("sameLineText",t);return}const n=s.fontSize;if(n===0){this.dependencyTracker?.recordOperation(t);return}const r=this.ctx,a=s.fontSizeScale,o=s.charSpacing,l=s.wordSpacing,h=s.fontDirection,d=s.textHScale*h,u=e.length,f=i.vertical,g=f?1:-1,p=i.defaultVMetrics,b=n*s.fontMatrix[0],m=s.textRenderingMode===nt.FILL&&!i.disableFontFace&&!s.patternFill;r.save(),s.textMatrix&&r.transform(...s.textMatrix),r.translate(s.x,s.y+s.textRise),h>0?r.scale(d,-1):r.scale(d,1);let A,y;if(s.patternFill){r.save();const S=s.fillColor.getPattern(r,this,Et(r),at.FILL);A=W(r),r.restore(),r.fillStyle=S}if(s.patternStroke){r.save();const S=s.strokeColor.getPattern(r,this,Et(r),at.STROKE);y=W(r),r.restore(),r.strokeStyle=S}let C=s.lineWidth;const w=s.textMatrixScale;if(w===0||C===0){const S=s.textRenderingMode&nt.FILL_STROKE_MASK;(S===nt.STROKE||S===nt.FILL_STROKE)&&(C=this.getSinglePixelWidth())}else C/=w;if(a!==1&&(r.scale(a,a),C/=a),r.lineWidth=C,i.isInvalidPDFjsFont){const S=[];let E=0;for(const T of e)S.push(T.unicode),E+=T.width;const D=S.join("");if(r.fillText(D,0,0),this.dependencyTracker!==null){const T=r.measureText(D);this.dependencyTracker.recordBBox(t,this.ctx,-T.actualBoundingBoxLeft,T.actualBoundingBoxRight,-T.actualBoundingBoxAscent,T.actualBoundingBoxDescent).recordOperation(t).recordIncrementalData("sameLineText",t)}s.x+=E*b*d,r.restore(),this.compose();return}let v=0,x;for(x=0;x<u;++x){const S=e[x];if(typeof S=="number"){v+=g*S*n/1e3;continue}let E=!1;const D=(S.isSpace?l:0)+o,T=S.fontChar,V=S.accent;let P,N,$=S.width;if(f){const q=S.vmetric||p,lt=-(S.vmetric?q[1]:$*.5)*b,Rt=q[2]*b;$=q?-q[0]:$,P=lt/a,N=(v+Rt)/a}else P=v/a,N=0;let R;if(i.remeasure&&$>0){R=r.measureText(T);const q=R.width*1e3/n*a;if($<q&&this.isFontSubpixelAAEnabled){const lt=$/q;E=!0,r.save(),r.scale(lt,1),P/=lt}else $!==q&&(P+=($-q)/2e3*n/a)}if(this.contentVisible&&(S.isInFont||i.missingFile)){if(m&&!V)r.fillText(T,P,N),this.dependencyTracker?.recordCharacterBBox(t,r,R?{bbox:null}:i,n/a,P,N,()=>R??r.measureText(T));else if(this.paintChar(t,T,P,N,A,y),V){const q=P+n*V.offset.x/a,lt=N-n*V.offset.y/a;this.paintChar(t,V.fontChar,q,lt,A,y)}}const L=f?$*b-D*h:$*b+D*h;v+=L,E&&r.restore()}f?s.y-=v:s.x+=v*d,r.restore(),this.compose(),this.dependencyTracker?.recordOperation(t).recordIncrementalData("sameLineText",t)}showType3Text(t,e){const s=this.ctx,i=this.current,n=i.font,r=i.fontSize,a=i.fontDirection,o=n.vertical?1:-1,l=i.charSpacing,h=i.wordSpacing,d=i.textHScale*a,u=i.fontMatrix||fs,f=e.length,g=i.textRenderingMode===nt.INVISIBLE;let p,b,m,A;if(g||r===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),i.textMatrix&&s.transform(...i.textMatrix),s.translate(i.x,i.y+i.textRise),s.scale(d,a);const y=this.dependencyTracker;for(this.dependencyTracker=y?new ze(y,t):null,p=0;p<f;++p){if(b=e[p],typeof b=="number"){A=o*b*r/1e3,this.ctx.translate(A,0),i.x+=A*d;continue}const C=(b.isSpace?h:0)+l,w=n.charProcOperatorList[b.operatorListId];w?this.contentVisible&&(this.save(),s.scale(r,r),s.transform(...u),this.executeOperatorList(w),this.restore()):B(`Type3 character "${b.operatorListId}" is not available.`);const v=[b.width,0];M.applyTransform(v,u),m=v[0]*r+C,s.translate(m,0),i.x+=m*d}s.restore(),y&&(this.dependencyTracker.recordNestedDependencies(),this.dependencyTracker=y)}setCharWidth(t,e,s){}setCharWidthAndBounds(t,e,s,i,n,r,a){const o=new Path2D;o.rect(i,n,r-i,a-n),this.ctx.clip(o),this.dependencyTracker?.recordBBox(t,this.ctx,i,r,n,a).recordClipBox(t,this.ctx,i,r,n,a),this.endPath(t)}getColorN_Pattern(t,e){let s;if(e[0]==="TilingPattern"){const i=this.baseTransform||W(this.ctx),n={createCanvasGraphics:r=>new ne(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new ze(this.dependencyTracker,t):null)};s=new Ls(e,this.ctx,n,i)}else s=this._getPattern(t,e[1],e[2]);return s}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,s=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=Un(this.getObject(t,e)),this.cachedPatterns.set(e,i)),s&&(i.matrix=s),i}shadingFill(t,e){if(!this.contentVisible)return;const s=this.ctx;this.save(t);const i=this._getPattern(t,e);s.fillStyle=i.getPattern(s,this,Et(s),at.SHADING);const n=Et(s);if(n){const{width:r,height:a}=s.canvas,o=se.slice();M.axialAlignedBoundingBox([0,0,r,a],n,o);const[l,h,d,u]=o;this.ctx.fillRect(l,h,d-l,u-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,At.transform).recordDependencies(t,At.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){z("Should not call beginInlineImage")}beginImageData(){z("Should not call beginImageData")}paintFormXObjectBegin(t,e,s){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=W(this.ctx),s)){M.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[i,n,r,a]=s,o=new Path2D;o.rect(i,n,r-i,a-n),this.ctx.clip(o),this.dependencyTracker?.recordClipBox(t,this.ctx,i,r,n,a),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;e.isolated||Xe("TODO: Support non-isolated groups."),e.knockout&&B("Knockout groups not supported.");const i=W(s);if(e.matrix&&s.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let n=se.slice();M.axialAlignedBoundingBox(e.bbox,W(s),n);const r=[0,0,s.canvas.width,s.canvas.height];n=M.intersect(n,r)||[0,0,0,0];const a=Math.floor(n[0]),o=Math.floor(n[1]),l=Math.max(Math.ceil(n[2])-a,1),h=Math.max(Math.ceil(n[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,h]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(d,l,h),f=u.context;f.translate(-a,-o),f.transform(...i);let g=new Path2D;const[p,b,m,A]=e.bbox;if(g.rect(p,b,m-p,A-b),e.matrix){const y=new Path2D;y.addPath(g,new DOMMatrix(e.matrix)),g=y}f.clip(g),e.smask&&this.smaskStack.push({canvas:u.canvas,context:f,offsetX:a,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(a,o),s.save()),le(s,f),this.ctx=f,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const n=W(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...n);const r=se.slice();M.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],n,r),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(t,e,s,i,n,r){if(this.#t(),Fe(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const a=s[2]-s[0],o=s[3]-s[1];if(r&&this.annotationCanvasMap){i=i.slice(),i[4]-=s[0],i[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=a,s[3]=o,M.singularValueDecompose2dScale(W(this.ctx),bt);const{viewportScale:l}=this,h=Math.ceil(a*this.outputScaleX*l),d=Math.ceil(o*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(h,d);const{canvas:u,context:f}=this.annotationCanvas;this.annotationCanvasMap.set(e,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=f,this.ctx.save(),this.ctx.setTransform(bt[0],0,0,-bt[1],0,o*bt[1]),Fe(this.ctx)}else{Fe(this.ctx),this.endPath(t);const l=new Path2D;l.rect(s[0],s[1],a,o),this.ctx.clip(l)}}this.current=new ei(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...i),this.transform(t,...n)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const s=e.count;e=this.getObject(t,e.data,e),e.count=s;const i=this.ctx,n=this._createMaskCanvas(t,e),r=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,n.offsetX,n.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,n.offsetX,n.offsetX+r.width,n.offsetY,n.offsetY+r.height).recordOperation(t),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s,i=0,n=0,r,a){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const o=this.ctx;o.save();const l=W(o);o.transform(s,i,n,r,0,0);const h=this._createMaskCanvas(t,e);o.setTransform(1,0,0,1,h.offsetX-l[4],h.offsetY-l[5]),this.dependencyTracker?.resetBBox(t);for(let d=0,u=a.length;d<u;d+=2){const f=M.transform(l,[s,i,n,r,a[d],a[d+1]]);o.drawImage(h.canvas,f[4],f[5]),this.dependencyTracker?.recordBBox(t,this.ctx,f[4],f[4]+h.canvas.width,f[5],f[5]+h.canvas.height)}o.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx,i=this.current.fillColor,n=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,At.transformAndFill);for(const r of e){const{data:a,width:o,height:l,transform:h}=r,d=this.cachedCanvases.getCanvas("maskCanvas",o,l),u=d.context;u.save();const f=this.getObject(t,a,r);ii(u,f),u.globalCompositeOperation="source-in",u.fillStyle=n?i.getPattern(u,this,Et(s),at.FILL):i,u.fillRect(0,0,o,l),u.restore(),s.save(),s.transform(...h),s.scale(1,-1),Ne(s,d.canvas,0,0,o,l,0,-1,1,1),this.dependencyTracker?.recordBBox(t,s,0,o,0,l),s.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const s=this.getObject(t,e);if(!s){B("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,s)}paintImageXObjectRepeat(t,e,s,i,n){if(!this.contentVisible)return;const r=this.getObject(t,e);if(!r){B("Dependent image isn't ready yet");return}const a=r.width,o=r.height,l=[];for(let h=0,d=n.length;h<d;h+=2)l.push({transform:[s,0,0,i,n[h],n[h+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(t,r,l)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:i}=t,n=this.cachedCanvases.getCanvas("inlineImage",s,i),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",n.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const s=e.width,i=e.height,n=this.ctx;this.save(t);const{filter:r}=n;r!=="none"&&r!==""&&(n.filter="none"),n.scale(1/s,-1/i);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const h=this.cachedCanvases.getCanvas("inlineImage",s,i).context;si(h,e),a=this.applyTransferMapsToCanvas(h)}const o=this._scaleImage(a,Et(n));n.imageSmoothingEnabled=ni(W(n),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,n,0,s,-i,0).recordDependencies(t,At.imageXObject).recordOperation(t),Ne(n,o.img,0,0,o.paintWidth,o.paintHeight,0,-i,s,i),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,s){if(!this.contentVisible)return;const i=this.ctx;let n;if(e.bitmap)n=e.bitmap;else{const r=e.width,a=e.height,l=this.cachedCanvases.getCanvas("inlineImage",r,a).context;si(l,e),n=this.applyTransferMapsToCanvas(l)}this.dependencyTracker?.resetBBox(t);for(const r of s)i.save(),i.transform(...r.transform),i.scale(1,-1),Ne(i,n,r.x,r.y,r.w,r.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,i,0,1,-1,0),i.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,At.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,s){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,s){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,s){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const n=this.ctx;this.pendingClip?(i||(this.pendingClip===ri?n.clip(e,"evenodd"):n.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=W(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:i,d:n}=this.ctx.getTransform();let r,a;if(s===0&&i===0){const o=Math.abs(e),l=Math.abs(n);if(o===l)if(t===0)r=a=1/o;else{const h=o*t;r=a=h<1?1/h:1}else if(t===0)r=1/o,a=1/l;else{const h=o*t,d=l*t;r=h<1?1/h:1,a=d<1?1/d:1}}else{const o=Math.abs(e*n-s*i),l=Math.hypot(e,s),h=Math.hypot(i,n);if(t===0)r=h/o,a=l/o;else{const d=t*o;r=h>d?h/d:1,a=l>d?l/d:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:s,current:{lineWidth:i}}=this,[n,r]=this.getScaleForStroking();if(n===r){s.lineWidth=(i||1)*n,s.stroke(t);return}const a=s.getLineDash();e&&s.save(),s.scale(n,r),hs.a=1/n,hs.d=1/r;const o=new Path2D;if(o.addPath(t,hs),a.length>0){const l=Math.max(n,r);s.setLineDash(a.map(h=>h/l)),s.lineDashOffset/=l}s.lineWidth=i||1,s.stroke(o),e&&s.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const c in ye)ne.prototype[c]!==void 0&&(ne.prototype[ye[c]]=ne.prototype[c]);class be{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class Jn{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const te=Symbol("INTERNAL");class tr{#t=!1;#e=!1;#s=!1;#i=!0;constructor(t,{name:e,intent:s,usage:i,rbGroups:n}){this.#t=!!(t&mt.DISPLAY),this.#e=!!(t&mt.PRINT),this.name=e,this.intent=s,this.usage=i,this.rbGroups=n}get visible(){if(this.#s)return this.#i;if(!this.#i)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,s=!1){t!==te&&z("Internal method `_setVisible` called."),this.#s=s,this.#i=e}}class er{#t=null;#e=new Map;#s=null;#i=null;constructor(t,e=mt.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#i=t.order;for(const s of t.groups)this.#e.set(s.id,new tr(e,s));if(t.baseState==="OFF")for(const s of this.#e.values())s._setVisible(te,!1);for(const s of t.on)this.#e.get(s)._setVisible(te,!0);for(const s of t.off)this.#e.get(s)._setVisible(te,!1);this.#s=this.getHash()}}#r(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let i=1;i<e;i++){const n=t[i];let r;if(Array.isArray(n))r=this.#r(n);else if(this.#e.has(n))r=this.#e.get(n).visible;else return B(`Optional content group not found: ${n}`),!0;switch(s){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return s==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return Xe("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(B(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#r(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return B(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return B(`Unknown optional content policy ${t.policy}.`),!0}return B(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){const i=this.#e.get(t);if(!i){B(`Optional content group not found: ${t}`);return}if(s&&e&&i.rbGroups.length)for(const n of i.rbGroups)for(const r of n)r!==t&&this.#e.get(r)?._setVisible(te,!1,!0);i._setVisible(te,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let s;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const n=this.#e.get(i);if(n)switch(s){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!n.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#i?this.#i.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new bi;for(const[e,s]of this.#e)t.update(`${e}:${s.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class sr{constructor(t,{disableRange:e=!1,disableStream:s=!1}){et(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:n,progressiveDone:r,contentDispositionFilename:a}=t;if(this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=a,n?.length>0){const o=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(o)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((o,l)=>{this._onReceiveData({begin:o,chunk:l})}),t.addProgressListener((o,l)=>{this._onProgress({loaded:o,total:l})}),t.addProgressiveReadListener(o=>{this._onReceiveData({chunk:o})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(s),!0)});et(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){et(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new ir(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new nr(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class ir{constructor(t,e,s=!1,i=null){this._stream=t,this._done=s||!1,this._filename=Es(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class nr{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function rr(c){let t=!0,e=s("filename\\*","i").exec(c);if(e){e=e[1];let h=a(e);return h=unescape(h),h=o(h),h=l(h),n(h)}if(e=r(c),e){const h=l(e);return n(h)}if(e=s("filename","i").exec(c),e){e=e[1];let h=a(e);return h=l(h),n(h)}function s(h,d){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function i(h,d){if(h){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const u=new TextDecoder(h,{fatal:!0}),f=ve(d);d=u.decode(f),t=!1}catch{}}return d}function n(h){return t&&/[\x80-\xff]/.test(h)&&(h=i("utf-8",h),t&&(h=i("iso-8859-1",h))),h}function r(h){const d=[];let u;const f=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(u=f.exec(h))!==null;){let[,p,b,m]=u;if(p=parseInt(p,10),p in d){if(p===0)break;continue}d[p]=[b,m]}const g=[];for(let p=0;p<d.length&&p in d;++p){let[b,m]=d[p];m=a(m),b&&(m=unescape(m),p===0&&(m=o(m))),g.push(m)}return g.join("")}function a(h){if(h.startsWith('"')){const d=h.slice(1).split('\\"');for(let u=0;u<d.length;++u){const f=d[u].indexOf('"');f!==-1&&(d[u]=d[u].slice(0,f),d.length=u+1),d[u]=d[u].replaceAll(/\\(.)/g,"$1")}h=d.join('"')}return h}function o(h){const d=h.indexOf("'");if(d===-1)return h;const u=h.slice(0,d),g=h.slice(d+1).replace(/^[^']*'/,"");return i(u,g)}function l(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,u,f,g){if(f==="q"||f==="Q")return g=g.replaceAll("_"," "),g=g.replaceAll(/=([0-9a-fA-F]{2})/g,function(p,b){return String.fromCharCode(parseInt(b,16))}),i(u,g);try{g=atob(g)}catch{}return i(u,g)})}return""}function xi(c,t){const e=new Headers;if(!c||!t||typeof t!="object")return e;for(const s in t){const i=t[s];i!==void 0&&e.append(s,i)}return e}function Qe(c){return URL.parse(c)?.origin??null}function Si({responseHeaders:c,isHttp:t,rangeChunkSize:e,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(c.get("Content-Length"),10);return!Number.isInteger(n)||(i.suggestedLength=n,n<=2*e)||s||!t||c.get("Accept-Ranges")!=="bytes"||(c.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function Ei(c){const t=c.get("Content-Disposition");if(t){let e=rr(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Es(e))return e}return null}function Ee(c,t){return new Ve(`Unexpected server response (${c}) while retrieving PDF "${t}".`,c,c===404||c===0&&t.startsWith("file:"))}function Ti(c){return c===200||c===206}function ki(c,t,e){return{method:"GET",headers:c,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function Pi(c){return c instanceof Uint8Array?c.buffer:c instanceof ArrayBuffer?c:(B(`getArrayBuffer - unexpected data format: ${c}`),new Uint8Array(c).buffer)}class ar{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=xi(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return et(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new or(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new lr(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class or{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers),i=e.url;fetch(i,ki(s,this._withCredentials,this._abortController)).then(n=>{if(t._responseOrigin=Qe(n.url),!Ti(n.status))throw Ee(n.status,i);this._reader=n.body.getReader(),this._headersCapability.resolve();const r=n.headers,{allowRangeRequests:a,suggestedLength:o}=Si({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=o||this._contentLength,this._filename=Ei(r),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new $t("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Pi(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class lr{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${e}-${s-1}`);const r=i.url;fetch(r,ki(n,this._withCredentials,this._abortController)).then(a=>{const o=Qe(a.url);if(o!==t._responseOrigin)throw new Error(`Expected range response-origin "${o}" to match "${t._responseOrigin}".`);if(!Ti(a.status))throw Ee(a.status,r);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Pi(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const cs=200,ds=206;function hr(c){const t=c.response;return typeof t!="string"?t:ve(t).buffer}class cr{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:s}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=xi(this.isHttp,e),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[n,r]of this.headers)e.setRequestHeader(n,r);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=ds):i.expectedStatus=cs,e.responseType="arraybuffer",et(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){const s=this.pendingRequests[t];s&&s.onProgress?.(e)}onStateChange(t,e){const s=this.pendingRequests[t];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],i.status===0&&this.isHttp){s.onError(i.status);return}const n=i.status||cs;if(!(n===cs&&s.expectedStatus===ds)&&n!==s.expectedStatus){s.onError(i.status);return}const a=hr(i);if(n===ds){const o=i.getResponseHeader("Content-Range"),l=/bytes (\d+)-(\d+)\/(\d+)/.exec(o);l?s.onDone({begin:parseInt(l[1],10),chunk:a}):(B('Missing or invalid "Content-Range" header.'),s.onError(0))}else a?s.onDone({begin:0,chunk:a}):s.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class dr{constructor(t){this._source=t,this._manager=new cr(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return et(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new ur(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new fr(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class ur{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Qe(e.responseURL);const s=e.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[o,...l]=a.split(": ");return[o,l.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:r}=Si({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=Ei(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Ee(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class fr{constructor(t,e,s){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=Qe(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=Ee(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const pr=/^[a-z][a-z0-9\-+.]+:/i;function gr(c){if(pr.test(c))return new URL(c);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(c))}class mr{constructor(t){this.source=t,this.url=gr(t.url),et(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return et(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new br(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new yr(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class br{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=Ee(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new $t("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class yr{constructor(t,e,s){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=t.source;this._isStreamingSupported=!i.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const he=Symbol("INITIAL_DATA");class Mi{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:he}}get(t,e=null){if(e){const i=this.#e(t);return i.promise.then(()=>e(i.data)),null}const s=this.#t[t];if(!s||s.data===he)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=this.#t[t];return!!e&&e.data!==he}delete(t){const e=this.#t[t];return!e||e.data===he?!1:(delete this.#t[t],!0)}resolve(t,e=null){const s=this.#e(t);s.data=e,s.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==he&&(yield[t,e])}}}const Ar=1e5,ai=30;class ht{#t=Promise.withResolvers();#e=null;#s=!1;#i=!!globalThis.FontInspector?.enabled;#r=null;#n=null;#a=0;#o=0;#l=null;#h=null;#u=0;#c=0;#f=Object.create(null);#g=[];#p=null;#d=[];#m=new WeakMap;#A=null;static#b=new Map;static#w=new Map;static#v=new WeakMap;static#y=null;static#_=new Set;constructor({textContentSource:t,container:e,viewport:s}){if(t instanceof ReadableStream)this.#p=t;else if(typeof t=="object")this.#p=new ReadableStream({start(o){o.enqueue(t),o.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#h=e,this.#c=s.scale*Mt.pixelRatio,this.#u=s.rotation,this.#n={div:null,properties:null,ctx:null};const{pageWidth:i,pageHeight:n,pageX:r,pageY:a}=s.rawDims;this.#A=[1,0,0,-1,-r,a+n],this.#o=i,this.#a=n,ht.#P(),qt(e,s),this.#t.promise.finally(()=>{ht.#_.delete(this),this.#n=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=ot.platform;return H(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#l.read().then(({value:e,done:s})=>{if(s){this.#t.resolve();return}this.#r??=e.lang,Object.assign(this.#f,e.styles),this.#k(e.items),t()},this.#t.reject)};return this.#l=this.#p.getReader(),ht.#_.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const s=t.scale*Mt.pixelRatio,i=t.rotation;if(i!==this.#u&&(e?.(),this.#u=i,qt(this.#h,{rotation:i})),s!==this.#c){e?.(),this.#c=s;const n={div:null,properties:null,ctx:ht.#L(this.#r)};for(const r of this.#d)n.properties=this.#m.get(r),n.div=r,this.#x(n)}}cancel(){const t=new $t("TextLayer task cancelled.");this.#l?.cancel(t).catch(()=>{}),this.#l=null,this.#t.reject(t)}get textDivs(){return this.#d}get textContentItemsStr(){return this.#g}#k(t){if(this.#s)return;this.#n.ctx??=ht.#L(this.#r);const e=this.#d,s=this.#g;for(const i of t){if(e.length>Ar){B("Ignoring additional textDivs for performance reasons."),this.#s=!0;return}if(i.str===void 0){if(i.type==="beginMarkedContentProps"||i.type==="beginMarkedContent"){const n=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),i.id&&this.#e.setAttribute("id",`${i.id}`),n.append(this.#e)}else i.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}s.push(i.str),this.#E(i)}}#E(t){const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#d.push(e);const i=M.transform(this.#A,t.transform);let n=Math.atan2(i[1],i[0]);const r=this.#f[t.fontName];r.vertical&&(n+=Math.PI/2);let a=this.#i&&r.fontSubstitution||r.fontFamily;a=ht.fontFamilyMap.get(a)||a;const o=Math.hypot(i[2],i[3]),l=o*ht.#N(a,r,this.#r);let h,d;n===0?(h=i[4],d=i[5]-l):(h=i[4]+l*Math.sin(n),d=i[5]-l*Math.cos(n));const u="calc(var(--total-scale-factor) *",f=e.style;this.#e===this.#h?(f.left=`${(100*h/this.#o).toFixed(2)}%`,f.top=`${(100*d/this.#a).toFixed(2)}%`):(f.left=`${u}${h.toFixed(2)}px)`,f.top=`${u}${d.toFixed(2)}px)`),f.fontSize=`${u}${(ht.#y*o).toFixed(2)}px)`,f.fontFamily=a,s.fontSize=o,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#i&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),n!==0&&(s.angle=n*(180/Math.PI));let g=!1;if(t.str.length>1)g=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const p=Math.abs(t.transform[0]),b=Math.abs(t.transform[3]);p!==b&&Math.max(p,b)/Math.min(p,b)>1.5&&(g=!0)}if(g&&(s.canvasWidth=r.vertical?t.height:t.width),this.#m.set(e,s),this.#n.div=e,this.#n.properties=s,this.#x(this.#n),s.hasText&&this.#e.append(e),s.hasEOL){const p=document.createElement("br");p.setAttribute("role","presentation"),this.#e.append(p)}}#x(t){const{div:e,properties:s,ctx:i}=t,{style:n}=e;let r="";if(ht.#y>1&&(r=`scale(${1/ht.#y})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:a}=n,{canvasWidth:o,fontSize:l}=s;ht.#T(i,l*this.#c,a);const{width:h}=i.measureText(e.textContent);h>0&&(r=`scaleX(${o*this.#c/h}) ${r}`)}s.angle!==0&&(r=`rotate(${s.angle}deg) ${r}`),r.length>0&&(n.transform=r)}static cleanup(){if(!(this.#_.size>0)){this.#b.clear();for(const{canvas:t}of this.#w.values())t.remove();this.#w.clear()}}static#L(t=null){let e=this.#w.get(t||="");if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#w.set(t,e),this.#v.set(e,{size:0,family:""})}return e}static#T(t,e,s){const i=this.#v.get(t);e===i.size&&s===i.family||(t.font=`${e}px ${s}`,i.size=e,i.family=s)}static#P(){if(this.#y!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#y=t.getBoundingClientRect().height,t.remove()}static#N(t,e,s){const i=this.#b.get(t);if(i)return i;const n=this.#L(s);n.canvas.width=n.canvas.height=ai,this.#T(n,ai,t);const r=n.measureText(""),a=r.fontBoundingBoxAscent,o=Math.abs(r.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let l=.8;return a?l=a/(a+o):(ot.platform.isFirefox&&B("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?l=e.ascent:e.descent&&(l=1+e.descent)),this.#b.set(t,l),l}}class Ae{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function i(n){if(!n)return;let r=null;const a=n.name;if(a==="#text")r=n.value;else if(Ae.shouldBuildText(a))n?.attributes?.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&e.push({str:r}),!!n.children)for(const o of n.children)i(o)}return i(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const Cr=100;function wr(c={}){typeof c=="string"||c instanceof URL?c={url:c}:(c instanceof ArrayBuffer||ArrayBuffer.isView(c))&&(c={data:c});const t=new Ds,{docId:e}=t,s=c.url?kn(c.url):null,i=c.data?Pn(c.data):null,n=c.httpHeaders||null,r=c.withCredentials===!0,a=c.password??null,o=c.range instanceof Ri?c.range:null,l=Number.isInteger(c.rangeChunkSize)&&c.rangeChunkSize>0?c.rangeChunkSize:2**16;let h=c.worker instanceof Ce?c.worker:null;const d=c.verbosity,u=typeof c.docBaseUrl=="string"&&!Ye(c.docBaseUrl)?c.docBaseUrl:null,f=De(c.cMapUrl),g=c.cMapPacked!==!1,p=c.CMapReaderFactory||(ct?On:Xs),b=De(c.iccUrl),m=De(c.standardFontDataUrl),A=c.StandardFontDataFactory||(ct?Bn:Ys),y=De(c.wasmUrl),C=c.WasmFactory||(ct?Hn:Ks),w=c.stopAtErrors!==!0,v=Number.isInteger(c.maxImageSize)&&c.maxImageSize>-1?c.maxImageSize:-1,x=c.isEvalSupported!==!1,S=typeof c.isOffscreenCanvasSupported=="boolean"?c.isOffscreenCanvasSupported:!ct,E=typeof c.isImageDecoderSupported=="boolean"?c.isImageDecoderSupported:!ct&&(ot.platform.isFirefox||!globalThis.chrome),D=Number.isInteger(c.canvasMaxAreaInBytes)?c.canvasMaxAreaInBytes:-1,T=typeof c.disableFontFace=="boolean"?c.disableFontFace:ct,V=c.fontExtraProperties===!0,P=c.enableXfa===!0,N=c.ownerDocument||globalThis.document,$=c.disableRange===!0,R=c.disableStream===!0,L=c.disableAutoFetch===!0,q=c.pdfBug===!0,lt=c.CanvasFactory||(ct?Fn:Dn),Rt=c.FilterFactory||(ct?Nn:In),_t=c.enableHWA===!0,st=c.useWasm!==!1,Y=o?o.length:c.length??NaN,Zt=typeof c.useSystemFonts=="boolean"?c.useSystemFonts:!ct&&!T,Nt=typeof c.useWorkerFetch=="boolean"?c.useWorkerFetch:!!(p===Xs&&A===Ys&&C===Ks&&f&&m&&y&&fe(f,document.baseURI)&&fe(m,document.baseURI)&&fe(y,document.baseURI)),Ft=null;an(d);const X={canvasFactory:new lt({ownerDocument:N,enableHWA:_t}),filterFactory:new Rt({docId:e,ownerDocument:N}),cMapReaderFactory:Nt?null:new p({baseUrl:f,isCompressed:g}),standardFontDataFactory:Nt?null:new A({baseUrl:m}),wasmFactory:Nt?null:new C({baseUrl:y})};h||(h=Ce.create({verbosity:d,port:be.workerPort}),t._worker=h);const oe={docId:e,apiVersion:"5.4.149",data:i,password:a,disableAutoFetch:L,rangeChunkSize:l,length:Y,docBaseUrl:u,enableXfa:P,evaluatorOptions:{maxImageSize:v,disableFontFace:T,ignoreErrors:w,isEvalSupported:x,isOffscreenCanvasSupported:S,isImageDecoderSupported:E,canvasMaxAreaInBytes:D,fontExtraProperties:V,useSystemFonts:Zt,useWasm:st,useWorkerFetch:Nt,cMapUrl:f,iccUrl:b,standardFontDataUrl:m,wasmUrl:y}},Vi={ownerDocument:N,pdfBug:q,styleElement:Ft,loadingParams:{disableAutoFetch:L,enableXfa:P}};return h.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const zi=h.messageHandler.sendWithPromise("GetDocRequest",oe,i?[i.buffer]:null);let ts;if(o)ts=new sr(o,{disableRange:$,disableStream:R});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const es=fe(s)?ar:ct?mr:dr;ts=new es({url:s,length:Y,httpHeaders:n,withCredentials:r,rangeChunkSize:l,disableRange:$,disableStream:R})}return zi.then(es=>{if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const js=new pe(e,es,h.port),Gi=new xr(js,t,ts,Vi,X,_t);t._transport=Gi,js.send("Ready",null)})}).catch(t._capability.reject),t}class Ds{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Ds.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class Ri{#t=Promise.withResolvers();#e=[];#s=[];#i=[];#r=[];constructor(t,e,s=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(t){this.#r.push(t)}addProgressListener(t){this.#i.push(t)}addProgressiveReadListener(t){this.#s.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const s of this.#r)s(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const s of this.#i)s(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#s)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){z("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class vr{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return H(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class _r{#t=!1;constructor(t,e,s,i=!1){this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=i?new Us:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new Mi,this._intentStates=new Map,this.destroyed=!1,this.recordedGroups=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=!1}={}){return new xe({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return H(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:s,intent:i="display",annotationMode:n=Ht.ENABLE,transform:r=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:h=null,printAnnotationStorage:d=null,isEditing:u=!1,recordOperations:f=!1,filteredOperationIndexes:g=null}){this._stats?.time("Overall");const p=this._transport.getRenderingIntent(i,n,d,u),{renderingIntent:b,cacheKey:m}=p;this.#t=!1,o||=this._transport.getOptionalContentConfig(b);let A=this._intentStates.get(m);A||(A=Object.create(null),this._intentStates.set(m,A)),A.streamReaderCancelTimeout&&(clearTimeout(A.streamReaderCancelTimeout),A.streamReaderCancelTimeout=null);const y=!!(b&mt.PRINT);A.displayReadyCapability||(A.displayReadyCapability=Promise.withResolvers(),A.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(p));const C=!this.recordedGroups&&(f||this._pdfBug&&globalThis.StepperManager?.enabled),w=S=>{if(A.renderTasks.delete(v),C){const E=v.gfx?.dependencyTracker.take();E?(v.stepper?.setOperatorGroups(E),f&&(this.recordedGroups=E)):f&&(this.recordedGroups=[])}y&&(this.#t=!0),this.#e(),S?(v.capability.reject(S),this._abortOperatorList({intentState:A,reason:S instanceof Error?S:new Error(S)})):v.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},v=new ie({callback:w,params:{canvas:e,canvasContext:t,dependencyTracker:C?new jn(e):null,viewport:s,transform:r,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:A.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!y,pdfBug:this._pdfBug,pageColors:h,enableHWA:this._transport.enableHWA,filteredOperationIndexes:g});(A.renderTasks||=new Set).add(v);const x=v.task;return Promise.all([A.displayReadyCapability.promise,o]).then(([S,E])=>{if(this.destroyed){w();return}if(this._stats?.time("Rendering"),!(E.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");v.initializeGraphics({transparency:S,optionalContentConfig:E}),v.operatorListChanged()}).catch(w),x}getOperatorList({intent:t="display",annotationMode:e=Ht.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){function n(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(o))}const r=this._transport.getRenderingIntent(t,e,s,i,!0);let a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let o;return a.opListReadCapability||(o=Object.create(null),o.operatorListChanged=n,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(o),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>Ae.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,i){function n(){r.read().then(function({value:o,done:l}){if(l){s(a);return}a.lang??=o.lang,Object.assign(a.styles,o.styles),a.items.push(...o.items),n()},i)}const r=e.getReader(),a={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new Us),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const s=this._intentStates.get(e);s&&(this._stats?.timeEnd("Page Request"),s.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){const{map:n,transfer:r}=s,o=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:i},r).getReader(),l=this._intentStates.get(e);l.streamReader=o;const h=()=>{o.read().then(({value:d,done:u})=>{if(u){l.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,l),h())},d=>{if(l.streamReader=null,!this._transport.destroyed){if(l.operatorList){l.operatorList.lastChunk=!0;for(const u of l.renderTasks)u.operatorListChanged();this.#e()}if(l.displayReadyCapability)l.displayReadyCapability.reject(d);else if(l.opListReadCapability)l.opListReadCapability.reject(d);else throw d}})};h()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof Ss){let i=Cr;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new $t(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,n]of this._intentStates)if(n===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}var jt,vt,It,Gt,Ue,Ut,Wt,ut,je,Li,Di,ge,re,$e;const U=class U{constructor({name:t=null,port:e=null,verbosity:s=on()}={}){xt(this,ut);xt(this,jt,Promise.withResolvers());xt(this,vt,null);xt(this,It,null);xt(this,Gt,null);if(this.name=t,this.destroyed=!1,this.verbosity=s,e){if(G(U,Wt).has(e))throw new Error("Cannot use more than one PDFWorker per port.");G(U,Wt).set(e,this),St(this,ut,Li).call(this,e)}else St(this,ut,Di).call(this)}get promise(){return G(this,jt).promise}get port(){return G(this,It)}get messageHandler(){return G(this,vt)}destroy(){this.destroyed=!0,G(this,Gt)?.terminate(),ft(this,Gt,null),G(U,Wt).delete(G(this,It)),ft(this,It,null),G(this,vt)?.destroy(),ft(this,vt,null)}static create(t){const e=G(this,Wt).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new U(t)}static get workerSrc(){if(be.workerSrc)return be.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return H(this,"_setupFakeWorkerGlobal",(async()=>G(this,re,$e)?G(this,re,$e):(await import(this.workerSrc)).WorkerMessageHandler)())}};jt=new WeakMap,vt=new WeakMap,It=new WeakMap,Gt=new WeakMap,Ue=new WeakMap,Ut=new WeakMap,Wt=new WeakMap,ut=new WeakSet,je=function(){G(this,jt).resolve(),G(this,vt).send("configure",{verbosity:this.verbosity})},Li=function(t){ft(this,It,t),ft(this,vt,new pe("main","worker",t)),G(this,vt).on("ready",()=>{}),St(this,ut,je).call(this)},Di=function(){if(G(U,Ut)||G(U,re,$e)){St(this,ut,ge).call(this);return}let{workerSrc:t}=U;try{U._isSameOrigin(window.location,t)||(t=U._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new pe("main","worker",e),i=()=>{n.abort(),s.destroy(),e.terminate(),this.destroyed?G(this,jt).reject(new Error("Worker was destroyed")):St(this,ut,ge).call(this)},n=new AbortController;e.addEventListener("error",()=>{G(this,Gt)||i()},{signal:n.signal}),s.on("test",a=>{if(n.abort(),this.destroyed||!a){i();return}ft(this,vt,s),ft(this,It,e),ft(this,Gt,e),St(this,ut,je).call(this)}),s.on("ready",a=>{if(n.abort(),this.destroyed){i();return}try{r()}catch{St(this,ut,ge).call(this)}});const r=()=>{const a=new Uint8Array;s.send("test",a,[a.buffer])};r();return}catch{Xe("The worker has been disabled.")}St(this,ut,ge).call(this)},ge=function(){G(U,Ut)||(B("Setting up fake worker."),ft(U,Ut,!0)),U._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){G(this,jt).reject(new Error("Worker was destroyed"));return}const e=new Ln;ft(this,It,e);const s=`fake${Vs(U,Ue)._++}`,i=new pe(s+"_worker",s,e);t.setup(i,e),ft(this,vt,new pe(s,s+"_worker",e)),St(this,ut,je).call(this)}).catch(t=>{G(this,jt).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},re=new WeakSet,$e=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},xt(U,re),xt(U,Ue,0),xt(U,Ut,!1),xt(U,Wt,new WeakMap),ct&&(ft(U,Ut,!0),be.workerSrc||="./pdf.worker.mjs"),U._isSameOrigin=(t,e)=>{const s=URL.parse(t);if(!s?.origin||s.origin==="null")return!1;const i=new URL(e,s);return s.origin===i.origin},U._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},U.fromPort=t=>{if(An("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return U.create(t)};let Ce=U;class xr{#t=new Map;#e=new Map;#s=new Map;#i=new Map;#r=null;constructor(t,e,s,i,n,r){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Mi,this.fontLoader=new En({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=r,this.setupMessageHandler()}#n(t,e=null){const s=this.#t.get(t);if(s)return s;const i=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,i),i}get annotationStorage(){return H(this,"annotationStorage",new Ps)}getRenderingIntent(t,e=Ht.ENABLE,s=null,i=!1,n=!1){let r=mt.DISPLAY,a=bs;switch(t){case"any":r=mt.ANY;break;case"display":break;case"print":r=mt.PRINT;break;default:B(`getRenderingIntent - invalid intent: ${t}`)}const o=r&mt.PRINT&&s instanceof yi?s:this.annotationStorage;switch(e){case Ht.DISABLE:r+=mt.ANNOTATIONS_DISABLE;break;case Ht.ENABLE:break;case Ht.ENABLE_FORMS:r+=mt.ANNOTATIONS_FORMS;break;case Ht.ENABLE_STORAGE:r+=mt.ANNOTATIONS_STORAGE,a=o.serializable;break;default:B(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(r+=mt.IS_EDITING),n&&(r+=mt.OPLIST);const{ids:l,hash:h}=o.modifiedIds,d=[r,a.hash,h];return{renderingIntent:r,cacheKey:d.join("_"),annotationStorageSerializable:a,modifiedIds:l}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of this.#e.values())t.push(s._destroy());this.#e.clear(),this.#s.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),ht.cleanup(),this._networkStream?.cancelAllRequests(new $t("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,i)=>{et(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},i.onPull=()=>{this._fullReader.read().then(function({value:n,done:r}){if(r){i.close();return}et(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{i.error(n)})},i.onCancel=n=>{this._fullReader.cancel(n),i.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async s=>{await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:n,contentLength:r}=this._fullReader;return(!i||!n)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{e.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:i,isRangeSupported:n,contentLength:r}}),t.on("GetRangeReader",(s,i)=>{et(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(s.begin,s.end);if(!n){i.close();return}i.onPull=()=>{n.read().then(function({value:r,done:a}){if(a){i.close();return}et(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{n.cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new vr(s,this))}),t.on("DocException",s=>{e._capability.reject(pt(s))}),t.on("PasswordRequest",s=>{this.#r=Promise.withResolvers();try{if(!e.onPassword)throw pt(s);const i=n=>{n instanceof Error?this.#r.reject(n):this.#r.resolve({password:n})};e.onPassword(i,s.code)}catch(i){this.#r.reject(i)}return this.#r.promise}),t.on("DataLoaded",s=>{e.onProgress?.({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;this.#e.get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,i,n])=>{if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in n){const l=n.error;B(`Error during font loading: ${l}`),this.commonObjs.resolve(s,l);break}const r=this._params.pdfBug&&globalThis.FontInspector?.enabled?(l,h)=>globalThis.FontInspector.fontAdded(l,h):null,a=new Tn(n,r);this.fontLoader.bind(a).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!a.fontExtraProperties&&a.data&&(a.data=null),this.commonObjs.resolve(s,a)});break;case"CopyLocalImage":const{imageRef:o}=n;et(o,"The imageRef must be defined.");for(const l of this.#e.values())for(const[,h]of l.objs)if(h?.ref===o)return h.dataLen?(this.commonObjs.resolve(s,structuredClone(h)),h.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,n);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([s,i,n,r])=>{if(this.destroyed)return;const a=this.#e.get(i);if(!a.objs.has(s)){if(a._intentStates.size===0){r?.bitmap?.close();return}switch(n){case"Image":case"Pattern":a.objs.resolve(s,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",s=>{this.destroyed||e.onProgress?.({loaded:s.loaded,total:s.total})}),t.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&B("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=this.#s.get(e);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#i.set(n.refStr,t);const r=new _r(e,n,this,this._params.pdfBug);return this.#e.set(e,r),r});return this.#s.set(e,i),i}getPageIndex(t){return ys(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#n("GetFieldObjects")}hasJSActions(){return this.#n("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#n("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#n("GetOptionalContentConfig").then(e=>new er(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(i=>({info:i[0],metadata:i[1]?new Jn(i[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),ht.cleanup()}}cachedPageNumber(t){if(!ys(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#i.get(e)??null}}class Sr{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class ie{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:r,pageIndex:a,canvasFactory:o,filterFactory:l,useRequestAnimationFrame:h=!1,pdfBug:d=!1,pageColors:u=null,enableHWA:f=!1,filteredOperationIndexes:g=null}){this.callback=t,this.params=e,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=o,this.filterFactory=l,this._pdfBug=d,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Sr(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=f,this._dependencyTracker=e.dependencyTracker,this._filteredOperationIndexes=g}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(ie.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");ie.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:n,dependencyTracker:r}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new ne(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,r),this.gfx.beginDrawing({transform:i,viewport:s,transparency:t,background:n}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),ie.#e.delete(this._canvas),t||=new Ss(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._filteredOperationIndexes),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),ie.#e.delete(this._canvas),this.callback())))}}const Er="5.4.149",Tr="9e2e9e209";class Ct{#t=null;#e=null;#s;#i=null;#r=!1;#n=!1;#a=null;#o;#l=null;#h=null;static#u=null;static get _keyboardManager(){return H(this,"_keyboardManager",new Se([[["Escape","mac+Escape"],Ct.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ct.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ct.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ct.prototype._moveToPrevious],[["Home","mac+Home"],Ct.prototype._moveToBeginning],[["End","mac+End"],Ct.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#n=!1,this.#a=t):this.#n=!0,this.#h=t?._uiManager||e,this.#o=this.#h._eventBus,this.#s=t?.color?.toUpperCase()||this.#h?.highlightColors.values().next().value||"#FFFF98",Ct.#u||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#a&&(t.ariaControls=`${this.#a.id}_colorpicker_dropdown`);const e=this.#h._signal;t.addEventListener("click",this.#p.bind(this),{signal:e}),t.addEventListener("keydown",this.#g.bind(this),{signal:e});const s=this.#e=document.createElement("span");return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=this.#s,t.append(s),t}renderMainDropdown(){const t=this.#i=this.#c();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#c(){const t=document.createElement("div"),e=this.#h._signal;t.addEventListener("contextmenu",wt,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#a&&(t.id=`${this.#a.id}_colorpicker_dropdown`);for(const[s,i]of this.#h.highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",i),n.title=s,n.setAttribute("data-l10n-id",Ct.#u[s]);const r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=i,n.ariaSelected=i===this.#s,n.addEventListener("click",this.#f.bind(this,i),{signal:e}),t.append(n)}return t.addEventListener("keydown",this.#g.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:j.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#p(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#m){this.#p(t);return}if(t.target===this.#t){this.#i.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#i?.firstChild||t.target===this.#t){this.#m&&this._hideDropdownFromKeyboard();return}this.#m||this.#p(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#m){this.#p(t);return}this.#i.firstChild?.focus()}_moveToEnd(t){if(!this.#m){this.#p(t);return}this.#i.lastChild?.focus()}#g(t){Ct._keyboardManager.exec(this,t)}#p(t){if(this.#m){this.hideDropdown();return}if(this.#r=t.detail===0,this.#l||(this.#l=new AbortController,window.addEventListener("pointerdown",this.#d.bind(this),{signal:this.#h.combinedSignal(this.#l)})),this.#t.ariaExpanded="true",this.#i){this.#i.classList.remove("hidden");return}const e=this.#i=this.#c();this.#t.append(e)}#d(t){this.#i?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#l?.abort(),this.#l=null}get#m(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#n){if(!this.#m){this.#a?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#i)return;const e=this.#h.highlightColors.values();for(const s of this.#i.children)s.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#i?.remove(),this.#i=null}}class we{#t=null;#e=null;#s=null;static#i=null;constructor(t){this.#e=t,this.#s=t._uiManager,we.#i||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,colorValue:s}=this.#e,i=this.#t=document.createElement("input");return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",we.#i[t]),i.addEventListener("input",()=>{this.#s.updateParams(e,i.value)},{signal:this.#s._signal}),i}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function oi(c){return Math.floor(Math.max(0,Math.min(1,c))*255).toString(16).padStart(2,"0")}function ce(c){return Math.max(0,Math.min(255,255*c))}class li{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=ce(t),[t,t,t]}static G_HTML([t]){const e=oi(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(ce)}static RGB_HTML(t){return`#${t.map(oi).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[ce(1-Math.min(1,t+i)),ce(1-Math.min(1,s+i)),ce(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const i=1-t,n=1-e,r=1-s,a=Math.min(i,n,r);return["CMYK",i,n,r,a]}}class kr{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){z("Abstract method `_createSVG` called.")}}class Ge extends kr{_createSVG(t){return document.createElementNS(Lt,t)}}class Ii{static setupStorage(t,e,s,i,n){const r=i.getValue(e,{value:null});switch(s.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),n==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(r.value===s.attributes.xfaOn?t.setAttribute("checked",!0):r.value===s.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",a=>{i.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),n==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const a of s.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{const o=a.target.options,l=o.selectedIndex===-1?"":o[o.selectedIndex].value;i.setValue(e,{value:l})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:n}){const{attributes:r}=e,a=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${i}`);for(const[o,l]of Object.entries(r))if(l!=null)switch(o){case"class":l.length&&t.setAttribute(o,l.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",l);break;case"style":Object.assign(t.style,l);break;case"textContent":t.textContent=l;break;default:(!a||o!=="href"&&o!=="newWindow")&&t.setAttribute(o,l)}a&&n.addLinkAttributes(t,r.href,r.newWindow),s&&r.dataId&&this.setupStorage(t,r.dataId,e,s)}static render(t){const e=t.annotationStorage,s=t.linkService,i=t.xfaHtml,n=t.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:n,linkService:s});const a=n!=="richText",o=t.div;if(o.append(r),t.viewport){const d=`matrix(${t.viewport.transform.join(",")})`;o.style.transform=d}a&&o.setAttribute("class","xfaLayer xfaFont");const l=[];if(i.children.length===0){if(i.value){const d=document.createTextNode(i.value);r.append(d),a&&Ae.shouldBuildText(i.name)&&l.push(d)}return{textDivs:l}}const h=[[i,-1,r]];for(;h.length>0;){const[d,u,f]=h.at(-1);if(u+1===d.children.length){h.pop();continue}const g=d.children[++h.at(-1)[1]];if(g===null)continue;const{name:p}=g;if(p==="#text"){const m=document.createTextNode(g.value);l.push(m),f.append(m);continue}const b=g?.attributes?.xmlns?document.createElementNS(g.attributes.xmlns,p):document.createElement(p);if(f.append(b),g.attributes&&this.setAttributes({html:b,element:g,storage:e,intent:n,linkService:s}),g.children?.length>0)h.push([g,-1,b]);else if(g.value){const m=document.createTextNode(g.value);a&&Ae.shouldBuildText(p)&&l.push(m),b.append(m)}}for(const d of o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:l}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Pr=9,Xt=new WeakSet,Mr=new Date().getTimezoneOffset()*60*1e3;class hi{static create(t){switch(t.data.annotationType){case J.LINK:return new Is(t);case J.TEXT:return new Rr(t);case J.WIDGET:switch(t.data.fieldType){case"Tx":return new Lr(t);case"Btn":return t.data.radioButton?new Ni(t):t.data.checkBox?new Ir(t):new Nr(t);case"Ch":return new Fr(t);case"Sig":return new Dr(t)}return new Kt(t);case J.POPUP:return new Cs(t);case J.FREETEXT:return new Fi(t);case J.LINE:return new Br(t);case J.SQUARE:return new Hr(t);case J.CIRCLE:return new jr(t);case J.POLYLINE:return new Oi(t);case J.CARET:return new Vr(t);case J.INK:return new Ns(t);case J.POLYGON:return new $r(t);case J.HIGHLIGHT:return new Bi(t);case J.UNDERLINE:return new zr(t);case J.SQUIGGLY:return new Gr(t);case J.STRIKEOUT:return new Ur(t);case J.STAMP:return new Hi(t);case J.FILEATTACHMENT:return new Wr(t);default:return new Z(t)}}}class Z{#t=null;#e=!1;#s=null;constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Z._hasPopupData(this.data)}get hasCommentButton(){return this.enableComment&&this._isEditable&&this.hasPopupElement}get commentButtonPosition(){const{quadPoints:t,rect:e}=this.data;let s=-1/0,i=-1/0;if(t?.length>=8){for(let n=0;n<t.length;n+=8)t[n+1]>i?(i=t[n+1],s=t[n+2]):t[n+1]===i&&(s=Math.max(s,t[n+2]));return[s,i]}return e?[e[2],e[3]]:null}get commentButtonColor(){if(!this.data.color)return null;const[t,e,s]=this.data.color,n=255*(1-(this.data.opacity??1));return this.#i(Math.min(t+n,255),Math.min(e+n,255),Math.min(s+n,255))}#i(t,e,s){t/=255,e/=255,s/=255;const i=Math.max(t,e,s),n=Math.min(t,e,s),r=(i+n)/2,a=((1+Math.sqrt(r))/2*100).toFixed(2);if(i===n)return`hsl(0, 0%, ${a}%)`;const o=i-n;let l;i===t?l=(e-s)/o+(e<s?6:0):i===e?l=(s-t)/o+2:l=(t-e)/o+4,l=(l*60).toFixed(2);const h=(o/(1-Math.abs(2*r-1))*100).toFixed(2);return`hsl(${l}, ${h}%, ${a}%)`}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-n)/s,t[1]=100*(t[1]-r)/i,t}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:s}=t;e&&this.#r(e);let i=this.#s?.popup||this.popup;!i&&s?.text&&(this._createPopup(s),i=this.#s.popup),i&&(i.updateEdited(t),s?.deleted&&(i.remove(),this.#s=null,this.popup=null))}resetEdited(){this.#t&&(this.#r(this.#t.rect),this.#s?.popup.resetEdited(),this.#t=null)}#r(t){const{container:{style:e},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:o}}}}=this;s?.splice(0,4,...t),e.left=`${100*(t[0]-a)/n}%`,e.top=`${100*(r-t[3]+o)/r}%`,i===0?(e.width=`${100*(t[2]-t[0])/n}%`,e.height=`${100*(t[3]-t[1])/r}%`):this.setRotation(i)}_createContainer(t){const{data:e,parent:{page:s,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),!(this instanceof Kt)&&!(this instanceof Is)&&(n.tabIndex=0);const{style:r}=n;if(r.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof Cs){const{rotation:p}=e;return!e.hasOwnCanvas&&p!==0&&this.setRotation(p,n),n}const{width:a,height:o}=this;if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const p=e.borderStyle.horizontalCornerRadius,b=e.borderStyle.verticalCornerRadius;if(p>0||b>0){const A=`calc(${p}px * var(--total-scale-factor)) / calc(${b}px * var(--total-scale-factor))`;r.borderRadius=A}else if(this instanceof Ni){const A=`calc(${a}px * var(--total-scale-factor)) / calc(${o}px * var(--total-scale-factor))`;r.borderRadius=A}switch(e.borderStyle.style){case Jt.SOLID:r.borderStyle="solid";break;case Jt.DASHED:r.borderStyle="dashed";break;case Jt.BEVELED:B("Unimplemented border style: beveled");break;case Jt.INSET:B("Unimplemented border style: inset");break;case Jt.UNDERLINE:r.borderBottomStyle="solid";break}const m=e.borderColor||null;m?(this.#e=!0,r.borderColor=M.makeHexColor(m[0]|0,m[1]|0,m[2]|0)):r.borderWidth=0}const l=M.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:h,pageHeight:d,pageX:u,pageY:f}=i.rawDims;r.left=`${100*(l[0]-u)/h}%`,r.top=`${100*(l[1]-f)/d}%`;const{rotation:g}=e;return e.hasOwnCanvas||g===0?(r.width=`${100*a/h}%`,r.height=`${100*o/d}%`):this.setRotation(g,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:n,height:r}=this;t%180!==0&&([n,r]=[r,n]),e.style.width=`${100*n/s}%`,e.style.height=`${100*r/i}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,i)=>{const n=i.detail[e],r=n[0],a=n.slice(1);i.target.style[s]=li[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[s]:li[`${r}_rgb`](a)})};return H(this,"_commonActions",{display:e=>{const{display:s}=e.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const i of Object.keys(e.detail))(t[i]||s[i])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[i,n]of Object.entries(e)){const r=s[i];if(r){const a={detail:{[i]:n},target:t};r(a),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,i,n]=this.data.rect.map(p=>Math.fround(p));if(t.length===8){const[p,b,m,A]=t.subarray(2,6);if(i===p&&n===b&&e===m&&s===A)return}const{style:r}=this.container;let a;if(this.#e){const{borderColor:p,borderWidth:b}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${p}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const o=i-e,l=n-s,{svgFactory:h}=this,d=h.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0),d.role="none";const u=h.createElement("defs");d.append(u);const f=h.createElement("clipPath"),g=`clippath_${this.data.id}`;f.setAttribute("id",g),f.setAttribute("clipPathUnits","objectBoundingBox"),u.append(f);for(let p=2,b=t.length;p<b;p+=8){const m=t[p],A=t[p+1],y=t[p+2],C=t[p+3],w=h.createElement("rect"),v=(y-e)/o,x=(n-A)/l,S=(m-y)/o,E=(A-C)/l;w.setAttribute("x",v),w.setAttribute("y",x),w.setAttribute("width",S),w.setAttribute("height",E),f.append(w),a?.push(`<rect vector-effect="non-scaling-stroke" x="${v}" y="${x}" width="${S}" height="${E}"/>`)}this.#e&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(d),this.container.style.clipPath=`url(#${g})`}_createPopup(t=null){const{data:e}=this;let s,i;t?(s={str:t.text},i=t.date):(s=e.contentsObj,i=e.modificationDate);const n=this.#s=new Cs({data:{color:e.color,titleObj:e.titleObj,modificationDate:i,contentsObj:s,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent.div.append(n.render())}get hasPopupElement(){return!!(this.#s||this.popup||this.data.popupRef)}render(){z("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:n,id:r,exportValues:a}of i){if(n===-1||r===e)continue;const o=typeof a=="string"?a:null,l=document.querySelector(`[data-element-id="${r}"]`);if(l&&!Xt.has(l)){B(`_getElementsByName - element not allowed: ${r}`);continue}s.push({id:r,exportValue:o,domElement:l})}return s}for(const i of document.getElementsByName(t)){const{exportValue:n}=i,r=i.getAttribute("data-element-id");r!==e&&Xt.has(i)&&s.push({id:r,exportValue:n,domElement:i})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Is extends Z{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let i=!1;return t.url?(e.addLinkAttributes(s,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(s,t.action,t.overlaidText),i=!0):t.attachment?(this.#e(s,t.attachment,t.overlaidText,t.attachmentDest),i=!0):t.setOCGState?(this.#s(s,t.setOCGState,t.overlaidText),i=!0):t.dest?(this._bindLink(s,t.dest,t.overlaidText),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),i=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(s,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(s),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,s=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),s&&(t.title=s)}_bindNamedAction(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),s&&(t.title=s),this.#t()}#e(t,e,s="",i=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:s&&(t.title=s),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,i),!1),this.#t()}#s(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),s&&(t.title=s),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(e.actions)){const n=s.get(i);n&&(t[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:i}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){B('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{s?.();const{fields:i,refs:n,include:r}=e,a=[];if(i.length!==0||n.length!==0){const h=new Set(n);for(const d of i){const u=this._fieldObjects[d]||[];for(const{id:f}of u)h.add(f)}for(const d of Object.values(this._fieldObjects))for(const u of d)h.has(u.id)===r&&a.push(u)}else for(const h of Object.values(this._fieldObjects))a.push(...h);const o=this.annotationStorage,l=[];for(const h of a){const{id:d}=h;switch(l.push(d),h.type){case"text":{const f=h.defaultValue||"";o.setValue(d,{value:f});break}case"checkbox":case"radiobutton":{const f=h.defaultValue===h.exportValues;o.setValue(d,{value:f});break}case"combobox":case"listbox":{const f=h.defaultValue||"";o.setValue(d,{value:f});break}default:continue}const u=document.querySelector(`[data-element-id="${d}"]`);if(u){if(!Xt.has(u)){B(`_bindResetFormAction - element not allowed: ${d}`);continue}}else continue;u.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:l,name:"ResetForm"}}),!1}}}class Rr extends Z{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class Kt extends Z{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return ot.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,n){s.includes("mouse")?t.addEventListener(s,r=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(s,r=>{if(s==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r)}})})}_setEventListeners(t,e,s,i){for(const[n,r]of s)(r==="Action"||this.data.actions?.[r])&&((r==="Focus"||r==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,n,r,i),r==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):r==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":M.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||Pr,n=t.style;let r;const a=2,o=l=>Math.round(10*l)/10;if(this.data.multiLine){const l=Math.abs(this.data.rect[3]-this.data.rect[1]-a),h=Math.round(l/(ns*i))||1,d=l/h;r=Math.min(i,o(d/ns))}else{const l=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(i,o(l/ns))}n.fontSize=`calc(${r}px * var(--total-scale-factor))`,n.color=M.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class Lr extends Kt{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,i){const n=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=s),n.setValue(r.id,{[i]:s})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const i=t.getValue(e,{value:this.data.fieldValue});let n=i.value||"";const r=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;r&&n.length>r&&(n=n.slice(0,r));let a=i.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const o={userValue:n,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=a??n,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",a??n),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Xt.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:l,datetimeType:h,timeStep:d}=this.data,u=!!h&&this.enableScripting;l&&(s.title=l),this._setRequired(s,this.data.required),r&&(s.maxLength=r),s.addEventListener("input",g=>{t.setValue(e,{value:g.target.value}),this.setPropertyOnSiblings(s,"value",g.target.value,"value"),o.formattedValue=null}),s.addEventListener("resetform",g=>{const p=this.data.defaultFieldValue??"";s.value=o.userValue=p,o.formattedValue=null});let f=g=>{const{formattedValue:p}=o;p!=null&&(g.target.value=p),g.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",p=>{if(o.focused)return;const{target:b}=p;if(u&&(b.type=h,d&&(b.step=d)),o.userValue){const m=o.userValue;if(u)if(h==="time"){const A=new Date(m),y=[A.getHours(),A.getMinutes(),A.getSeconds()];b.value=y.map(C=>C.toString().padStart(2,"0")).join(":")}else b.value=new Date(m-Mr).toISOString().split(h==="date"?"T":".",1)[0];else b.value=m}o.lastCommittedValue=b.value,o.commitKey=1,this.data.actions?.Focus||(o.focused=!0)}),s.addEventListener("updatefromsandbox",p=>{this.showElementAndHideCanvas(p.target);const b={value(m){o.userValue=m.detail.value??"",u||t.setValue(e,{value:o.userValue.toString()}),m.target.value=o.userValue},formattedValue(m){const{formattedValue:A}=m.detail;o.formattedValue=A,A!=null&&m.target!==document.activeElement&&(m.target.value=A);const y={formattedValue:A};u&&(y.value=A),t.setValue(e,y)},selRange(m){m.target.setSelectionRange(...m.detail.selRange)},charLimit:m=>{const{charLimit:A}=m.detail,{target:y}=m;if(A===0){y.removeAttribute("maxLength");return}y.setAttribute("maxLength",A);let C=o.userValue;!C||C.length<=A||(C=C.slice(0,A),y.value=o.userValue=C,t.setValue(e,{value:C}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:C,willCommit:!0,commitKey:1,selStart:y.selectionStart,selEnd:y.selectionEnd}}))}};this._dispatchEventFromSandbox(b,p)}),s.addEventListener("keydown",p=>{o.commitKey=1;let b=-1;if(p.key==="Escape"?b=0:p.key==="Enter"&&!this.data.multiLine?b=2:p.key==="Tab"&&(o.commitKey=3),b===-1)return;const{value:m}=p.target;o.lastCommittedValue!==m&&(o.lastCommittedValue=m,o.userValue=m,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:m,willCommit:!0,commitKey:b,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}))});const g=f;f=null,s.addEventListener("blur",p=>{if(!o.focused||!p.relatedTarget)return;this.data.actions?.Blur||(o.focused=!1);const{target:b}=p;let{value:m}=b;if(u){if(m&&h==="time"){const A=m.split(":").map(y=>parseInt(y,10));m=new Date(2e3,0,1,A[0],A[1],A[2]||0).valueOf(),b.step=""}else m=new Date(m).valueOf();b.type="text"}o.userValue=m,o.lastCommittedValue!==m&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:m,willCommit:!0,commitKey:o.commitKey,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}),g(p)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",p=>{o.lastCommittedValue=null;const{data:b,target:m}=p,{value:A,selectionStart:y,selectionEnd:C}=m;let w=y,v=C;switch(p.inputType){case"deleteWordBackward":{const x=A.substring(0,y).match(/\w*[^\w]*$/);x&&(w-=x[0].length);break}case"deleteWordForward":{const x=A.substring(y).match(/^[^\w]*\w*/);x&&(v+=x[0].length);break}case"deleteContentBackward":y===C&&(w-=1);break;case"deleteContentForward":y===C&&(v+=1);break}p.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:A,change:b||"",willCommit:!1,selStart:w,selEnd:v}})}),this._setEventListeners(s,o,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],p=>p.target.value)}if(f&&s.addEventListener("blur",f),this.data.comb){const p=(this.data.rect[2]-this.data.rect[0])/r;s.classList.add("comb"),s.style.letterSpacing=`calc(${p}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Dr extends Kt{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class Ir extends Kt{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return Xt.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=0,n.addEventListener("change",r=>{const{name:a,checked:o}=r.target;for(const l of this._getElementsByName(a,s)){const h=o&&l.exportValue===e.exportValue;l.domElement&&(l.domElement.checked=h),t.setValue(l.id,{value:h})}t.setValue(s,{value:o})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue||"Off";r.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{const a={value(o){o.target.checked=o.detail.value!=="Off",t.setValue(s,{value:o.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Ni extends Kt{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(s,{value:i})),i)for(const r of this._getElementsByName(e.fieldName,s))t.setValue(r.id,{value:!1});const n=document.createElement("input");if(Xt.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=0,n.addEventListener("change",r=>{const{name:a,checked:o}=r.target;for(const l of this._getElementsByName(a,s))t.setValue(l.id,{value:!1});t.setValue(s,{value:o})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue;r.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){const r=e.buttonValue;n.addEventListener("updatefromsandbox",a=>{const o={value:l=>{const h=r===l.detail.value;for(const d of this._getElementsByName(l.target.name)){const u=h&&d.id===s;d.domElement&&(d.domElement.checked=u),t.setValue(d.id,{value:u})}}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Nr extends Is{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class Fr extends Kt{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");Xt.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",h=>{const d=this.data.defaultFieldValue;for(const u of i.options)u.selected=u.value===d});for(const h of this.data.options){const d=document.createElement("option");d.textContent=h.displayValue,d.value=h.exportValue,s.value.includes(h.exportValue)&&(d.setAttribute("selected",!0),n=!1),i.append(d)}let r=null;if(n){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),i.prepend(h),r=()=>{h.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}const a=h=>{const d=h?"value":"textContent",{options:u,multiple:f}=i;return f?Array.prototype.filter.call(u,g=>g.selected).map(g=>g[d]):u.selectedIndex===-1?null:u[u.selectedIndex][d]};let o=a(!1);const l=h=>{const d=h.target.options;return Array.prototype.map.call(d,u=>({displayValue:u.textContent,exportValue:u.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",h=>{const d={value(u){r?.();const f=u.detail.value,g=new Set(Array.isArray(f)?f:[f]);for(const p of i.options)p.selected=g.has(p.value);t.setValue(e,{value:a(!0)}),o=a(!1)},multipleSelection(u){i.multiple=!0},remove(u){const f=i.options,g=u.detail.remove;f[g].selected=!1,i.remove(g),f.length>0&&Array.prototype.findIndex.call(f,b=>b.selected)===-1&&(f[0].selected=!0),t.setValue(e,{value:a(!0),items:l(u)}),o=a(!1)},clear(u){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),o=a(!1)},insert(u){const{index:f,displayValue:g,exportValue:p}=u.detail.insert,b=i.children[f],m=document.createElement("option");m.textContent=g,m.value=p,b?b.before(m):i.append(m),t.setValue(e,{value:a(!0),items:l(u)}),o=a(!1)},items(u){const{items:f}=u.detail;for(;i.length!==0;)i.remove(0);for(const g of f){const{displayValue:p,exportValue:b}=g,m=document.createElement("option");m.textContent=p,m.value=b,i.append(m)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:a(!0),items:l(u)}),o=a(!1)},indices(u){const f=new Set(u.detail.indices);for(const g of u.target.options)g.selected=f.has(g.index);t.setValue(e,{value:a(!0)}),o=a(!1)},editable(u){u.target.disabled=!u.detail.editable}};this._dispatchEventFromSandbox(d,h)}),i.addEventListener("input",h=>{const d=a(!0),u=a(!1);t.setValue(e,{value:d}),h.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:o,change:u,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):i.addEventListener("input",function(h){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Cs extends Z{constructor(t){const{data:e,elements:s}=t;super(t,{isRenderable:Z._hasPopupData(e)}),this.elements=s,this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=new Or({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,eventBus:this.linkService.eventBus}),s=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",s.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",s.map(i=>`${xs}${i}`).join(",")),this.container}}class Or{#t=this.#I.bind(this);#e=this.#S.bind(this);#s=this.#H.bind(this);#i=this.#R.bind(this);#r=null;#n=null;#a=null;#o=null;#l=null;#h=null;#u=null;#c=null;#f=!1;#g=null;#p=null;#d=null;#m=null;#A=null;#b=null;#w=null;#v=null;#y=null;#_=null;#k=!1;constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:n,contentsObj:r,richText:a,parent:o,rect:l,parentRect:h,open:d,eventBus:u=null}){this.#n=t,this.#y=i,this.#a=r,this.#v=a,this.#u=o,this.#r=e,this.#w=l,this.#c=h,this.#l=s,this.#h=u,this.#o=gs.toDateObject(n),this.trigger=s.flatMap(f=>f.getElementsToTriggerPopup()),this.#E(),this.#n.hidden=!0,d&&this.#R()}#E(){if(this.#p)return;this.#p=new AbortController;const{signal:t}=this.#p;for(const e of this.trigger)e.addEventListener("click",this.#i,{signal:t}),e.addEventListener("mouseenter",this.#s,{signal:t}),e.addEventListener("mouseleave",this.#e,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#t,{signal:t});this.#L()}#x(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#A=t._normalizePoint(t.commentButtonPosition),this.#b=t.commentButtonColor)}#L(){if(this.#m||(this.#A||this.#x(),!this.#A))return;const t=this.#m=document.createElement("button");t.className="annotationCommentButton";const e=this.#l[0].container;t.style.zIndex=e.style.zIndex+1,t.tabIndex=0;const{signal:s}=this.#p;t.addEventListener("hover",this.#i,{signal:s}),t.addEventListener("keydown",this.#t,{signal:s}),t.addEventListener("click",()=>{const[{data:{id:n},annotationEditorType:r}]=this.#l;this.#h?.dispatch("switchannotationeditormode",{source:this,editId:n,mode:r,editComment:!0})},{signal:s});const{style:i}=t;i.left=`calc(${this.#A[0]}%)`,i.top=`calc(${this.#A[1]}% - var(--comment-button-dim))`,this.#b&&(i.backgroundColor=this.#b),e.after(t)}render(){if(this.#g)return;const t=this.#g=document.createElement("div");if(t.className="popup",this.#r){const i=t.style.outlineColor=M.makeHexColor(...this.#r);t.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#y?.str){const i=document.createElement("span");i.className="title",e.append(i),{dir:i.dir,str:i.textContent}=this.#y}if(t.append(e),this.#o){const i=document.createElement("time");i.className="popupDate",i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),i.dateTime=this.#o.toISOString(),e.append(i)}const s=this.#T;if(s)Ii.render({xfaHtml:s,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const i=this._formatContents(this.#a);t.append(i)}this.#n.append(t)}get#T(){const t=this.#v,e=this.#a;return t?.str&&(!e?.str||e.str===t.str)&&this.#v.html||null}get#P(){return this.#T?.attributes?.style?.fontSize||0}get#N(){return this.#T?.attributes?.style?.color||null}#D(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:this.#N,fontSize:this.#P?`calc(${this.#P}px * var(--total-scale-factor))`:""}};for(const n of t.split(`
`))e.push({name:"span",value:n,attributes:i});return s}_formatContents({str:t,dir:e}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=e;const i=t.split(/(?:\r\n?|\n)/);for(let n=0,r=i.length;n<r;++n){const a=i[n];s.append(document.createTextNode(a)),n<r-1&&s.append(document.createElement("br"))}return s}#I(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#R()}updateEdited({rect:t,popup:e,deleted:s}){if(s||e?.deleted){this.remove();return}this.#E(),this.#_||={contentsObj:this.#a,richText:this.#v},t&&(this.#d=null),e&&(this.#v=this.#D(e.text),this.#o=gs.toDateObject(e.date),this.#a=null),this.#g?.remove(),this.#g=null}resetEdited(){this.#_&&({contentsObj:this.#a,richText:this.#v}=this.#_,this.#_=null,this.#g?.remove(),this.#g=null,this.#d=null)}remove(){this.#p?.abort(),this.#p=null,this.#g?.remove(),this.#g=null,this.#k=!1,this.#f=!1;for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#F(){if(this.#d!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:i,pageY:n}}}=this.#u;let r=!!this.#c,a=r?this.#c:this.#w;for(const g of this.#l)if(!a||M.intersect(g.data.rect,a)!==null){a=g.data.rect,r=!0;break}const o=M.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),h=r?a[2]-a[0]+5:0,d=o[0]+h,u=o[1];this.#d=[100*(d-i)/e,100*(u-n)/s];const{style:f}=this.#n;f.left=`${this.#d[0]}%`,f.top=`${this.#d[1]}%`}#R(){this.#f=!this.#f,this.#f?(this.#H(),this.#n.addEventListener("click",this.#i),this.#n.addEventListener("keydown",this.#t)):(this.#S(),this.#n.removeEventListener("click",this.#i),this.#n.removeEventListener("keydown",this.#t))}#H(){this.#g||this.render(),this.isVisible?this.#f&&this.#n.classList.add("focused"):(this.#F(),this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#S(){this.#n.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#k=this.isVisible,this.#k&&(this.#n.hidden=!0)}maybeShow(){this.#E(),this.#k&&(this.#g||this.#H(),this.#k=!1,this.#n.hidden=!1)}get isVisible(){return this.#n.hidden===!1}}class Fi extends Z{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=O.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Br extends Z{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=this.#t=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),n.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),n.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),n.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),n.setAttribute("stroke-width",t.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),i.append(n),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Hr extends Z{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",n/2),r.setAttribute("y",n/2),r.setAttribute("width",e-n),r.setAttribute("height",s-n),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class jr extends Z{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",e/2),r.setAttribute("cy",s/2),r.setAttribute("rx",e/2-n/2),r.setAttribute("ry",s/2-n/2),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Oi extends Z{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:s,popupRef:i},width:n,height:r}=this;if(!e)return this.container;const a=this.svgFactory.create(n,r,!0);let o=[];for(let h=0,d=e.length;h<d;h+=2){const u=e[h]-t[0],f=t[3]-e[h+1];o.push(`${u},${f}`)}o=o.join(" ");const l=this.#t=this.svgFactory.createElement(this.svgElementName);return l.setAttribute("points",o),l.setAttribute("stroke-width",s.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),a.append(l),this.container.append(a),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class $r extends Oi{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Vr extends Z{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Ns extends Z{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?O.HIGHLIGHT:O.INK}#s(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:s,borderStyle:i,popupRef:n}}=this,{transform:r,width:a,height:o}=this.#s(e,t),l=this.svgFactory.create(a,o,!0),h=this.#t=this.svgFactory.createElement("svg:g");l.append(h),h.setAttribute("stroke-width",i.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",r);for(let d=0,u=s.length;d<u;d++){const f=this.svgFactory.createElement(this.svgElementName);this.#e.push(f),f.setAttribute("points",s[d].join(",")),h.append(f)}return!n&&this.hasPopupData&&this._createPopup(),this.container.append(l),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:s,rect:i}=t,n=this.#t;if(e>=0&&n.setAttribute("stroke-width",e||1),s)for(let r=0,a=this.#e.length;r<a;r++)this.#e[r].setAttribute("points",s[r].join(","));if(i){const{transform:r,width:a,height:o}=this.#s(this.data.rotation,i);n.parentElement.setAttribute("viewBox",`0 0 ${a} ${o}`),n.setAttribute("transform",r)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}get commentButtonPosition(){const{inkLists:t,rect:e}=this.data;if(t?.length>=1){let s=-1/0,i=-1/0;for(const n of t)for(let r=0,a=n.length;r<a;r+=2)n[r+1]>i?(i=n[r+1],s=n[r]):n[r+1]===i&&(s=Math.max(s,n[r]));if(s!==1/0)return[s,i]}return e?[e[2],e[3]]:null}}class Bi extends Z{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=O.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class zr extends Z{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Gr extends Z{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Ur extends Z{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Hi extends Z{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=O.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Wr extends Z{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let s;e.hasAppearance||e.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#e.bind(this)),this.#t=s;const{isMac:i}=ot.platform;return t.addEventListener("keydown",n=>{n.key==="Enter"&&(i?n.metaKey:n.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Fs{#t=null;#e=null;#s=new Map;#i=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:r,structTreeLayer:a}){this.div=t,this.#t=e,this.#e=s,this.#i=a||null,this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return this.#s.size>0}async#r(t,e,s){const i=t.firstChild||t,n=i.id=`${xs}${e}`,r=await this.#i?.getAriaAttributes(n);if(r)for(const[a,o]of r)i.setAttribute(a,o);s?s.at(-1).container.after(t):(this.div.append(t),this.#t?.moveElementInDOM(this.div,t,i,!1))}async render(t){const{annotations:e}=t,s=this.div;qt(s,this.viewport);const i=new Map,n={data:null,layer:s,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Ge,annotationStorage:t.annotationStorage||new Ps,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const r of e){if(r.noHTML)continue;const a=r.annotationType===J.POPUP;if(a){const h=i.get(r.id);if(!h)continue;n.elements=h}else if(r.rect[2]===r.rect[0]||r.rect[3]===r.rect[1])continue;n.data=r;const o=hi.create(n);if(!o.isRenderable)continue;if(!a&&r.popupRef){const h=i.get(r.popupRef);h?h.push(o):i.set(r.popupRef,[o])}const l=o.render();r.hidden&&(l.style.visibility="hidden"),await this.#r(l,r.id,n.elements),o._isEditable&&(this.#s.set(o.data.id,o),this._annotationEditorUIManager?.renderAnnotationElement(o))}this.#n()}async addLinkAnnotations(t,e){const s={data:null,layer:this.div,linkService:e,svgFactory:new Ge,parent:this};for(const i of t){i.borderStyle||=Fs._defaultBorderStyle,s.data=i;const n=hi.create(s);if(!n.isRenderable)continue;const r=n.render();await this.#r(r,i.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,qt(e,{rotation:t.rotation}),this.#n(),e.hidden=!1}#n(){if(!this.#e)return;const t=this.div;for(const[e,s]of this.#e){const i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:n}=i;n?n.nodeName==="CANVAS"?n.replaceWith(s):n.classList.contains("annotationContent")?n.after(s):n.before(s):i.append(s);const r=this.#s.get(e);r&&(r._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,i.id,s),r._hasNoCanvas=!1):r.canvas=s)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(t){return this.#s.get(t)}static get _defaultBorderStyle(){return H(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Jt.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const Oe=/\r\n?|\n/g;class it extends I{#t;#e="";#s=`${this.id}-editor`;#i=null;#r;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=it.prototype,e=n=>n.isEmpty(),s=Vt.TRANSLATE_SMALL,i=Vt.TRANSLATE_BIG;return H(this,"_keyboardManager",new Se([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}]]))}static _type="freetext";static _editorType=O.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#t=t.color||it._defaultColor||I._defaultLineColor,this.#r=t.fontSize||it._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(t,e){I.initialize(t,e);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case j.FREETEXT_SIZE:it._defaultFontSize=e;break;case j.FREETEXT_COLOR:it._defaultColor=e;break}}updateParams(t,e){switch(t){case j.FREETEXT_SIZE:this.#n(e);break;case j.FREETEXT_COLOR:this.#a(e);break}}static get defaultPropertiesToUpdate(){return[[j.FREETEXT_SIZE,it._defaultFontSize],[j.FREETEXT_COLOR,it._defaultColor||I._defaultLineColor]]}get propertiesToUpdate(){return[[j.FREETEXT_SIZE,this.#r],[j.FREETEXT_COLOR,this.#t]]}get toolbarButtons(){return this._colorPicker||=new we(this),[["colorPicker",this._colorPicker]]}get colorType(){return j.FREETEXT_COLOR}get colorValue(){return this.#t}#n(t){const e=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--total-scale-factor))`,this.translate(0,-(i-this.#r)*this.parentScale),this.#r=i,this.#l()},s=this.#r;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:j.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#a(t){const e=i=>{this.#t=this.editorDiv.style.color=i,this._colorPicker?.update(i)},s=this.#t;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:j.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-it._internalPadding*t,-(it._internalPadding+this.#r)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const t=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#s),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){const t=[];this.editorDiv.normalize();let e=null;for(const s of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(it.#h(s)),e=s);return t.join(`
`)}#l(){const[t,e]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:i,div:n}=this,r=n.style.display,a=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",i.div.append(this.div),s=n.getBoundingClientRect(),n.remove(),n.style.display=r,n.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/e):(this.width=s.height/t,this.height=s.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#e,e=this.#e=this.#o().trimEnd();if(t===e)return;const s=i=>{if(this.#e=i,!i){this.remove();return}this.#u(),this._uiManager.rebuild(this),this.#l()};this.addCommands({cmd:()=>{s(e)},undo:()=>{s(t)},mustExec:!1}),this.#l()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){it._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#s),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#r}px * var(--total-scale-factor))`,s.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[i,n]=this.parentDimensions;if(this.annotationElementId){const{position:r}=this._initialData;let[a,o]=this.getInitialTranslation();[a,o]=this.pageTranslationToScreen(a,o);const[l,h]=this.pageDimensions,[d,u]=this.pageTranslation;let f,g;switch(this.rotation){case 0:f=t+(r[0]-d)/l,g=e+this.height-(r[1]-u)/h;break;case 90:f=t+(r[0]-d)/l,g=e-(r[1]-u)/h,[a,o]=[o,-a];break;case 180:f=t-this.width+(r[0]-d)/l,g=e-(r[1]-u)/h,[a,o]=[-a,-o];break;case 270:f=t+(r[0]-d-this.height*h)/l,g=e+(r[1]-u-this.width*l)/h,[a,o]=[-o,a];break}this.setAt(f*i,g*n,a,o)}else this._moveAfterPaste(t,e);this.#u(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#h(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Oe,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:s}=e;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const i=it.#f(e.getData("text")||"").replaceAll(Oe,`
`);if(!i)return;const n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();const r=n.getRangeAt(0);if(!i.includes(`
`)){r.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),n.collapseToStart();return}const{startContainer:a,startOffset:o}=r,l=[],h=[];if(a.nodeType===Node.TEXT_NODE){const f=a.parentElement;if(h.push(a.nodeValue.slice(o).replaceAll(Oe,"")),f!==this.editorDiv){let g=l;for(const p of this.editorDiv.childNodes){if(p===f){g=h;continue}g.push(it.#h(p))}}l.push(a.nodeValue.slice(0,o).replaceAll(Oe,""))}else if(a===this.editorDiv){let f=l,g=0;for(const p of this.editorDiv.childNodes)g++===o&&(f=h),f.push(it.#h(p))}this.#e=`${l.join(`
`)}${i}${h.join(`
`)}`,this.#u();const d=new Range;let u=Math.sumPrecise(l.map(f=>f.length));for(const{firstChild:f}of this.editorDiv.childNodes)if(f.nodeType===Node.TEXT_NODE){const g=f.nodeValue.length;if(u<=g){d.setStart(f,u),d.setEnd(f,u);break}u-=g}n.removeAllRanges(),n.addRange(d)}#u(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const t of this.#e.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#c(){return this.#e.replaceAll(" "," ")}static#f(t){return t.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=it._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,s){let i=null;if(t instanceof Fi){const{data:{defaultAppearanceData:{fontSize:r,fontColor:a},rect:o,rotation:l,id:h,popupRef:d,contentsObj:u},textContent:f,textPosition:g,parent:{page:{pageNumber:p}}}=t;if(!f||f.length===0)return null;i=t={annotationType:O.FREETEXT,color:Array.from(a),fontSize:r,value:f.join(`
`),position:g,pageIndex:p-1,rect:o.slice(0),rotation:l,annotationElementId:h,id:h,deleted:!1,popupRef:d,comment:u?.str||null}}const n=await super.deserialize(t,e,s);return n.#r=t.fontSize,n.#t=M.makeHexColor(...t.color),n.#e=it.#f(t.value),n._initialData=i,t.comment&&n.setCommentData(t.comment),n}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=this.getPDFRect(),s=I._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),i={annotationType:O.FREETEXT,color:s,fontSize:this.#r,value:this.#c(),pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(i),t?(i.isCopy=!0,i):this.annotationElementId&&!this.#g(i)?null:(i.id=this.annotationElementId,i)}#g(t){const{value:e,fontSize:s,color:i,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==s||t.color.some((r,a)=>r!==i[a])||t.pageIndex!==n}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:s}=e;s.fontSize=`calc(${this.#r}px * var(--total-scale-factor))`,s.color=this.#t,e.replaceChildren();for(const n of this.#e.split(`
`)){const r=document.createElement("div");r.append(n?document.createTextNode(n):document.createElement("br")),e.append(r)}const i={rect:this.getPDFRect()};return i.popup=this.hasEditedComment?this.comment:{text:this.#e},t.updateEdited(i),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class k{static PRECISION=1e-4;toSVGPath(){z("Abstract method `toSVGPath` must be implemented.")}get box(){z("Abstract getter `box` must be implemented.")}serialize(t,e){z("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,i,n,r){r||=new Float32Array(t.length);for(let a=0,o=t.length;a<o;a+=2)r[a]=e+t[a]*i,r[a+1]=s+t[a+1]*n;return r}static _rescaleAndSwap(t,e,s,i,n,r){r||=new Float32Array(t.length);for(let a=0,o=t.length;a<o;a+=2)r[a]=e+t[a+1]*i,r[a+1]=s+t[a]*n;return r}static _translate(t,e,s,i){i||=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n+=2)i[n]=e+t[n],i[n+1]=s+t[n+1];return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,i,n){switch(n){case 90:return[1-e/s,t/i];case 180:return[1-t/s,1-e/i];case 270:return[e/s,1-t/i];default:return[t/s,e/i]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,i,n,r){return[(t+5*s)/6,(e+5*i)/6,(5*s+n)/6,(5*i+r)/6,(s+n)/2,(i+r)/2]}}class zt{#t;#e=[];#s;#i;#r=[];#n=new Float32Array(18);#a;#o;#l;#h;#u;#c;#f=[];static#g=8;static#p=2;static#d=zt.#g+zt.#p;constructor({x:t,y:e},s,i,n,r,a=0){this.#t=s,this.#c=n*i,this.#i=r,this.#n.set([NaN,NaN,NaN,NaN,t,e],6),this.#s=a,this.#h=zt.#g*i,this.#l=zt.#d*i,this.#u=i,this.#f.push(t,e)}isEmpty(){return isNaN(this.#n[8])}#m(){const t=this.#n.subarray(4,6),e=this.#n.subarray(16,18),[s,i,n,r]=this.#t;return[(this.#a+(t[0]-e[0])/2-s)/n,(this.#o+(t[1]-e[1])/2-i)/r,(this.#a+(e[0]-t[0])/2-s)/n,(this.#o+(e[1]-t[1])/2-i)/r]}add({x:t,y:e}){this.#a=t,this.#o=e;const[s,i,n,r]=this.#t;let[a,o,l,h]=this.#n.subarray(8,12);const d=t-l,u=e-h,f=Math.hypot(d,u);if(f<this.#l)return!1;const g=f-this.#h,p=g/f,b=p*d,m=p*u;let A=a,y=o;a=l,o=h,l+=b,h+=m,this.#f?.push(t,e);const C=-m/g,w=b/g,v=C*this.#c,x=w*this.#c;return this.#n.set(this.#n.subarray(2,8),0),this.#n.set([l+v,h+x],4),this.#n.set(this.#n.subarray(14,18),12),this.#n.set([l-v,h-x],16),isNaN(this.#n[6])?(this.#r.length===0&&(this.#n.set([a+v,o+x],2),this.#r.push(NaN,NaN,NaN,NaN,(a+v-s)/n,(o+x-i)/r),this.#n.set([a-v,o-x],14),this.#e.push(NaN,NaN,NaN,NaN,(a-v-s)/n,(o-x-i)/r)),this.#n.set([A,y,a,o,l,h],6),!this.isEmpty()):(this.#n.set([A,y,a,o,l,h],6),Math.abs(Math.atan2(y-o,A-a)-Math.atan2(m,b))<Math.PI/2?([a,o,l,h]=this.#n.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((a+l)/2-s)/n,((o+h)/2-i)/r),[a,o,A,y]=this.#n.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((A+a)/2-s)/n,((y+o)/2-i)/r),!0):([A,y,a,o,l,h]=this.#n.subarray(0,6),this.#r.push(((A+5*a)/6-s)/n,((y+5*o)/6-i)/r,((5*a+l)/6-s)/n,((5*o+h)/6-i)/r,((a+l)/2-s)/n,((o+h)/2-i)/r),[l,h,a,o,A,y]=this.#n.subarray(12,18),this.#e.push(((A+5*a)/6-s)/n,((y+5*o)/6-i)/r,((5*a+l)/6-s)/n,((5*o+h)/6-i)/r,((a+l)/2-s)/n,((o+h)/2-i)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#r,e=this.#e;if(isNaN(this.#n[6])&&!this.isEmpty())return this.#A();const s=[];s.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);this.#w(s);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return this.#b(s),s.join(" ")}#A(){const[t,e,s,i]=this.#t,[n,r,a,o]=this.#m();return`M${(this.#n[2]-t)/s} ${(this.#n[3]-e)/i} L${(this.#n[4]-t)/s} ${(this.#n[5]-e)/i} L${n} ${r} L${a} ${o} L${(this.#n[16]-t)/s} ${(this.#n[17]-e)/i} L${(this.#n[14]-t)/s} ${(this.#n[15]-e)/i} Z`}#b(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#w(t){const[e,s,i,n]=this.#t,r=this.#n.subarray(4,6),a=this.#n.subarray(16,18),[o,l,h,d]=this.#m();t.push(`L${(r[0]-e)/i} ${(r[1]-s)/n} L${o} ${l} L${h} ${d} L${(a[0]-e)/i} ${(a[1]-s)/n}`)}newFreeDrawOutline(t,e,s,i,n,r){return new ji(t,e,s,i,n,r)}getOutlines(){const t=this.#r,e=this.#e,s=this.#n,[i,n,r,a]=this.#t,o=new Float32Array((this.#f?.length??0)+2);for(let d=0,u=o.length-2;d<u;d+=2)o[d]=(this.#f[d]-i)/r,o[d+1]=(this.#f[d+1]-n)/a;if(o[o.length-2]=(this.#a-i)/r,o[o.length-1]=(this.#o-n)/a,isNaN(s[6])&&!this.isEmpty())return this.#v(o);const l=new Float32Array(this.#r.length+24+this.#e.length);let h=t.length;for(let d=0;d<h;d+=2){if(isNaN(t[d])){l[d]=l[d+1]=NaN;continue}l[d]=t[d],l[d+1]=t[d+1]}h=this.#_(l,h);for(let d=e.length-6;d>=6;d-=6)for(let u=0;u<6;u+=2){if(isNaN(e[d+u])){l[h]=l[h+1]=NaN,h+=2;continue}l[h]=e[d+u],l[h+1]=e[d+u+1],h+=2}return this.#y(l,h),this.newFreeDrawOutline(l,o,this.#t,this.#u,this.#s,this.#i)}#v(t){const e=this.#n,[s,i,n,r]=this.#t,[a,o,l,h]=this.#m(),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(e[2]-s)/n,(e[3]-i)/r,NaN,NaN,NaN,NaN,(e[4]-s)/n,(e[5]-i)/r,NaN,NaN,NaN,NaN,a,o,NaN,NaN,NaN,NaN,l,h,NaN,NaN,NaN,NaN,(e[16]-s)/n,(e[17]-i)/r,NaN,NaN,NaN,NaN,(e[14]-s)/n,(e[15]-i)/r],0),this.newFreeDrawOutline(d,t,this.#t,this.#u,this.#s,this.#i)}#y(t,e){const s=this.#e;return t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e),e+=6}#_(t,e){const s=this.#n.subarray(4,6),i=this.#n.subarray(16,18),[n,r,a,o]=this.#t,[l,h,d,u]=this.#m();return t.set([NaN,NaN,NaN,NaN,(s[0]-n)/a,(s[1]-r)/o,NaN,NaN,NaN,NaN,l,h,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,(i[0]-n)/a,(i[1]-r)/o],e),e+=24}}class ji extends k{#t;#e=new Float32Array(4);#s;#i;#r;#n;#a;constructor(t,e,s,i,n,r){super(),this.#a=t,this.#r=e,this.#t=s,this.#n=i,this.#s=n,this.#i=r,this.lastPoint=[NaN,NaN],this.#o(r);const[a,o,l,h]=this.#e;for(let d=0,u=t.length;d<u;d+=2)t[d]=(t[d]-a)/l,t[d+1]=(t[d+1]-o)/h;for(let d=0,u=e.length;d<u;d+=2)e[d]=(e[d]-a)/l,e[d+1]=(e[d+1]-o)/h}toSVGPath(){const t=[`M${this.#a[4]} ${this.#a[5]}`];for(let e=6,s=this.#a.length;e<s;e+=6){if(isNaN(this.#a[e])){t.push(`L${this.#a[e+4]} ${this.#a[e+5]}`);continue}t.push(`C${this.#a[e]} ${this.#a[e+1]} ${this.#a[e+2]} ${this.#a[e+3]} ${this.#a[e+4]} ${this.#a[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,s,i],n){const r=s-t,a=i-e;let o,l;switch(n){case 0:o=k._rescale(this.#a,t,i,r,-a),l=k._rescale(this.#r,t,i,r,-a);break;case 90:o=k._rescaleAndSwap(this.#a,t,e,r,a),l=k._rescaleAndSwap(this.#r,t,e,r,a);break;case 180:o=k._rescale(this.#a,s,e,-r,a),l=k._rescale(this.#r,s,e,-r,a);break;case 270:o=k._rescaleAndSwap(this.#a,s,i,-r,-a),l=k._rescaleAndSwap(this.#r,s,i,-r,-a);break}return{outline:Array.from(o),points:[Array.from(l)]}}#o(t){const e=this.#a;let s=e[4],i=e[5];const n=[s,i,s,i];let r=s,a=i;const o=t?Math.max:Math.min;for(let h=6,d=e.length;h<d;h+=6){const u=e[h+4],f=e[h+5];if(isNaN(e[h]))M.pointBoundingBox(u,f,n),a<f?(r=u,a=f):a===f&&(r=o(r,u));else{const g=[1/0,1/0,-1/0,-1/0];M.bezierBoundingBox(s,i,...e.slice(h,h+6),g),M.rectBoundingBox(...g,n),a<g[3]?(r=g[2],a=g[3]):a===g[3]&&(r=o(r,g[2]))}s=u,i=f}const l=this.#e;l[0]=n[0]-this.#s,l[1]=n[1]-this.#s,l[2]=n[2]-n[0]+2*this.#s,l[3]=n[3]-n[1]+2*this.#s,this.lastPoint=[r,a]}get box(){return this.#e}newOutliner(t,e,s,i,n,r=0){return new zt(t,e,s,i,n,r)}getNewOutline(t,e){const[s,i,n,r]=this.#e,[a,o,l,h]=this.#t,d=n*l,u=r*h,f=s*l+a,g=i*h+o,p=this.newOutliner({x:this.#r[0]*d+f,y:this.#r[1]*u+g},this.#t,this.#n,t,this.#i,e??this.#s);for(let b=2;b<this.#r.length;b+=2)p.add({x:this.#r[b]*d+f,y:this.#r[b+1]*u+g});return p.getOutlines()}}class ws{#t;#e;#s=[];#i=[];constructor(t,e=0,s=0,i=!0){const n=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:f,y:g,width:p,height:b}of t){const m=Math.floor((f-e)/r)*r,A=Math.ceil((f+p+e)/r)*r,y=Math.floor((g-e)/r)*r,C=Math.ceil((g+b+e)/r)*r,w=[m,y,C,!0],v=[A,y,C,!1];this.#s.push(w,v),M.rectBoundingBox(m,y,A,C,n)}const a=n[2]-n[0]+2*s,o=n[3]-n[1]+2*s,l=n[0]-s,h=n[1]-s,d=this.#s.at(i?-1:-2),u=[d[0],d[2]];for(const f of this.#s){const[g,p,b]=f;f[0]=(g-l)/a,f[1]=(p-h)/o,f[2]=(b-h)/o}this.#t=new Float32Array([l,h,a,o]),this.#e=u}getOutlines(){this.#s.sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of this.#s)e[3]?(t.push(...this.#l(e)),this.#a(e)):(this.#o(e),t.push(...this.#l(e)));return this.#r(t)}#r(t){const e=[],s=new Set;for(const r of t){const[a,o,l]=r;e.push([a,o,r],[a,l,r])}e.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=e.length;r<a;r+=2){const o=e[r][2],l=e[r+1][2];o.push(l),l.push(o),s.add(o),s.add(l)}const i=[];let n;for(;s.size>0;){const r=s.values().next().value;let[a,o,l,h,d]=r;s.delete(r);let u=a,f=o;for(n=[a,l],i.push(n);;){let g;if(s.has(h))g=h;else if(s.has(d))g=d;else break;s.delete(g),[a,o,l,h,d]=g,u!==a&&(n.push(u,f,a,f===o?o:l),u=a),f=f===o?l:o}n.push(u,f)}return new qr(i,this.#t,this.#e)}#n(t){const e=this.#i;let s=0,i=e.length-1;for(;s<=i;){const n=s+i>>1,r=e[n][0];if(r===t)return n;r<t?s=n+1:i=n-1}return i+1}#a([,t,e]){const s=this.#n(t);this.#i.splice(s,0,[t,e])}#o([,t,e]){const s=this.#n(t);for(let i=s;i<this.#i.length;i++){const[n,r]=this.#i[i];if(n!==t)break;if(n===t&&r===e){this.#i.splice(i,1);return}}for(let i=s-1;i>=0;i--){const[n,r]=this.#i[i];if(n!==t)break;if(n===t&&r===e){this.#i.splice(i,1);return}}}#l(t){const[e,s,i]=t,n=[[e,s,i]],r=this.#n(i);for(let a=0;a<r;a++){const[o,l]=this.#i[a];for(let h=0,d=n.length;h<d;h++){const[,u,f]=n[h];if(!(l<=u||f<=o)){if(u>=o){if(f>l)n[h][1]=l;else{if(d===1)return[];n.splice(h,1),h--,d--}continue}n[h][2]=o,f>l&&n.push([e,l,f])}}}return n}}class qr extends k{#t;#e;constructor(t,e,s){super(),this.#e=t,this.#t=e,this.lastPoint=s}toSVGPath(){const t=[];for(const e of this.#e){let[s,i]=e;t.push(`M${s} ${i}`);for(let n=2;n<e.length;n+=2){const r=e[n],a=e[n+1];r===s?(t.push(`V${a}`),i=a):a===i&&(t.push(`H${r}`),s=r)}t.push("Z")}return t.join(" ")}serialize([t,e,s,i],n){const r=[],a=s-t,o=i-e;for(const l of this.#e){const h=new Array(l.length);for(let d=0;d<l.length;d+=2)h[d]=t+l[d]*a,h[d+1]=i-l[d+1]*o;r.push(h)}return r}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class vs extends zt{newFreeDrawOutline(t,e,s,i,n,r){return new Xr(t,e,s,i,n,r)}}class Xr extends ji{newOutliner(t,e,s,i,n,r=0){return new vs(t,e,s,i,n,r)}}class K extends I{#t=null;#e=0;#s;#i=null;#r=null;#n=null;#a=null;#o=0;#l=null;#h=null;#u=null;#c=!1;#f=null;#g;#p=null;#d="";#m;#A="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=O.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=K.prototype;return H(this,"_keyboardManager",new Se([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||K._defaultColor,this.#m=t.thickness||K._defaultThickness,this.#g=t.opacity||K._defaultOpacity,this.#s=t.boxes||null,this.#A=t.methodOfCreation||"",this.#d=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#c=!0,this.#w(t),this.#E()):this.#s&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#a=t.focusNode,this.#o=t.focusOffset,this.#b(),this.#E(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#c?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#m,methodOfCreation:this.#A}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}get commentColor(){return this.color}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#b(){const t=new ws(this.#s,.001);this.#h=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#h.box;const e=new ws(this.#s,.0025,.001,this._uiManager.direction==="ltr");this.#n=e.getOutlines();const{lastPoint:s}=this.#n;this.#f=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]}#w({highlightOutlines:t,highlightId:e,clipPathId:s}){this.#h=t;const i=1.5;if(this.#n=t.getNewOutline(this.#m/2+i,.0025),e>=0)this.#u=e,this.#i=s,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},!0);else if(this.parent){const h=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:K.#x(this.#h.box,(h-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:K.#x(this.#n.box,h),path:{d:this.#n.toSVGPath()}})}const[n,r,a,o]=t.box;switch(this.rotation){case 0:this.x=n,this.y=r,this.width=a,this.height=o;break;case 90:{const[h,d]=this.parentDimensions;this.x=r,this.y=1-n,this.width=a*d/h,this.height=o*h/d;break}case 180:this.x=1-n,this.y=1-r,this.width=a,this.height=o;break;case 270:{const[h,d]=this.parentDimensions;this.x=1-r,this.y=n,this.width=a*d/h,this.height=o*h/d;break}}const{lastPoint:l}=this.#n;this.#f=[(l[0]-n)/a,(l[1]-r)/o]}static initialize(t,e){I.initialize(t,e),K._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case j.HIGHLIGHT_COLOR:K._defaultColor=e;break;case j.HIGHLIGHT_THICKNESS:K._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#f}updateParams(t,e){switch(t){case j.HIGHLIGHT_COLOR:this.#v(e);break;case j.HIGHLIGHT_THICKNESS:this.#y(e);break}}static get defaultPropertiesToUpdate(){return[[j.HIGHLIGHT_COLOR,K._defaultColor],[j.HIGHLIGHT_THICKNESS,K._defaultThickness]]}get propertiesToUpdate(){return[[j.HIGHLIGHT_COLOR,this.color||K._defaultColor],[j.HIGHLIGHT_THICKNESS,this.#m||K._defaultThickness],[j.HIGHLIGHT_FREE,this.#c]]}#v(t){const e=(n,r)=>{this.color=n,this.#g=r,this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:n,"fill-opacity":r}}),this.#r?.updateColor(n)},s=this.color,i=this.#g;this.addCommands({cmd:e.bind(this,t,K._defaultOpacity),undo:e.bind(this,s,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:j.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#y(t){const e=this.#m,s=i=>{this.#m=i,this.#_(i)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:j.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#r=new Ct({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#P())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#P())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#k(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#E(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#k():t&&(this.#E(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#_(t){if(!this.#c)return;this.#w({highlightOutlines:this.#h.getNewOutline(t/2)}),this.fixAndSetPosition();const[e,s]=this.parentDimensions;this.setDims(this.width*e,this.height*s)}#k(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#E(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#i}=t.drawLayer.draw({bbox:this.#h.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#g},rootClass:{highlight:!0,free:this.#c},path:{d:this.#h.toSVGPath()}},!1,!0),this.#p=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#c},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},this.#c),this.#l&&(this.#l.style.clipPath=this.#i))}static#x([t,e,s,i],n){switch(n){case 90:return[1-e-i,t,i,s];case 180:return[1-t-s,1-e-i,s,i];case 270:return[e,1-t-s,i,s]}return[t,e,s,i]}rotate(t){const{drawLayer:e}=this.parent;let s;this.#c?(t=(t-this.rotation+360)%360,s=K.#x(this.#h.box,t)):s=K.#x([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#u,{bbox:s,root:{"data-main-rotation":t}}),e.updateProperties(this.#p,{bbox:K.#x(this.#n.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#d&&(t.setAttribute("aria-label",this.#d),t.setAttribute("role","mark")),this.#c?t.classList.add("free"):this.div.addEventListener("keydown",this.#L.bind(this),{signal:this._uiManager._signal});const e=this.#l=document.createElement("div");t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#i;const[s,i]=this.parentDimensions;return this.setDims(this.width*s,this.height*i),mi(this,this.#l,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#L(t){K._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#T(!0);break;case 1:case 3:this.#T(!1);break}}#T(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#a,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#c||this.#T(!1))}get _mustFixPosition(){return!this.#c}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!t}}))}#P(){return this.#c?this.rotation:0}#N(){if(this.#c)return null;const[t,e]=this.pageDimensions,[s,i]=this.pageTranslation,n=this.#s,r=new Float32Array(n.length*8);let a=0;for(const{x:o,y:l,width:h,height:d}of n){const u=o*t+s,f=(1-l)*e+i;r[a]=r[a+4]=u,r[a+1]=r[a+3]=f,r[a+2]=r[a+6]=u+h*t,r[a+5]=r[a+7]=f-d*e,a+=8}return r}#D(t){return this.#h.serialize(t,this.#P())}static startHighlighting(t,e,{target:s,x:i,y:n}){const{x:r,y:a,width:o,height:l}=s.getBoundingClientRect(),h=new AbortController,d=t.combinedSignal(h),u=f=>{h.abort(),this.#F(t,f)};window.addEventListener("blur",u,{signal:d}),window.addEventListener("pointerup",u,{signal:d}),window.addEventListener("pointerdown",tt,{capture:!0,passive:!1,signal:d}),window.addEventListener("contextmenu",wt,{signal:d}),s.addEventListener("pointermove",this.#I.bind(this,t),{signal:d}),this._freeHighlight=new vs({x:i,y:n},[r,a,o,l],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#I(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#F(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,s){let i=null;if(t instanceof Bi){const{data:{quadPoints:g,rect:p,rotation:b,id:m,color:A,opacity:y,popupRef:C,contentsObj:w},parent:{page:{pageNumber:v}}}=t;i=t={annotationType:O.HIGHLIGHT,color:Array.from(A),opacity:y,quadPoints:g,boxes:null,pageIndex:v-1,rect:p.slice(0),rotation:b,annotationElementId:m,id:m,deleted:!1,popupRef:C,comment:w?.str||null}}else if(t instanceof Ns){const{data:{inkLists:g,rect:p,rotation:b,id:m,color:A,borderStyle:{rawWidth:y},popupRef:C,contentsObj:w},parent:{page:{pageNumber:v}}}=t;i=t={annotationType:O.HIGHLIGHT,color:Array.from(A),thickness:y,inkLists:g,boxes:null,pageIndex:v-1,rect:p.slice(0),rotation:b,annotationElementId:m,id:m,deleted:!1,popupRef:C,comment:w?.str||null}}const{color:n,quadPoints:r,inkLists:a,opacity:o}=t,l=await super.deserialize(t,e,s);l.color=M.makeHexColor(...n),l.#g=o||1,a&&(l.#m=t.thickness),l._initialData=i,t.comment&&l.setCommentData(t.comment);const[h,d]=l.pageDimensions,[u,f]=l.pageTranslation;if(r){const g=l.#s=[];for(let p=0;p<r.length;p+=8)g.push({x:(r[p]-u)/h,y:1-(r[p+1]-f)/d,width:(r[p+2]-r[p])/h,height:(r[p+1]-r[p+5])/d});l.#b(),l.#E(),l.rotate(l.rotation)}else if(a){l.#c=!0;const g=a[0],p={x:g[0]-u,y:d-(g[1]-f)},b=new vs(p,[0,0,h,d],1,l.#m/2,!0,.001);for(let y=0,C=g.length;y<C;y+=2)p.x=g[y]-u,p.y=d-(g[y+1]-f),b.add(p);const{id:m,clipPathId:A}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:l.color,"fill-opacity":l._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:b.toSVGPath()}},!0,!0);l.#w({highlightOutlines:b.getOutlines(),highlightId:m,clipPathId:A}),l.#E(),l.rotate(l.parentRotation)}return l}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=this.getPDFRect(),s=I._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i={annotationType:O.HIGHLIGHT,color:s,opacity:this.#g,thickness:this.#m,quadPoints:this.#N(),outlines:this.#D(e),pageIndex:this.pageIndex,rect:e,rotation:this.#P(),structTreeParentId:this._structTreeParentId};return this.addComment(i),this.annotationElementId&&!this.#R(i)?null:(i.id=this.annotationElementId,i)}#R(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((s,i)=>s!==e[i])}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const e={rect:this.getPDFRect()};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}static canCreateNewEmptyEditor(){return!1}}class $i{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,s)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){z("Not implemented")}}class F extends I{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#s=null;static#i=null;static#r=null;static#n=NaN;static#a=null;static#o=null;static#l=NaN;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(this.#h(t),this.#f())}#h({drawOutlines:t,drawId:e,drawingOptions:s}){this.#t=t,this._drawingOptions||=s,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#u(t,this.parent),this.#d(t.box)}#u(t,e){const{id:s}=e.drawLayer.draw(F._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(t,e){const s=new Set(Object.keys(t));for(const[i,n]of Object.entries(e))s.has(i)?Object.assign(t[i],n):t[i]=n;return t}static getDefaultDrawingOptions(t){z("Not implemented")}static get typesMap(){z("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,e),this._currentParent&&(F.#s.updateProperty(s,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[s,i]of this.typesMap)t.push([s,e[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[s,i]of this.constructor.typesMap)t.push([s,e[i]]);return t}_updateProperty(t,e,s){const i=this._drawingOptions,n=i[e],r=a=>{i.updateProperty(e,a);const o=this.#t.updateProperty(e,a);o&&this.#d(o),this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties()),t===this.colorType&&this._colorPicker?.update(a)};this.addCommands({cmd:r.bind(this,s),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#p()),{bbox:this.#m()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#p()),{bbox:this.#m()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#m()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#m()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#c(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#d(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#c()):t&&(this._uiManager.addShouldRescale(this),this.#f(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#c(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#u(this.#t,t)}}#g([t,e,s,i]){const{parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[e,1-t,s*(r/n),i*(n/r)];case 180:return[1-t,1-e,s,i];case 270:return[1-e,t,s*(r/n),i*(n/r)];default:return[t,e,s,i]}}#p(){const{x:t,y:e,width:s,height:i,parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[1-e,t,s*(n/r),i*(r/n)];case 180:return[1-t,1-e,s,i];case 270:return[e,1-t,s*(n/r),i*(r/n)];default:return[t,e,s,i]}}#d(t){if([this.x,this.y,this.width,this.height]=this.#g(t),this.div){this.fixAndSetPosition();const[e,s]=this.parentDimensions;this.setDims(this.width*e,this.height*s)}this._onResized()}#m(){const{x:t,y:e,width:s,height:i,rotation:n,parentRotation:r,parentDimensions:[a,o]}=this;switch((n*4+r)/90){case 1:return[1-e-i,t,i,s];case 2:return[1-t-s,1-e-i,s,i];case 3:return[e,1-t-s,i,s];case 4:return[t,e-s*(a/o),i*(o/a),s*(a/o)];case 5:return[1-e,t,s*(a/o),i*(o/a)];case 6:return[1-t-i*(o/a),1-e,i*(o/a),s*(a/o)];case 7:return[e-s*(a/o),1-t-i*(o/a),s*(a/o),i*(o/a)];case 8:return[t-s,e-i,s,i];case 9:return[1-e,t-s,i,s];case 10:return[1-t,1-e,s,i];case 11:return[e-i,1-t,i,s];case 12:return[t-i*(o/a),e,i*(o/a),s*(a/o)];case 13:return[1-e-s*(a/o),t-i*(o/a),s*(a/o),i*(o/a)];case 14:return[1-t,1-e-s*(a/o),i*(o/a),s*(a/o)];case 15:return[e,1-t,s*(a/o),i*(o/a)];default:return[t,e,s,i]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties({bbox:this.#m()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#d(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const s=super.render();s.classList.add("draw");const i=document.createElement("div");s.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";const[n,r]=this.parentDimensions;return this.setDims(this.width*n,this.height*r),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),s}static createDrawerInstance(t,e,s,i,n){z("Not implemented")}static startDrawing(t,e,s,i){const{target:n,offsetX:r,offsetY:a,pointerId:o,pointerType:l}=i;if(F.#a&&F.#a!==l)return;const{viewport:{rotation:h}}=t,{width:d,height:u}=n.getBoundingClientRect(),f=F.#i=new AbortController,g=t.combinedSignal(f);if(F.#n||=o,F.#a??=l,window.addEventListener("pointerup",p=>{F.#n===p.pointerId?this._endDraw(p):F.#o?.delete(p.pointerId)},{signal:g}),window.addEventListener("pointercancel",p=>{F.#n===p.pointerId?this._currentParent.endDrawingSession():F.#o?.delete(p.pointerId)},{signal:g}),window.addEventListener("pointerdown",p=>{F.#a===p.pointerType&&((F.#o||=new Set).add(p.pointerId),F.#s.isCancellable()&&(F.#s.removeLastElement(),F.#s.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",wt,{signal:g}),n.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),n.addEventListener("touchmove",p=>{p.timeStamp===F.#l&&tt(p)},{signal:g}),t.toggleDrawing(),e._editorUndoBar?.hide(),F.#s){t.drawLayer.updateProperties(this._currentDrawId,F.#s.startNew(r,a,d,u,h));return}e.updateUIForDefaultProperties(this),F.#s=this.createDrawerInstance(r,a,d,u,h),F.#r=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(F.#r.toSVGProperties(),F.#s.defaultSVGProperties),!0,!1)}static _drawMove(t){if(F.#l=-1,!F.#s)return;const{offsetX:e,offsetY:s,pointerId:i}=t;if(F.#n===i){if(F.#o?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,F.#s.add(e,s)),F.#l=t.timeStamp,tt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,F.#s=null,F.#r=null,F.#a=null,F.#l=NaN),F.#i&&(F.#i.abort(),F.#i=null,F.#n=NaN,F.#o=null)}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,F.#s.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=F.#s,i=this._currentDrawId,n=s.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(i,s.setLastElement(n))},undo:()=>{e.drawLayer.updateProperties(i,s.removeLastElement())},mustExec:!1,type:j.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(j.DRAW_STEP),!F.#s.isEmpty()){const{pageDimensions:[s,i],scale:n}=e,r=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:F.#s.getOutlines(s*n,i*n,n,this._INNER_MARGIN),drawingOptions:F.#r,mustBeCommitted:!t});return this._cleanup(!0),r}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,s,i,n,r){z("Not implemented")}static async deserialize(t,e,s){const{rawDims:{pageWidth:i,pageHeight:n,pageX:r,pageY:a}}=e.viewport,o=this.deserializeDraw(r,a,i,n,this._INNER_MARGIN,t),l=await super.deserialize(t,e,s);return l.createDrawingOptions(t),l.#h({drawOutlines:o}),l.#f(),l.onScaleChanging(),l.rotate(),l}serializeDraw(t){const[e,s]=this.pageTranslation,[i,n]=this.pageDimensions;return this.#t.serialize([e,s,i,n],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class Yr{#t=new Float64Array(6);#e;#s;#i;#r;#n;#a="";#o=0;#l=new Te;#h;#u;constructor(t,e,s,i,n,r){this.#h=s,this.#u=i,this.#i=n,this.#r=r,[t,e]=this.#c(t,e);const a=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#n=[t,e],this.#s=[{line:a,points:this.#n}],this.#t.set(a,0)}updateProperty(t,e){t==="stroke-width"&&(this.#r=e)}#c(t,e){return k._normalizePoint(t,e,this.#h,this.#u,this.#i)}isEmpty(){return!this.#s||this.#s.length===0}isCancellable(){return this.#n.length<=10}add(t,e){[t,e]=this.#c(t,e);const[s,i,n,r]=this.#t.subarray(2,6),a=t-n,o=e-r;return Math.hypot(this.#h*a,this.#u*o)<=2?null:(this.#n.push(t,e),isNaN(s)?(this.#t.set([n,r,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([s,i,n,r,t,e],0),this.#e.push(...k.createBezierPoints(s,i,n,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const s=this.add(t,e);return s||(this.#n.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,i,n){this.#h=s,this.#u=i,this.#i=n,[t,e]=this.#c(t,e);const r=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#n=[t,e];const a=this.#s.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#s.push({line:r,points:this.#n}),this.#t.set(r,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#s.at(-1)}setLastElement(t){return this.#s?(this.#s.push(t),this.#e=t.line,this.#n=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#l.setLastElement(t)}removeLastElement(){if(!this.#s)return this.#l.removeLastElement();this.#s.pop(),this.#a="";for(let t=0,e=this.#s.length;t<e;t++){const{line:s,points:i}=this.#s[t];this.#e=s,this.#n=i,this.#o=0,this.toSVGPath()}return{path:{d:this.#a}}}toSVGPath(){const t=k.svgRound(this.#e[4]),e=k.svgRound(this.#e[5]);if(this.#n.length===2)return this.#a=`${this.#a} M ${t} ${e} Z`,this.#a;if(this.#n.length<=6){const i=this.#a.lastIndexOf("M");this.#a=`${this.#a.slice(0,i)} M ${t} ${e}`,this.#o=6}if(this.#n.length===4){const i=k.svgRound(this.#e[10]),n=k.svgRound(this.#e[11]);return this.#a=`${this.#a} L ${i} ${n}`,this.#o=12,this.#a}const s=[];this.#o===0&&(s.push(`M ${t} ${e}`),this.#o=6);for(let i=this.#o,n=this.#e.length;i<n;i+=6){const[r,a,o,l,h,d]=this.#e.slice(i,i+6).map(k.svgRound);s.push(`C${r} ${a} ${o} ${l} ${h} ${d}`)}return this.#a+=s.join(" "),this.#o=this.#e.length,this.#a}getOutlines(t,e,s,i){const n=this.#s.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#l.build(this.#s,t,e,s,this.#i,this.#r,i),this.#t=null,this.#e=null,this.#s=null,this.#a=null,this.#l}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Te extends k{#t;#e=0;#s;#i;#r;#n;#a;#o;#l;build(t,e,s,i,n,r,a){this.#r=e,this.#n=s,this.#a=i,this.#o=n,this.#l=r,this.#s=a??0,this.#i=t,this.#c()}get thickness(){return this.#l}setLastElement(t){return this.#i.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#i){if(t.push(`M${k.svgRound(e[4])} ${k.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${k.svgRound(e[10])} ${k.svgRound(e[11])}`);continue}for(let s=6,i=e.length;s<i;s+=6){const[n,r,a,o,l,h]=e.subarray(s,s+6).map(k.svgRound);t.push(`C${n} ${r} ${a} ${o} ${l} ${h}`)}}return t.join("")}serialize([t,e,s,i],n){const r=[],a=[],[o,l,h,d]=this.#u();let u,f,g,p,b,m,A,y,C;switch(this.#o){case 0:C=k._rescale,u=t,f=e+i,g=s,p=-i,b=t+o*s,m=e+(1-l-d)*i,A=t+(o+h)*s,y=e+(1-l)*i;break;case 90:C=k._rescaleAndSwap,u=t,f=e,g=s,p=i,b=t+l*s,m=e+o*i,A=t+(l+d)*s,y=e+(o+h)*i;break;case 180:C=k._rescale,u=t+s,f=e,g=-s,p=i,b=t+(1-o-h)*s,m=e+l*i,A=t+(1-o)*s,y=e+(l+d)*i;break;case 270:C=k._rescaleAndSwap,u=t+s,f=e+i,g=-s,p=-i,b=t+(1-l-d)*s,m=e+(1-o-h)*i,A=t+(1-l)*s,y=e+(1-o)*i;break}for(const{line:w,points:v}of this.#i)r.push(C(w,u,f,g,p,n?new Array(w.length):null)),a.push(C(v,u,f,g,p,n?new Array(v.length):null));return{lines:r,points:a,rect:[b,m,A,y]}}static deserialize(t,e,s,i,n,{paths:{lines:r,points:a},rotation:o,thickness:l}){const h=[];let d,u,f,g,p;switch(o){case 0:p=k._rescale,d=-t/s,u=e/i+1,f=1/s,g=-1/i;break;case 90:p=k._rescaleAndSwap,d=-e/i,u=-t/s,f=1/i,g=1/s;break;case 180:p=k._rescale,d=t/s+1,u=-e/i,f=-1/s,g=1/i;break;case 270:p=k._rescaleAndSwap,d=e/i+1,u=t/s+1,f=-1/i,g=-1/s;break}if(!r){r=[];for(const m of a){const A=m.length;if(A===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,m[0],m[1]]));continue}if(A===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,m[0],m[1],NaN,NaN,NaN,NaN,m[2],m[3]]));continue}const y=new Float32Array(3*(A-2));r.push(y);let[C,w,v,x]=m.subarray(0,4);y.set([NaN,NaN,NaN,NaN,C,w],0);for(let S=4;S<A;S+=2){const E=m[S],D=m[S+1];y.set(k.createBezierPoints(C,w,v,x,E,D),(S-2)*3),[C,w,v,x]=[v,x,E,D]}}}for(let m=0,A=r.length;m<A;m++)h.push({line:p(r[m].map(y=>y??NaN),d,u,f,g),points:p(a[m].map(y=>y??NaN),d,u,f,g)});const b=new this.prototype.constructor;return b.build(h,s,i,1,o,l,n),b}#h(t=this.#l){const e=this.#s+t/2*this.#a;return this.#o%180===0?[e/this.#r,e/this.#n]:[e/this.#n,e/this.#r]}#u(){const[t,e,s,i]=this.#t,[n,r]=this.#h(0);return[t+n,e+r,s-2*n,i-2*r]}#c(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:i}of this.#i){if(i.length<=12){for(let a=4,o=i.length;a<o;a+=6)M.pointBoundingBox(i[a],i[a+1],t);continue}let n=i[4],r=i[5];for(let a=6,o=i.length;a<o;a+=6){const[l,h,d,u,f,g]=i.subarray(a,a+6);M.bezierBoundingBox(n,r,l,h,d,u,f,g,t),n=f,r=g}}const[e,s]=this.#h();t[0]=dt(t[0]-e,0,1),t[1]=dt(t[1]-s,0,1),t[2]=dt(t[2]+e,0,1),t[3]=dt(t[3]+s,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,s]=this.#h();this.#l=t;const[i,n]=this.#h(),[r,a]=[i-e,n-s],o=this.#t;return o[0]-=r,o[1]-=a,o[2]+=2*r,o[3]+=2*a,o}updateParentDimensions([t,e],s){const[i,n]=this.#h();this.#r=t,this.#n=e,this.#a=s;const[r,a]=this.#h(),o=r-i,l=a-n,h=this.#t;return h[0]-=o,h[1]-=l,h[2]+=2*o,h[3]+=2*l,h}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(k.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${k.svgRound(t)} ${k.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let s=0,i=0,n=0,r=0,a=0,o=0;switch(this.#e){case 90:i=e/t,n=-t/e,a=t;break;case 180:s=-1,r=-1,a=t,o=e;break;case 270:i=-e/t,n=t/e,o=e;break;default:return""}return`matrix(${s} ${i} ${n} ${r} ${k.svgRound(a)} ${k.svgRound(o)})`}getPathResizingSVGProperties([t,e,s,i]){const[n,r]=this.#h(),[a,o,l,h]=this.#t;if(Math.abs(l-n)<=k.PRECISION||Math.abs(h-r)<=k.PRECISION){const p=t+s/2-(a+l/2),b=e+i/2-(o+h/2);return{path:{"transform-origin":`${k.svgRound(t)} ${k.svgRound(e)}`,transform:`${this.rotationTransform} translate(${p} ${b})`}}}const d=(s-2*n)/(l-2*n),u=(i-2*r)/(h-2*r),f=l/s,g=h/i;return{path:{"transform-origin":`${k.svgRound(a)} ${k.svgRound(o)}`,transform:`${this.rotationTransform} scale(${f} ${g}) translate(${k.svgRound(n)} ${k.svgRound(r)}) scale(${d} ${u}) translate(${k.svgRound(-n)} ${k.svgRound(-r)})`}}}getPathResizedSVGProperties([t,e,s,i]){const[n,r]=this.#h(),a=this.#t,[o,l,h,d]=a;if(a[0]=t,a[1]=e,a[2]=s,a[3]=i,Math.abs(h-n)<=k.PRECISION||Math.abs(d-r)<=k.PRECISION){const b=t+s/2-(o+h/2),m=e+i/2-(l+d/2);for(const{line:A,points:y}of this.#i)k._translate(A,b,m,A),k._translate(y,b,m,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${k.svgRound(t)} ${k.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const u=(s-2*n)/(h-2*n),f=(i-2*r)/(d-2*r),g=-u*(o+n)+t+n,p=-f*(l+r)+e+r;if(u!==1||f!==1||g!==0||p!==0)for(const{line:b,points:m}of this.#i)k._rescale(b,g,p,u,f,b),k._rescale(m,g,p,u,f,m);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${k.svgRound(t)} ${k.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],s){const[i,n]=s,r=this.#t,a=t-r[0],o=e-r[1];if(this.#r===i&&this.#n===n)for(const{line:l,points:h}of this.#i)k._translate(l,a,o,l),k._translate(h,a,o,h);else{const l=this.#r/i,h=this.#n/n;this.#r=i,this.#n=n;for(const{line:d,points:u}of this.#i)k._rescale(d,a,o,l,h,d),k._rescale(u,a,o,l,h,u);r[2]*=l,r[3]*=h}return r[0]=t,r[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${k.svgRound(t)} ${k.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${k.svgRound(t[0])} ${k.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class Je extends $i{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:I._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new Je(this._viewParameters);return t.updateAll(this),t}}class Os extends F{static _type="ink";static _editorType=O.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){I.initialize(t,e),this._defaultDrawingOptions=new Je(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return H(this,"typesMap",new Map([[j.INK_THICKNESS,"stroke-width"],[j.INK_COLOR,"stroke"],[j.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,s,i,n){return new Yr(t,e,s,i,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,s,i,n,r){return Te.deserialize(t,e,s,i,n,r)}static async deserialize(t,e,s){let i=null;if(t instanceof Ns){const{data:{inkLists:r,rect:a,rotation:o,id:l,color:h,opacity:d,borderStyle:{rawWidth:u},popupRef:f,contentsObj:g},parent:{page:{pageNumber:p}}}=t;i=t={annotationType:O.INK,color:Array.from(h),thickness:u,opacity:d,paths:{points:r},boxes:null,pageIndex:p-1,rect:a.slice(0),rotation:o,annotationElementId:l,id:l,deleted:!1,popupRef:f,comment:g?.str||null}}const n=await super.deserialize(t,e,s);return n._initialData=i,t.comment&&n.setCommentData(t.comment),n}get toolbarButtons(){return this._colorPicker||=new we(this),[["colorPicker",this._colorPicker]]}get colorType(){return j.INK_COLOR}get colorValue(){return this._drawingOptions.stroke}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:s}=this;e.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:s}){this._drawingOptions=Os.getDefaultDrawingOptions({stroke:M.makeHexColor(...t),"stroke-width":e,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:s,rect:i}=this.serializeDraw(t),{_drawingOptions:{stroke:n,"stroke-opacity":r,"stroke-width":a}}=this,o={annotationType:O.INK,color:I._colorManager.convert(n),opacity:r,thickness:a,paths:{lines:e,points:s},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(o),t?(o.isCopy=!0,o):this.annotationElementId&&!this.#t(o)?null:(o.id=this.annotationElementId,o)}#t(t){const{color:e,thickness:s,opacity:i,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((r,a)=>r!==e[a])||t.thickness!==s||t.opacity!==i||t.pageIndex!==n}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:s}=this.serializeDraw(!1),i={rect:s,thickness:this._drawingOptions["stroke-width"],points:e};return this.hasEditedComment&&(i.popup=this.comment),t.updateEdited(i),null}}class _s extends Te{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Be=8,de=3;class ee{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,s,i){return s-=t,i-=e,s===0?i>0?0:4:s===1?i+6:2-i}static#s=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#i(t,e,s,i,n,r,a){const o=this.#e(s,i,n,r);for(let l=0;l<8;l++){const h=(-l+o-a+16)%8,d=this.#s[2*h],u=this.#s[2*h+1];if(t[(s+d)*e+(i+u)]!==0)return h}return-1}static#r(t,e,s,i,n,r,a){const o=this.#e(s,i,n,r);for(let l=0;l<8;l++){const h=(l+o+a+16)%8,d=this.#s[2*h],u=this.#s[2*h+1];if(t[(s+d)*e+(i+u)]!==0)return h}return-1}static#n(t,e,s,i){const n=t.length,r=new Int32Array(n);for(let h=0;h<n;h++)r[h]=t[h]<=i?1:0;for(let h=1;h<s-1;h++)r[h*e]=r[h*e+e-1]=0;for(let h=0;h<e;h++)r[h]=r[e*s-1-h]=0;let a=1,o;const l=[];for(let h=1;h<s-1;h++){o=1;for(let d=1;d<e-1;d++){const u=h*e+d,f=r[u];if(f===0)continue;let g=h,p=d;if(f===1&&r[u-1]===0)a+=1,p-=1;else if(f>=1&&r[u+1]===0)a+=1,p+=1,f>1&&(o=f);else{f!==1&&(o=Math.abs(f));continue}const b=[d,h],m=p===d+1,A={isHole:m,points:b,id:a,parent:0};l.push(A);let y;for(const T of l)if(T.id===o){y=T;break}y?y.isHole?A.parent=m?y.parent:o:A.parent=m?o:y.parent:A.parent=m?o:0;const C=this.#i(r,e,h,d,g,p,0);if(C===-1){r[u]=-a,r[u]!==1&&(o=Math.abs(r[u]));continue}let w=this.#s[2*C],v=this.#s[2*C+1];const x=h+w,S=d+v;g=x,p=S;let E=h,D=d;for(;;){const T=this.#r(r,e,E,D,g,p,1);w=this.#s[2*T],v=this.#s[2*T+1];const V=E+w,P=D+v;b.push(P,V);const N=E*e+D;if(r[N+1]===0?r[N]=-a:r[N]===1&&(r[N]=a),V===h&&P===d&&E===x&&D===S){r[u]!==1&&(o=Math.abs(r[u]));break}else g=E,p=D,E=V,D=P}}}return l}static#a(t,e,s,i){if(s-e<=4){for(let x=e;x<s-2;x+=2)i.push(t[x],t[x+1]);return}const n=t[e],r=t[e+1],a=t[s-4]-n,o=t[s-3]-r,l=Math.hypot(a,o),h=a/l,d=o/l,u=h*r-d*n,f=o/a,g=1/l,p=Math.atan(f),b=Math.cos(p),m=Math.sin(p),A=g*(Math.abs(b)+Math.abs(m)),y=g*(1-A+A**2),C=Math.max(Math.atan(Math.abs(m+b)*y),Math.atan(Math.abs(m-b)*y));let w=0,v=e;for(let x=e+2;x<s-2;x+=2){const S=Math.abs(u-h*t[x+1]+d*t[x]);S>w&&(v=x,w=S)}w>(l*C)**2?(this.#a(t,e,v+2,i),this.#a(t,v,s,i)):i.push(n,r)}static#o(t){const e=[],s=t.length;return this.#a(t,0,s,e),e.push(t[s-2],t[s-1]),e.length<=4?null:e}static#l(t,e,s,i,n,r){const a=new Float32Array(r**2),o=-2*i**2,l=r>>1;for(let p=0;p<r;p++){const b=(p-l)**2;for(let m=0;m<r;m++)a[p*r+m]=Math.exp((b+(m-l)**2)/o)}const h=new Float32Array(256),d=-2*n**2;for(let p=0;p<256;p++)h[p]=Math.exp(p**2/d);const u=t.length,f=new Uint8Array(u),g=new Uint32Array(256);for(let p=0;p<s;p++)for(let b=0;b<e;b++){const m=p*e+b,A=t[m];let y=0,C=0;for(let v=0;v<r;v++){const x=p+v-l;if(!(x<0||x>=s))for(let S=0;S<r;S++){const E=b+S-l;if(E<0||E>=e)continue;const D=t[x*e+E],T=a[v*r+S]*h[Math.abs(D-A)];y+=D*T,C+=T}}const w=f[m]=Math.round(y/C);g[w]++}return[f,g]}static#h(t){const e=new Uint32Array(256);for(const s of t)e[s]++;return e}static#u(t){const e=t.length,s=new Uint8ClampedArray(e>>2);let i=-1/0,n=1/0;for(let a=0,o=s.length;a<o;a++){const l=s[a]=t[a<<2];i=Math.max(i,l),n=Math.min(n,l)}const r=255/(i-n);for(let a=0,o=s.length;a<o;a++)s[a]=(s[a]-n)*r;return s}static#c(t){let e,s=-1/0,i=-1/0;const n=t.findIndex(o=>o!==0);let r=n,a=n;for(e=n;e<256;e++){const o=t[e];o>s&&(e-r>i&&(i=e-r,a=e-1),s=o,r=e)}for(e=a-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:s,height:i}=t,{maxDim:n}=this.#t;let r=s,a=i;if(s>n||i>n){let u=s,f=i,g=Math.log2(Math.max(s,i)/n);const p=Math.floor(g);g=g===p?p-1:p;for(let m=0;m<g;m++){r=Math.ceil(u/2),a=Math.ceil(f/2);const A=new OffscreenCanvas(r,a);A.getContext("2d").drawImage(t,0,0,u,f,0,0,r,a),u=r,f=a,t!==e&&t.close(),t=A.transferToImageBitmap()}const b=Math.min(n/r,n/a);r=Math.round(r*b),a=Math.round(a*b)}const l=new OffscreenCanvas(r,a).getContext("2d",{willReadFrequently:!0});l.fillStyle="white",l.fillRect(0,0,r,a),l.filter="grayscale(1)",l.drawImage(t,0,0,t.width,t.height,0,0,r,a);const h=l.getImageData(0,0,r,a).data;return[this.#u(h),r,a]}static extractContoursFromText(t,{fontFamily:e,fontStyle:s,fontWeight:i},n,r,a,o){let l=new OffscreenCanvas(1,1),h=l.getContext("2d",{alpha:!1});const d=200,u=h.font=`${s} ${i} ${d}px ${e}`,{actualBoundingBoxLeft:f,actualBoundingBoxRight:g,actualBoundingBoxAscent:p,actualBoundingBoxDescent:b,fontBoundingBoxAscent:m,fontBoundingBoxDescent:A,width:y}=h.measureText(t),C=1.5,w=Math.ceil(Math.max(Math.abs(f)+Math.abs(g)||0,y)*C),v=Math.ceil(Math.max(Math.abs(p)+Math.abs(b)||d,Math.abs(m)+Math.abs(A)||d)*C);l=new OffscreenCanvas(w,v),h=l.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=u,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,w,v),h.fillStyle="black",h.fillText(t,w*(C-1)/2,v*(3-C)/2);const x=this.#u(h.getImageData(0,0,w,v).data),S=this.#h(x),E=this.#c(S),D=this.#n(x,w,v,E);return this.processDrawnLines({lines:{curves:D,width:w,height:v},pageWidth:n,pageHeight:r,rotation:a,innerMargin:o,mustSmooth:!0,areContours:!0})}static process(t,e,s,i,n){const[r,a,o]=this.#f(t),[l,h]=this.#l(r,a,o,Math.hypot(a,o)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),d=this.#c(h),u=this.#n(l,a,o,d);return this.processDrawnLines({lines:{curves:u,width:a,height:o},pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:r,areContours:a}){i%180!==0&&([e,s]=[s,e]);const{curves:o,width:l,height:h}=t,d=t.thickness??0,u=[],f=Math.min(e/l,s/h),g=f/e,p=f/s,b=[];for(const{points:A}of o){const y=r?this.#o(A):A;if(!y)continue;b.push(y);const C=y.length,w=new Float32Array(C),v=new Float32Array(3*(C===2?2:C-2));if(u.push({line:v,points:w}),C===2){w[0]=y[0]*g,w[1]=y[1]*p,v.set([NaN,NaN,NaN,NaN,w[0],w[1]],0);continue}let[x,S,E,D]=y;x*=g,S*=p,E*=g,D*=p,w.set([x,S,E,D],0),v.set([NaN,NaN,NaN,NaN,x,S],0);for(let T=4;T<C;T+=2){const V=w[T]=y[T]*g,P=w[T+1]=y[T+1]*p;v.set(k.createBezierPoints(x,S,E,D,V,P),(T-2)*3),[x,S,E,D]=[E,D,V,P]}}if(u.length===0)return null;const m=a?new _s:new Te;return m.build(u,e,s,1,i,a?0:d,n),{outline:m,newCurves:b,areContours:a,thickness:d,width:l,height:h}}static async compressSignature({outlines:t,areContours:e,thickness:s,width:i,height:n}){let r=1/0,a=-1/0,o=0;for(const y of t){o+=y.length;for(let C=2,w=y.length;C<w;C++){const v=y[C]-y[C-2];r=Math.min(r,v),a=Math.max(a,v)}}let l;r>=-128&&a<=127?l=Int8Array:r>=-32768&&a<=32767?l=Int16Array:l=Int32Array;const h=t.length,d=Be+de*h,u=new Uint32Array(d);let f=0;u[f++]=d*Uint32Array.BYTES_PER_ELEMENT+(o-2*h)*l.BYTES_PER_ELEMENT,u[f++]=0,u[f++]=i,u[f++]=n,u[f++]=e?0:1,u[f++]=Math.max(0,Math.floor(s??0)),u[f++]=h,u[f++]=l.BYTES_PER_ELEMENT;for(const y of t)u[f++]=y.length-2,u[f++]=y[0],u[f++]=y[1];const g=new CompressionStream("deflate-raw"),p=g.writable.getWriter();await p.ready,p.write(u);const b=l.prototype.constructor;for(const y of t){const C=new b(y.length-2);for(let w=2,v=y.length;w<v;w++)C[w-2]=y[w]-y[w-2];p.write(C)}p.close();const m=await new Response(g.readable).arrayBuffer(),A=new Uint8Array(m);return gi(A)}static async decompressSignature(t){try{const e=mn(t),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),n=i.getWriter();await n.ready,n.write(e).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let r=null,a=0;for await(const y of s)r||=new Uint8Array(new Uint32Array(y.buffer,0,4)[0]),r.set(y,a),a+=y.length;const o=new Uint32Array(r.buffer,0,r.length>>2),l=o[1];if(l!==0)throw new Error(`Invalid version: ${l}`);const h=o[2],d=o[3],u=o[4]===0,f=o[5],g=o[6],p=o[7],b=[],m=(Be+de*g)*Uint32Array.BYTES_PER_ELEMENT;let A;switch(p){case Int8Array.BYTES_PER_ELEMENT:A=new Int8Array(r.buffer,m);break;case Int16Array.BYTES_PER_ELEMENT:A=new Int16Array(r.buffer,m);break;case Int32Array.BYTES_PER_ELEMENT:A=new Int32Array(r.buffer,m);break}a=0;for(let y=0;y<g;y++){const C=o[de*y+Be],w=new Float32Array(C+2);b.push(w);for(let v=0;v<de-1;v++)w[v]=o[de*y+Be+v+1];for(let v=0;v<C;v++)w[v+2]=w[v]+A[a++]}return{areContours:u,thickness:f,outlines:b,width:h,height:d}}catch(e){return B(`decompressSignature: ${e}`),null}}}class Bs extends $i{constructor(){super(),super.updateProperties({fill:I._defaultLineColor,"stroke-width":0})}clone(){const t=new Bs;return t.updateAll(this),t}}class Hs extends Je{constructor(t){super(t),super.updateProperties({stroke:I._defaultLineColor,"stroke-width":1})}clone(){const t=new Hs(this._viewParameters);return t.updateAll(this),t}}class kt extends F{#t=!1;#e=null;#s=null;#i=null;static _type="signature";static _editorType=O.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#s=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){I.initialize(t,e),this._defaultDrawingOptions=new Bs,this._defaultDrawnSignatureOptions=new Hs(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return H(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#s){const{lines:i,mustSmooth:n,areContours:r,description:a,uuid:o,heightInPage:l}=this.#s,{rawDims:{pageWidth:h,pageHeight:d},rotation:u}=this.parent.viewport,f=ee.processDrawnLines({lines:i,pageWidth:h,pageHeight:d,rotation:u,innerMargin:kt._INNER_MARGIN,mustSmooth:n,areContours:r});this.addSignature(f,l,a,o)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return s&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#i=t,this.addEditToolbar()}getUuid(){return this.#i}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:s,width:i,height:n}=this.#s,r=Math.max(i,n),a=ee.processDrawnLines({lines:{curves:t.map(o=>({points:o})),thickness:s,width:i,height:n},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:a.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,s,i){const{x:n,y:r}=this,{outline:a}=this.#s=t;this.#t=a instanceof _s,this.description=s;let o;this.#t?o=kt.getDefaultDrawingOptions():(o=kt._defaultDrawnSignatureOptions.clone(),o.updateProperties({"stroke-width":a.thickness})),this._addOutlines({drawOutlines:a,drawingOptions:o});const[l,h]=this.parentDimensions,[,d]=this.pageDimensions;let u=e/d;u=u>=1?.5:u,this.width*=u/this.height,this.width>=1&&(u*=.9/this.width,this.width=.9),this.height=u,this.setDims(l*this.width,h*this.height),this.x=n,this.y=r,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return ee.process(t,e,s,i,kt._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return ee.extractContoursFromText(t,e,s,i,n,kt._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return ee.processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:kt._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=kt.getDefaultDrawingOptions():(this._drawingOptions=kt._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:s,rect:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":n}}=this,r={annotationType:O.SIGNATURE,isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:n,pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(r),t?(r.paths={lines:e,points:s},r.uuid=this.#i,r.isCopy=!0):r.lines=e,this.#e&&(r.accessibilityData={type:"Figure",alt:this.#e}),r}static deserializeDraw(t,e,s,i,n,r){return r.areContours?_s.deserialize(t,e,s,i,n,r):Te.deserialize(t,e,s,i,n,r)}static async deserialize(t,e,s){const i=await super.deserialize(t,e,s);return i.#t=t.areContours,i.description=t.accessibilityData?.alt||"",i.#i=t.uuid,i}}class Kr extends I{#t=null;#e=null;#s=null;#i=null;#r=null;#n="";#a=null;#o=!1;#l=null;#h=!1;#u=!1;static _type="stamp";static _editorType=O.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#i=t.bitmapUrl,this.#r=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){I.initialize(t,e)}static isHandlingMimeForPasting(t){return ms.includes(t)}static paste(t,e){e.pasteEditor({mode:O.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#c(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#h=t.isSvg),t.file&&(this.#n=t.file.name),this.#p()}#f(){if(this.#s=null,this._uiManager.enableWaiting(!1),!!this.#a){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:n,height:r}=t||this.copyCanvas(null,null,!0).imageData,a=await s.guess({name:"altText",request:{data:i,width:n,height:r,channels:i.length/(n*r)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const o=a.output;return await this.setGuessedAltText(o),e&&!this.hasAltTextData()&&(this.altTextData={alt:o,decorative:!1}),o}#g(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(s=>this.#c(s,!0)).finally(()=>this.#f());return}if(this.#i){const s=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(s).then(i=>this.#c(i)).finally(()=>this.#f());return}if(this.#r){const s=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(s).then(i=>this.#c(i)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=ms.join(",");const e=this._uiManager._signal;this.#s=new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#c(i)}s()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#a?.remove(),this.#a=null,this.#l&&(clearTimeout(this.#l),this.#l=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#g();return}super.rebuild(),this.div!==null&&(this.#e&&this.#a===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#i||this.#r||this.#e||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#t?this.#p():this.#g()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:s,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(this.#e=s,i&&(this.#t=i),this.#o=!1,this.#p())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#l!==null&&clearTimeout(this.#l);const t=200;this.#l=setTimeout(()=>{this.#l=null,this.#m()},t)}#p(){const{div:t}=this;let{width:e,height:s}=this.#t;const[i,n]=this.pageDimensions,r=.75;if(this.width)e=this.width*i,s=this.height*n;else if(e>r*i||s>r*n){const h=Math.min(r*i/e,r*n/s);e*=h,s*=h}const[a,o]=this.parentDimensions;this.setDims(e*a/i,s*o/n),this._uiManager.enableWaiting(!1);const l=this.#a=document.createElement("canvas");l.setAttribute("role","img"),this.addContainer(l),this.width=e/i,this.height=s/n,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#m(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#n&&this.div.setAttribute("aria-description",this.#n),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,s=!1){t||(t=224);const{width:i,height:n}=this.#t,r=new Mt;let a=this.#t,o=i,l=n,h=null;if(e){if(i>e||n>e){const v=Math.min(e/i,e/n);o=Math.floor(i*v),l=Math.floor(n*v)}h=document.createElement("canvas");const u=h.width=Math.ceil(o*r.sx),f=h.height=Math.ceil(l*r.sy);this.#h||(a=this.#d(u,f));const g=h.getContext("2d");g.filter=this._uiManager.hcmFilter;let p="white",b="#cfcfd8";this._uiManager.hcmFilter!=="none"?b="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(p="#8f8f9d",b="#42414d");const m=15,A=m*r.sx,y=m*r.sy,C=new OffscreenCanvas(A*2,y*2),w=C.getContext("2d");w.fillStyle=p,w.fillRect(0,0,A*2,y*2),w.fillStyle=b,w.fillRect(0,0,A,y),w.fillRect(A,y,A,y),g.fillStyle=g.createPattern(C,"repeat"),g.fillRect(0,0,u,f),g.drawImage(a,0,0,a.width,a.height,0,0,u,f)}let d=null;if(s){let u,f;if(r.symmetric&&a.width<t&&a.height<t)u=a.width,f=a.height;else if(a=this.#t,i>t||n>t){const b=Math.min(t/i,t/n);u=Math.floor(i*b),f=Math.floor(n*b),this.#h||(a=this.#d(u,f))}const p=new OffscreenCanvas(u,f).getContext("2d",{willReadFrequently:!0});p.drawImage(a,0,0,a.width,a.height,0,0,u,f),d={width:u,height:f,data:p.getImageData(0,0,u,f).data}}return{canvas:h,width:o,height:l,imageData:d}}#d(t,e){const{width:s,height:i}=this.#t;let n=s,r=i,a=this.#t;for(;n>2*t||r>2*e;){const o=n,l=r;n>2*t&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const h=new OffscreenCanvas(n,r);h.getContext("2d").drawImage(a,0,0,o,l,0,0,n,r),a=h.transferToImageBitmap()}return a}#m(){const[t,e]=this.parentDimensions,{width:s,height:i}=this,n=new Mt,r=Math.ceil(s*t*n.sx),a=Math.ceil(i*e*n.sy),o=this.#a;if(!o||o.width===r&&o.height===a)return;o.width=r,o.height=a;const l=this.#h?this.#t:this.#d(r,a),h=o.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(l,0,0,l.width,l.height,0,0,r,a)}#A(t){if(t){if(this.#h){const i=this._uiManager.imageManager.getSvgUrl(this.#e);if(i)return i}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#h){const[e,s]=this.pageDimensions,i=Math.round(this.width*e*ae.PDF_TO_CSS_UNITS),n=Math.round(this.height*s*ae.PDF_TO_CSS_UNITS),r=new OffscreenCanvas(i,n);return r.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,i,n),r.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,s){let i=null,n=!1;if(t instanceof Hi){const{data:{rect:p,rotation:b,id:m,structParent:A,popupRef:y,contentsObj:C},container:w,parent:{page:{pageNumber:v}},canvas:x}=t;let S,E;x?(delete t.canvas,{id:S,bitmap:E}=s.imageManager.getFromCanvas(w.id,x),x.remove()):(n=!0,t._hasNoCanvas=!0);const D=(await e._structTree.getAriaAttributes(`${xs}${m}`))?.get("aria-label")||"";i=t={annotationType:O.STAMP,bitmapId:S,bitmap:E,pageIndex:v-1,rect:p.slice(0),rotation:b,annotationElementId:m,id:m,deleted:!1,accessibilityData:{decorative:!1,altText:D},isSvg:!1,structParent:A,popupRef:y,comment:C?.str||null}}const r=await super.deserialize(t,e,s),{rect:a,bitmap:o,bitmapUrl:l,bitmapId:h,isSvg:d,accessibilityData:u}=t;n?(s.addMissingCanvas(t.id,r),r.#o=!0):h&&s.imageManager.isValidId(h)?(r.#e=h,o&&(r.#t=o)):r.#i=l,r.#h=d;const[f,g]=r.pageDimensions;return r.width=(a[2]-a[0])/f,r.height=(a[3]-a[1])/g,u&&(r.altTextData=u),r._initialData=i,t.comment&&r.setCommentData(t.comment),r.#u=!!i,r}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s={annotationType:O.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,isSvg:this.#h,structTreeParentId:this._structTreeParentId};if(this.addComment(s),t)return s.bitmapUrl=this.#A(!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:i,altText:n}=this.serializeAltText(!1);if(!i&&n&&(s.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){const a=this.#b(s);if(a.isSame)return null;a.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1}if(s.id=this.annotationElementId,e===null)return s;e.stamps||=new Map;const r=this.#h?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:r,serialized:s}),s.bitmap=this.#A(!1);else if(this.#h){const a=e.stamps.get(this.#e);r>a.area&&(a.area=r,a.serialized.bitmap.close(),a.serialized.bitmap=this.#A(!1))}return s}#b(t){const{pageIndex:e,accessibilityData:{altText:s}}=this._initialData,i=t.pageIndex===e,n=(t.accessibilityData?.alt||"")===s;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&i&&n,isSameAltText:n}}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const e={rect:this.getPDFRect()};return this.hasEditedComment&&(e.popup=this.comment),t.updateEdited(e),null}}class Dt{#t;#e=!1;#s=null;#i=null;#r=null;#n=new Map;#a=!1;#o=!1;#l=!1;#h=null;#u=null;#c=null;#f=null;#g=null;#p=-1;#d;static _initialized=!1;static#m=new Map([it,Os,Kr,K,kt].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:i,accessibilityManager:n,annotationLayer:r,drawLayer:a,textLayer:o,viewport:l,l10n:h}){const d=[...Dt.#m.values()];if(!Dt._initialized){Dt._initialized=!0;for(const u of d)u.initialize(h,t)}t.registerEditorTypes(d),this.#d=t,this.pageIndex=e,this.div=s,this.#t=n,this.#s=r,this.viewport=l,this.#c=o,this.drawLayer=a,this._structTree=i,this.#d.addLayer(this)}get isEmpty(){return this.#n.size===0}get isInvisible(){return this.isEmpty&&this.#d.getMode()===O.NONE}updateToolbar(t){this.#d.updateToolbar(t)}updateMode(t=this.#d.getMode()){switch(this.#y(),t){case O.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case O.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case O.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const s of Dt.#m.values())e.toggle(`${s._type}Editing`,t===s._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#c?.div}setEditingState(t){this.#d.setEditingState(t)}addCommands(t){this.#d.addCommands(t)}cleanUndoStack(t){this.#d.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#s?.div.classList.toggle("disabled",!t)}async enable(){this.#l=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.#g?.abort(),this.#g=null;const t=new Set;for(const s of this.#n.values())s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#d.removeChangedExistingAnnotation(s),t.add(s.annotationElementId));if(!this.#s){this.#l=!1;return}const e=this.#s.getEditableAnnotations();for(const s of e){if(s.hide(),this.#d.isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}this.#l=!1}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.#c&&!this.#g){this.#g=new AbortController;const i=this.#d.combinedSignal(this.#g);this.#c.div.addEventListener("pointerdown",n=>{const{clientX:a,clientY:o,timeStamp:l}=n,h=this.#p;if(l-h>500){this.#p=l;return}this.#p=-1;const{classList:d}=this.div;d.toggle("getElements",!0);const u=document.elementsFromPoint(a,o);if(d.toggle("getElements",!1),!this.div.contains(u[0]))return;let f;const g=new RegExp(`^${ci}[0-9]+$`);for(const b of u)if(g.test(b.id)){f=b.id;break}if(!f)return;const p=this.#n.get(f);p?.annotationElementId===null&&(n.stopPropagation(),n.preventDefault(),p.dblclick())},{signal:i,capture:!0})}const t=new Map,e=new Map;for(const i of this.#n.values())if(i.disableEditing(),!!i.annotationElementId){if(i.serialize()!==null){t.set(i.annotationElementId,i);continue}else e.set(i.annotationElementId,i);this.getEditableAnnotation(i.annotationElementId)?.show(),i.remove()}if(this.#s){const i=this.#s.getEditableAnnotations();for(const n of i){const{id:r}=n.data;if(this.#d.isDeletedAnnotationElement(r)){n.updateEdited({deleted:!0});continue}let a=e.get(r);if(a){a.resetAnnotationElement(n),a.show(!1),n.show();continue}a=t.get(r),a&&(this.#d.addChangedExistingAnnotation(a),a.renderAnnotationElement(n)&&a.show(!1)),n.show()}}this.#y(),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const i of Dt.#m.values())s.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(t){return this.#s?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#d.getActive()!==t&&this.#d.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#c?.div&&!this.#f){this.#f=new AbortController;const t=this.#d.combinedSignal(this.#f);this.#c.div.addEventListener("pointerdown",this.#A.bind(this),{signal:t}),this.#c.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#c?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#c.div.classList.remove("highlighting"))}#A(t){this.#d.unselectAll();const{target:e}=t;if(e===this.#c.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#c.div.contains(e)){const{isMac:s}=ot.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#d.showAllEditors("highlight",!0,!0),this.#c.div.classList.add("free"),this.toggleDrawing(),K.startHighlighting(this,this.#d.direction==="ltr",{target:this.#c.div,x:t.x,y:t.y}),this.#c.div.addEventListener("pointerup",()=>{this.#c.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#d._signal}),t.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;const t=this.#d.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#i?.abort(),this.#i=null}attach(t){this.#n.set(t.id,t);const{annotationElementId:e}=t;e&&this.#d.isDeletedAnnotationElement(e)&&this.#d.removeDeletedAnnotationElement(t)}detach(t){this.#n.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#d.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#d.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#d.addDeletedAnnotationElement(t.annotationElementId),I.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#d.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#l),this.#d.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#r&&(t._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#d._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getNextId(){return this.#d.getId()}get#b(){return Dt.#m.get(this.#d.getMode())}combinedSignal(t){return this.#d.combinedSignal(t)}#w(t){const e=this.#b;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#b?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#d.updateMode(t.mode);const{offsetX:s,offsetY:i}=this.#v(),n=this.getNextId(),r=this.#w({parent:this,id:n,x:s,y:i,uiManager:this.#d,isCentered:!0,...e});r&&this.add(r)}async deserialize(t){return await Dt.#m.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#d)||null}createAndAddNewEditor(t,e,s={}){const i=this.getNextId(),n=this.#w({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:this.#d,isCentered:e,...s});return n&&this.add(n),n}#v(){const{x:t,y:e,width:s,height:i}=this.div.getBoundingClientRect(),n=Math.max(0,t),r=Math.max(0,e),a=Math.min(window.innerWidth,t+s),o=Math.min(window.innerHeight,e+i),l=(n+a)/2-t,h=(r+o)/2-e,[d,u]=this.viewport.rotation%180===0?[l,h]:[h,l];return{offsetX:d,offsetY:u}}addNewEditor(t={}){this.createAndAddNewEditor(this.#v(),!0,t)}setSelected(t){this.#d.setSelected(t)}toggleSelected(t){this.#d.toggleSelected(t)}unselect(t){this.#d.unselect(t)}pointerup(t){const{isMac:e}=ot.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#a||(this.#a=!1,this.#b?.isDrawer&&this.#b.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const s=this.#d.getMode();if(s===O.STAMP||s===O.SIGNATURE){this.#d.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#d.getMode()===O.HIGHLIGHT&&this.enableTextSelection(),this.#a){this.#a=!1;return}const{isMac:e}=ot.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#a=!0,this.#b?.isDrawer){this.startDrawingSession(t);return}const s=this.#d.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#h){this.#b.startDrawing(this,this.#d,!1,t);return}this.#d.setCurrentDrawingSession(this),this.#h=new AbortController;const e=this.#d.combinedSignal(this.#h);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#u=null,this.commitOrRemove())},{signal:e}),this.#b.startDrawing(this,this.#d,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#u=e);return}this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(t=!1){return this.#h?(this.#d.setCurrentDrawingSession(null),this.#h.abort(),this.#h=null,this.#u=null,this.#b.endDrawing(t)):null}findNewParent(t,e,s){const i=this.#d.findParent(e,s);return i===null||i===this?!1:(i.changeParent(t),!0)}commitOrRemove(){return this.#h?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#h&&this.#b.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#d.getActive()?.parent===this&&(this.#d.commitOrRemove(),this.#d.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(const t of this.#n.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#n.clear(),this.#d.removeLayer(this)}#y(){for(const t of this.#n.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,qt(this.div,t);for(const e of this.#d.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#d.commitOrRemove(),this.#y();const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,qt(this.div,{rotation:s}),e!==s)for(const i of this.#n.values())i.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#d.viewParameters.realScale}}class rt{#t=null;#e=new Map;#s=new Map;static#i=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return H(this,"_svgFactory",new Ge)}static#r(t,[e,s,i,n]){const{style:r}=t;r.top=`${100*s}%`,r.left=`${100*e}%`,r.width=`${100*i}%`,r.height=`${100*n}%`}#n(){const t=rt._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#a(t,e){const s=rt._svgFactory.createElement("clipPath");t.append(s);const i=`clip_${e}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const n=rt._svgFactory.createElement("use");return s.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),i}#o(t,e){for(const[s,i]of Object.entries(e))i===null?t.removeAttribute(s):t.setAttribute(s,i)}draw(t,e=!1,s=!1){const i=rt.#i++,n=this.#n(),r=rt._svgFactory.createElement("defs");n.append(r);const a=rt._svgFactory.createElement("path");r.append(a);const o=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#s.set(i,a);const l=s?this.#a(r,o):null,h=rt._svgFactory.createElement("use");return n.append(h),h.setAttribute("href",`#${o}`),this.updateProperties(n,t),this.#e.set(i,n),{id:i,clipPathId:`url(#${l})`}}drawOutline(t,e){const s=rt.#i++,i=this.#n(),n=rt._svgFactory.createElement("defs");i.append(n);const r=rt._svgFactory.createElement("path");n.append(r);const a=`path_p${this.pageIndex}_${s}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let o;if(e){const d=rt._svgFactory.createElement("mask");n.append(d),o=`mask_p${this.pageIndex}_${s}`,d.setAttribute("id",o),d.setAttribute("maskUnits","objectBoundingBox");const u=rt._svgFactory.createElement("rect");d.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");const f=rt._svgFactory.createElement("use");d.append(f),f.setAttribute("href",`#${a}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}const l=rt._svgFactory.createElement("use");i.append(l),l.setAttribute("href",`#${a}`),o&&l.setAttribute("mask",`url(#${o})`);const h=l.cloneNode();return i.append(h),l.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(i,t),this.#e.set(s,i),s}finalizeDraw(t,e){this.#s.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:s,bbox:i,rootClass:n,path:r}=e,a=typeof t=="number"?this.#e.get(t):t;if(a){if(s&&this.#o(a,s),i&&rt.#r(a,i),n){const{classList:o}=a;for(const[l,h]of Object.entries(n))o.toggle(l,h)}if(r){const l=a.firstChild.firstChild;this.#o(l,r)}}}updateParent(t,e){if(e===this)return;const s=this.#e.get(t);s&&(e.#t.append(s),this.#e.delete(t),e.#e.set(t,s))}remove(t){this.#s.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#s.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:ws};globalThis.pdfjsLib={AbortException:$t,AnnotationEditorLayer:Dt,AnnotationEditorParamsType:j,AnnotationEditorType:O,AnnotationEditorUIManager:Vt,AnnotationLayer:Fs,AnnotationMode:Ht,AnnotationType:J,build:Tr,ColorPicker:Ct,createValidAbsoluteUrl:di,DOMSVGFactory:Ge,DrawLayer:rt,FeatureTest:ot,fetchData:_e,getDocument:wr,getFilenameFromUrl:bn,getPdfFilenameFromUrl:yn,getRGB:Ke,getUuid:pi,getXfaPageViewport:Cn,GlobalWorkerOptions:be,ImageKind:He,InvalidPDFException:ps,isDataScheme:Ye,isPdfFile:Es,isValidExplicitDest:Rn,MathClamp:dt,noContextMenu:wt,normalizeUnicode:pn,OPS:ye,OutputScale:Mt,PasswordResponses:rn,PDFDataRangeTransport:Ri,PDFDateString:gs,PDFWorker:Ce,PermissionFlag:nn,PixelsPerInch:ae,RenderingCancelledException:Ss,ResponseException:Ve,setLayerDimensions:qt,shadow:H,SignatureExtractor:ee,stopEvent:tt,SupportedImageMimeTypes:ms,TextLayer:ht,TouchManager:Ze,updateUrlHash:ui,Util:M,VerbosityLevel:We,version:Er,XfaLayer:Ii};function ua(){return _.jsx("svg",{width:"130",height:"128",viewBox:"0 0 65 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:_.jsx("g",{id:"FilePdf",children:_.jsx("path",{id:"Vector",d:"M11.2503 30H53.2503C53.5155 30 53.7698 29.8946 53.9574 29.7071C54.1449 29.5196 54.2503 29.2652 54.2503 29V22C54.2505 21.7373 54.1989 21.4771 54.0985 21.2343C53.9982 20.9915 53.8509 20.7709 53.6653 20.585L39.6653 6.585C39.4794 6.39933 39.2588 6.2521 39.016 6.15173C38.7732 6.05135 38.513 5.99979 38.2503 6H14.2503C13.1894 6 12.172 6.42143 11.4218 7.17157C10.6717 7.92172 10.2503 8.93913 10.2503 10V29C10.2503 29.2652 10.3556 29.5196 10.5432 29.7071C10.7307 29.8946 10.985 30 11.2503 30ZM38.2503 11L49.2503 22H38.2503V11ZM56.2503 38.1325C56.2055 38.6466 55.9681 39.1247 55.5856 39.4711C55.203 39.8174 54.7037 40.0064 54.1878 40H48.2503V44H52.1828C52.6989 43.993 53.1985 44.1818 53.5812 44.5283C53.9638 44.8747 54.2011 45.3532 54.2453 45.8675C54.2634 46.1411 54.2251 46.4155 54.1328 46.6736C54.0405 46.9318 53.896 47.1682 53.7085 47.3682C53.5209 47.5682 53.2942 47.7274 53.0425 47.8361C52.7908 47.9448 52.5194 48.0006 52.2453 48H48.2503V51.9325C48.2572 52.4486 48.0685 52.9483 47.722 53.3309C47.3755 53.7136 46.8971 53.9508 46.3828 53.995C46.1092 54.0132 45.8348 53.9749 45.5766 53.8825C45.3185 53.7902 45.0821 53.6458 44.8821 53.4582C44.6821 53.2706 44.5228 53.044 44.4141 52.7923C44.3054 52.5405 44.2497 52.2692 44.2503 51.995V38C44.2503 37.4696 44.461 36.9609 44.836 36.5858C45.2111 36.2107 45.7198 36 46.2503 36H54.2503C54.5244 35.9994 54.7958 36.0552 55.0475 36.1639C55.2992 36.2726 55.5259 36.4318 55.7135 36.6318C55.901 36.8318 56.0455 37.0682 56.1378 37.3264C56.2301 37.5845 56.2684 37.8589 56.2503 38.1325ZM16.2503 36H12.2503C11.7198 36 11.2111 36.2107 10.836 36.5858C10.461 36.9609 10.2503 37.4696 10.2503 38V51.9325C10.242 52.4495 10.4302 52.9504 10.7768 53.3341C11.1234 53.7178 11.6026 53.9558 12.1178 54C12.3913 54.0182 12.6657 53.9799 12.9239 53.8875C13.182 53.7952 13.4184 53.6508 13.6184 53.4632C13.8184 53.2756 13.9777 53.049 14.0864 52.7973C14.1951 52.5455 14.2509 52.2742 14.2503 52V50H16.1003C19.9103 50 23.1353 47.02 23.2478 43.2125C23.2762 42.2757 23.1163 41.3428 22.7774 40.469C22.4385 39.5952 21.9276 38.7984 21.275 38.1257C20.6224 37.4531 19.8414 36.9183 18.9783 36.5532C18.1151 36.188 17.1875 35.9999 16.2503 36ZM16.1628 46H14.2503V40H16.2503C16.6699 39.998 17.0852 40.0841 17.4695 40.2527C17.8537 40.4212 18.1984 40.6685 18.4811 40.9786C18.7638 41.2887 18.9783 41.6546 19.1108 42.0527C19.2433 42.4509 19.2908 42.8724 19.2503 43.29C19.163 44.044 18.7988 44.7388 18.2283 45.2395C17.6578 45.7402 16.9217 46.0112 16.1628 46ZM32.2503 36H28.2503C27.7198 36 27.2111 36.2107 26.836 36.5858C26.461 36.9609 26.2503 37.4696 26.2503 38V52C26.2503 52.5304 26.461 53.0391 26.836 53.4142C27.2111 53.7893 27.7198 54 28.2503 54H32.0803C36.9953 54 41.1328 50.13 41.2478 45.2175C41.2768 44.0176 41.0655 42.8241 40.6264 41.7071C40.1872 40.5901 39.5291 39.5722 38.6907 38.7134C37.8524 37.8545 36.8507 37.172 35.7446 36.706C34.6386 36.24 33.4505 36 32.2503 36ZM32.1278 50H30.2503V40H32.2503C32.9234 39.9995 33.5897 40.1349 34.2092 40.3981C34.8287 40.6614 35.3887 41.047 35.8556 41.5319C36.3225 42.0167 36.6867 42.5909 36.9264 43.2199C37.166 43.8489 37.2762 44.5199 37.2503 45.1925C37.1453 47.8975 34.8353 50 32.1278 50Z",fill:"#808080"})})})}function fa(){return _.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"65",height:"64",viewBox:"0 0 65 64",children:_.jsx("path",{d:"M11.125 30H53.1425C53.4077 30 53.6621 29.8947 53.8496 29.7071C54.0371 29.5196 54.1425 29.2652 54.1425 29V22C54.1427 21.7373 54.0912 21.4771 53.9908 21.2343C53.8904 20.9915 53.7432 20.7709 53.5575 20.585L39.5575 6.58501C39.371 6.39875 39.1496 6.25117 38.9059 6.15078C38.6622 6.05038 38.4011 5.99915 38.1375 6.00001H14.125C13.0641 6.00001 12.0467 6.42144 11.2966 7.17158C10.5464 7.92173 10.125 8.93915 10.125 10V29C10.125 29.2652 10.2304 29.5196 10.4179 29.7071C10.6054 29.8947 10.8598 30 11.125 30ZM38.125 11L49.125 22H38.125V11ZM13.125 36H9.125C8.59457 36 8.08586 36.2107 7.71079 36.5858C7.33571 36.9609 7.125 37.4696 7.125 38V52C7.125 52.5304 7.33571 53.0392 7.71079 53.4142C8.08586 53.7893 8.59457 54 9.125 54H12.9575C17.875 54 22.0125 50.13 22.125 45.2175C22.154 44.0174 21.9427 42.8237 21.5034 41.7065C21.0641 40.5894 20.4057 39.5714 19.5671 38.7125C18.7285 37.8536 17.7265 37.1711 16.6201 36.7053C15.5138 36.2395 14.3254 35.9997 13.125 36ZM13.0025 50H11.125V40H13.125C13.7981 39.9995 14.4644 40.1349 15.084 40.3982C15.7035 40.6614 16.2635 41.047 16.7304 41.5319C17.1973 42.0167 17.5615 42.5909 17.8011 43.2199C18.0408 43.8489 18.1509 44.5199 18.125 45.1925C18.0225 47.8975 15.7125 50 13.005 50H13.0025ZM55.67 48.93C55.9899 49.332 56.1485 49.8389 56.1148 50.3515C56.081 50.8642 55.8574 51.3459 55.4875 51.7025C54.7939 52.4228 53.9633 52.9971 53.0446 53.3916C52.1258 53.7862 51.1374 53.993 50.1375 54C45.725 54 42.1375 49.9625 42.1375 45C42.1375 40.0375 45.7275 36 50.1375 36C51.1374 36.007 52.1258 36.2139 53.0446 36.6084C53.9633 37.003 54.7939 37.5773 55.4875 38.2975C55.8574 38.6541 56.081 39.1358 56.1148 39.6485C56.1485 40.1612 55.9899 40.668 55.67 41.07C55.4892 41.2848 55.2652 41.4592 55.0126 41.5817C54.7599 41.7042 54.4843 41.7721 54.2037 41.7811C53.9231 41.7901 53.6437 41.7398 53.3838 41.6337C53.1238 41.5275 52.8891 41.3679 52.695 41.165C52.3706 40.8074 51.9768 40.5196 51.5375 40.3193C51.0982 40.119 50.6227 40.0104 50.14 40C47.935 40 46.14 42.25 46.14 45C46.14 47.75 47.935 50 50.14 50C50.623 49.9894 51.0988 49.8806 51.5385 49.6804C51.9782 49.4801 52.3725 49.1925 52.6975 48.835C52.8916 48.6322 53.1263 48.4725 53.3863 48.3663C53.6462 48.2602 53.9256 48.21 54.2062 48.2189C54.4868 48.2279 54.7624 48.2958 55.0151 48.4183C55.2677 48.5409 55.4917 48.7152 55.6725 48.93H55.67ZM32.125 36C27.7125 36 24.125 40.0375 24.125 45C24.125 49.9625 27.7175 54 32.125 54C36.5325 54 40.125 49.9625 40.125 45C40.125 40.0375 36.5475 36 32.125 36ZM32.125 50C29.9175 50 28.125 47.75 28.125 45C28.125 42.25 29.92 40 32.125 40C34.33 40 36.125 42.25 36.125 45C36.125 47.75 34.34 50 32.125 50Z",fill:"#808080"})})}function pa(){return _.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"65",height:"124",viewBox:"0 0 65 64",fill:"none",children:_.jsx("path",{d:"M54.29 20.585L40.29 6.585C40.1041 6.39933 39.8835 6.2521 39.6407 6.15173C39.3979 6.05135 39.1377 5.99979 38.875 6H14.875C13.8141 6 12.7967 6.42143 12.0466 7.17157C11.2964 7.92172 10.875 8.93913 10.875 10V54C10.875 55.0609 11.2964 56.0783 12.0466 56.8284C12.7967 57.5786 13.8141 58 14.875 58H50.875C51.9359 58 52.9533 57.5786 53.7034 56.8284C54.4536 56.0783 54.875 55.0609 54.875 54V22C54.8752 21.7373 54.8237 21.4771 54.7233 21.2343C54.6229 20.9915 54.4757 20.7709 54.29 20.585ZM40.875 44H24.875C24.3446 44 23.8359 43.7893 23.4608 43.4142C23.0857 43.0391 22.875 42.5304 22.875 42C22.875 41.4696 23.0857 40.9609 23.4608 40.5858C23.8359 40.2107 24.3446 40 24.875 40H40.875C41.4054 40 41.9141 40.2107 42.2892 40.5858C42.6643 40.9609 42.875 41.4696 42.875 42C42.875 42.5304 42.6643 43.0391 42.2892 43.4142C41.9141 43.7893 41.4054 44 40.875 44ZM40.875 36H24.875C24.3446 36 23.8359 35.7893 23.4608 35.4142C23.0857 35.0391 22.875 34.5304 22.875 34C22.875 33.4696 23.0857 32.9609 23.4608 32.5858C23.8359 32.2107 24.3446 32 24.875 32H40.875C41.4054 32 41.9141 32.2107 42.2892 32.5858C42.6643 32.9609 42.875 33.4696 42.875 34C42.875 34.5304 42.6643 35.0391 42.2892 35.4142C41.9141 35.7893 41.4054 36 40.875 36ZM38.875 22V11L49.875 22H38.875Z",fill:"#797979"})})}function ga(){return _.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"45",height:"52",viewBox:"0 0 45 52",fill:"none",children:_.jsx("path",{d:"M44.29 14.585L30.29 0.585001C30.1041 0.399332 29.8835 0.252104 29.6407 0.151728C29.3979 0.0513516 29.1377 -0.000205972 28.875 6.18397e-07H4.875C3.81413 6.18397e-07 2.79672 0.421428 2.04657 1.17157C1.29643 1.92172 0.875 2.93913 0.875 4V48C0.875 49.0609 1.29643 50.0783 2.04657 50.8284C2.79672 51.5786 3.81413 52 4.875 52H40.875C41.9359 52 42.9533 51.5786 43.7034 50.8284C44.4536 50.0783 44.875 49.0609 44.875 48V16C44.8752 15.7373 44.8237 15.4771 44.7233 15.2343C44.6229 14.9915 44.4757 14.7709 44.29 14.585ZM30.875 38H14.875C14.3446 38 13.8359 37.7893 13.4608 37.4142C13.0857 37.0391 12.875 36.5304 12.875 36C12.875 35.4696 13.0857 34.9609 13.4608 34.5858C13.8359 34.2107 14.3446 34 14.875 34H30.875C31.4054 34 31.9141 34.2107 32.2892 34.5858C32.6643 34.9609 32.875 35.4696 32.875 36C32.875 36.5304 32.6643 37.0391 32.2892 37.4142C31.9141 37.7893 31.4054 38 30.875 38ZM30.875 30H14.875C14.3446 30 13.8359 29.7893 13.4608 29.4142C13.0857 29.0391 12.875 28.5304 12.875 28C12.875 27.4696 13.0857 26.9609 13.4608 26.5858C13.8359 26.2107 14.3446 26 14.875 26H30.875C31.4054 26 31.9141 26.2107 32.2892 26.5858C32.6643 26.9609 32.875 27.4696 32.875 28C32.875 28.5304 32.6643 29.0391 32.2892 29.4142C31.9141 29.7893 31.4054 30 30.875 30ZM28.875 16V5L39.875 16H28.875Z",fill:"#797979"})})}function ma(){return _.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"65",height:"64",viewBox:"0 0 65 64",children:_.jsx("path",{d:"M52.95 14.0849L32.95 8.08493C32.6514 7.9953 32.336 7.97671 32.0289 8.03066C31.7219 8.08461 31.4317 8.20959 31.1815 8.39564C30.9313 8.58169 30.7281 8.82364 30.5881 9.10219C30.4481 9.38074 30.3751 9.68816 30.375 9.99993V37.0649C28.3268 35.2329 25.7118 34.1594 22.9672 34.0238C20.2225 33.8882 17.5145 34.6987 15.2956 36.3199C13.0768 37.9411 11.4816 40.2747 10.7766 42.9307C10.0716 45.5868 10.2996 48.4043 11.4225 50.9124C12.5453 53.4206 14.4949 55.4673 16.9456 56.7107C19.3962 57.954 22.1993 58.3186 24.8865 57.7435C27.5736 57.1683 29.9819 55.6884 31.709 53.5509C33.436 51.4134 34.3771 48.7479 34.375 45.9999V12.6874L51.8 17.9149C52.0534 17.9975 52.3208 18.0285 52.5864 18.0063C52.8521 17.984 53.1105 17.9089 53.3467 17.7853C53.5829 17.6617 53.792 17.4922 53.9617 17.2866C54.1314 17.0811 54.2583 16.8437 54.3349 16.5884C54.4116 16.3331 54.4364 16.0651 54.408 15.8001C54.3796 15.535 54.2985 15.2784 54.1695 15.0451C54.0405 14.8119 53.8661 14.6068 53.6567 14.4419C53.4473 14.277 53.207 14.1556 52.95 14.0849Z",fill:"#808080"})})}function Zr({comment:c,commentReplies:t,setReplyTo:e}){const[s,i]=Bt.useState(!1),n=t.get(c.id)||[];return _.jsxs("div",{className:"space-y-2",children:[(c.type==="REJECTED"||c.type==="APPROVED")&&_.jsxs("div",{className:`flex flex-col p-3 rounded-lg border border-[#dbdbdb] ${c.type==="APPROVED"?"bg-green-50":"bg-red-50"}`,children:[c.type?_.jsx("h3",{className:`text-sm 3xl:text-base  mb-2 font-medium ${c.type==="APPROVED"?"text-green-500":"text-red-500"}`,children:c.type==="APPROVED"?"Approval Note":"Rejection Note"}):"",_.jsxs("div",{className:"flex gap-3 items-start mb-2",children:[_.jsx(Pe,{className:"w-7 h-7 flex items-center justify-center",children:c?.created_by?.profile_pic?_.jsx(Me,{src:c.created_by?.profile_pic}):_.jsx(is,{className:"w-4 h-4"})}),_.jsxs("div",{className:"flex-1 space-y-1",children:[_.jsxs("div",{className:"flex items-center justify-start gap-2",children:[_.jsxs("div",{className:"font-normal text-primaryblack text-sm 3xl:text-base",children:[c.created_by?.first_name," ",c.created_by?.last_name]}),_.jsx("div",{className:"text-[10px] 3xl:text-xs font-normal text-[#828282]",children:ke(c.created_at).format("hh:mm A")})]}),_.jsx("div",{className:"text-xs 3xl:text-sm text-[#444] leading-relaxed",children:_.jsx("ul",{className:"text-black text-opacity-60 space-y-1",children:c.comment?.split(`
`).map((r,a)=>_.jsxs("li",{className:"text-black text-opacity-60",children:[r.trim()," "]},a))})}),_.jsxs("div",{className:"flex gap-4",children:[!(c.type==="REJECTED"||c.type==="APPROVED")&&_.jsx(ue,{onClick:()=>e(c),className:"text-[#2F80ED] text-xs h-fit py-0 3xl:text-sm mt-1 bg-transparent px-0 cursor-pointer",children:"Reply"}),n.length>0&&_.jsx(ue,{onClick:()=>i(!s),className:"text-[#2F80ED] text-xs h-fit py-0 3xl:text-sm mt-1 bg-transparent px-0 cursor-pointer",children:s?"Hide Repl ":`Show Replies (${n.length})`})]})]})]}),s&&n.length>0&&_.jsx("div",{className:"ml-10 space-y-2",children:n.reverse().map(r=>_.jsxs("div",{className:"flex gap-3 items-start",children:[_.jsx(Pe,{className:"w-7 h-7",children:_.jsx(Me,{src:r.created_by?.profile_pic})}),_.jsxs("div",{className:"flex-1 space-y-1",children:[_.jsxs("div",{className:"flex items-center justify-start gap-2",children:[_.jsxs("div",{className:"font-normal text-primaryblack text-sm 3xl:text-base",children:[r.created_by?.first_name," ",r.created_by?.last_name]}),_.jsx("div",{className:"text-[10px] 3xl:text-xs font-normal text-[#828282]",children:ke(r.created_at).format("hh:mm A")})]}),_.jsx("div",{className:"text-xs 3xl:text-sm text-[#444] leading-relaxed",children:_.jsx("ul",{className:"text-black text-opacity-60 space-y-1",children:r.comment?.split(`
`).map((a,o)=>_.jsxs("li",{className:"text-black text-opacity-60",children:[a.trim()," "]},o))})})]})]},r.id))})]}),c.type===null&&_.jsxs("div",{className:"  flex flex-col",children:[_.jsxs("div",{className:"flex gap-3 items-start mb-2",children:[_.jsx(Pe,{className:"w-7 h-7 flex items-center justify-center",children:c?.created_by?.profile_pic?_.jsx(Me,{src:c.created_by?.profile_pic}):_.jsx(is,{className:"w-4 h-4"})}),_.jsxs("div",{className:"flex-1 space-y-1",children:[_.jsxs("div",{className:"flex items-center justify-start gap-2",children:[_.jsxs("div",{className:"font-normal text-primaryblack text-sm 3xl:text-base",children:[c.created_by?.first_name," ",c.created_by?.last_name]}),_.jsx("div",{className:"text-[10px] 3xl:text-xs font-normal text-[#828282]",children:ke(c.created_at).format("hh:mm A")})]}),_.jsx("div",{className:"text-xs 3xl:text-sm text-[#444] leading-relaxed",children:_.jsx("ul",{className:"text-black text-opacity-60 space-y-1",children:c.comment?.split(`
`).map((r,a)=>_.jsxs("li",{className:"text-black text-opacity-60",children:[r.trim()," "]},a))})}),_.jsxs("div",{className:"flex gap-4",children:[_.jsx(ue,{onClick:()=>e(c),className:"text-[#2F80ED] text-xs h-fit py-0 3xl:text-sm mt-1 bg-transparent px-0 cursor-pointer",children:"Reply"}),n.length>0&&_.jsx(ue,{onClick:()=>i(!s),className:"text-[#2F80ED] text-xs h-fit py-0 3xl:text-sm mt-1 bg-transparent px-0 cursor-pointer",children:s?"Hide Replies":`Show Replies (${n.length})`})]})]})]}),s&&n.length>0&&_.jsx("div",{className:"ml-10 space-y-2",children:n.reverse().map(r=>_.jsxs("div",{className:"flex gap-3 items-start",children:[_.jsx(Pe,{className:"w-7 h-7 flex items-center justify-center",children:c?.created_by?.profile_pic?_.jsx(Me,{src:c.created_by?.profile_pic}):_.jsx(is,{className:"w-4 h-4"})}),_.jsxs("div",{className:"flex-1 space-y-1",children:[_.jsxs("div",{className:"flex items-center justify-start gap-2",children:[_.jsxs("div",{className:"font-normal text-primaryblack text-sm 3xl:text-base",children:[r.created_by?.first_name," ",r.created_by?.last_name]}),_.jsx("div",{className:"text-[10px] 3xl:text-xs font-normal text-[#828282]",children:ke(r.created_at).format("hh:mm A")})]}),_.jsx("div",{className:"text-xs 3xl:text-sm text-[#444] leading-relaxed",children:_.jsx("ul",{className:"text-black text-opacity-60 space-y-1",children:r.comment?.split(`
`).map((a,o)=>_.jsxs("li",{className:"text-black text-opacity-60",children:[a.trim()," "]},o))})})]})]},r.id))})]})]})}function Qr({className:c}){return _.jsxs("svg",{width:"696",height:"753",viewBox:"0 0 696 753",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:c,children:[_.jsx("path",{d:"M386.251 557.72C527.139 557.72 641.351 443.052 641.351 301.6C641.351 160.148 527.139 45.4795 386.251 45.4795C245.364 45.4795 131.151 160.148 131.151 301.6C131.151 443.052 245.364 557.72 386.251 557.72Z",stroke:"url(#paint0_linear_14178_35718)",strokeWidth:"2.797"}),_.jsx("path",{d:"M350.936 272.965V207.643L327.514 169.494L172.405 163.223L109.425 183.604L105.261 263.035L109.425 333.061L139.094 351.874L148.983 402.564L224.455 357.622L300.448 351.874L350.936 324.7V272.965Z",fill:"#D2D2D2"}),_.jsx("path",{d:"M671.247 336.656C652.207 346.139 626.938 333.947 626.938 333.947C626.938 333.947 632.553 306.384 651.604 296.914C670.644 287.431 695.906 299.612 695.906 299.612C695.906 299.612 690.287 327.174 671.247 336.656Z",fill:"url(#paint1_linear_14178_35718)"}),_.jsx("path",{d:"M280.666 452.48C304.336 466.724 338.295 453.557 338.295 453.557C338.295 453.557 333.854 417.303 310.17 403.075C286.5 388.833 252.555 401.983 252.555 401.983C252.555 401.983 256.996 438.238 280.666 452.48Z",fill:"url(#paint2_linear_14178_35718)"}),_.jsx("path",{d:"M610.362 474.681C603.343 474.681 597.652 480.393 597.652 487.441C597.652 494.49 603.343 500.202 610.362 500.202C617.382 500.202 623.072 494.49 623.072 487.441C623.072 480.393 617.382 474.681 610.362 474.681Z",fill:"#D2D2D2"}),_.jsx("path",{d:"M212.209 100.514C204.312 100.514 197.91 106.941 197.91 114.87C197.91 122.798 204.312 129.226 212.209 129.226C220.106 129.226 226.508 122.798 226.508 114.87C226.508 106.941 220.106 100.514 212.209 100.514Z",fill:"#D2D2D2"}),_.jsx("path",{d:"M12.036 235.678C5.45502 235.678 0.120117 230.322 0.120117 223.715C0.120117 217.107 5.45502 211.751 12.036 211.751C18.617 211.751 23.952 217.107 23.952 223.715C23.952 230.322 18.617 235.678 12.036 235.678Z",fill:"#D2D2D2"}),_.jsx("path",{d:"M566.512 267.148C563.441 267.148 560.951 264.648 560.951 261.565C560.951 258.481 563.441 255.981 566.512 255.981C569.583 255.981 572.073 258.481 572.073 261.565C572.073 264.648 569.583 267.148 566.512 267.148Z",fill:"#D2D2D2"}),_.jsx("path",{d:"M419.504 478.673C415.556 478.673 412.355 475.459 412.355 471.495C412.355 467.53 415.556 464.317 419.504 464.317C423.453 464.317 426.653 467.53 426.653 471.495C426.653 475.459 423.453 478.673 419.504 478.673Z",fill:"#E1E4E5"}),_.jsx("path",{d:"M447.665 535.221C441.962 535.221 437.338 530.58 437.338 524.853C437.338 519.127 441.962 514.484 447.665 514.484C453.369 514.484 457.992 519.127 457.992 524.853C457.992 530.58 453.369 535.221 447.665 535.221Z",fill:"#E1E4E5"}),_.jsx("path",{d:"M515.374 151.742C511.033 151.742 507.514 148.209 507.514 143.85C507.514 139.492 511.033 135.959 515.374 135.959C519.715 135.959 523.234 139.492 523.234 143.85C523.234 148.209 519.715 151.742 515.374 151.742Z",fill:"#E1E4E5"}),_.jsx("path",{d:"M49.4577 361.67C44.6317 361.67 40.7197 357.742 40.7197 352.897C40.7197 348.052 44.6317 344.124 49.4577 344.124C54.2837 344.124 58.1957 348.052 58.1957 352.897C58.1957 357.742 54.2837 361.67 49.4577 361.67Z",fill:"#E1E4E5"}),_.jsx("path",{d:"M260.904 77.9018C262.026 82.1047 259.542 86.4247 255.355 87.5508C251.169 88.677 246.866 86.1829 245.745 81.98C244.623 77.7771 247.107 73.4571 251.293 72.331C255.48 71.2048 259.782 73.6989 260.904 77.9018Z",fill:"#E1E4E5"}),_.jsx("path",{d:"M329.104 111.023C323.339 111.023 318.665 106.33 318.665 100.542C318.665 94.7539 323.339 90.0615 329.104 90.0615C334.869 90.0615 339.543 94.7539 339.543 100.542C339.543 106.33 334.869 111.023 329.104 111.023Z",fill:"#E1E4E5"}),_.jsx("path",{d:"M205.94 439.592C201.505 439.592 197.91 436.704 197.91 433.142C197.91 429.58 201.505 426.692 205.94 426.692C210.375 426.692 213.97 429.58 213.97 433.142C213.97 436.704 210.375 439.592 205.94 439.592Z",fill:"#E1E4E5"}),_.jsx("path",{d:"M515.058 70.061C517.392 78.8079 512.222 87.7985 503.51 90.1423C494.798 92.486 485.843 87.2952 483.509 78.5484C481.175 69.8014 486.345 60.8107 495.057 58.4671C503.769 56.1233 512.724 61.3141 515.058 70.061Z",fill:"#E1E4E5"}),_.jsx("path",{d:"M58.1888 246.835H58.3988C59.6428 264.53 72.7498 264.803 72.7498 264.803C72.7498 264.803 58.2958 265.086 58.2958 285.532C58.2958 265.086 43.8428 264.803 43.8428 264.803C43.8428 264.803 56.9448 264.53 58.1888 246.835ZM667.636 385.841H667.822C668.926 401.857 680.556 402.103 680.556 402.103C680.556 402.103 667.731 402.36 667.731 420.864C667.731 402.36 654.906 402.103 654.906 402.103C654.906 402.103 666.532 401.857 667.636 385.841Z",fill:"#E1E4E5"}),_.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M159.258 339.858V383.103L229.737 341.29L237.103 341.169C266.394 340.687 292.755 337.727 312.466 334.716C324.905 332.815 333.549 324.099 335.426 313.155C338.031 297.973 340.249 278.74 340.249 257.368C340.249 235.997 338.031 216.764 335.426 201.583C333.549 190.639 324.905 181.922 312.466 180.022C290.907 176.728 261.426 173.5 228.87 173.5C196.315 173.5 166.833 176.728 145.275 180.022C132.836 181.922 124.192 190.639 122.314 201.583C119.71 216.764 117.491 235.997 117.491 257.368C117.491 278.74 119.71 297.973 122.314 313.155C123.945 322.659 130.558 330.276 140.2 333.495L159.258 339.858ZM94.8745 196.837C98.9145 173.288 117.557 155.979 141.087 152.384C163.632 148.939 194.56 145.544 228.87 145.544C263.181 145.544 294.109 148.939 316.654 152.384C340.184 155.979 358.827 173.288 362.867 196.837C365.683 213.25 368.094 234.099 368.094 257.368C368.094 280.638 365.683 301.487 362.867 317.9C358.827 341.448 340.184 358.759 316.654 362.354C296.029 365.504 268.388 368.615 237.559 369.122L152.419 419.633C143.138 425.139 131.414 418.422 131.414 407.599V360.023C112.571 353.732 98.3425 338.114 94.8745 317.9C92.0585 301.487 89.6465 280.638 89.6465 257.368C89.6465 234.099 92.0585 213.25 94.8745 196.837Z",fill:"#D2D2D2"}),_.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M159.258 215.744C151.569 215.744 145.336 222.003 145.336 229.723C145.336 237.443 151.569 243.701 159.258 243.701H298.482C306.171 243.701 312.405 237.443 312.405 229.723C312.405 222.003 306.171 215.744 298.482 215.744H159.258ZM159.258 271.657C151.569 271.657 145.336 277.915 145.336 285.635C145.336 293.355 151.569 299.613 159.258 299.613H214.948C222.637 299.613 228.87 293.355 228.87 285.635C228.87 277.915 222.637 271.657 214.948 271.657H159.258Z",fill:"white"}),_.jsx("path",{d:"M357.318 350.544V285.222L380.741 247.073L535.849 240.803L598.829 261.183L602.993 340.614L598.829 410.64L569.161 429.453L559.271 480.143L483.799 435.201L407.807 429.453L357.318 402.279V350.544Z",fill:"#D2D2D2"}),_.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M548.836 418.206V461.45L478.358 419.637L470.991 419.517C441.7 419.035 415.339 416.074 395.629 413.063C383.189 411.163 374.546 402.446 372.668 391.501C370.063 376.321 367.845 357.087 367.845 335.716C367.845 314.345 370.063 295.111 372.668 279.931C374.546 268.986 383.189 260.27 395.629 258.37C417.187 255.076 446.669 251.848 479.224 251.848C511.779 251.848 541.261 255.076 562.819 258.37C575.259 260.27 583.902 268.986 585.78 279.931C588.384 295.111 590.603 314.345 590.603 335.716C590.603 357.087 588.384 376.321 585.78 391.501C584.149 401.006 577.536 408.624 567.894 411.842L548.836 418.206ZM613.22 275.185C609.18 251.636 590.537 234.326 567.008 230.732C544.463 227.287 513.534 223.892 479.224 223.892C444.913 223.892 413.985 227.287 391.44 230.732C367.911 234.326 349.267 251.636 345.227 275.185C342.412 291.597 340 312.446 340 335.716C340 358.986 342.412 379.835 345.227 396.247C349.267 419.796 367.911 437.106 391.44 440.701C412.065 443.852 439.707 446.962 470.535 447.469L555.676 497.981C564.956 503.487 576.681 496.77 576.681 485.947V438.37C595.524 432.08 609.752 416.462 613.22 396.247C616.036 379.835 618.448 358.986 618.448 335.716C618.448 312.446 616.036 291.597 613.22 275.185Z",fill:"#D2D2D2"}),_.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M409.612 294.093C401.923 294.093 395.69 300.352 395.69 308.071C395.69 315.791 401.923 322.049 409.612 322.049H548.836C556.525 322.049 562.758 315.791 562.758 308.071C562.758 300.352 556.525 294.093 548.836 294.093H409.612ZM409.612 350.006C401.923 350.006 395.69 356.263 395.69 363.983C395.69 371.703 401.923 377.962 409.612 377.962H465.302C472.991 377.962 479.224 371.703 479.224 363.983C479.224 356.263 472.991 350.006 465.302 350.006H409.612Z",fill:"white"}),_.jsx("path",{d:"M407.498 89.9387C409.292 88.8989 411.326 88.3516 413.397 88.3516C415.469 88.3516 417.503 88.8989 419.297 89.9387L455.896 111.153C457.69 112.193 459.179 113.689 460.215 115.489C461.25 117.29 461.795 119.333 461.795 121.412V163.842C461.795 168.074 459.547 171.985 455.896 174.101L419.297 195.316C417.503 196.356 415.469 196.903 413.397 196.903C411.326 196.903 409.292 196.356 407.498 195.316L370.899 174.101C369.106 173.061 367.616 171.566 366.581 169.765C365.545 167.964 365 165.922 365 163.842V121.412C365 119.333 365.545 117.29 366.581 115.49C367.616 113.689 369.106 112.193 370.899 111.153L407.498 89.9387Z",fill:"#D2D2D2"}),_.jsx("path",{d:"M413 145.352L398.053 160.358C397.69 160.723 397.237 160.919 396.721 160.944C396.167 160.971 395.68 160.759 395.281 160.358C394.893 159.969 394.668 159.501 394.668 158.967C394.668 158.433 394.893 157.965 395.281 157.575L410.228 142.567L395.281 127.561C394.918 127.196 394.723 126.741 394.698 126.223C394.671 125.667 394.882 125.178 395.281 124.778C395.669 124.388 396.135 124.162 396.667 124.162C397.199 124.162 397.665 124.388 398.053 124.778L413 139.784L427.948 124.778C428.311 124.413 428.765 124.217 429.283 124.192L413 145.352ZM413 145.352L427.948 160.358C428.336 160.748 428.802 160.974 429.334 160.974C429.866 160.974 430.332 160.748 430.72 160.358C431.118 159.959 431.33 159.471 431.303 158.916C431.278 158.395 431.083 157.94 430.72 157.575L415.773 142.567L430.72 127.561C431.108 127.171 431.333 126.703 431.333 126.169C431.333 125.635 431.108 125.167 430.72 124.778C430.322 124.378 429.836 124.165 429.283 124.192L413 145.352Z",fill:"white"}),_.jsx("path",{d:"M413 145.352L398.053 160.358C397.69 160.723 397.237 160.919 396.721 160.944C396.167 160.971 395.68 160.759 395.281 160.358C394.893 159.969 394.668 159.501 394.668 158.967C394.668 158.433 394.893 157.965 395.281 157.575L410.228 142.567L395.281 127.561C394.918 127.196 394.723 126.741 394.698 126.223C394.671 125.667 394.882 125.178 395.281 124.778C395.669 124.388 396.135 124.162 396.667 124.162C397.199 124.162 397.665 124.388 398.053 124.778L413 139.784L427.948 124.778C428.311 124.413 428.765 124.217 429.283 124.192M413 145.352L429.283 124.192M413 145.352L427.948 160.358C428.336 160.748 428.802 160.974 429.334 160.974C429.866 160.974 430.332 160.748 430.72 160.358C431.118 159.959 431.33 159.471 431.303 158.916C431.278 158.395 431.083 157.94 430.72 157.575L415.773 142.567L430.72 127.561C431.108 127.171 431.333 126.703 431.333 126.169C431.333 125.635 431.108 125.167 430.72 124.778C430.322 124.378 429.836 124.165 429.283 124.192",stroke:"white"}),_.jsx("path",{d:"M203 655.481V624.418H206.713L223.199 649.357V624.418H226.912V655.481H223.199L206.713 630.542V655.481H203ZM243.456 656.014C241.304 656.014 239.403 655.512 237.754 654.505C236.105 653.498 234.823 652.078 233.909 650.245C232.994 648.412 232.539 646.265 232.539 643.81C232.539 641.325 232.994 639.181 233.909 637.376C234.851 635.543 236.149 634.123 237.798 633.116C239.478 632.109 241.392 631.607 243.544 631.607C245.724 631.607 247.624 632.109 249.246 633.116C250.895 634.123 252.177 635.543 253.091 637.376C254.005 639.181 254.461 641.325 254.461 643.81C254.461 646.265 253.989 648.412 253.047 650.245C252.132 652.078 250.851 653.498 249.201 654.505C247.552 655.512 245.635 656.014 243.456 656.014ZM243.456 652.819C244.812 652.819 246.033 652.494 247.124 651.842C248.215 651.163 249.069 650.156 249.688 648.825C250.337 647.463 250.66 645.793 250.66 643.81C250.66 641.8 250.351 640.127 249.732 638.796C249.113 637.465 248.26 636.475 247.168 635.823C246.108 635.143 244.9 634.802 243.544 634.802C242.218 634.802 241.011 635.143 239.92 635.823C238.829 636.475 237.961 637.465 237.312 638.796C236.663 640.127 236.34 641.8 236.34 643.81C236.34 645.793 236.649 647.463 237.268 648.825C237.917 650.156 238.771 651.163 239.831 651.842C240.923 652.494 242.13 652.819 243.456 652.819ZM285.013 656.014C282.096 656.014 279.561 655.348 277.411 654.017C275.29 652.655 273.638 650.777 272.461 648.381C271.312 645.954 270.737 643.145 270.737 639.95C270.737 636.755 271.312 633.959 272.461 631.563C273.638 629.136 275.29 627.258 277.411 625.927C279.561 624.565 282.096 623.886 285.013 623.886C288.519 623.886 291.362 624.729 293.544 626.415C295.723 628.102 297.124 630.484 297.743 633.56H293.721C293.218 631.638 292.246 630.098 290.804 628.945C289.389 627.76 287.458 627.17 285.013 627.17C282.892 627.17 281.036 627.688 279.444 628.723C277.881 629.729 276.674 631.194 275.82 633.116C274.964 635.01 274.538 637.287 274.538 639.95C274.538 642.612 274.964 644.906 275.82 646.828C276.674 648.722 277.881 650.187 279.444 651.221C281.036 652.228 282.892 652.73 285.013 652.73C287.458 652.73 289.389 652.167 290.804 651.044C292.246 649.89 293.218 648.367 293.721 646.473H297.743C297.124 649.46 295.723 651.798 293.544 653.484C291.362 655.171 288.519 656.014 285.013 656.014ZM313.036 656.014C310.884 656.014 308.983 655.512 307.334 654.505C305.682 653.498 304.4 652.078 303.489 650.245C302.574 648.412 302.118 646.265 302.118 643.81C302.118 641.325 302.574 639.181 303.489 637.376C304.431 635.543 305.726 634.123 307.378 633.116C309.058 632.109 310.972 631.607 313.124 631.607C315.303 631.607 317.204 632.109 318.826 633.116C320.475 634.123 321.756 635.543 322.671 637.376C323.582 639.181 324.041 641.325 324.041 643.81C324.041 646.265 323.569 648.412 322.624 650.245C321.712 652.078 320.43 653.498 318.781 654.505C317.129 655.512 315.215 656.014 313.036 656.014ZM313.036 652.819C314.389 652.819 315.613 652.494 316.704 651.842C317.792 651.163 318.649 650.156 319.268 648.825C319.914 647.463 320.24 645.793 320.24 643.81C320.24 641.8 319.931 640.127 319.312 638.796C318.693 637.465 317.837 636.475 316.748 635.823C315.687 635.143 314.477 634.802 313.124 634.802C311.798 634.802 310.588 635.143 309.5 635.823C308.408 636.475 307.538 637.465 306.892 638.796C306.243 640.127 305.92 641.8 305.92 643.81C305.92 645.793 306.229 647.463 306.848 648.825C307.494 650.156 308.35 651.163 309.411 651.842C310.5 652.494 311.71 652.819 313.036 652.819ZM329.417 655.481V632.14H332.776L332.953 635.335C333.66 634.181 334.618 633.28 335.825 632.628C337.035 631.948 338.301 631.607 339.627 631.607C340.748 631.607 341.748 631.771 342.632 632.095C343.546 632.392 344.342 632.864 345.019 633.515C345.698 634.137 346.243 634.921 346.654 635.867C347.422 634.478 348.453 633.427 349.748 632.717C351.074 631.976 352.461 631.607 353.903 631.607C355.613 631.607 357.071 631.948 358.278 632.628C359.516 633.28 360.461 634.284 361.107 635.645C361.787 636.977 362.124 638.649 362.124 640.66V655.481H358.455V641.059C358.455 638.96 357.999 637.39 357.085 636.355C356.173 635.321 354.936 634.802 353.372 634.802C352.312 634.802 351.339 635.082 350.455 635.645C349.602 636.208 348.908 637.035 348.378 638.13C347.878 639.226 347.627 640.557 347.627 642.124V655.481H343.914V641.059C343.914 638.96 343.458 637.39 342.544 636.355C341.632 635.321 340.408 634.802 338.875 634.802C337.845 634.802 336.886 635.082 336.002 635.645C335.149 636.208 334.455 637.035 333.925 638.13C333.395 639.226 333.129 640.557 333.129 642.124V655.481H329.417ZM368.265 655.481V632.14H371.624L371.8 635.335C372.508 634.181 373.466 633.28 374.673 632.628C375.881 631.948 377.149 631.607 378.474 631.607C379.593 631.607 380.596 631.771 381.48 632.095C382.394 632.392 383.19 632.864 383.867 633.515C384.543 634.137 385.09 634.921 385.502 635.867C386.267 634.478 387.3 633.427 388.596 632.717C389.922 631.976 391.306 631.607 392.751 631.607C394.461 631.607 395.919 631.948 397.126 632.628C398.364 633.28 399.306 634.284 399.955 635.645C400.632 636.977 400.972 638.649 400.972 640.66V655.481H397.303V641.059C397.303 638.96 396.847 637.39 395.933 636.355C395.019 635.321 393.781 634.802 392.22 634.802C391.16 634.802 390.187 635.082 389.303 635.645C388.45 636.208 387.756 637.035 387.226 638.13C386.726 639.226 386.474 640.557 386.474 642.124V655.481H382.762V641.059C382.762 638.96 382.306 637.39 381.392 636.355C380.477 635.321 379.256 634.802 377.723 634.802C376.693 634.802 375.734 635.082 374.85 635.645C373.997 636.208 373.303 637.035 372.773 638.13C372.242 639.226 371.977 640.557 371.977 642.124V655.481H368.265ZM416.745 656.014C414.684 656.014 412.856 655.512 411.264 654.505C409.673 653.498 408.422 652.078 407.508 650.245C406.624 648.412 406.182 646.265 406.182 643.81C406.182 641.356 406.624 639.209 407.508 637.376C408.422 635.543 409.673 634.123 411.264 633.116C412.886 632.109 414.742 631.607 416.833 631.607C419.074 631.607 420.944 632.109 422.447 633.116C423.949 634.123 425.085 635.468 425.85 637.154C426.618 638.84 426.999 640.69 426.999 642.701C426.999 642.998 426.999 643.292 426.999 643.588C426.999 643.885 426.985 644.24 426.955 644.654H408.966V641.769H423.375C423.317 639.492 422.654 637.762 421.386 636.577C420.148 635.365 418.601 634.758 416.745 634.758C415.507 634.758 414.358 635.068 413.297 635.69C412.267 636.28 411.427 637.168 410.778 638.352C410.132 639.536 409.806 641.015 409.806 642.79V644.032C409.806 645.985 410.132 647.627 410.778 648.958C411.427 650.259 412.267 651.235 413.297 651.887C414.358 652.538 415.507 652.863 416.745 652.863C418.397 652.863 419.693 652.552 420.635 651.931C421.579 651.279 422.27 650.364 422.712 649.18H426.38C426.027 650.481 425.408 651.651 424.524 652.686C423.67 653.72 422.579 654.535 421.253 655.126C419.958 655.717 418.455 656.014 416.745 656.014ZM432.146 655.481V632.14H435.505L435.681 635.823C436.358 634.492 437.331 633.457 438.599 632.717C439.894 631.976 441.383 631.607 443.063 631.607C444.773 631.607 446.259 631.932 447.527 632.583C448.795 633.235 449.781 634.225 450.488 635.557C451.195 636.888 451.549 638.574 451.549 640.615V655.481H447.836V641.015C447.836 638.943 447.32 637.39 446.289 636.355C445.286 635.321 443.933 634.802 442.223 634.802C441.074 634.802 440.013 635.082 439.04 635.645C438.068 636.178 437.286 636.977 436.698 638.042C436.137 639.107 435.858 640.407 435.858 641.947V655.481H432.146ZM466.714 655.481C465.388 655.481 464.239 655.273 463.267 654.86C462.295 654.447 461.543 653.751 461.013 652.774C460.513 651.767 460.261 650.422 460.261 648.736V635.29H456.195V632.14H460.261L460.748 626.326H463.974V632.14H470.56V635.29H463.974V648.736C463.974 650.126 464.253 651.074 464.814 651.576C465.375 652.05 466.361 652.286 467.775 652.286H470.471V655.481H466.714ZM484.051 656.014C481.96 656.014 480.22 655.703 478.836 655.082C477.48 654.43 476.449 653.543 475.742 652.419C475.035 651.266 474.607 649.934 474.46 648.425H478.261C478.38 649.224 478.645 649.965 479.057 650.644C479.499 651.296 480.132 651.828 480.957 652.242C481.783 652.655 482.828 652.863 484.096 652.863C485.098 652.863 485.952 652.716 486.659 652.419C487.366 652.095 487.897 651.651 488.25 651.088C488.634 650.525 488.825 649.876 488.825 649.135C488.825 648.159 488.604 647.405 488.162 646.872C487.75 646.309 487.132 645.896 486.306 645.63C485.51 645.333 484.507 645.111 483.3 644.964C482.004 644.787 480.855 644.534 479.853 644.21C478.85 643.885 477.996 643.455 477.289 642.923C476.612 642.39 476.096 641.725 475.742 640.926C475.388 640.127 475.212 639.182 475.212 638.086C475.212 636.813 475.551 635.69 476.228 634.714C476.905 633.737 477.864 632.983 479.101 632.45C480.369 631.887 481.855 631.607 483.565 631.607C486.071 631.607 488.043 632.184 489.488 633.338C490.96 634.492 491.83 636.133 492.096 638.263H488.427C488.281 637.168 487.778 636.311 486.924 635.69C486.071 635.068 484.935 634.758 483.521 634.758C482.018 634.758 480.883 635.038 480.118 635.601C479.353 636.164 478.969 636.902 478.969 637.82C478.969 638.499 479.132 639.121 479.455 639.684C479.808 640.216 480.397 640.674 481.223 641.059C482.049 641.414 483.154 641.68 484.538 641.858C486.275 642.066 487.75 642.404 488.957 642.879C490.165 643.322 491.079 644.018 491.698 644.964C492.347 645.91 492.656 647.197 492.626 648.825C492.626 650.364 492.259 651.665 491.521 652.73C490.814 653.795 489.811 654.608 488.515 655.171C487.247 655.734 485.761 656.014 484.051 656.014Z",fill:"#434343"}),_.jsxs("defs",{children:[_.jsxs("linearGradient",{id:"paint0_linear_14178_35718",x1:"397.189",y1:"847.891",x2:"381.245",y2:"-516.21",gradientUnits:"userSpaceOnUse",children:[_.jsx("stop",{stopColor:"white"}),_.jsx("stop",{offset:"1",stopColor:"#EEEEEE"})]}),_.jsxs("linearGradient",{id:"paint1_linear_14178_35718",x1:"598.131",y1:"366.236",x2:"755.659",y2:"242.128",gradientUnits:"userSpaceOnUse",children:[_.jsx("stop",{stopColor:"white"}),_.jsx("stop",{offset:"1",stopColor:"#EEEEEE"})]}),_.jsxs("linearGradient",{id:"paint2_linear_14178_35718",x1:"372.262",y1:"498.329",x2:"181.1",y2:"321.422",gradientUnits:"userSpaceOnUse",children:[_.jsx("stop",{stopColor:"white"}),_.jsx("stop",{offset:"1",stopColor:"#EEEEEE"})]})]})]})}const us=c=>c.charAt(0).toUpperCase()+c.slice(1),ba=({documentId:c})=>{const[t,e]=Bt.useState(""),[s,i]=Bt.useState(""),[n,r]=Bt.useState(null),a=Bt.useRef(null),l=Xi().pathname,h=Ui({strict:!1}),d=h.stage,u=h.sub_stage,{isFetching:f,isLoading:g,isError:p,error:b,data:m,fetchNextPage:A,hasNextPage:y,refetch:C}=qi({queryKey:["comments",c],queryFn:async({pageParam:P=1})=>{try{const $=await Zi(c,{page:P,pageSize:10});if($?.status===200||$?.status===201)return $?.data?.data;throw new Error("Failed to fetch comments")}catch{return Ot.error("Error fetching comments",{action:{label:"✕",onClick:()=>Ot.dismiss()}}),{records:[],pagination_info:{}}}},initialPageParam:1,getNextPageParam:P=>P?.pagination_info?.next_page??void 0,refetchOnWindowFocus:!1}),{mutate:w,isPending:v}=Wi({mutationKey:["comment",c],mutationFn:async P=>{const N={case_stage:d,case_sub_stage:u,comment:P.comment,reply_to:P?.reply_to};return await Qi(N,c)},onSuccess:()=>{C(),e(""),i(""),r(null)},onError:()=>{Ot.error("Failed to post a comment",{action:{label:"✕",onClick:()=>Ot.dismiss()}})}}),x=P=>{if(P.preventDefault(),!t.trim()){Ot.error("Comment cannot be empty",{action:{label:"✕",onClick:()=>Ot.dismiss()}});return}w({comment:t,reply_to:n?.id})},S=P=>{r(P),i(`@${P.created_by?.first_name} `),e("")},E=P=>{const N=P.target.value;if(n&&N.startsWith(`@${n.created_by?.first_name} `)){const $=`@${n.created_by?.first_name} `,R=N.slice($.length);i($+us(R)),e(us(R.trim()))}else i(us(N)),e(N.trim())},D=m?.pages?.flatMap(P=>P?.records??[])??[],{Comments:T,CommentReplies:V}=D.reduce((P,N)=>(N&&(N.reply_to?(P.CommentReplies.has(N.reply_to)||P.CommentReplies.set(N.reply_to,[]),P.CommentReplies.get(N.reply_to)?.push(N)):P.Comments.push(N)),P),{Comments:[],CommentReplies:new Map});return Bt.useEffect(()=>{const P=()=>{if(a.current){const{scrollTop:$,scrollHeight:R,clientHeight:L}=a.current;R-$<=L+50&&y&&!f&&A()}},N=a.current;return N&&N.addEventListener("scroll",P),()=>{N&&N.removeEventListener("scroll",P)}},[y,f,A]),Bt.useEffect(()=>{p&&b instanceof Error&&Ot.error(b.message||"Error fetching comments",{action:{label:"✕",onClick:()=>Ot.dismiss()}})},[p,b]),Bt.useEffect(()=>{setTimeout(()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)},100)},[D.length]),_.jsxs(Yi,{className:"w-full h-full mx-auto relative rounded-none border-gray-200 border-0.5 ",children:[_.jsx("div",{className:"flex justify-between items-center mb-4 px-2 pt-4",children:_.jsxs("h6",{className:"text-[#444] text-md 3xl:text-lg font-normal",children:["Comments"," ",_.jsx("span",{className:"bg-black px-3 rounded-full py-[1px] text-xs 3xl:text-sm text-white",children:T.length})]})}),_.jsx("div",{children:g?_.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-270px)]",children:_.jsx("span",{children:"Loading Comments..."})}):_.jsx("div",{className:"h-[calc(100vh-270px)]",children:T?.length?_.jsx("div",{className:"space-y-4 h-full overflow-x-auto px-3",ref:a,children:[...T].reverse().map(P=>_.jsx(Zr,{comment:P,commentReplies:V,setReplyTo:S},P.id))}):_.jsx("div",{className:"flex items-center justify-center h-full",children:_.jsx(Qr,{className:"size-56"})})})}),!l.includes("files")&&_.jsx("div",{className:"absolute bottom-0 w-full",children:_.jsxs("div",{className:" relative flex items-center border rounded-none  border-gray-200 p-2 gap-2 bg-gray-100",children:[_.jsx(Ki,{value:s,onChange:E,onKeyDown:P=>{P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),v||x(P))},placeholder:"Add comment",className:"border-none h-10 resize-none px-2 py-1 bg-transparent focus:ring-0 flex-1 outline-none text-xs 3xl:text-sm text-[#444] placeholder:text-[#444] placeholder:text-xs 3xl:placeholder:text-sm"}),_.jsx(ue,{onClick:x,variant:"ghost",size:"icon",className:"text-white shadow-none bg-black h-9 w-9 rounded-none cursor-pointer",disabled:v,children:v?_.jsx(tn,{className:"animate-spin"}):_.jsx(sn,{className:"w-5 h-5"})})]})})]})};export{ba as D,ua as F,be as G,pa as a,ga as b,fa as c,ma as d,wr as g};
