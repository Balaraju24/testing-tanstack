import{r as o,t as i,j as e}from"./main-Cfdx-166.js";import{U as I}from"./Provider-ByMBYsBJ.js";import{L as U}from"./Loading-CBYA94ZU.js";import{h as L,e as M}from"./fileUpload-C5Dy2rVy.js";import{d as V}from"./apiHelpers-Bpl3N5CG.js";import{i as Y,M as B}from"./ManageCaseHeader-C-iqY6N9.js";import{u}from"./useMutation-B1DU5d2J.js";import{d as O}from"./dayjs.min-CmsQqqGy.js";import{T as h,S as T}from"./TableHeader-sQshSSr-.js";import{E as H}from"./eye-BQaVMbMk.js";import{L as f}from"./loader-circle-CtVpcMqj.js";import{D as $}from"./download-DD_AicsW.js";import"./litigations-CHZYp0Qz.js";import"./fetch-B9iWZIk4.js";import"./manage-N6m0a4Rv.js";import"./useQuery-JrEwn0HC.js";import"./useInfiniteQuery-CsBoIoE-.js";import"./index-FfAIZCaX.js";import"./index-CHQA3myx.js";import"./index-lXLfk88N.js";import"./CaseFilingIcon-B3T83UWb.js";import"./legal-notice-icon-CQRroJUz.js";import"./notes-edit-icon-DR2vjJ_2.js";import"./index-C_gXUdb4.js";import"./index-hzHaN75t.js";import"./index-DF_xtgj4.js";import"./tooltip-Dk48ikt-.js";import"./index-DE95MUWf.js";import"./index-BoybbV93.js";import"./index-BBlAPqfG.js";import"./manage-B5DlZb4f.js";import"./utc-BVtgXMZy.js";import"./useUserPermissions-EkOdBJwI.js";import"./userDetails-BK07mqDr.js";import"./pending-icon-DAWTPq6S.js";import"./approved-Icon-DeOvi-fV.js";import"./current-icon-8I7qxN0n.js";import"./chevron-down-CCzDJ7wY.js";import"./createLucideIcon-BmLFQ-XG.js";import"./complete-logo-C9qAcUgu.js";import"./notes-close-icon-DwQRAOm_.js";import"./index-DETgyAaU.js";import"./index-Vwln1SHO.js";import"./textarea-HR3ErcZs.js";import"./notification-Dr26wPLe.js";import"./service-7i-FAUkJ.js";import"./index-BjReNNxi.js";import"./x-OEbIHzu5.js";import"./default-user-H6DJgCjJ.js";import"./notes-delete-icon-BGPvWUIE.js";import"./notes-head-icon-B7j4bc-E.js";import"./summary-icon-card-D2HQg2x6.js";import"./avatar-BO1wJRFV.js";import"./input-DYbhqlvz.js";import"./sheet-CMzcKqsy.js";import"./skeleton-CvqsTR7_.js";function Ge({stage:l,subStage:n,isLoading:c=!1}){const{allDocsIsLoading:m,allDocsData:a,caseStagesData:g,getAllDocsRefetch:y}=I(),[w,j]=o.useState(new Set),[D,d]=o.useState(null),[N,b]=o.useState(null),v=Y(g?.sub_stages,n),{mutate:A,isPending:_}=u({mutationFn:async t=>{const s={file_key:t.key},r=await L(s),p=r?.data?.status,x=r?.data?.data?.download_url;if((p===200||p===201)&&x)V(x,t.file_name),d(null);else throw new Error("Invalid response or download URL")},onError:()=>{i.error("Failed to download attachment.")}}),{mutate:k,isPending:S}=u({mutationFn:async t=>{const r=await M({payload:{verification_status:"APPROVED",case_stage:l,case_sub_stage:n},doc_id:t});if(r?.status===200||r?.status===201)return r.data;throw new Error("Failed to accept document")},onSuccess:(t,s)=>{i.success("Document accepted successfully"),j(r=>new Set(r).add(s)),y()},onError:()=>{i.error("Failed to accept document")}}),P=t=>{t?window.open(t,"_blank","noopener,noreferrer"):console.error("No download URL available")},C=t=>{t.key?(d(t.id),A({key:t.key,file_name:t.file_name})):i.error("Document key not available for download")},E=o.useMemo(()=>!Array.isArray(a)||a.length===0?!1:a.every(t=>t.verification_status==="APPROVED"),[a]),F=t=>{b(t),k(t)},R=()=>c?e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full",children:[e.jsx(h,{}),e.jsx("tbody",{children:Array.from({length:5}).map((t,s)=>e.jsx(T,{index:s},`skeleton-${s}`))})]})}):!Array.isArray(a)||a?.length===0?e.jsx("div",{className:"px-4 py-5 sm:px-6",children:e.jsx("h3",{className:"text-lg font-normal leading-6 text-gray-900",children:"No Documents Uploaded"})}):e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full",children:[e.jsx(h,{}),e.jsx("tbody",{children:Array.isArray(a)&&a?.map((t,s)=>e.jsxs("tr",{className:`hover:bg-gray-200 ${s%2===0?"bg-gray-100":"bg-white"}`,children:[e.jsx("td",{className:"px-4 py-3 text-xs text-gray-900",children:O(t.created_at).format("DD MMM YYYY")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsx("div",{className:"truncate w-32",title:t?.file_name||"--",children:t?.file_name||"--"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsx("div",{className:"truncate w-32 cursor-pointer",title:t.document_type,children:t.document_type})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>P(t.download_url),className:"p-1 hover:bg-gray-300 cursor-pointer rounded transition-colors",title:"View Document",children:e.jsx(H,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>C(t),disabled:_,className:"p-1 hover:bg-gray-300 cursor-pointer rounded transition-colors disabled:opacity-50",title:"Download Document",children:D===t.id?e.jsx(f,{className:"w-4 h-4 text-gray-600 animate-spin"}):e.jsx($,{className:"w-4 h-4 text-gray-600"})}),w.has(t.id)||t?.verification_status==="APPROVED"?e.jsx("button",{className:"px-2 py-1 bg-green-600 text-white text-xs rounded flex items-center gap-1 cursor-default",title:"Document Accepted",children:"Accepted"}):!v&&e.jsx("button",{onClick:()=>F(t.id),disabled:S,className:"px-2 py-1 bg-white w-18 cursor-pointer hover:bg-gray-300  border border-gray-200 text-gray-700 text-xs rounded transition-colors flex items-center justify-center gap-1 disabled:opacity-50",title:"Accept Document",children:N===t.id?e.jsx(f,{className:"w-4 h-4 animate-spin"}):"Accept"})]})})]},t.id))})]})});return e.jsx("div",{className:"h-full relative",children:m?e.jsx(U,{loading:m,message:"Loading documents..."}):e.jsxs(e.Fragment,{children:[e.jsx(B,{caseStage:l,caseSubStage:n,showActionButton:!!E,showUploadButton:!1,showNoteButton:!1}),!Array.isArray(a)||a?.length===0?e.jsx("div",{className:"px-4 py-5 sm:px-6",children:e.jsx("h3",{className:"text-lg font-normal leading-6 text-gray-900",children:"No Documents Uploaded"})}):e.jsxs("div",{className:"w-full overflow-auto",children:[e.jsx("div",{className:"p-2 h-max-[calc(100%-60px)] w-full overflow-auto",children:e.jsx("div",{className:"bg-white overflow-hidden",children:R()})}),!c&&Array.isArray(a)&&a?.[0]?.remarks&&e.jsxs("div",{className:"col-span-12 space-y-2 mt-4 flex flex-col p-4 pt-2",children:[e.jsx("div",{className:"w-full text-sm font-normal text-gray-900 mb-1",children:"Remarks"}),e.jsx("div",{className:"bg-gray-50 p-2 text-gray-700 text-xs 2xl:textsm",children:a[0].remarks})]})]})]})})}export{Ge as default};
