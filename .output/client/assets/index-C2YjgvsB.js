import{r as v,t as n,j as e,h as ee,u as te}from"./main-CbopZ6M6.js";import{u as se}from"./index-9N-Gpv7K.js";import{U as O}from"./Provider-BC_HjP_o.js";import{L as ae}from"./Loading-DliovM0z.js";import{N as re}from"./no-cases-data-D0ClwAfz.js";import{v as ie,r as oe}from"./legalOpinion-CVXYCweo.js";import{i as ne,M as le}from"./ManageCaseHeader-5m-OMl3k.js";import{h as ce,u as de,a as me,f as pe}from"./fileUpload-CyZu8moV.js";import{d as ue}from"./apiHelpers-Cq0RJRye.js";import{u as M}from"./useMutation-AZp6LET6.js";import{u as W}from"./useUserPermissions-DqHuV15h.js";import{d as ge}from"./dayjs.min-BPVt0UoP.js";import{L as U}from"./loader-circle-CHBElFpm.js";import{D as xe}from"./download-C1tTGVQS.js";import{c as he}from"./createLucideIcon-2fvSvvVa.js";import{U as fe}from"./upload-DbbL0UMR.js";import"./CaseFilingIcon-Ki22rwHg.js";import"./legal-notice-icon-DY79a5uN.js";import"./notes-edit-icon-Dx1vAmyL.js";import"./index-DFgmobCw.js";import"./index-Bz18Tu21.js";import"./index-CXHJR4o1.js";import"./index-BfzcKS58.js";import"./index-BYuWQ9Ar.js";import"./tooltip-BNtdrHqg.js";import"./index-NA-xklZo.js";import"./index-C-zDLRzy.js";import"./index-CB5qnijn.js";import"./manage-Dtja-RKh.js";import"./utc-YeGeLL22.js";import"./pending-icon-xk-CqbVY.js";import"./approved-Icon-sUM8RCgD.js";import"./current-icon-dhgqbcsv.js";import"./chevron-down-DFI8aQgh.js";import"./litigations-CmIaLu41.js";import"./fetch-BYBqU-UB.js";import"./manage-UYlebOZ2.js";import"./useQuery-aXFamHAp.js";import"./useInfiniteQuery-DCpiOsiQ.js";import"./complete-logo-BdyjTQM1.js";import"./notes-close-icon-CZlPG_WL.js";import"./index-Bn1KO0DZ.js";import"./index-BrJXLgSY.js";import"./textarea-DVdyI6Fw.js";import"./notification-B2GbDUfo.js";import"./service-Clbc7XwB.js";import"./index-BFdYt5ff.js";import"./x-ClszbkRs.js";import"./default-user-B5Qt0uKr.js";import"./notes-delete-icon-COtxmY5M.js";import"./notes-head-icon-zA5gOWGa.js";import"./summary-icon-card-x7nT6ld4.js";import"./avatar-I9rQhuEx.js";import"./input-BFw7NH1J.js";import"./sheet-KGfwaNTI.js";import"./skeleton-CGIrBuj0.js";import"./userDetails-BKeSBteA.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ye=he("trash-2",ve),be=(l,a,m)=>{const[o,t]=v.useState(null),{mutate:y,isPending:b}=M({mutationFn:async p=>{const u=await ce({file_key:p.key});if(u?.data?.status===200&&u?.data?.data?.download_url)ue(u.data.data.download_url,p.file_name);else throw new Error("Invalid response or download URL")},onError:()=>n.error("Failed to download attachment"),onSettled:()=>t(null)});return{downloadingDocId:o,isPendingDownloadFile:b,handleDownload:p=>{p.key?(t(p.id),y({key:p.key,file_name:p.file_name})):n.error("Document key not available for download")}}},we=(l,a,m)=>{const[o,t]=v.useState([]),[y,b]=v.useState(!1),[x,p]=v.useState(!1),[u,g]=v.useState(new Set),j=x||u.size>0,{getAllDocsRefetch:c,serviceData:F}=O();return{uploadedFiles:o,isDragOver:y,loading:x,deletingFiles:u,isAnyOperationInProgress:j,handleFileSelect:async i=>{if(j){n.error("Please wait for the current operation to complete");return}const r=i[0];if(!r)return;if(r.size>50*1024*1024){n.error("File size must be less than 50MB");return}if(!["image/jpeg","image/jpg","image/png","image/webp","application/pdf"].includes(r.type)){n.error("Unsupported file type. Please upload JPEG, PNG, WebP, or PDF files.");return}try{const w=r.name.split(".").pop(),{data:f}=await pe({file_name:r.name,file_type:w,file_size:r.size}),{target_url:_,file_key:S}=f?.data;if(!_)throw new Error("Presigned URL is missing");t(k=>[...k,{id:Date.now(),name:r.name,size:r.size,uploadDate:new Date().toLocaleDateString("en-GB"),type:r.type,key:S,presignedUrl:_,file:r}])}catch{n.error("Failed to prepare file for upload")}},handleSubmit:async()=>{if(o.length===0){n.error("Please upload at least one file before submitting.");return}if(u.size>0){n.error("Please wait for file removal operations to complete");return}p(!0);try{for(const i of o)await de(i.presignedUrl,i.file),await me({case_id:Number(l),file_name:i.name,file_type:i.name.split(".").pop(),file_size:i.size,key:i.key,case_stage:a,case_sub_stage:m,category:F?.is_received_original_doc?"Final Report Document":"Legal Report Document"});c&&await c(),n.success("Successfully submitted report document"),t([])}catch{n.error("Failed to submit files")}finally{p(!1)}},removeFile:async i=>{if(x){n.error("Cannot remove files while submitting");return}if(u.has(i)){n.error("File is already being removed");return}g(r=>new Set(r).add(i));try{await new Promise(r=>setTimeout(r,300)),t(r=>r.filter(h=>h.id!==i)),n.success("File removed successfully")}catch{n.error("Failed to remove file")}finally{g(r=>{const h=new Set(r);return h.delete(i),h})}},setIsDragOver:b}},q=({className:l})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"34",viewBox:"0 0 28 34",fill:"none",className:l,children:e.jsx("path",{d:"M27.2889 9.915L18.6002 1.22634C18.4849 1.11111 18.3479 1.01974 18.1972 0.957446C18.0466 0.895151 17.8851 0.863153 17.722 0.863282H2.8272C2.16881 0.863282 1.53738 1.12483 1.07183 1.59038C0.606272 2.05594 0.344727 2.68736 0.344727 3.34575V30.653C0.344727 31.3114 0.606272 31.9428 1.07183 32.4083C1.53738 32.8739 2.16881 33.1354 2.8272 33.1354H25.1695C25.8279 33.1354 26.4593 32.8739 26.9248 32.4083C27.3904 31.9428 27.6519 31.3114 27.6519 30.653V10.7932C27.6521 10.6301 27.6201 10.4686 27.5578 10.318C27.4955 10.1673 27.4041 10.0304 27.2889 9.915ZM18.9633 24.4468H9.03338C8.70419 24.4468 8.38847 24.316 8.1557 24.0832C7.92292 23.8505 7.79215 23.5347 7.79215 23.2055C7.79215 22.8763 7.92292 22.5606 8.1557 22.3279C8.38847 22.0951 8.70419 21.9643 9.03338 21.9643H18.9633C19.2925 21.9643 19.6082 22.0951 19.841 22.3279C20.0737 22.5606 20.2045 22.8763 20.2045 23.2055C20.2045 23.5347 20.0737 23.8505 19.841 24.0832C19.6082 24.316 19.2925 24.4468 18.9633 24.4468ZM18.9633 19.4818H9.03338C8.70419 19.4818 8.38847 19.3511 8.1557 19.1183C7.92292 18.8855 7.79215 18.5698 7.79215 18.2406C7.79215 17.9114 7.92292 17.5957 8.1557 17.3629C8.38847 17.1301 8.70419 16.9994 9.03338 16.9994H18.9633C19.2925 16.9994 19.6082 17.1301 19.841 17.3629C20.0737 17.5957 20.2045 17.9114 20.2045 18.2406C20.2045 18.5698 20.0737 18.8855 19.841 19.1183C19.6082 19.3511 19.2925 19.4818 18.9633 19.4818ZM17.722 10.7932V3.96637L24.5488 10.7932H17.722Z",fill:"#828282"})}),Z=({documents:l,category:a,downloadingDocId:m,handleDownload:o})=>e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-sm font-medium text-gray-900 mb-3",children:a}),e.jsx("div",{className:"space-y-2",children:l.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(q,{className:"h-6 w-6"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.file_name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:ge(t.created_at).format("DD MMM YYYY")}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(t.file_size/(1024*1024)).toFixed(2)," MB"]})]})]})]}),e.jsx("button",{onClick:()=>o(t),disabled:m===t.id,className:"p-1 text-gray-500 hover:text-gray-700 hover:bg-gray-50 cursor-pointer border border-gray-300 hover:border-gray-400 transition-colors ml-2 disabled:opacity-50",title:m===t.id?"Downloading...":"Download file",children:m===t.id?e.jsx(U,{className:"h-4 w-4 text-gray-600 animate-spin"}):e.jsx(xe,{className:"h-4 w-4"})})]},t.id))})]}),je=({files:l,isDeleting:a,removeFile:m,loading:o})=>e.jsxs("div",{className:"mt-6",children:[e.jsxs("h2",{className:"text-sm font-medium text-gray-900 mb-3",children:["Selected Files (",l.length,")"]}),e.jsx("div",{className:"space-y-2",children:l.map(t=>e.jsxs("div",{className:`flex items-center justify-between p-3 bg-gray-50 rounded-md border border-gray-200 transition-opacity ${a(t.id)?"opacity-50":""}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(q,{className:"h-6 w-6"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.uploadDate," - ",(t.size/(1024*1024)).toFixed(2)," MB"]})]})]}),e.jsx("button",{onClick:()=>m(t.id),className:`p-1.5 rounded-md transition-colors ml-2 ${o||a(t.id)?"text-gray-400":"text-red-500 hover:text-red-700 hover:bg-red-50"}`,title:o?"Cannot remove during submission":a(t.id)?"Removing...":"Remove file",disabled:o||a(t.id),children:e.jsx(ye,{className:"h-4 w-4"})})]},t.id))})]}),J=({isDragOver:l,isAnyOperationInProgress:a,handleFileInput:m,handleDrop:o,handleDragOver:t,handleDragLeave:y})=>e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 mt-4 text-center transition-colors ${l&&!a?"border-blue-400 bg-blue-50":a?"border-gray-200 bg-gray-50 opacity-50":"border-gray-300 hover:border-gray-400"}`,onDrop:o,onDragOver:t,onDragLeave:y,children:[e.jsx(fe,{className:`mx-auto h-8 w-8 mb-3 ${a?"text-gray-300":"text-gray-400"}`}),e.jsx("p",{className:`text-sm mb-1 ${a?"text-gray-400":"text-gray-600"}`,children:a?"Please wait for current operation to complete":"Click to upload or drag and drop"}),!a&&e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"JPEG, PNG, JPG, WEBP and PDF (Max 50MB)"}),e.jsxs("label",{className:"inline-block",children:[e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png,.webp",onChange:m,className:"hidden",disabled:a}),e.jsx("span",{className:`bg-white border border-gray-300 rounded-md px-4 py-1.5 text-sm font-medium transition-colors ${a?"opacity-50 text-gray-400":"text-gray-700 hover:bg-gray-50 cursor-pointer"}`,children:a?"Please Wait...":"Choose File"})]})]}),Ct=({stage:l,subStage:a})=>{const{service_id:m}=ee({strict:!1});te();const[o,t]=v.useState(!1),[y,b]=v.useState(!1),{isAdvocate:x}=W(),{completeSubStage:p}=se(),{allDocsIsFetching:u,allDocsData:g,setServiceData:j,serviceData:c,getCaseStagesRefetch:F,caseStagesData:$}=O(),z=`${c?.advocate_cases?.[0]?.advocate?.first_name||""} ${c?.advocate_cases?.[0]?.advocate?.last_name||""}`.trim(),{isUser:D}=W(),{uploadedFiles:i,isDragOver:r,loading:h,deletingFiles:w,isAnyOperationInProgress:f,handleFileSelect:_,handleSubmit:S,removeFile:k,setIsDragOver:P}=we(m,l,a),{downloadingDocId:E,handleDownload:B}=be(),H=ne($?.sub_stages,a),C=g?.length>0,K=!C&&i.length===0&&!D(),Q=g?.length>1,I=c?.is_received_original_doc&&i.length===0&&!Q,{mutate:V,isPending:N}=M({mutationFn:async s=>{const d=await ie(m,{vetting_of_doc:s,stage:l,sub_stage:a});if(d?.status===200||d?.status===201)return d.data;throw new Error("Failed to update vetting status")},onSuccess:async(s,d)=>{n.success(s.message),j(L=>({...L,vetting_of_doc:d})),await F(),p(a)},onError:(s,d)=>{t(!d),n.error(s.message)}}),{mutate:X,isPending:R}=M({mutationFn:async s=>{const d=await oe(m,{is_received_original_doc:s,stage:l,sub_stage:a});if(d?.status===200||d?.status===201)return d.data;throw new Error("Failed to update received status")},onSuccess:(s,d)=>{n.success(s.message),j(L=>({...L,is_received_original_doc:d}))},onError:(s,d)=>{b(!d),n.error(s.message)}}),T=s=>{s.target.files&&_(s.target.files)},G=s=>{s.preventDefault(),P(!1),!f&&s.dataTransfer.files.length>0&&_(s.dataTransfer.files)},Y=s=>{s.preventDefault(),f||P(!0)},A=s=>{s.preventDefault(),P(!1)};return v.useEffect(()=>{t(c?.vetting_of_doc||!1),b(c?.is_received_original_doc||!1)},[c?.vetting_of_doc,c?.is_received_original_doc]),u?e.jsx("div",{className:"h-full relative bg-white",children:e.jsx(ae,{loading:u,message:"Loading documents..."})}):e.jsxs("div",{className:"h-full relative bg-white",children:[e.jsx(le,{caseStage:l,caseSubStage:a,showActionButton:!D()&&(g?.length===2||g?.length===1&&H&&!o),showUploadButton:!1,showNoteButton:!1}),e.jsxs("div",{className:"px-4 py-2",children:[K&&e.jsx(J,{isDragOver:r,isAnyOperationInProgress:f,handleFileInput:T,handleDrop:G,handleDragOver:Y,handleDragLeave:A}),!C&&D()&&e.jsxs("div",{className:"flex flex-col justify-center items-center h-[calc(100vh-300px)]",children:[e.jsx(re,{className:"cursor-pointer w-80 h-50"}),e.jsx("div",{className:"text-base 3xl:text-xl text-center font-light text-[#444] mx-auto",children:"No report submissions found for this case."})]}),C&&e.jsx(Z,{documents:g.filter(s=>s.category==="Legal Report Document"),category:"Legal Report Document",downloadingDocId:E,handleDownload:B}),C&&!(H&&!c?.vetting_of_doc)&&e.jsx("div",{className:"bg-blue-50 p-2 rounded mt-2",children:c?.vetting_of_doc?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-blue-600",checked:o,disabled:!0}),e.jsx("span",{className:`text-gray-700 ${N?"opacity-70":""}`,children:"Requesting for vetting documents"})]}):e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("span",{className:`text-gray-700 ${N?"opacity-70":""}`,children:"Requesting for vetting documents"}),N?e.jsx(U,{className:"w-5 h-5 text-blue-600 animate-spin"}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>V(!0),disabled:N,className:`px-3 py-1 rounded text-sm cursor-pointer ${o?"bg-blue-600 text-white":"bg-green-400 text-gray-700"}`,children:"Yes"}),e.jsx("button",{onClick:()=>V(!1),disabled:N,className:`px-3 py-1 rounded text-sm cursor-pointer ${o?"bg-gray-200 text-gray-700":"bg-red-600 text-white"}`,children:"No"})]})]})}),c?.vetting_of_doc&&e.jsx("div",{className:"bg-blue-50 p-2 rounded mt-2",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[R?e.jsx(U,{className:"w-5 h-5 text-black animate-spin"}):e.jsx("input",{type:"checkbox",className:" text-black bg-white border-gray-300 rounded focus:ring-black focus:ring-2 accent-black",checked:y,onChange:s=>X(s.target.checked),disabled:R||!x()||g?.length===2}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:`text-gray-700 ${R?"opacity-70":""}`,children:!x()&&c?.is_received_original_doc?`Received original documents by ${z}`:"Received original documents"}),!x()&&!c?.is_received_original_doc&&e.jsx("div",{className:"text-[11px] 2xl:text-xs  text-gray-500",children:"Only advocates can perform this action"})]})]})}),I&&x()&&e.jsx(J,{isDragOver:r,isAnyOperationInProgress:f,handleFileInput:T,handleDrop:G,handleDragOver:Y,handleDragLeave:A}),c?.is_received_original_doc&&!I&&e.jsx(Z,{documents:g.filter(s=>s.category==="Final Report Document"),category:"Final Report Document",downloadingDocId:E,handleDownload:B}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(je,{files:i,isDeleting:s=>w.has(s),removeFile:k,loading:h}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:S,disabled:f,className:`px-3 py-1 text-sm rounded-md font-normal transition-colors cursor-pointer ${f?"bg-gray-300 text-gray-500":"bg-black text-white hover:bg-gray-800"}`,title:h?"Submitting files...":w.size>0?"Please wait for file removal to complete":"Submit files",children:h?"Submitting...":w.size>0?"Please Wait...":"Submit"})})]})]})]})};export{Ct as default};
