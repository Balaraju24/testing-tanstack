import{j as e,r as j,t as x}from"./main-CbopZ6M6.js";import{U as N}from"./Provider-BC_HjP_o.js";import{L as b}from"./Loading-DliovM0z.js";import{h as v}from"./fileUpload-CyZu8moV.js";import{d as D}from"./apiHelpers-Cq0RJRye.js";import{u as k}from"./useMutation-AZp6LET6.js";import{M as _}from"./ManageCaseHeader-5m-OMl3k.js";import{T as h,S as F}from"./TableHeader-PAzqqOBh.js";import{d as C}from"./dayjs.min-BPVt0UoP.js";import{E as S}from"./eye-c83Bg9AE.js";import{L as U}from"./loader-circle-CHBElFpm.js";import{D as A}from"./download-C1tTGVQS.js";import"./litigations-CmIaLu41.js";import"./fetch-BYBqU-UB.js";import"./manage-UYlebOZ2.js";import"./useQuery-aXFamHAp.js";import"./useInfiniteQuery-DCpiOsiQ.js";import"./index-Bz18Tu21.js";import"./index-DFgmobCw.js";import"./index-9N-Gpv7K.js";import"./CaseFilingIcon-Ki22rwHg.js";import"./legal-notice-icon-DY79a5uN.js";import"./notes-edit-icon-Dx1vAmyL.js";import"./index-CXHJR4o1.js";import"./index-BfzcKS58.js";import"./index-BYuWQ9Ar.js";import"./tooltip-BNtdrHqg.js";import"./index-NA-xklZo.js";import"./index-C-zDLRzy.js";import"./index-CB5qnijn.js";import"./manage-Dtja-RKh.js";import"./utc-YeGeLL22.js";import"./useUserPermissions-DqHuV15h.js";import"./userDetails-BKeSBteA.js";import"./pending-icon-xk-CqbVY.js";import"./approved-Icon-sUM8RCgD.js";import"./current-icon-dhgqbcsv.js";import"./chevron-down-DFI8aQgh.js";import"./createLucideIcon-2fvSvvVa.js";import"./complete-logo-BdyjTQM1.js";import"./notes-close-icon-CZlPG_WL.js";import"./index-Bn1KO0DZ.js";import"./index-BrJXLgSY.js";import"./textarea-DVdyI6Fw.js";import"./notification-B2GbDUfo.js";import"./service-Clbc7XwB.js";import"./index-BFdYt5ff.js";import"./x-ClszbkRs.js";import"./default-user-B5Qt0uKr.js";import"./notes-delete-icon-COtxmY5M.js";import"./notes-head-icon-zA5gOWGa.js";import"./summary-icon-card-x7nT6ld4.js";import"./avatar-I9rQhuEx.js";import"./input-BFw7NH1J.js";import"./sheet-KGfwaNTI.js";import"./skeleton-CGIrBuj0.js";const E=({doc:a,index:n,downloadingDocId:s,isPendingDownloadFile:m,onView:i,onDownload:l})=>e.jsxs("tr",{className:`hover:bg-gray-200 ${n%2===0?"bg-gray-100":"bg-white"}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:C(a.created_at).format("DD MMM YYYY")}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsx("div",{className:"truncate w-32",title:a?.file_name||"--",children:a?.file_name||"--"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsx("div",{className:"truncate w-32 cursor-pointer",title:a.document_type,children:a.document_type})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(a.download_url),className:"p-1 hover:bg-gray-300 rounded transition-colors cursor-pointer",title:"View Document",children:e.jsx(S,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>l(a),disabled:m,className:"p-1 hover:bg-gray-300 rounded transition-colors disabled:opacity-50 cursor-pointer",title:"Download Document",children:s===a.id?e.jsx(U,{className:"w-4 h-4 text-gray-600 animate-spin"}):e.jsx(A,{className:"w-4 h-4 text-gray-600"})})]})})]},a.id);function Me({stage:a,subStage:n,isLoading:s=!1}){const[m,i]=j.useState(null),{allDocsIsFetching:l,allDocsData:o}=N(),{mutate:u,isPending:f}=k({mutationFn:async t=>{const r={file_key:t.key},d=await v(r),p=d?.data?.status,c=d?.data?.data?.download_url;if((p===200||p===201)&&c)D(c,t.file_name),i(null);else throw new Error("Invalid response or download URL")},onError:()=>{x.error("Failed to download attachment.")}}),g=t=>{t?window.open(t,"_blank","noopener,noreferrer"):console.error("No download URL available")},w=t=>{t.key?(i(t.id),u({key:t.key,file_name:t.file_name})):x.error("Document key not available for download")},y=()=>s?e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full",children:[e.jsx(h,{}),e.jsx("tbody",{children:Array.from({length:5}).map((t,r)=>e.jsx(F,{index:r},`skeleton-${r}`))})]})}):o?.length===0?e.jsx("div",{className:"px-4 py-5 sm:px-6",children:e.jsx("h3",{className:"text-lg font-normal leading-6 text-gray-900",children:"No Documents Uploaded"})}):e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full",children:[e.jsx(h,{}),e.jsx("tbody",{children:Array.isArray(o)&&o.map((t,r)=>e.jsx(E,{doc:t,index:r,downloadingDocId:m,isPendingDownloadFile:f,onView:g,onDownload:w},t.id))})]})});return e.jsx("div",{className:"h-full relative",children:l?e.jsx(b,{loading:l,message:"Loading documents..."}):e.jsxs(e.Fragment,{children:[e.jsx(_,{caseStage:a,caseSubStage:n,showActionButton:!1,showUploadButton:!1}),e.jsx("div",{className:"p-2 w-full h-max-[calc(100%-60px)] overflow-auto",children:e.jsx("div",{className:"bg-white overflow-hidden",children:y()})}),s?e.jsxs("div",{className:"col-span-12 space-y-2 mt-4 flex flex-col p-4 pt-2",children:[e.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded animate-pulse mb-2"}),e.jsx("div",{className:"bg-gray-50 p-2",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})})]}):o?.length>0&&o[0]?.remarks&&e.jsxs("div",{className:"col-span-12 space-y-2 mt-4 flex flex-col p-4 pt-2",children:[e.jsx("div",{className:"w-full text-sm font-normal text-gray-700 mb-1",children:"Remarks"}),e.jsx("div",{className:"bg-gray-50 p-2 text-gray-700 text-xs 2xl:text-sm",children:o[0].remarks})]})]})})}export{Me as default};
