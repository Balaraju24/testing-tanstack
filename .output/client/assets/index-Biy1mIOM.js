import{h as z,r as c,t as n,j as t,B as x}from"./main-Cfdx-166.js";import{U as K}from"./Provider-ByMBYsBJ.js";import{D as H}from"./delete-stroke-icon-Bw6hM1IS.js";import{S as T}from"./send-icon-TKbN3C7W.js";import{I as G}from"./input-DYbhqlvz.js";import{b as J}from"./fileUpload-C5Dy2rVy.js";import{e as O,U as V}from"./legalOpinion-Br1-lBUF.js";import{i as W,M as X}from"./ManageCaseHeader-C-iqY6N9.js";import{u as Z}from"./useUserPermissions-EkOdBJwI.js";import{u as C}from"./useMutation-B1DU5d2J.js";import{d as ee}from"./dayjs.min-CmsQqqGy.js";import{L as te}from"./Loading-CBYA94ZU.js";import{c as se}from"./createLucideIcon-BmLFQ-XG.js";import{L as re}from"./loader-circle-CtVpcMqj.js";import"./litigations-CHZYp0Qz.js";import"./fetch-B9iWZIk4.js";import"./manage-N6m0a4Rv.js";import"./useQuery-JrEwn0HC.js";import"./useInfiniteQuery-CsBoIoE-.js";import"./index-FfAIZCaX.js";import"./index-CHQA3myx.js";import"./index-lXLfk88N.js";import"./CaseFilingIcon-B3T83UWb.js";import"./legal-notice-icon-CQRroJUz.js";import"./notes-edit-icon-DR2vjJ_2.js";import"./index-C_gXUdb4.js";import"./index-hzHaN75t.js";import"./index-DF_xtgj4.js";import"./tooltip-Dk48ikt-.js";import"./index-DE95MUWf.js";import"./index-BoybbV93.js";import"./index-BBlAPqfG.js";import"./manage-B5DlZb4f.js";import"./utc-BVtgXMZy.js";import"./pending-icon-DAWTPq6S.js";import"./approved-Icon-DeOvi-fV.js";import"./current-icon-8I7qxN0n.js";import"./chevron-down-CCzDJ7wY.js";import"./complete-logo-C9qAcUgu.js";import"./notes-close-icon-DwQRAOm_.js";import"./index-DETgyAaU.js";import"./index-Vwln1SHO.js";import"./textarea-HR3ErcZs.js";import"./notification-Dr26wPLe.js";import"./service-7i-FAUkJ.js";import"./index-BjReNNxi.js";import"./x-OEbIHzu5.js";import"./default-user-H6DJgCjJ.js";import"./notes-delete-icon-BGPvWUIE.js";import"./notes-head-icon-B7j4bc-E.js";import"./summary-icon-card-D2HQg2x6.js";import"./avatar-BO1wJRFV.js";import"./sheet-CMzcKqsy.js";import"./skeleton-CvqsTR7_.js";import"./userDetails-BK07mqDr.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],oe=se("pen-line",ae),ct=({stage:p,subStage:l})=>{const{service_id:v}=z({strict:!1}),[d,m]=c.useState(""),[_,y]=c.useState(""),[u,f]=c.useState(!1),[h,r]=c.useState(""),[N,b]=c.useState(null),[S,E]=c.useState(null),{isUser:k}=Z(),{getAllDocsRefetch:j,allDocsData:i,caseStagesData:w,allDocsIsFetching:D}=K(),M=W(w?.sub_stages,l),g=w?.sub_stages?.find(e=>e.code==="QURI#MDSC")?.status==="completed",{mutate:A,isPending:U}=C({mutationKey:["Adding_lod"],mutationFn:async e=>{const s={case_id:Number(v),category:e.category,is_requested:!0,case_stage:p,case_sub_stage:l};return(await O(s))?.data},onSuccess:e=>{m(""),r(""),j(),n.success(e?.message,{action:{label:"✕",onClick:()=>n.dismiss()}})},onError:e=>{if(e.status===422){const s=e?.data?.errData?.category;r(s)}else{const s=e?.data?.message;r(s)}}}),{mutate:P,isPending:q}=C({mutationFn:async e=>(await V(I,{category:e.category,id:I[0],case_id:Number(v),case_stage:p,case_sub_stage:l}))?.data,onSuccess:e=>{n.success(e?.message||"Category updated successfully",{action:{label:"✕",onClick:()=>n.dismiss()}}),f(!1),y(""),m(""),r(""),b(null),j()},onError:e=>{if(e.status===422){const s=e?.data?.errData?.category;r(s)}else{const s=e?.data?.message;r(s)}}}),{mutate:F,isPending:L}=C({mutationKey:["deleteFile"],mutationFn:async e=>{if(e=i?.find(o=>o.id===e)?.id,!e)throw new Error("Document ID not found");const s=await J({docId:e,payload:{case_stage:p,case_sub_stage:l}});if(s?.status===200||s?.status===201)return s.data.data;throw new Error("Failed to delete file")},onSuccess:e=>{n.success("File deleted successfully",{action:{label:"✕",onClick:()=>n.dismiss()}}),j()},onError:e=>{}}),I=Array.isArray(i)&&i?.filter(e=>_===e.category&&e.is_requested).map(e=>e.id),$=()=>{r(""),u&&N?P({category:d.trim()}):A({category:d.trim()})},B=e=>{f(!0),m(e.category),y(e.category),b(e.id),r("")},Q=(e,s)=>!s.some(o=>o.category===e&&!o.is_requested&&(o.key||o.file_name)),R=e=>{E(e.id),F(e.id)},Y=()=>{f(!1),m(""),y(""),r(""),b(null)},a=U||q||L;return t.jsx("div",{className:"h-full",children:D?t.jsx("div",{className:"relative h-[calc(100%-43px)] flex items-center justify-center",children:t.jsx(te,{loading:D,message:"Docs loading..."})}):t.jsxs("div",{className:"h-full justify-center items-center overflow-hidden",children:[t.jsx(X,{caseStage:p,caseSubStage:l,showActionButton:k()?!1:!u,showNoteButton:!1,showUploadButton:!1}),g&&i?.length===0&&t.jsx("div",{className:"h-[calc(100%-100px)] flex justify-center items-center",children:t.jsx("div",{className:"text-center text-base text-gray-500 flex items-center justify-center",children:"This stage is already completed. No queries were raised."})}),t.jsxs("form",{onSubmit:e=>{e.preventDefault(),$()},children:[!g&&t.jsxs("div",{className:"flex items-center space-x-4 p-2 rounded-none",children:[t.jsx(G,{className:"flex-1 border h-9 rounded-none border-gray-200 bg-gray-100 text-sm 3xl:text-base font-normal focus:!outline-none outline-none",placeholder:u?"Edit query":"Enter query",value:d?d.charAt(0).toUpperCase()+d.slice(1):"",onChange:e=>{m(e.target.value),h&&r("")},disabled:a}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs(x,{type:"submit",size:"sm",className:`bg-black hover:bg-black h-9 cursor-pointer text-white text-xs 3xl:text-sm rounded-none font-normal ${a?"opacity-50 cursor-not-allowed":""}`,disabled:a,children:[t.jsx(T,{className:"w-4 h-4"}),u?"Update":"Request"]}),u&&t.jsx(x,{type:"button",size:"sm",className:`cursor-pointer text-white text-xs 3xl:text-sm rounded-none ${a?"bg-gray-500 hover:bg-gray-500 opacity-50 cursor-not-allowed":"bg-black hover:bg-black"}`,onClick:Y,disabled:a,children:"Cancel"})]})]}),h&&t.jsx("div",{className:"px-2 pb-2",children:t.jsx("p",{className:"text-red-500 text-xs",children:h})})]}),t.jsx("div",{className:`p-2 space-y-2 ${M?" overflow-y-auto h-[calc(100vh-250px)]":"overflow-y-auto h-[calc(100vh-100px)] "}`,children:Array.isArray(i)&&i?.map(e=>{const s=N===e.id;return t.jsxs("div",{className:"flex flex-cols w-full border p-2 gap-4 border-gray-200",children:[t.jsx("div",{className:"text-sm flex-1 self-center",children:e?.category}),t.jsx("div",{className:"text-xs bg-gray-200 font-normal p-1 flex  self-center",children:ee(e?.created_at).format("DD MMM YYYY")}),!g&&t.jsx(x,{onClick:()=>!a&&B(e),className:`!p-0 !m-0  ${a?"cursor-not-allowed opacity-50":"cursor-pointer hover:text-blue-600"} transition-colors`,title:"Edit this query",disabled:s,children:t.jsx(oe,{className:"w-4 h-4"})}),!g&&t.jsx(x,{onClick:()=>{a||(Q(e.category,i)?R(e):n.error("Files exist in this category, cannot delete."))},title:"Delete this query",disabled:s,className:` !p-0 !m-0 ${a?"cursor-not-allowed opacity-50":"cursor-pointer hover:text-red-600"} transition-colors`,children:S===e.id?t.jsx(re,{className:"animate-spin w-4 h-4"}):t.jsx(H,{})})]},e?.id)})})]})})};export{ct as default};
