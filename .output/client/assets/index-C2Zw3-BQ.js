import{u as S,j as e,R as f,r as p,k as O}from"./main-CbopZ6M6.js";import{g as $}from"./dashboard-DoA9sCnn.js";import{g as _,u as M,M as C,I as h,a as W,b as E,C as w,c as P}from"./dashboard_queries-CH6tSHQA.js";import{u as T}from"./useQuery-aXFamHAp.js";import{d as b}from"./dayjs.min-BPVt0UoP.js";import{u as V,g as Y,f as F}from"./select-BAZmUwVY.js";import{L as I}from"./Loading-DliovM0z.js";import{N as q}from"./NoDataBlock-B_IMWKz8.js";import{u as A}from"./index-Bz18Tu21.js";import"./fetch-BYBqU-UB.js";import"./createLucideIcon-2fvSvvVa.js";import"./litigation-icon-DVtOXpxK.js";import"./check-CKzaR09m.js";import"./popover-CoI_Kke6.js";import"./index-CXHJR4o1.js";import"./index-DFgmobCw.js";import"./index-NA-xklZo.js";import"./index-BfzcKS58.js";import"./index-BrJXLgSY.js";import"./index-C-zDLRzy.js";import"./index-BYuWQ9Ar.js";import"./command-P1h1coax.js";import"./index-Bn1KO0DZ.js";import"./search-ElaKESin.js";import"./x-ClszbkRs.js";import"./loader-circle-CHBElFpm.js";import"./calendar-B2nKypLE.js";import"./chevron-right-63yA6sUh.js";import"./chevron-down-DFI8aQgh.js";import"./separator-CIw6DZcG.js";import"./calendar-CPLYzr7c.js";import"./index-DGqRz6qL.js";import"./index-CB5qnijn.js";import"./no-cases-data-D0ClwAfz.js";import"./useUserPermissions-DqHuV15h.js";import"./userDetails-BKeSBteA.js";import"./noDataConstants-nJx6rPaL.js";const K=({dateRange:c,searchOrganization:m})=>{const i=S(),{data:g,isLoading:x}=T({queryKey:["serviceStats",c,m],queryFn:async()=>{let s={};return c&&(s={from_date:b(c?.from).format("YYYY-MM-DD"),to_date:b(c?.to).format("YYYY-MM-DD")}),m&&(s={...s,user_id:m}),(await $(s))?.data?.data},refetchOnWindowFocus:!1,refetchOnMount:!1}),l=[{title:"Legal Opinion",path:"legal-opinion?page=1&page_size=15&service_type=Legal+opinion&view=grid"},{title:"Engineer Property Valuation",path:"engineer-property-valuation?"},{title:"Litigation",path:"litigations?page=1&page_size=15&view=grid"}].map(s=>{const t=g?.find(a=>a.service_type.toLowerCase()===s.title.toLowerCase());if(t){const a={};return t.statuses.forEach(r=>{r.status==="TO_START"&&(a.to_start=r.count),r.status==="IN_PROGRESS"&&(a.progress=r.count),r.status==="COMPLETED"&&(a.completed=r.count)}),{title:s.title,path:s.path,cases:t.statuses.reduce((r,n)=>r+n.count,0),...a}}else return{title:s.title,path:s.path,cases:0,to_start:0,progress:0,completed:0}}),u=[{key:"cases",label:"Cases"},{key:"to_start",label:"To Start"},{key:"progress",label:"In Progress"},{key:"completed",label:"Completed"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 mt-1 p-1 ",children:l.map((s,t)=>e.jsxs("div",{className:"p-1 px-2 rounded bg-white border border-gray-300",children:[e.jsx("h2",{className:"text-sm font-medium text-gray-800",children:s.title}),e.jsx("div",{className:"grid grid-cols-2 gap-2 my-1",children:u.map(a=>e.jsxs("div",{className:`px-2 py-1 border border-gray-300 flex justify-between items-center \r
                     cursor-pointer hover:bg-gray-50`,onClick:()=>{a.key==="cases"?i({to:`/${s.path}`}):i({to:`/${s.path}&status=${a.key.toUpperCase()}`})},children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-smd font-light text-gray-700",children:a.label}),e.jsx("p",{className:"font-medium",children:s[a.key]||0})]}),e.jsx("div",{children:_(a.key)})]},a.key))})]},t))})},B=({dateRange:c,organization:m,location:i})=>{const{data:g,isLoading:x}=M({dateRange:c,organization:m,location:i}),{organizations:d,months:l}=g||{organizations:[],months:[]},u=f.useMemo(()=>[{accessorKey:"name",header:()=>"Organization Name",cell:t=>e.jsxs("div",{className:"w-40",children:[e.jsx("div",{children:t.row.original.name}),e.jsx(e.Fragment,{children:t.row.original.location.length>0&&e.jsxs("div",{className:"text-xs text-amber-800 flex gap-1 items-center mt-1 text-[10px]",children:[e.jsx(C,{className:"w-3 h-3"})," ",t.row.original.location]})})]}),size:140},...l.flatMap(t=>[{id:`${t}-lop-cases`,header:()=>"Cases",meta:{parent:`${t}-lop`},cell:a=>a.row.original.data.find(r=>r.month===t).lop.cases},{id:`${t}-lop-revenue`,header:()=>"Revenue",meta:{parent:`${t}-lop`},cell:a=>{const r=a.row.original.data.find(n=>n.month===t).lop.revenue;return h.format(r)}},{id:`${t}-eop-cases`,header:()=>"Cases",meta:{parent:`${t}-eop`},cell:a=>a.row.original.data.find(r=>r.month===t).eop.cases},{id:`${t}-eop-revenue`,header:()=>"Revenue",meta:{parent:`${t}-eop`},cell:a=>{const r=a.row.original.data.find(n=>n.month===t).eop.revenue;return h.format(r)}},{id:`${t}-litigation-cases`,header:()=>"Cases",meta:{parent:`${t}-litigation`},cell:a=>a.row.original.data.find(r=>r.month===t).litigation.cases},{id:`${t}-litigation-revenue`,header:()=>"Revenue",meta:{parent:`${t}-litigation`},cell:a=>{const r=a.row.original.data.find(n=>n.month===t).litigation.revenue;return h.format(r)}}]),{id:"total-lop-cases",header:()=>"Cases",meta:{parent:"total-lop"},cell:t=>t.row.original.total.lop.cases},{id:"total-lop-revenue",header:()=>"Revenue",meta:{parent:"total-lop"},cell:t=>{const a=t.row.original.total.lop.revenue;return h.format(a)}},{id:"total-eop-cases",header:()=>"Cases",meta:{parent:"total-eop"},cell:t=>t.row.original.total.eop.cases},{id:"total-eop-revenue",header:()=>"Revenue",meta:{parent:"total-eop"},cell:t=>{const a=t.row.original.total.eop.revenue;return h.format(a)}},{id:"total-litigation-cases",header:()=>"Cases",meta:{parent:"total-litigation"},cell:t=>t.row.original.total.litigation.cases},{id:"total-litigation-revenue",header:()=>"Revenue",meta:{parent:"total-litigation"},cell:t=>{const a=t.row.original.total.litigation.revenue;return h.format(a)}}],[l]),s=V({data:d,columns:u,getCoreRowModel:Y()});return e.jsx("div",{className:"border h-[calc(100vh-280px)] relative overflow-auto border-gray-300",children:x?e.jsx(I,{loading:x,message:"Loading..."}):d.length>0?e.jsxs("table",{className:"border-separate border-spacing-0 table-auto text-sm min-w-full",children:[e.jsxs("thead",{className:"bg-gray-100 sticky top-0 z-30",children:[e.jsxs("tr",{children:[e.jsx("th",{rowSpan:3,className:"font-normal text-sm p-2 border border-gray-300 sticky left-0 bg-gray-100 z-20",children:"Organization Name"}),l.map(t=>e.jsx("th",{colSpan:6,className:"font-normal border border-gray-300 capitalize text-xs p-2",children:t},t)),e.jsx("th",{colSpan:6,className:"font-normal text-xs p-2 sticky border border-gray-300 right-0 bg-gray-100 z-20",children:"Total"})]}),e.jsxs("tr",{children:[l.map(t=>e.jsxs(f.Fragment,{children:[e.jsx("th",{colSpan:2,className:"font-normal border border-gray-300  text-xs p-2",children:"Legal Opinion"}),e.jsx("th",{colSpan:2,className:"font-normal border border-gray-300 text-xs p-2",children:"EP Valuation"}),e.jsx("th",{colSpan:2,className:"font-normal border border-gray-300 text-xs p-2",children:"Litigation"})]},t)),e.jsx("th",{colSpan:2,className:"font-normal text-xs p-2 border border-gray-300 sticky right-[calc((80px+100px)*2)]  bg-gray-100 z-20",children:"Legal Opinion"}),e.jsx("th",{colSpan:2,className:"font-normal text-xs p-2 sticky border border-gray-300 right-[180px] bg-gray-100 z-20",children:"EP Valuation"}),e.jsx("th",{colSpan:2,className:"font-normal text-xs p-2 sticky right-0 border border-gray-300 bg-gray-100 z-20",children:"Litigation"})]}),e.jsxs("tr",{children:[l.map(t=>e.jsxs(f.Fragment,{children:[e.jsx("th",{className:"font-normal border border-gray-300 text-xs p-2",style:{width:"80px",minWidth:"80px"},children:"Cases"}),e.jsx("th",{className:"font-normal text-xs p-2 border border-gray-300",style:{width:"100px",minWidth:"100px"},children:"Revenue"}),e.jsx("th",{className:"font-normal text-xs p-2 border border-gray-300",style:{width:"80px",minWidth:"80px"},children:"Cases"}),e.jsx("th",{className:"font-normal text-xs p-2 border border-gray-300",style:{width:"100px",minWidth:"100px"},children:"Revenue"}),e.jsx("th",{className:"font-normal text-xs p-2 border border-gray-300",style:{width:"80px",minWidth:"80px"},children:"Cases"}),e.jsx("th",{className:"font-normal text-xs p-2 border border-gray-300",style:{width:"100px",minWidth:"100px"},children:"Revenue"})]},t)),e.jsx("th",{className:"font-normal text-xs p-2 border border-gray-300 sticky right-[calc(80px+80px+100px+100px+100px)] bg-gray-100 z-20",style:{width:"80px",minWidth:"80px"},children:"Cases"}),e.jsx("th",{className:"font-normal text-xs p-2 border border-gray-300 sticky right-[calc((80px+100px)*2)] bg-gray-100 z-20",style:{width:"100px",minWidth:"100px"},children:"Revenue"}),e.jsx("th",{className:"font-normal text-xs p-2 sticky border border-gray-300 right-[calc(80px+100px+100px)] bg-gray-100 z-20",style:{width:"80px",minWidth:"80px"},children:"Cases"}),e.jsx("th",{className:"font-normal text-xs p-2 border border-gray-300 sticky right-[calc(80px+100px)] bg-gray-100 z-20",style:{width:"100px",minWidth:"100px"},children:"Revenue"}),e.jsx("th",{className:"font-normal text-xs p-2 sticky right-[100px] border border-gray-300 bg-gray-100 z-20",style:{width:"80px",minWidth:"80px"},children:"Cases"}),e.jsx("th",{className:"font-normal text-xs p-2 sticky right-0 border border-gray-300 bg-gray-100 z-20",style:{width:"100px",minWidth:"100px"},children:"Revenue"})]})]}),e.jsx("tbody",{children:s.getRowModel().rows.map(t=>e.jsx("tr",{children:t.getVisibleCells().map((a,r)=>e.jsx("td",{className:`border-r border-gray-300 p-2 text-xs text-center ${r===0?"sticky left-0 bg-white z-10 text-left":r>=t.getVisibleCells().length-6?"sticky bg-white z-10":r===t.getVisibleCells().length-5?"border-l border-gray-300":""}`,style:r>=t.getVisibleCells().length-6?{right:`${[80,100,80,100,80,100].slice(r-(t.getVisibleCells().length-6)+1).reduce((n,y)=>n+y,0)}px`}:{},children:F(a.column.columnDef.cell,a.getContext())},a.id))},t.id))})]}):e.jsx("div",{className:"mt-3 h-[calc(100vh-400px)] flex flex-col items-center justify-center",children:e.jsx(q,{title:"Data"})})})},G=()=>{const[c,m]=p.useState(""),i=O({strict:!1}),g=S(),x=A(),[d,l]=p.useState(),[u,s]=p.useState(null),[t,a]=p.useState(),[r,n]=p.useState(null),[y,z]=p.useState(null),{data:k,isLoading:L}=W({search_string:u}),v=k?.records?.map(o=>({id:o.id,label:o.name})),{data:R,isLoading:D}=E(t),j=R?.records?.map(o=>({id:o.id,label:o.organisation_name}));return p.useEffect(()=>{const o=i.from?b(i.from).toDate():void 0,N=i.to?b(i.to).toDate():void 0;(o||N)&&l({from:o,to:N}),(i.from||i.to)&&g({to:x?.pathname,search:void 0,replace:!0})},[i.from,i.to,g]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-end  items-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx(w,{items:j,placeholder:"Select Organization",value:j?.find(o=>o.id===r),onChange:o=>n(o?.id),className:"h-8 text-smd font-light border-gray-300",contentClassName:"bg-white rounded",isLoading:D,onSearchChange:a,enableApiSearch:!0})}),e.jsx("div",{children:e.jsx(w,{items:v,placeholder:"Select Location",value:v?.find(o=>o.id===y),onChange:o=>z(o?.id),defaultIcon:C,className:"h-8 text-smd font-light border-gray-300",contentClassName:"bg-white rounded",isLoading:L,onSearchChange:o=>s(o),enableApiSearch:!0})}),e.jsx("div",{children:e.jsx(P,{date:d,setDate:l,mode:"month-year",align:"end"})})]}),e.jsx(K,{dateRange:d,searchOrganization:r}),e.jsx("div",{className:"p-1 mt-1",children:e.jsx(B,{dateRange:d,location:y,organization:r})})]})},Oe=G;export{Oe as component};
