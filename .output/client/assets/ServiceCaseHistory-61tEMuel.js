import{j as e,r as p,h as U,a as L,B as w}from"./main-Cfdx-166.js";import{U as V}from"./Provider-ByMBYsBJ.js";import{L as z}from"./Loading-CBYA94ZU.js";import{D as A}from"./default-user-H6DJgCjJ.js";import{A as D,a as I}from"./avatar-BO1wJRFV.js";import{T as _,a as c,b as F,c as H,d,e as O}from"./table-ebtTQYDA.js";import{c as Y}from"./manage-N6m0a4Rv.js";import{k as $}from"./service-7i-FAUkJ.js";import{u as q}from"./userDetails-BK07mqDr.js";import{u as B}from"./useMutation-B1DU5d2J.js";import{u as W}from"./useInfiniteQuery-CsBoIoE-.js";import{d as G}from"./dayjs.min-CmsQqqGy.js";import{T as K}from"./TabValuesForViewCase-JKzxB9xn.js";const Q=({className:t,...i})=>e.jsxs("svg",{width:"900",height:"600",viewBox:"0 0 900 600",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,...i,children:[e.jsx("path",{fill:"transparent",d:"M0 0h900v600H0z"}),e.jsx("path",{d:"M812.538 276.782c-25.082 12.442-58.372-3.557-58.372-3.557s7.398-36.163 32.494-48.588c25.082-12.442 58.359 3.539 58.359 3.539s-7.399 36.163-32.481 48.606z",fill:"url(#a)"}),e.jsx("path",{d:"M100.08 367.715c32.772 19.642 79.791 1.484 79.791 1.484s-6.148-49.996-38.941-69.616c-32.772-19.642-79.77-1.507-79.77-1.507s6.147 49.997 38.92 69.639z",fill:"url(#b)"}),e.jsx("circle",{cx:"763.186",cy:"193.409",r:"13.695",transform:"rotate(180 763.186 193.409)",fill:"#858591"}),e.jsx("circle",{cx:"703.641",cy:"317.631",r:"15.407",transform:"rotate(180 703.641 317.631)",fill:"#858591"}),e.jsx("circle",{r:"12.839",transform:"matrix(-1 0 0 1 144.141 180.425)",fill:"#858591"}),e.jsx("circle",{r:"5.992",transform:"matrix(-1 0 0 1 645.732 247.189)",fill:"#858591"}),e.jsx("circle",{r:"7.704",transform:"matrix(-1 0 0 1 680.311 514.546)",fill:"#E1E4E5"}),e.jsx("circle",{r:"11.127",transform:"matrix(-1 0 0 1 141.844 434.555)",fill:"#E1E4E5"}),e.jsx("circle",{r:"8.469",transform:"matrix(-1 0 0 1 270.527 150.238)",fill:"#E1E4E5"}),e.jsx("circle",{r:"9.416",transform:"matrix(-1 0 0 1 681.697 151.809)",fill:"#E1E4E5"}),e.jsx("circle",{r:"8.455",transform:"scale(1 -1) rotate(-75 -84.875 -238.371)",fill:"#E1E4E5"}),e.jsx("circle",{r:"11.248",transform:"matrix(-1 0 0 1 382.042 79.19)",fill:"#E1E4E5"}),e.jsx("ellipse",{rx:"8.652",ry:"6.922",transform:"matrix(-1 0 0 1 740.745 366.706)",fill:"#E1E4E5"}),e.jsx("circle",{r:"17.597",transform:"scale(1 -1) rotate(-75 270.683 -461.601)",fill:"#E1E4E5"}),e.jsx("path",{d:"M806.36 318.9h.226c1.34 18.991 15.464 19.283 15.464 19.283s-15.574.304-15.574 22.248c0-21.944-15.575-22.248-15.575-22.248s14.118-.292 15.459-19.283zM237.473 503.525h.201c1.189 17.189 13.722 17.453 13.722 17.453s-13.82.275-13.82 20.136c0-19.861-13.819-20.136-13.819-20.136s12.527-.264 13.716-17.453z",fill:"#E1E4E5"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M634.992 471.883V196.296c0-13.073-4.334-25.629-12.015-34.855l-58.101-69.785c-7.702-9.25-18.156-14.455-29.041-14.455H306.388c-22.694 0-41.076 22.078-41.076 49.335v345.347c0 27.257 18.382 49.335 41.076 49.335h287.528c22.694 0 41.076-22.078 41.076-49.335z",fill:"#858591",stroke:"#858591",strokeWidth:"36.875",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M530.983 231.438c44.92 44.919 44.92 117.747 0 162.666-44.919 44.919-117.747 44.919-162.666 0s-44.919-117.747 0-162.666 117.747-44.919 162.666 0",stroke:"#fff",strokeWidth:"36.875",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M530.365 393.639 450 312.69V204.781",stroke:"#fff",strokeWidth:"36.875",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"a",x1:"716.22",y1:"315.592",x2:"923.098",y2:"151.951",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{stopColor:"#fff"}),e.jsx("stop",{offset:"1",stopColor:"#EEE"})]}),e.jsxs("linearGradient",{id:"b",x1:"226.901",y1:"430.941",x2:"-36.799",y2:"185.929",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{stopColor:"#fff"}),e.jsx("stop",{offset:"1",stopColor:"#EEE"})]})]})]}),xe=()=>{const t=p.useRef(null),{service_id:i}=U({strict:!1}),[n,h]=p.useState(null),j=L(q,s=>s.user)?.id,x=!!n,{caseStagesData:g}=V(),E=async({pageParam:s=1})=>{try{if(!i)return;const r=await Y(i,{page:s,page_size:10,types:"SUMMARY"});return{data:r?.data?.data?.records,nextCursor:r?.data?.data?.pagination_info?.next_page?r?.data?.data?.pagination_info?.current_page+1:null,prevCursor:r?.data?.data?.pagination_info?.current_page!==1?r?.data?.data?.pagination_info?.current_page-1:null,totalRecords:r?.data?.data?.pagination_info?.total_records}}catch{throw new Error("Failed to fetch case history")}},{data:k,fetchNextPage:y,hasNextPage:b,isLoading:N,isFetchingNextPage:m,refetch:C}=W({initialPageParam:1,queryKey:["case-history","summary",i],queryFn:E,getNextPageParam:s=>s?.nextCursor??null,getPreviousPageParam:s=>s?.prevCursor??null,refetchOnWindowFocus:!1}),o=k?.pages.map(s=>s.data).flat()||[],f=o.find(s=>s.id===n),S=p.useCallback(s=>{m||(t.current&&t.current.disconnect(),t.current=new IntersectionObserver(a=>{a[0].isIntersecting&&b&&y()}),s&&t.current.observe(s))},[m,b,y]),{mutate:P}=B({mutationFn:async s=>{const a={summary_ids:[Number(s)]};return(await $(a))?.data},onSuccess:()=>{C()}}),T=s=>{h(s===n?null:s),o?.some(r=>r.id===s&&r?.notes_read_status?.some(u=>!u.is_seen&&u.user_id===j))&&P(s)},M=o.map((s,a)=>{const r=s.notes_read_status?.some(l=>!l.is_seen&&l.user_id===j),u=`${s?.created_by?.first_name} ${s?.created_by?.last_name}`,v=s?.title||"No Title";return e.jsxs(_,{className:`border-t border-gray-200 hover:bg-gray-50 transition-colors ${n===s.id?"bg-blue-50":"bg-white"}`,ref:a===o.length-1?S:null,children:[e.jsxs(c,{className:"px-4 py-1 border-r border-gray-200 relative",children:[r&&e.jsx("div",{className:"absolute top-1 right-2 w-2 h-2 bg-red-500 rounded-full"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-8 h-8 flex items-center justify-center",children:s?.created_by?.profile_pic?e.jsx(I,{src:s.created_by?.profile_pic}):e.jsx(A,{className:"w-4 2xl:w-5 2xl:h-5 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"2xl:text-sm text-xs capitalize font-normal text-gray-900 truncate max-w-[80px]",children:u}),e.jsx("div",{className:"text-[10px] 2xl:text-xs text-gray-500",children:G(s.created_at).format("DD MMM YYYY")})]})]})]}),e.jsx(c,{className:"px-4 py-1 border-r border-gray-200 font-normal break-words",children:e.jsx("div",{className:`line-clamp-2 text-gray-900 truncate ${x?"w-12":"w-32"}`,title:v,children:v})}),e.jsxs(c,{className:"px-4 py-1 border-r border-gray-200 font-normal",children:[e.jsx("div",{className:"text-xs text-gray-900",children:g?.stages?.find(l=>l.code===s?.case_stage)?.title||s?.case_stage||"--"}),e.jsx("div",{className:"text-xs text-gray-500",children:g?.sub_stages?.find(l=>l.code===s?.case_sub_stage)?.title||s?.case_sub_stage||"--"})]}),e.jsx(c,{className:"px-4 py-1 border-r border-gray-200 2xl:text-sm text-xs font-normal",children:e.jsx("div",{className:"text-gray-700 break-words whitespace-pre-wrap line-clamp-2",children:s?.note})}),!x&&e.jsx(c,{className:"px-4 py-1",children:e.jsx(w,{className:"2xl:text-sm text-xs h-fit py-1 px-2 !shadow-none cursor-pointer bg-blue-50 text-black hover:bg-blue-100 border border-gray-200 rounded-md",onClick:()=>T(s.id),children:"View"})})]},a)}),R=N&&!m?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(z,{loading:N,message:"Loading Notes..."})}):o?.length>0?e.jsx("div",{className:"bg-white border border-gray-200 overflow-hidden",children:e.jsxs(F,{className:"w-full",children:[e.jsx(H,{children:e.jsxs(_,{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx(d,{className:"text-left w-32 font-normal px-4 py-2 border-r border-gray-200",children:"User Name"}),e.jsx(d,{className:"text-left font-normal px-4 py-2 border-r border-gray-200",children:"Title"}),e.jsx(d,{className:"text-left font-normal px-4 py-2 border-r border-gray-200",children:"Stage"}),e.jsx(d,{className:"text-left font-normal px-4 py-2 border-r border-gray-200",children:"Notes"}),!x&&e.jsx(d,{className:"text-left w-20 font-normal px-4 py-2",children:"Actions"})]})}),e.jsx(O,{children:M})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[e.jsx(Q,{className:"w-60 h-60 text-gray-400"}),e.jsx("span",{children:"No Case History Available"})]});return e.jsxs("div",{className:"border border-gray-300 flex flex-col h-[calc(100vh-132px)]",children:[e.jsx(K,{}),e.jsxs("div",{className:"flex flex-1 p-4 gap-2 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 relative overflow-auto",children:[R,m&&e.jsx("div",{className:"flex justify-center py-2",children:e.jsx("div",{children:"Loading Notes..."})})]}),n&&e.jsx("div",{className:`bg-gray-100 flex-shrink-0 overflow-auto transition-all duration-1500 ease-in-out ${x?"w-2/5 border-l border-gray-200":"w-0"}`,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-sm font-normal",children:[f?.created_by?.first_name," ",f?.created_by?.last_name]}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>h(null),className:"h-fit bg-red-200 text-red-400 text-sm rounded-none",children:"Close"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h2",{className:"text-base font-medium mb-2",children:f?.title}),e.jsx("div",{className:"text-gray-700",children:f?.note.split(`
`).map((s,a)=>e.jsx("div",{className:"text-black text-opacity-60 text-sm",children:s.trim()},a))})]})]})})]})]})};export{xe as S};
