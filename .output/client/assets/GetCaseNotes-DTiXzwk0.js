import{r as n,k as D,a as I,t as d,j as s,B as m}from"./main-Cfdx-166.js";import{U as _}from"./Provider-ByMBYsBJ.js";import{N as w}from"./notes-delete-icon-BGPvWUIE.js";import{N as k}from"./notes-edit-icon-DR2vjJ_2.js";import{i as P}from"./manage-N6m0a4Rv.js";import{u as R}from"./userDetails-BK07mqDr.js";import{i as E,f as A}from"./ManageCaseHeader-C-iqY6N9.js";import{u as B}from"./useMutation-B1DU5d2J.js";import{L as F}from"./loader-circle-CtVpcMqj.js";const Q=()=>{const[u,l]=n.useState(null),{fetchNextPage:o,hasNextPage:r,isFetchingNextPage:i,refetchCaseNotes:x,allRecords:c,setNotes:p,caseStagesData:f,notesId:N,setNotesId:h}=_(),g=D({strict:!1}).sub_stage,j=I(R,e=>e.user)?.id,{mutate:y}=B({mutationKey:["delete-note",N],mutationFn:async e=>{const t=await P(e);if(t.status===200||t.status===204)return t?.data;throw t},onSuccess:async()=>{d.success("Note Deleted Successfully",{action:{label:"âœ•",onClick:()=>d.dismiss()}}),x(),p(null)}}),a=n.useRef(null),b=n.useCallback(e=>{i||!r||(a.current&&a.current.disconnect(),a.current=new IntersectionObserver(t=>{t[0].isIntersecting&&r&&o()}),e&&a.current.observe(e))},[i,r,o]),v=E(f?.sub_stages,g),S=e=>{l(e),y(e,{onSettled:()=>{l(null)}})};return s.jsxs("div",{className:"space-y-3 mt-4 bg-gray-100 divide-y-2 divide-gray-200",children:[c?.map((e,t)=>s.jsxs("div",{ref:t===c.length-1?b:null,className:"space-y-1   p-2",children:[s.jsxs("div",{className:"flex justify-between gap-8",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:" text-sm  text-gray-600 ",children:["-",e?.created_by?.first_name," ",e?.created_by?.last_name,","]}),s.jsx("div",{className:"text-sm text-gray-600",children:e?.created_at&&A(e?.created_at)})]}),s.jsx("div",{className:"flex items-center justify-end",children:e?.created_by?.id===j&&!v&&s.jsxs("div",{children:[s.jsx(m,{className:"bg-transparent px-2 h-fit py-1 cursor-pointer",onClick:()=>{h(e?.id)},children:s.jsx(k,{className:"w-4 h-4 cursor-pointer"})}),s.jsx(m,{className:"bg-transparent px-2 h-fit py-1 cursor-pointer",onClick:()=>S(e?.id),disabled:u===e?.id,children:s.jsx(w,{className:"w-4 h-4 cursor-pointer"})})]})})]}),s.jsx("div",{className:"font-normal text-md ",children:e?.title}),s.jsx("div",{className:"text-sm text-gray-800",children:e?.note.split(`
`).map((C,U)=>s.jsx("p",{className:"",children:C}))})]},t)),c.length>0&&i&&s.jsx("div",{className:"text-center  flex items-center justify-center",children:s.jsx(F,{className:"w-4 h-4 animate-spin"})})]})};export{Q as G};
