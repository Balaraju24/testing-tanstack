import{b as o}from"./main-CbopZ6M6.js";const l=(n,t)=>{let e;return e=t.map(r=>`${n}=${r}`),e.join("&")},f=(n,t)=>{let r=Object.keys(t).map(a=>{const s=t[a];return s&&s.length?Array.isArray(s)?l(a,s):`${a}=${t[a]}`:s?`${a}=${t[a]}`:""}).filter(a=>a.length).filter(a=>a).join("&");return r?n+"?"+r:n};class y{authStatusCodes=[401,403,404];authErrorURLs=["/auth/signin-with-phone","/auth/signin-with-email"];_fetchType;constructor(t="json"){this._fetchType=t}configureAuthorization(t){let e=o.get("token")||"";t.headers.Authorization="Bearer "+e}setHeader(t){t.headers={}}setDefaultHeaders(t){t.headers=t.headers||{},t.headers["Content-Type"]||(t.headers["Content-Type"]="application/json")}checkToLogOutOrNot(t){return this.authErrorURLs.some(e=>t.includes(e))}isAuthRequest(t){return this.authErrorURLs.includes(t)}async refreshAccessToken(){const t=o.get("refreshToken");if(!t)return window.location.href="/",null;try{const e=await fetch("https://dev-api-b2b-nyatech.workr.in/v1.0/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(!e.ok)return o.remove("token"),o.remove("refreshToken"),window.location.href="/",null;const r=await e.json();return o.set("token",r.accessToken),r.accessToken}catch{return window.location.href="/",null}}async hit(...t){let[e,r]=t;r.headers=r.headers||{},r.headers["Content-Type"]||this.setDefaultHeaders(r),this.isAuthRequest(e)||this.configureAuthorization(r);let a="https://dev-api-b2b-nyatech.workr.in/v1.0"+e,s=await fetch(a,r);if(!s.ok){if(s.status===401&&!this.checkToLogOutOrNot(e)){const h=await this.refreshAccessToken();h&&(r.headers.Authorization="Bearer "+h,s=await fetch(a,r))}if(this.authStatusCodes.includes(s.status)&&!this.checkToLogOutOrNot(e)){const h=s.headers.get("Content-Type")||"";let u;try{u=h.includes("text/html")?await s.text():await s.json()}catch{u={message:s.statusText}}return{success:!1,status:s.status,data:u,message:s.statusText}}const d=s.headers.get("Content-Type")||"";let i;try{i=d.includes("text/html")?await s.text():await s.json()}catch{i={message:s.statusText}}let c=new Error(i.message||s.statusText);throw c.data=i,c.status=s.status,c}return this._fetchType==="response"?s:(s.headers.get("Content-Type")||"").includes("text/html")?{success:!0,status:s.status,data:await s.text()}:{success:!0,status:s.status,data:await s.json()}}async post(t,e){return await this.hit(t,{method:"POST",body:e?JSON.stringify(e):void 0})}async postFormData(t,e){return await this.hit(t,{method:"POST",body:e})}async get(t,e={},r){Object.keys(e).length&&(t=f(t,e));const a={method:"GET",headers:{}};return this.setDefaultHeaders(a),r&&(a.headers["Content-Type"]=r,a.headers.Accept=r),this.hit(t,a)}async delete(t,e={}){return this.hit(t,{method:"DELETE",body:JSON.stringify(e)})}async deleteWithOutPayload(t){return this.hit(t,{method:"DELETE"})}async put(t,e={}){return this.hit(t,{method:"PUT",body:JSON.stringify(e)})}async patch(t,e={}){return this.hit(t,{method:"PATCH",body:JSON.stringify(e)})}}const p=new y;export{p as $};
