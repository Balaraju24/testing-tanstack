import{u as ie,r as s,t as u,j as a,B as le}from"./main-CbopZ6M6.js";import{S as O}from"./SearchDropdown-BIeLOPsK.js";import{I as r}from"./input-BFw7NH1J.js";import{a as ce,c as me,b as pe}from"./legalOpinion-CVXYCweo.js";import{l as de,p as ue}from"./litigation-CPq33wDP.js";import{u as ge}from"./useUserPermissions-DqHuV15h.js";import{u as he}from"./useQuery-aXFamHAp.js";import{u as D}from"./useMutation-AZp6LET6.js";import{A as xe}from"./arrow-left-BV_RWyDU.js";import{C as ye}from"./check-CKzaR09m.js";import{L as fe}from"./loader-circle-CHBElFpm.js";import"./x-ClszbkRs.js";import"./createLucideIcon-2fvSvvVa.js";import"./search-ElaKESin.js";import"./chevron-down-DFI8aQgh.js";import"./fetch-BYBqU-UB.js";import"./legal-notice-icon-DY79a5uN.js";import"./userDetails-BKeSBteA.js";const be=()=>{const g=ie(),[n,i]=s.useState(""),[P,h]=s.useState(""),[x,M]=s.useState(""),[y,K]=s.useState(""),[o,f]=s.useState(""),[b,S]=s.useState(""),[T,l]=s.useState(""),[U,c]=s.useState(!1),[j,V]=s.useState(""),[m,A]=s.useState(""),[z,v]=s.useState(""),[$,L]=s.useState(""),[q,C]=s.useState(!1),[p,N]=s.useState({}),{isManager:w,isAdmin:_}=ge(),k=[...de,{value:"other",label:"Other (Please specify)"}],B=k.filter(e=>e.label.toLowerCase().includes(b.toLowerCase())||e.value.toLowerCase().includes(b.toLowerCase())),Z=[...ue,"Other (Please specify)"].filter(e=>e.toLowerCase().includes(z.toLowerCase())),{isLoading:H,data:Q}=he({queryKey:["organisation_name","location_id"],queryFn:async()=>{const e=await ce();if(e?.status===200||e?.status===201)return e?.data?.data},enabled:w()||_(),refetchOnWindowFocus:!1}),R=Q?.filter(e=>{const t=P.toLowerCase(),d=e.organisation_name.toLowerCase(),F=e.location.name.toLowerCase(),re=`${d} ${F}`;return d.includes(t)||F.includes(t)||re.includes(t)})||[],{mutate:W,isPending:I}=D({mutationFn:async e=>await me(e),onSuccess:e=>{u.success(e.data.message),g({to:"/legal-opinion"})},onError:e=>{e.status==422?N(e.data.errData):u.error(e.message||"Something went wrong.")}}),{mutate:G,isPending:E}=D({mutationFn:async e=>await pe(e),onSuccess:e=>{u.success(e.data.message),i(""),g({to:"/legal-opinion"})},onError:e=>{e.status==422?N(e.data.errData):u.error(e.message||"Something went wrong.")}}),J=()=>{const e=o==="other"?T:o,t=m==="other (please specify)"?$:m;w()||_()?G({case_type_acrym:"LO",customer_name:x,loan_type:e,property_type:t,loan_application_number:y,loan_amount:Number(j),service_id:1,location_id:n.location_id||"",organisation_name:n.organisation_name||"",user_id:n.id||""}):W({case_type_acrym:"LO",customer_name:x,loan_type:e,property_type:t,loan_application_number:y,loan_amount:Number(j),service_id:1})},X=e=>{i(e),h(`${e.organisation_name}`)},Y=e=>{h(e),n&&!`${n.organisation_name} ${n.location.name}`.toLowerCase().includes(e.toLowerCase())&&i("")},ee=()=>{i(""),h(""),N(e=>({...e,organisation_name:void 0}))},ae=e=>{f(e.value),S(e.label),e.value==="other"?c(!0):(c(!1),l(""))},te=e=>{S(e);const t=k.find(d=>d.value===o);t&&e!==t.label&&(f(""),c(!1),l(""))},se=()=>{f(""),S(""),c(!1),l("")},ne=e=>{const t=e.toLowerCase();A(t),v(e),t==="other (please specify)"?C(!0):(C(!1),L(""))},oe=()=>{A(""),v(""),C(!1),L("")};return a.jsx("div",{className:"flex flex-col h-[calc(100vh-120px)] justify-center items-center bg-white",children:a.jsx("div",{className:"flex justify-center items-center py-8",children:a.jsxs("div",{className:"w-full max-w-3xl px-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-8",children:[a.jsx("div",{className:"border border-gray-300 p-2 cursor-pointer hover:bg-gray-50 ",onClick:()=>g({to:"/legal-opinion"}),children:a.jsx(xe,{className:"h-4 w-6"})}),a.jsx("div",{children:a.jsx("h2",{className:"text-xl font-light text-amber-600",children:"Fill the details below"})}),a.jsx("div",{className:"w-12"})]}),a.jsxs("form",{className:"bg-white border border-gray-300 p-4 grid grid-cols-1 md:grid-cols-2 gap-6",children:[(w()||_())&&a.jsxs("div",{children:[a.jsxs("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:["Organization"," ",a.jsx("span",{className:"text-sm text-red-600",children:"*"})]}),a.jsx(O,{placeholder:"Search organization...",options:R,value:n,searchValue:P,onSearchChange:Y,onSelect:X,onClear:ee,getOptionLabel:e=>`${e.organisation_name} ${e.location.name}`,getOptionKey:e=>`${e.organisation_name}_${e.location.id||e.location.name}`,isSelected:e=>n&&n.organisation_name===e.organisation_name&&n.location.id===e.location.id,renderOption:(e,t)=>a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"flex gap-2",children:[e.organisation_name," "]}),t&&a.jsx(ye,{className:"h-4 w-4 text-green-600"})]}),isLoading:H,loadingText:"Loading organizations...",noOptionsText:"No organizations found"}),p?.organisation_name&&a.jsx("p",{className:"text-xs 3xl:text-sm text-red-500 font-medium",children:p?.organisation_name})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:["Customer Name"," ",a.jsx("span",{className:"text-sm text-red-600",children:"*"})]}),a.jsx(r,{placeholder:"Enter customer name",value:x,onChange:e=>{let t=e.target.value;t=t.charAt(0).toUpperCase()+t.slice(1),/^[A-Za-z_ ]*$/.test(t)&&M(t)},className:"rounded-none bg-slate-100"}),p?.customer_name&&a.jsx("p",{className:"text-xs 3xl:text-sm text-red-500 font-medium",children:p?.customer_name})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Loan Application Number"}),a.jsx(r,{placeholder:"Enter application number",value:y,onChange:e=>{let t=e.target.value;t=t.toUpperCase(),/^[A-Za-z0-9 -/]*$/.test(t)&&K(t)},className:"rounded-none bg-slate-100"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Type of Loan"}),a.jsx(O,{placeholder:"Search or select loan type...",options:B,value:o,searchValue:b,onSearchChange:te,onSelect:ae,onClear:se,getOptionLabel:e=>e.label,getOptionKey:e=>e.value,isSelected:e=>o===e.value}),U&&a.jsx("div",{className:"mt-2",children:a.jsx(r,{placeholder:"Please specify loan type...",value:T,onChange:e=>l(e.target.value),className:"rounded-none bg-slate-50"})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Loan Amount"}),a.jsx(r,{placeholder:"Enter loan amount",value:j,onChange:e=>{const t=e.target.value;/^\d{0,10}$/.test(t)&&V(t)},className:"rounded-none bg-slate-100"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Type of Property"}),a.jsx(O,{placeholder:"Search property type...",options:Z,value:m,searchValue:z,onSearchChange:v,onSelect:ne,onClear:oe,getOptionLabel:e=>e,getOptionKey:e=>e,isSelected:e=>m===e.toLowerCase(),width:"w-full",maxHeight:"max-h-40"}),q&&a.jsx("div",{className:"mt-2",children:a.jsx(r,{placeholder:"Please specify property type...",value:$,onChange:e=>L(e.target.value),className:"rounded-none bg-slate-50"})})]})]}),a.jsx("div",{className:"mt-6 flex justify-end",children:a.jsx(le,{className:"bg-black text-white hover:bg-gray-800 !rounded-none cursor-pointer",onClick:J,disabled:E||I,children:E||I?a.jsxs(a.Fragment,{children:["Submitting...",a.jsx(fe,{className:"animate-spin ml-1 h-4 w-4"})]}):"Submit"})})]})})})},Me=be;export{Me as component};
