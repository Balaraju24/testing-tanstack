import{j as e,B as j,h as se,r as h,k as te,t as n}from"./main-Cfdx-166.js";import{u as R}from"./useMutation-B1DU5d2J.js";import{u as ae}from"./index-BjReNNxi.js";import{g as ne}from"./DocsCommentsSection-BmQlyRR2.js";import{L as ie}from"./Loading-CBYA94ZU.js";import{f as oe,u as le,a as re,i as ce}from"./fileUpload-C5Dy2rVy.js";import{s as de}from"./manage-B5DlZb4f.js";import{D as I,a as L,b as T,c as A,f as ue,g as me}from"./dialog-Cl5SrRCX.js";import{F as _}from"./file-DgjstKY5.js";import{T as pe}from"./textarea-HR3ErcZs.js";import{L as z}from"./loader-Dypvt6yb.js";function fe({isOpen:u,setIsOpen:b,getFilePreview:v,selectedFile:g,handleCancelUpload:l,handleConfirmUpload:y}){return e.jsx(I,{open:u,onOpenChange:b,children:e.jsxs(L,{className:"sm:max-w-md bg-white",children:[e.jsxs(T,{children:[e.jsx(A,{children:"File Preview"}),e.jsx(ue,{children:"Review your file before uploading"})]}),e.jsx("div",{className:"py-4",children:v()}),e.jsxs(me,{children:[e.jsx(j,{variant:"outline",onClick:l,className:" text-red-500 h-7 py-1 px-3 rounded-none cursor-pointer",children:"Cancel"}),e.jsx(j,{onClick:y,className:"bg-black hover:bg-black font-normal text-white h-7 py-1 px-3 rounded-none cursor-pointer",children:"Upload"})]})]})})}const Ce=({refetch:u,documentId:b,category:v,loading2:g,setLoading2:l,children:y})=>{const{service_id:F}=se({strict:!1}),[i,w]=h.useState(null),[m,p]=h.useState(null),[N,C]=h.useState(null),[D,r]=h.useState(!1),[c,f]=h.useState(null),P=te({strict:!1}),E=P.stage,O=P.sub_stage,S=(s,a)=>{const t=s[0];if(t?.size>50*1024*1024){n.error("File size must be less than 50MB",{action:{label:"✕",onClick:()=>n.dismiss()}});return}a.length>0&&n.warning("Unsupported file type is uploaded",{action:{label:"✕",onClick:()=>n.dismiss()}}),w(t),C(null);const d=URL.createObjectURL(t);if(p(d),s[0]?.type==="application/pdf"){const o=new FileReader;o.onload=()=>{X(o.result)},o.readAsDataURL(t)}else f(d);r(!0)},M=s=>{const a=s.map(({file:t,errors:d})=>d.map(o=>o.code==="file-invalid-type"?`File "${t.name}" has an unsupported type.`:`File "${t.name}" was rejected. Reason: ${o.message}`)).flat().join(", ");n.message(a)},{getRootProps:B,getInputProps:K,open:V}=ae({onDrop:S,onDropRejected:M,accept:{"image/jpeg":[".jpeg",".jpg"],"image/png":[".png"],"image/webp":[".webp"],"application/pdf":[".pdf"]},multiple:!1,noClick:!0}),$=()=>{i&&J(i,b),r(!1)},H=()=>{w(null),m&&(URL.revokeObjectURL(m),p(null)),c&&(URL.revokeObjectURL(c),f(null)),r(!1)},J=(s,a)=>{W({file:s,documentId:a})},{mutate:W}=R({mutationFn:async({file:s,documentId:a})=>{l&&l(!0);const t=s.name.split(".").pop(),{data:d}=await oe({file_name:s.name,file_type:t,file_size:s.size}),{target_url:o,file_key:x}=d?.data;if(!o)throw new Error("Presigned URL is missing");return await q({url:o,file:s}),{documentId:a,file_name:s.name,file_type:t,file_size:s.size,key:x}},onSuccess:async({file_name:s,file_type:a,file_size:t,key:d,documentId:o})=>{const x={case_id:Number(F),file_name:s,file_type:a,file_size:t,key:d,case_stage:E,case_sub_stage:O,category:v};o?Q.mutate({documentId:o,payload:x}):G.mutate(x),m&&(URL.revokeObjectURL(m),p(null)),c&&(URL.revokeObjectURL(c),f(null))},onError:s=>{s.response?.status===422&&s.response?.data?.errData?.file_size?n.message(s.response.data.errData.file_size[0]):n.error("Failed to upload file.",{action:{label:"✕",onClick:()=>n.dismiss()}})}}),q=async({url:s,file:a})=>{try{const t=await le(s,a);if(!(t.status===200||t.status===201))throw t}catch{}},G=R({mutationFn:async s=>{try{const a=await re(s);if(a.data?.status===200||a.data?.status===201)return n.success("File uploaded successfully",{action:{label:"✕",onClick:()=>n.dismiss()}}),u(),a;throw new Error("Failed to upload ")}catch{n.error("Failed to upload.",{action:{label:"✕",onClick:()=>n.dismiss()}})}}}),Q=R({mutationFn:async({documentId:s,payload:a})=>{try{const t=await ce({docId:s,payload:a});if(t.data?.status===200||t.data?.status===201)return n.success("File uploaded successfully",{action:{label:"✕",onClick:()=>n.dismiss()}}),u(),t;throw new Error("Failed to update document")}catch{n.error("Failed to update document.",{action:{label:"✕",onClick:()=>n.dismiss()}})}}}),X=async s=>{try{const a=s.split(",")[1]||s,t=Uint8Array.from(atob(a),ee=>ee.charCodeAt(0)),x=await(await ne({data:t}).promise).getPage(1),U=x.getViewport({scale:1}),k=document.createElement("canvas"),Z=k.getContext("2d");k.width=U.width,k.height=U.height,await x.render({canvas:k,canvasContext:Z,viewport:U}).promise,f(k.toDataURL("image/png"))}catch(a){console.error("Error generating PDF thumbnail:",a)}},Y=()=>{if(!i||!m)return null;const s=i.type;return i.name,s.startsWith("image/")?e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("img",{src:m,alt:"Preview",className:"max-h-64 max-w-full object-contain"})}):s==="application/pdf"?e.jsx("div",{className:"flex flex-col items-center",children:c?e.jsx("img",{src:c,className:"w-80 h-80 object-contain",alt:"PDF Preview"}):e.jsxs("div",{className:"bg-gray-100 p-6 mt-4",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(_,{size:70})}),e.jsx("p",{className:"text-base mt-4",children:"No Preview Available"}),e.jsx("div",{className:"text-sm text-gray-500 flex items-center justify-center",children:i&&e.jsxs("p",{children:[Math.round(i.size/1024)," KB - PDF"]})})]})}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-sm flex items-center justify-center",children:de(i?.name,25)}),e.jsxs("div",{className:"bg-gray-100 p-6 mt-4",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(_,{size:70})}),e.jsx("p",{className:"text-base mt-4",children:"No Preview Available"}),e.jsx("div",{className:"text-sm text-gray-500 flex items-center justify-center",children:i&&e.jsxs("p",{children:[Math.round(i.size/1024)," KB -"," ",i.type.split("/")[1]?.toUpperCase()]})})]})]})};return e.jsxs("div",{id:"upload-attachments",className:"w-full",children:[e.jsx("div",{className:"w-full py-0 flex justify-between items-center",children:e.jsx(j,{type:"button",onClick:V,variant:"default",size:"default",className:"h-fit w-full px-0 [&_svg]:w-[unset] [&_svg]:h-[unset] py-0 text-sm bg-transparent rounded-none hover:bg-transparent cursor-pointer",children:y})}),e.jsxs("div",{children:[e.jsx("div",{...B(),className:"hidden",children:e.jsx("input",{...K()})}),N&&e.jsx("p",{className:"text-red-600 mt-2",children:N})]}),e.jsx(fe,{isOpen:D,setIsOpen:r,selectedFile:i,getFilePreview:Y,handleCancelUpload:H,handleConfirmUpload:$}),e.jsx(ie,{loading:g??!1,message:"Loading...",className:"bg-white"})]})},De=({removeConfirm:u,setRemoveConfirm:b,onCancel:v,onConfirm:g,isDeleteLoading:l,setApproveRejectReason:y,dialogType:F,appRejError:i,setAppRejError:w,isPending:m})=>{const[p,N]=h.useState(""),C=r=>{w("");const c=r.target.value,f=c.charAt(0).toUpperCase()+c.slice(1);N(f),y?.(f)},D=r=>{if(r.key==="Enter"&&!r.shiftKey&&p.length>0){if(r.preventDefault(),l||m)return;g()}};return h.useEffect(()=>{u||(N(""),w(""))},[u]),e.jsx(I,{open:u,onOpenChange:b,children:e.jsxs(L,{className:"sm:max-w-[350px] bg-white rounded-none !shadow-all font-primary","aria-describedby":void 0,children:[e.jsxs(T,{children:[e.jsxs("div",{className:"flex flex-col text-base 3xl:text-xl font-normal tracking-wide text-grey-600",children:[e.jsx(A,{children:e.jsxs("div",{className:"flex gap-2 items-end text-red-500",children:[" ","Rejection Notes"]})}),e.jsx(pe,{className:"flex-1 border rounded-none border-gray-200 h-40 resize-none text-sm 3xl:text-base font-normal mt-2 focus:!outline-none outline-none",value:p,onKeyDown:D,onChange:C,placeholder:"Rejection Reason"})]}),i&&e.jsx("p",{className:"text-red-500",children:i})]}),e.jsxs("div",{className:"flex justify-end gap-5 mt-4",children:[e.jsx(j,{variant:"outline",onClick:v,className:"bg-transparent cursor-pointer border rounded-none active:scale-95 duration-300 transition-all  text-red-500 font-medium text-sm 3xl:text-base px-4 py-0 h-8 outline-none focus:outline-none hover:bg-transparent",children:"Cancel"}),F?.verification_status==="REJECTED"?e.jsx(j,{onClick:g,disabled:p.length===0||l,className:"bg-black hover:bg-black cursor-pointer  text-white font-medium active:scale-95 duration-300 transition-all text-sm 3xl:text-base px-4 py-0 h-8 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0 focus-visible:ring-transparent focus:ring-none  outline-none focus:outline-none",children:l?e.jsx(z,{className:"animate-spin"}):"Confirm"}):e.jsx(j,{onClick:g,disabled:l,className:"bg-black hover:bg-black cursor-pointer  text-white font-medium text-sm 3xl:text-base px-4 py-0 h-8 rounded-none focus-visible:ring-0 focus-visible:ring-offset-0 focus-visible:ring-transparent focus:ring-none  outline-none focus:outline-none",children:l?e.jsx(z,{className:"animate-spin"}):"Confirm"})]})]})})};export{De as A,Ce as F};
