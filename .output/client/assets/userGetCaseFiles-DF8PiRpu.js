import{h as W,k as Y,r as c,t as y,j as s,B as Q}from"./main-CbopZ6M6.js";import{D as X}from"./DocsCommentsSection-w38vTm24.js";import{F as Z,U as ee}from"./upload-file-icon-Dizl9EAw.js";import{F as se,A as te}from"./approve-logo-Cvv-fgf8.js";import{F as A,A as ae}from"./ApproveRejectDialog-BF9KYNd2.js";import{U as re}from"./Provider-BC_HjP_o.js";import{A as oe}from"./complete-logo-BdyjTQM1.js";import{L as ne}from"./Loading-DliovM0z.js";import{A as ie}from"./approved-Icon-sUM8RCgD.js";import{E as le}from"./edit-icon-BWkv9_1B.js";import{R as ce}from"./reject-icon-DuJbt4iK.js";import{C as de,a as me,b as ue,c as pe}from"./card-Byeow1YH.js";import{D as xe,d as ge,a as fe,c as he,e as je}from"./dialog-fcNOpNe_.js";import{S as Ce}from"./separator-CIw6DZcG.js";import{b as ye,c as ve,e as be}from"./fileUpload-CyZu8moV.js";import{f as De}from"./manage-UYlebOZ2.js";import{i as we,g as _e,a as Se}from"./ManageCaseHeader-5m-OMl3k.js";import{s as Fe,f as Ne}from"./manage-Dtja-RKh.js";import{u as Ae}from"./useQuery-aXFamHAp.js";import{u as v}from"./useMutation-AZp6LET6.js";import{U as Pe}from"./userFileIcon-DAQMTY8-.js";import{X as Re}from"./x-ClszbkRs.js";const ts=()=>{const f=W({strict:!1}),b=Y({strict:!1}),[u,i]=c.useState(null),[D,P]=c.useState(""),[d,p]=c.useState(null),[w,R]=c.useState(""),[h,x]=c.useState(!1),[E,_]=c.useState(""),{caseStagesData:S,allRecords:j}=re(),g=b.stage,a=b.sub_stage,G=()=>i(null),U=()=>p(null),l=we(S?.sub_stages,a),F=_e(S?.sub_stages,a),O=(a==="CSFG#SGCP"||a==="CSFG#UDOC")&&!l,{isFetching:N,isLoading:I,data:o,refetch:n}=Ae({queryKey:["user-file-details",f?.service_id,g,a],queryFn:async({signal:e})=>{try{let t={};a==="ONBD#VKAC"||a==="CSFG#SGCP"||a==="CSFG#UDOC"?t={case_stage:a.split("#")[0],case_sub_stages:encodeURIComponent(a)}:t={case_stage:g,case_sub_stage:a&&encodeURIComponent(a),verification_status:"APPROVED"};const r=await De(f?.service_id,t,{signal:e});if(r.status===200||r.status===201){const m=r.data?.data?.records;return x(!1),m}else throw new Error("Failed to fetch documents")}catch(t){if(t.name==="AbortError")return;throw new Error("Failed to fetch case data")}},enabled:!!f?.service_id,refetchOnWindowFocus:!1}),{mutate:T,isPending:C}=v({mutationKey:["deleteFile"],mutationFn:async e=>{e=o?.find(r=>r.id===e)?.id;const t=await ye({docId:e,payload:{reason:D,case_stage:g,case_sub_stage:a}});if(t?.status==200||t?.status==201)return t?.data;throw t},onSuccess:e=>{y.success(e?.message),i(null),n()},onError:e=>{n()}}),{mutate:k,isPending:B}=v({mutationKey:["deletePlaceholder"],mutationFn:async e=>{e=o?.find(r=>r.id===e)?.id;const t=await ve({docId:e,payload:{reason:D}});if(t?.status==200||t?.status==201)return t?.data;throw t},onSuccess:e=>{y.success(e?.message),i(null),n(),P("")},onError:e=>{n()}}),{mutate:L,isPending:z}=v({mutationKey:["approve_reject_document"],mutationFn:async({docId:e,verification_status:t,notes:r})=>{e=o?.find(q=>q.id===e)?.id;let m={verification_status:t,case_stage:g,case_sub_stage:a,notes:void 0};return w!==""&&(m={...m,notes:w,type:t}),await be({payload:m,doc_id:e})},onSuccess:e=>{n(),y.success(e?.data?.message),p(null)},onError:e=>{_(e?.data?.errData?.notes[0])}}),H=e=>{p({docId:e.docId,verification_status:e.verification_status})},M=()=>{C||T(u?.id||"")},J=e=>{i(e)},K=e=>{i(e)},V=()=>{C||k(u?.id||"")},$=()=>{d&&L({...d,notes:d.notes??""})};return s.jsxs("div",{className:`${j?.length===0&&o?.length===0&&(!["CSFG#SGCP","CSFG#UDOC","CSCR#JUGC","CTPG#PYSC","CSCR#ORDC","ONBD#STFE"].includes(a)||["CSFG#SGCP","CSFG#UDOC"].includes(a)&&l)?"h-[calc(100%-20px)]":""}`,children:[N?s.jsx(ne,{loading:N,message:"Files...",className:"bg-white"}):!o||o?.length===0&&j?.length===0&&!["CSFG#SGCP","CSFG#UDOC","CSCR#JUGC","CTPG#PYSC","CSCR#ORDC","ONBD#STFE"].includes(a)||["CSFG#SGCP","CSFG#UDOC"].includes(a)&&l&&o?.length===0&&j?.length===0?s.jsx("div",{className:"col-span-full text-center text-base text-gray-600 3xl:text-base h-full flex items-center justify-center",children:l?`This stage is successfully completed. As the ${F} document is optional, it may not be uploaded by your Advocate.`:`${F} document will be uploaded by your Advocate.`}):s.jsx("div",{className:"w-full",children:!o&&!I?null:s.jsxs("div",{className:"grid grid-cols-2 2xl:grid-cols-3 3xl:grid-cols-4 gap-2",children:[Array.isArray(o)&&o.map(e=>{const t=e.file_type==="application/pdf"||e.file_type==="pdf"?"bg-[#F3F3F3]":"bg-gray-100";return s.jsxs("div",{className:"w-fit ",children:[s.jsx("div",{className:"text-sm text-gray-600",children:e.category?e.category:""}),e.download_url&&s.jsxs(de,{className:"w-56 rounded-none overflow-hidden border shadow-none border-gray-300",children:[s.jsxs(xe,{children:[s.jsx(ge,{className:"w-full",children:s.jsxs(me,{className:`${t} relative flex items-center p-0 space-y-0 justify-center min-h-28 w-full`,children:[s.jsxs("span",{className:"text-green-500 absolute top-3 right-3",children:[e?.verification_status==="APPROVED"&&s.jsx(ie,{}),e?.verification_status==="REJECTED"&&s.jsx(ce,{})]}),s.jsx(Q,{className:"flex items-center  cursor-pointer justify-center py-0 px-0 overflow-hidden w-full h-fit rounded-none border-none bg-transparent [&_svg]:size-14","aria-label":"View Image",children:s.jsx(Pe,{fileType:e.file_type,downloadUrl:e.download_url,fileName:e.file_name})})]})}),s.jsxs(fe,{className:"w-[90%] !p-1 gap-0 bg-white",children:[s.jsx(he,{}),s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsx("div",{className:"text-sm",children:e.file_name}),s.jsx(je,{className:"border-0 mt-0 h-fit p-1 [&_svg]:size-6  cursor-pointer",children:s.jsx(Re,{className:"stroke-red-500"})})]}),s.jsx("hr",{className:"mb-0 border-1 border-gray-300"}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("div",{className:"w-3/5 px-2 py-2 border-r border-gray-300 flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-end w-full gap-2",children:[e.category!=="Final Document"&&s.jsx("p",{className:e.verification_status==="REJECTED"?"bg-red-500 flex items-center  cursor-pointer hover:bg-red-500 text-xs px-4 py-2 text-white rounded-none font-primary":e.verification_status==="APPROVED"?"bg-green-500 h-7 hover:bg-green-500  cursor-pointer text-white-500 text-xs px-4 text-center py-1.5 text-white rounded-none font-primary":e.verification_status==="PENDING"?"bg-orange-500 h-7 hover:bg-orange-500  cursor-pointer text-white-500 text-xs px-4 py-1 text-white rounded-none font-primary":"bg-black h-7 hover:bg-black text-white-500  cursor-pointer text-xs px-4 py-1 text-white rounded-none font-primary",children:e.verification_status?e.verification_status.charAt(0).toUpperCase()+e.verification_status.slice(1).toLowerCase():""}),e.category!=="Final Document"&&s.jsx("div",{className:"w-[0.5px] h-9 bg-gray-300"}),s.jsx("div",{className:"",children:s.jsx(se,{file:{key:e.key,file_name:e.file_name}})})]}),s.jsx("div",{className:"flex",children:["image","jpg","jpeg","image/jpeg","image/png","gif","svg","png","webp"].includes(e.file_type)?s.jsx("img",{src:e.download_url,alt:"Full Image",className:"w-full h-[70vh] object-contain rounded-lg"}):s.jsx("iframe",{src:e.download_url,title:"Full Image",className:"w-full h-[70vh] object-contain rounded-lg"})})]}),s.jsx("div",{className:"w-2/5 h-full flex flex-col space-y-3",children:s.jsx(X,{documentId:e.id})})]})]})]}),s.jsxs(ue,{className:"flex flex-col px-2 py-1",children:[s.jsx("div",{className:"font-medium text-start text-xs cursor-pointer truncate w-full",title:e?.file_name,children:e?.file_name?Fe(e?.file_name,25):null}),s.jsx("div",{className:"text-xs font-light"})]}),s.jsxs(pe,{className:"w-full p-1.5 text-left flex justify-between items-center mt-0",children:[s.jsxs("div",{className:"text-gray-500 text-[10px] smd:text-[11px] 4xl:text-xs flex items-center gap-2",children:[Ne(e?.updated_at||e?.created_at),e.key&&s.jsxs("div",{children:[s.jsx(Ce,{orientation:"vertical",className:"h-3 bg-gray-500"}),Se(e.file_size),"MB"]})]}),s.jsx(Z,{file:e,onDeleteFile:J,onDeletePlaceHolder:K,rejAppDialog:H,getCaseFilesFetcher:n,loading2:h,setLoading2:x,isCurrentStageCompleted:l})]})]}),s.jsx("div",{className:"",children:e.category==="Client Document"&&e.verification_status==="REJECTED"&&!l&&s.jsx(A,{refetch:n,documentId:e.id,loading2:h,setLoading2:x,category:"Client Document",children:s.jsxs("div",{className:"flex gap-2 text-xs items-center mt-1 sm:mt-0 [&_svg]:size-4",children:[s.jsx(le,{className:""}),"Replace the Document"]})})})]},e.id)}),O&&s.jsx("div",{className:"w-fit rounded-none overflow-hidden space-y-1 h-fit",children:s.jsx(A,{refetch:n,setLoading2:x,loading2:h,children:s.jsxs("div",{className:"py-10  w-full border border-dashed bg-slate-100 border-gray-400 px-4 flex flex-col gap-2.5 items-center justify-center",children:[s.jsx(ee,{}),s.jsx("div",{className:"text-xs",children:"Drop Files here or Click to upload"}),s.jsx("div",{className:"text-[10px]",children:"Maximum file size:50MB"})]})})})]})}),s.jsxs(s.Fragment,{children:[s.jsx(oe,{icon:s.jsx(te,{}),open:!!u,onOpenChange:i,title:"Delete File",message:"Are you sure want to delete the file",onCancel:G,isPending:C||B,onConfirm:u?.category===null?M:V}),s.jsx(ae,{removeConfirm:!!d,setRemoveConfirm:()=>p(null),onCancel:U,onConfirm:$,isDeleteLoading:z,setApproveRejectReason:R,dialogType:d,appRejError:E,setAppRejError:_})]})]})};export{ts as U};
