import{j as e,r as d,t as u,B as P}from"./main-Cfdx-166.js";import{T as B}from"./TanstackTable-vIi7ShkO.js";import{L as G}from"./location-icon-BvhqtHAk.js";import{I as H}from"./input-DYbhqlvz.js";import{g as Q,e as X,C as Z,d as J,t as ee}from"./location-COFGmeCY.js";import{a as te}from"./app-BaxlpBql.js";import{u as se}from"./useQuery-JrEwn0HC.js";import{u as E}from"./useMutation-B1DU5d2J.js";import{u as ae}from"./index-FfAIZCaX.js";import{d as ie}from"./dayjs.min-CmsQqqGy.js";import{S as ne}from"./SearchFilter-CucxpMqz.js";import{D as oe}from"./delete-stroke-icon-Bw6hM1IS.js";import{L as S}from"./loader-circle-CtVpcMqj.js";import{O as re}from"./OverflowContentTooltip-DQomnG4W.js";import{P as ce}from"./pen-DPOfTKbd.js";import{X as le}from"./x-OEbIHzu5.js";import{P as W}from"./plus-CqTDA3jy.js";import"./NoDataBlock-gmsqOTLj.js";import"./no-cases-data-1cuEGLat.js";import"./useUserPermissions-EkOdBJwI.js";import"./userDetails-BK07mqDr.js";import"./noDataConstants-nJx6rPaL.js";import"./select-CFrWO_XW.js";import"./index-C_gXUdb4.js";import"./index-CHQA3myx.js";import"./index-DE95MUWf.js";import"./index-hzHaN75t.js";import"./index-Vwln1SHO.js";import"./index-BoybbV93.js";import"./index-CUHrv82z.js";import"./index-BBlAPqfG.js";import"./chevron-down-CCzDJ7wY.js";import"./createLucideIcon-BmLFQ-XG.js";import"./check-eR3old9D.js";import"./skeleton-CvqsTR7_.js";import"./chevron-right-B9rEYsY4.js";import"./fetch-B9iWZIk4.js";import"./search-BG32cvb7.js";import"./tooltip-Dk48ikt-.js";import"./index-DF_xtgj4.js";function de({status:f,toggleStatus:h,disabled:p=!1,disabledAll:m=!1,editDisable:c=!1,className:x=""}){const i=f==="Active",a=p||m||c,n=()=>{a||h()};return e.jsxs("div",{className:`flex items-center gap-2 ${x}`,children:[e.jsx("div",{onClick:n,className:`
          relative flex items-center justify-center w-10 h-5 rounded-full transition-all duration-300 ease-in-out
          ${a?"cursor-default":"cursor-pointer"}
          ${i?"bg-green-500":"bg-red-500"}
          ${a?"opacity-70":""}
        `,children:p?e.jsx(S,{className:"w-3 h-3 text-white animate-spin"}):e.jsx("div",{className:`
              absolute w-4 h-4 bg-white rounded-full shadow-md transition-transform duration-300 ease-in-out
              ${i?"translate-x-2.5":"-translate-x-2.5"}
            `})}),e.jsx("span",{className:`text-sm font-medium select-none ${i?"text-green-600":"text-red-500"} ${p||c?"opacity-70":""}`,children:i?"Active":"Inactive"})]})}function me({toggleStatus:f,deleteLocation:h,editLocation:p,deletingId:m,togglingId:c,editingLocation:x}){const i=x!==null;return[{accessorKey:"serial",id:"serial",cell:a=>e.jsx("div",{className:"text-white-700 text-sm font-normal pl-6",children:a.getValue()}),header:()=>e.jsx("div",{className:"text-white text-sm font-normal pl-6",children:"S No"}),size:80},{accessorKey:"name",id:"name",cell:a=>e.jsx(re,{text:a.getValue()}),header:()=>e.jsx("div",{className:"text-white text-sm font-normal pl-6",children:"Location Name"}),width:"190px",maxWidth:"190px",minWidth:"190px"},{accessorKey:"dateAdded",id:"dateAdded",cell:a=>e.jsx("div",{className:"text-gray-700 text-sm font-normal pl-6",children:a.getValue()}),header:()=>e.jsx("div",{className:"text-white text-sm font-normal pl-6",children:"Date Added"}),width:"130px",maxWidth:"100px",minWidth:"100px"},{accessorKey:"status",id:"status",cell:a=>{const n=a.getValue(),o=a.row.original,L=c===o.id,j=c!==null&&c!==o.id;return e.jsx("div",{className:"pl-6",children:e.jsx(de,{status:n,toggleStatus:()=>f(o.id),disabled:L,disabledAll:j,editDisable:i},`switch-${o.id}-${n}`)})},header:()=>e.jsx("div",{className:"text-white text-sm font-normal pl-6",children:"Status"}),width:"150px",maxWidth:"150px",minWidth:"150px"},{accessorFn:a=>a.actions,id:"actions",cell:a=>{const n=a.row.original,o=n.status==="Inactive";return e.jsxs("div",{className:"table-action-buttons flex space-x-3 items-center",children:[e.jsx("span",{onClick:()=>!o&&!i&&p(n),title:o||i?"":"Edit Location",className:`transition-colors ${o||i?"pointer-events-none text-gray-400":"hover:text-blue-600 cursor-pointer"}`,children:e.jsx(ce,{className:"size-4"})}),e.jsx("span",{onClick:()=>!o&&!i&&h(n.id),title:o||i?"":"Delete Location",className:`transition-colors ${o||i?"pointer-events-none":"hover:text-red-600 cursor-pointer"}`,children:m===n.id?e.jsx(S,{className:"size-4 text-black animate-spin"}):e.jsx(oe,{className:`size-4 ${o||i?"text-gray-400":"text-black"}`})})]})},header:()=>e.jsx("span",{className:"text-sm",children:"Actions"}),footer:a=>a.column.id,width:"100px",minWidth:"100px",maxWidth:"100px"}]}const ue=()=>{const f=ae(),h=new URLSearchParams(f.search),[p,m]=d.useState({}),[c,x]=d.useState(""),[i,a]=d.useState(null),[n,o]=d.useState({current_page:Number(h.get("page"))||1,page_size:Number(h.get("page_size"))||15}),[L,j]=d.useState(null),[b,I]=d.useState(null),[$,D]=d.useState({}),[v,F]=d.useState(""),[C,M]=d.useState(""),y=i!==null,{isLoading:K,data:k,refetch:A}=se({queryKey:["locations",n,C],queryFn:async()=>{const t={page:n.current_page,page_size:n.page_size,...C&&{search_string:C}},s=await Q(t);if(s.status===200||s.status===201){const{records:l,pagination_info:r}=s?.data?.data||{},N=l?.map(w=>({id:w.id,name:w.name,dateAdded:ie(w.created_at).format("DD MMM YYYY"),status:w.active?"Active":"Inactive"}))||[];return{records:te(N,r?.current_page||1,r?.page_size||15),pagination_info:r}}return{records:[],pagination_info:{}}},refetchOnWindowFocus:!1}),g=E({mutationFn:async({name:t,locationId:s})=>s?await X({locationId:s,payload:{name:t,id:s}}):await Z({name:t}),onSuccess:t=>{(t.status===200||t.status===201)&&(A(),_(),m({}))},onError:t=>{const s=t?.data?.errData||{};m(s?.name||{})}}),T=E({mutationFn:async t=>(j(t),(await J({locationId:t})).data),onSuccess:t=>{(t.status===200||t.status===201)&&(u.success("Location deleted successfully",{action:{label:"✕",onClick:()=>u.dismiss()}}),A())},onError:t=>{t.status===409&&u.error(t.message,{action:{label:"✕",onClick:()=>u.dismiss()}})},onSettled:()=>{j(null)}}),{mutate:U}=E({mutationFn:async({locationId:t,active:s})=>(I(t),D(r=>({...r,[t]:s?"Active":"Inactive"})),{response:await ee({locationId:t,payload:{active:s}}),locationId:t,active:s}),onSuccess:({response:t,locationId:s,active:l})=>{(t.status===200||t.status===201)&&(b===s&&u.success("Location status updated successfully",{action:{label:"✕",onClick:()=>u.dismiss()}}),A().finally(()=>{D(r=>{const N={...r};return delete N[s],N})}))},onError:(t,{locationId:s})=>{D(l=>{const r={...l};return delete r[s],r}),b===s&&u.error("Failed to update location status",{action:{label:"✕",onClick:()=>u.dismiss()}})},onSettled:()=>{I(null)}}),O=k?.records?.map(t=>({...t,status:$[t.id]||t.status}))||[],z=()=>{if(!c.trim()){m({0:"Location name is required"});return}g.mutate({name:c,locationId:i?.id})},R=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),g.mutate({name:c,locationId:i?.id}))},q=t=>{a(t),x(t.name),m({})},_=()=>{x(""),a(null),m({})},V=t=>{if(b===t)return;const s=k?.records?.find(l=>l.id===t);if(s){const r=($[t]||s.status)==="Inactive";U({locationId:t,active:r})}},Y=({page:t,page_size:s})=>{o({current_page:t,page_size:s})};return d.useEffect(()=>{const t=setTimeout(()=>{o(s=>({...s,current_page:v?s.current_page:1})),M(v)},1e3);return()=>clearTimeout(t)},[v]),e.jsxs("div",{className:"flex gap-2 bg-white",children:[e.jsx("div",{className:"w-96 flex-shrink-0 p-2",children:e.jsxs("div",{className:"bg-white rounded-sm border border-gray-300 p-3",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-6 border-b border-gray-200 pb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-black text-white flex items-center justify-center",children:e.jsx(G,{className:"w-8 h-8"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-normal text-gray-900",children:y?"Edit Location":"Add Location"}),e.jsx("p",{className:"text-xs text-gray-500",children:y?"Update the location details":"Create a new business location"})]}),y&&e.jsx("button",{onClick:_,className:"p-1 hover:bg-gray-100 rounded",title:"Cancel editing",children:e.jsx(le,{className:"w-4 h-4 text-gray-500"})})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-normal text-gray-500 mb-2",children:"Location"}),e.jsx(H,{type:"text",placeholder:"Enter location name",value:c,onChange:t=>{let s=t.target.value;s=s.charAt(0).toUpperCase()+s.slice(1),/^[A-Za-z0-9 -]*$/.test(s)&&x(s)},onKeyDown:R,className:"w-full h-10 text-sm bg-gray-100 border-gray-300 !rounded-none focus:border-gray-400 focus:ring-0"}),e.jsx("div",{className:"text-red-500 text-xs mt-1",children:e.jsx("p",{children:p[0]})})]}),y?e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(P,{onClick:z,disabled:g.isPending,className:"w-full h-10 bg-black cursor-pointer hover:bg-gray-800 text-white text-sm font-normal !rounded-none flex items-center justify-center gap-2",children:[g.isPending?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsx(W,{className:"w-4 h-4"}),"Update Location"]}),e.jsx(P,{onClick:_,variant:"outline",className:"w-full h-10 border-gray-300 text-gray-700 hover:bg-gray-50 text-sm font-normal !rounded-none",children:"Cancel"})]}):e.jsxs(P,{onClick:z,disabled:g.isPending,className:"w-full h-10 bg-black cursor-pointer hover:bg-gray-800 text-white text-sm font-normal !rounded-none flex items-center justify-center gap-2",children:[g.isPending?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsx(W,{className:"w-4 h-4"}),"Add Location"]})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden pl-0 mt-2",children:e.jsxs("div",{className:"bg-white rounded-sm border border-gray-300 flex flex-col px-2",children:[e.jsx("div",{className:"border-b border-gray-200 flex-shrink-0 py-2 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-sm font-normal text-gray-900",children:"Manage your business locations"}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(ne,{searchString:v,setSearchString:F,title:"Search by location"})})]})}),e.jsx("div",{className:"flex-1",children:e.jsx(B,{data:O,columns:me({toggleStatus:V,deleteLocation:T.mutate,editLocation:q,deletingId:L,togglingId:b,editingLocation:i}),paginationDetails:k?.pagination_info||{current_page:n.current_page,page_size:n.page_size,total_records:0,total_pages:1},getData:Y,loading:K,removeSortingForColumnIds:["serial","status","name","dateAdded","actions"],heightClass:"h-[calc(100vh-190px)] 3xl:h-[calc(100vh-184px)]",noDataLabel:"locations",noDataDescription:"Get started by creating your first Location",showNoDataIcon:!0,noDataHeight:"h-[calc(100vh-170px)]"})})]})})]})};function et(){return e.jsx("div",{children:e.jsx(ue,{})})}export{et as component};
